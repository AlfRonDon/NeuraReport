## 2025-11-10T16:31:47Z - v2

```json
{
  "id": "chatcmpl-CaP3iRNhQami6bK8ywGzhLk7TSytH",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "{\n  \"overview_md\": \"Executive Summary\\nThis report produces material-level consumption (Set vs Achieved) over a date range from recipes data, unpivoting bin1..bin12 into long form, grouping by trimmed material name, and computing row-level variances and overall totals. Optional filtering by recipe_code is applied; plant_name, location, print_date, page_no, and page_total are pass-through display parameters.\\n\\nToken Inventory\\nDynamic tokens present in the template:\\n- Scalars: plant_name, location, print_date, from_date, to_date, recipe_code, footer_company, page_no, page_total\\n- Row tokens: row_sl_no, row_material_name, row_set_wt, row_ach_wt, row_error_kg, row_error_pct\\n- Totals: total_set_wt, total_ach_wt, total_error_kg, total_error_pct\\n\\nMapping Table\\n- plant_name -> PARAM:plant_name\\n- location -> PARAM:location\\n- print_date -> PARAM:print_date\\n- from_date -> PARAM:from_date\\n- to_date -> PARAM:to_date\\n- recipe_code -> PARAM:recipe_code (used as an optional equality filter on recipes.recipe_name)\\n- footer_company -> PARAM:footer_company\\n- page_no -> PARAM:page_no\\n- page_total -> PARAM:page_total\\n- row_material_name -> MIN(TRIM(long_bins.material_name))\\n- row_set_wt -> SUM(long_bins.set_wt_kg)\\n- row_ach_wt -> SUM(long_bins.ach_wt_kg)\\n- row_error_kg -> SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)\\n- row_error_pct -> CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)) / SUM(long_bins.set_wt_kg) END\\n- row_sl_no -> ROW_NUMBER() OVER (ORDER BY UPPER(rows.row_material_name) ASC, rows.row_material_name ASC)\\n- total_set_wt -> SUM(rows.row_set_wt)\\n- total_ach_wt -> SUM(rows.row_ach_wt)\\n- total_error_kg -> SUM(rows.row_error_kg)\\n- total_error_pct -> SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0)\\n\\nJoin & Date Rules\\n- Tables: recipes (no joins to other tables).\\n- Date column: recipes.start_time. Apply inclusive range filter: start_time >= from_date AND start_time <= to_date.\\n- Optional filter: when recipe_code is provided and non-empty, apply recipes.recipe_name = recipe_code.\\n\\nTransformations\\n- Unpivot/Union: Create a long form (long_bins) by UNION ALL over recipes.bin1..bin12 for columns: content -> material_name; sp -> set_wt_kg; act -> ach_wt_kg. Use COALESCE for numeric weights and TRIM for names.\\n- Pre-aggregation filters: apply date range and optional recipe_code to the base recipes table. In long_bins, drop rows where TRIM(material_name) = ''.\\n- Rows dataset: group by normalized material name TRIM(long_bins.material_name); compute row_set_wt, row_ach_wt, row_error_kg, row_error_pct as above. Order rows case-insensitively by material name. Number rows using ROW_NUMBER() over the same ordering.\\n- Totals: compute as SUM across the rows dataset to stay consistent with row computations and filters.\\n\\nParameters\\n- Required: from_date (date), to_date (date). These drive the date range filter on recipes.start_time (inclusive).\\n- Optional: recipe_code (string) -> equality filter on recipes.recipe_name when non-empty; plant_name (string), location (string), print_date (date), page_no (integer), page_total (integer), footer_company (string) are pass-through for rendering only.\\n- Examples: from_date=2024-03-24, to_date=2024-03-24, recipe_code='GANGADHAR-2024'.\\n\\nChecklist for Step 5\\n- Use only recipes.* columns provided in the catalog.\\n- Build long_bins via UNION ALL of 12 bin columns with TRIM/COALESCE.\\n- Apply pre-aggregation filters: recipes.start_time between from_date and to_date (inclusive); optional recipes.recipe_name = recipe_code when non-empty; exclude blank material names (TRIM(name) <> '').\\n- Group rows by TRIM(long_bins.material_name). Compute row_error_kg and row_error_pct with NULLIF guards as specified.\\n- Stable ordering: ORDER BY UPPER(row_material_name) ASC, row_material_name ASC. Use the same ordering in row numbering.\\n- Totals are sums of the rows dataset; total_error_pct uses NULLIF on denominator.\\n- Map header/footer tokens to PARAMs; do not attempt to source them from DB.\\n- Ensure non-empty order_by.rows and rows ordering description matches SQL.\\n\",\n  \"step5_requirements\": {\n    \"datasets\": {\n      \"header\": {\n        \"description\": \"One-row header dataset\",\n        \"columns\": [\n          \"plant_name\",\n          \"location\",\n          \"print_date\",\n          \"from_date\",\n          \"to_date\",\n          \"recipe_code\",\n          \"footer_company\",\n          \"page_no\",\n          \"page_total\"\n        ]\n      },\n      \"rows\": {\n        \"description\": \"Detail rows dataset\",\n        \"columns\": [\n          \"row_sl_no\",\n          \"row_material_name\",\n          \"row_set_wt\",\n          \"row_ach_wt\",\n          \"row_error_kg\",\n          \"row_error_pct\"\n        ],\n        \"grouping\": [\n          \"Group by TRIM(long_bins.material_name); material names trimmed; blanks removed before grouping.\",\n          \"Row values computed with SUM over set/ach weights per grouped material.\"\n        ],\n        \"ordering\": [\n          \"Stable, case-insensitive by material name: ORDER BY UPPER(row_material_name) ASC, row_material_name ASC.\",\n          \"row_sl_no is ROW_NUMBER() over the same ORDER BY for deterministic numbering.\"\n        ]\n      },\n      \"totals\": {\n        \"description\": \"Aggregate totals dataset\",\n        \"columns\": [\n          \"total_set_wt\",\n          \"total_ach_wt\",\n          \"total_error_kg\",\n          \"total_error_pct\"\n        ]\n      }\n    },\n    \"semantics\": \"from_date and to_date are required and filter recipes.start_time inclusive; recipe_code is an optional equality filter on recipes.recipe_name applied only when provided and non-empty. plant_name, location, print_date, footer_company, page_no, page_total are pass-through display parameters and do not affect queries.\",\n    \"parameters\": {\n      \"required\": [\n        { \"name\": \"from_date\", \"type\": \"date\" },\n        { \"name\": \"to_date\", \"type\": \"date\" }\n      ],\n      \"optional\": [\n        { \"name\": \"recipe_code\", \"type\": \"string\" },\n        { \"name\": \"plant_name\", \"type\": \"string\" },\n        { \"name\": \"location\", \"type\": \"string\" },\n        { \"name\": \"print_date\", \"type\": \"date\" },\n        { \"name\": \"footer_company\", \"type\": \"string\" },\n        { \"name\": \"page_no\", \"type\": \"integer\" },\n        { \"name\": \"page_total\", \"type\": \"integer\" }\n      ]\n    },\n    \"transformations\": [\n      \"UNION ALL reshape long_bins from recipes: for each N in 1..12, select TRIM(recipes.binN_content) as material_name, COALESCE(recipes.binN_sp,0) as set_wt_kg, COALESCE(recipes.binN_act,0) as ach_wt_kg.\",\n      \"Apply filters to recipes before unpivot: start_time between from_date and to_date (inclusive); and recipes.recipe_name = recipe_code only when recipe_code is non-empty.\",\n      \"Drop long_bins rows with TRIM(material_name) = '' before aggregation.\",\n      \"Rows dataset: group by TRIM(material_name); compute row_set_wt = SUM(set_wt_kg), row_ach_wt = SUM(ach_wt_kg); row_error_kg = row_ach_wt - row_set_wt; row_error_pct = CASE WHEN row_set_wt = 0 THEN NULL ELSE row_error_kg / row_set_wt END.\",\n      \"Row numbering: row_sl_no = ROW_NUMBER() OVER (ORDER BY UPPER(row_material_name) ASC, row_material_name ASC).\",\n      \"Totals computed from rows: total_set_wt = SUM(rows.row_set_wt); total_ach_wt = SUM(rows.row_ach_wt); total_error_kg = SUM(rows.row_error_kg); total_error_pct = SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0).\"\n    ]\n  },\n  \"contract\": {\n    \"tokens\": {\n      \"scalars\": [\n        \"plant_name\",\n        \"location\",\n        \"print_date\",\n        \"from_date\",\n        \"to_date\",\n        \"recipe_code\",\n        \"footer_company\",\n        \"page_no\",\n        \"page_total\"\n      ],\n      \"row_tokens\": [\n        \"row_sl_no\",\n        \"row_material_name\",\n        \"row_set_wt\",\n        \"row_ach_wt\",\n        \"row_error_kg\",\n        \"row_error_pct\"\n      ],\n      \"totals\": [\n        \"total_set_wt\",\n        \"total_ach_wt\",\n        \"total_error_kg\",\n        \"total_error_pct\"\n      ]\n    },\n    \"mapping\": {\n      \"plant_name\": \"PARAM:plant_name\",\n      \"location\": \"PARAM:location\",\n      \"print_date\": \"PARAM:print_date\",\n      \"from_date\": \"PARAM:from_date\",\n      \"to_date\": \"PARAM:to_date\",\n      \"recipe_code\": \"PARAM:recipe_code\",\n      \"footer_company\": \"PARAM:footer_company\",\n      \"page_no\": \"PARAM:page_no\",\n      \"page_total\": \"PARAM:page_total\",\n      \"row_material_name\": \"MIN(TRIM(long_bins.material_name))\",\n      \"row_set_wt\": \"SUM(long_bins.set_wt_kg)\",\n      \"row_ach_wt\": \"SUM(long_bins.ach_wt_kg)\",\n      \"row_error_kg\": \"SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)\",\n      \"row_error_pct\": \"CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)) / SUM(long_bins.set_wt_kg) END\",\n      \"row_sl_no\": \"ROW_NUMBER() OVER (ORDER BY UPPER(rows.row_material_name) ASC, rows.row_material_name ASC)\",\n      \"total_set_wt\": \"SUM(rows.row_set_wt)\",\n      \"total_ach_wt\": \"SUM(rows.row_ach_wt)\",\n      \"total_error_kg\": \"SUM(rows.row_error_kg)\",\n      \"total_error_pct\": \"SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0)\"\n    },\n    \"unresolved\": [],\n    \"join\": {\n      \"parent_table\": \"recipes\",\n      \"parent_key\": null,\n      \"child_table\": null,\n      \"child_key\": null\n    },\n    \"date_columns\": { \"recipes\": \"start_time\" },\n    \"filters\": {\n      \"optional\": {\n        \"recipe_code\": \"recipes.recipe_name\"\n      }\n    },\n    \"reshape_rules\": [\n      {\n        \"purpose\": \"Produce rows dataset\",\n        \"strategy\": \"UNION_ALL\",\n        \"explain\": \"Union bin1..bin12 into long form; trim material names; drop blanks pre-aggregation.\",\n        \"columns\": [\n          {\n            \"as\": \"material_name\",\n            \"from\": [\n              \"recipes.bin1_content\",\n              \"recipes.bin2_content\",\n              \"recipes.bin3_content\",\n              \"recipes.bin4_content\",\n              \"recipes.bin5_content\",\n              \"recipes.bin6_content\",\n              \"recipes.bin7_content\",\n              \"recipes.bin8_content\",\n              \"recipes.bin9_content\",\n              \"recipes.bin10_content\",\n              \"recipes.bin11_content\",\n              \"recipes.bin12_content\"\n            ]\n          },\n          {\n            \"as\": \"set_wt_kg\",\n            \"from\": [\n              \"recipes.bin1_sp\",\n              \"recipes.bin2_sp\",\n              \"recipes.bin3_sp\",\n              \"recipes.bin4_sp\",\n              \"recipes.bin5_sp\",\n              \"recipes.bin6_sp\",\n              \"recipes.bin7_sp\",\n              \"recipes.bin8_sp\",\n              \"recipes.bin9_sp\",\n              \"recipes.bin10_sp\",\n              \"recipes.bin11_sp\",\n              \"recipes.bin12_sp\"\n            ]\n          },\n          {\n            \"as\": \"ach_wt_kg\",\n            \"from\": [\n              \"recipes.bin1_act\",\n              \"recipes.bin2_act\",\n              \"recipes.bin3_act\",\n              \"recipes.bin4_act\",\n              \"recipes.bin5_act\",\n              \"recipes.bin6_act\",\n              \"recipes.bin7_act\",\n              \"recipes.bin8_act\",\n              \"recipes.bin9_act\",\n              \"recipes.bin10_act\",\n              \"recipes.bin11_act\",\n              \"recipes.bin12_act\"\n            ]\n          }\n        ]\n      }\n    ],\n    \"row_computed\": {\n      \"row_error_kg\": \"SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)\",\n      \"row_error_pct\": \"CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)) / SUM(long_bins.set_wt_kg) END\"\n    },\n    \"totals_math\": {\n      \"total_set_wt\": \"SUM(rows.row_set_wt)\",\n      \"total_ach_wt\": \"SUM(rows.row_ach_wt)\",\n      \"total_error_kg\": \"SUM(rows.row_error_kg)\",\n      \"total_error_pct\": \"SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0)\"\n    },\n    \"formatters\": {\n      \"row_error_pct\": \"percent(2)\",\n      \"total_error_pct\": \"percent(2)\",\n      \"print_date\": \"date(YYYY-MM-DD)\"\n    },\n    \"order_by\": {\n      \"rows\": [\n        \"UPPER(row_material_name) ASC\",\n        \"row_material_name ASC\"\n      ]\n    },\n    \"notes\": \"All fields sourced from recipes table bins 1..12. TRIM material names; ignore blank names. Date range is inclusive on recipes.start_time. recipe_code matches recipes.recipe_name exactly when provided.\"\n  },\n  \"validation\": {\n    \"unknown_tokens\": [],\n    \"unknown_columns\": [],\n    \"token_coverage\": {\n      \"scalars_mapped_pct\": 100,\n      \"row_tokens_mapped_pct\": 100,\n      \"totals_mapped_pct\": 100\n    }\n  }\n}",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762792170,
  "model": "gpt-5-2025-08-07",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": null,
  "usage": {
    "completion_tokens": 8668,
    "prompt_tokens": 8477,
    "total_tokens": 17145,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 5440,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 0
    }
  }
}
```

## 2025-11-10T16:34:04Z - generator_assets_v1

```json
{
  "id": "chatcmpl-CaP5wdNCpGaW09wBYDeJl0E3wBbm2",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "{\n  \"contract\": {\n    \"tokens\": {\n      \"scalars\": [\n        \"plant_name\",\n        \"location\",\n        \"print_date\",\n        \"from_date\",\n        \"to_date\",\n        \"recipe_code\",\n        \"footer_company\",\n        \"page_no\",\n        \"page_total\"\n      ],\n      \"row_tokens\": [\n        \"row_sl_no\",\n        \"row_material_name\",\n        \"row_set_wt\",\n        \"row_ach_wt\",\n        \"row_error_kg\",\n        \"row_error_pct\"\n      ],\n      \"totals\": [\n        \"total_set_wt\",\n        \"total_ach_wt\",\n        \"total_error_kg\",\n        \"total_error_pct\"\n      ]\n    },\n    \"mapping\": {\n      \"plant_name\": \"PARAM:plant_name\",\n      \"location\": \"PARAM:location\",\n      \"print_date\": \"PARAM:print_date\",\n      \"from_date\": \"PARAM:from_date\",\n      \"to_date\": \"PARAM:to_date\",\n      \"recipe_code\": \"PARAM:recipe_code\",\n      \"footer_company\": \"PARAM:footer_company\",\n      \"page_no\": \"PARAM:page_no\",\n      \"page_total\": \"PARAM:page_total\",\n      \"row_material_name\": \"MIN(TRIM(long_bins.material_name))\",\n      \"row_set_wt\": \"SUM(long_bins.set_wt_kg)\",\n      \"row_ach_wt\": \"SUM(long_bins.ach_wt_kg)\",\n      \"row_error_kg\": \"SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)\",\n      \"row_error_pct\": \"CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)) / SUM(long_bins.set_wt_kg) END\",\n      \"row_sl_no\": \"ROW_NUMBER() OVER (ORDER BY UPPER(rows.row_material_name) ASC, rows.row_material_name ASC)\",\n      \"total_set_wt\": \"SUM(rows.row_set_wt)\",\n      \"total_ach_wt\": \"SUM(rows.row_ach_wt)\",\n      \"total_error_kg\": \"SUM(rows.row_error_kg)\",\n      \"total_error_pct\": \"SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0)\"\n    },\n    \"join\": {\n      \"parent_table\": \"recipes\",\n      \"parent_key\": \"\",\n      \"child_table\": \"recipes\",\n      \"child_key\": \"\"\n    },\n    \"date_columns\": {\n      \"recipes\": \"start_time\"\n    },\n    \"filters\": {\n      \"optional\": {\n        \"recipe_code\": \"recipes.recipe_name\"\n      }\n    },\n    \"reshape_rules\": [\n      {\n        \"purpose\": \"Produce rows dataset\",\n        \"strategy\": \"UNION_ALL\",\n        \"columns\": [\n          {\n            \"as\": \"material_name\",\n            \"from\": [\n              \"recipes.bin1_content\",\n              \"recipes.bin2_content\",\n              \"recipes.bin3_content\",\n              \"recipes.bin4_content\",\n              \"recipes.bin5_content\",\n              \"recipes.bin6_content\",\n              \"recipes.bin7_content\",\n              \"recipes.bin8_content\",\n              \"recipes.bin9_content\",\n              \"recipes.bin10_content\",\n              \"recipes.bin11_content\",\n              \"recipes.bin12_content\"\n            ]\n          },\n          {\n            \"as\": \"set_wt_kg\",\n            \"from\": [\n              \"recipes.bin1_sp\",\n              \"recipes.bin2_sp\",\n              \"recipes.bin3_sp\",\n              \"recipes.bin4_sp\",\n              \"recipes.bin5_sp\",\n              \"recipes.bin6_sp\",\n              \"recipes.bin7_sp\",\n              \"recipes.bin8_sp\",\n              \"recipes.bin9_sp\",\n              \"recipes.bin10_sp\",\n              \"recipes.bin11_sp\",\n              \"recipes.bin12_sp\"\n            ]\n          },\n          {\n            \"as\": \"ach_wt_kg\",\n            \"from\": [\n              \"recipes.bin1_act\",\n              \"recipes.bin2_act\",\n              \"recipes.bin3_act\",\n              \"recipes.bin4_act\",\n              \"recipes.bin5_act\",\n              \"recipes.bin6_act\",\n              \"recipes.bin7_act\",\n              \"recipes.bin8_act\",\n              \"recipes.bin9_act\",\n              \"recipes.bin10_act\",\n              \"recipes.bin11_act\",\n              \"recipes.bin12_act\"\n            ]\n          }\n        ],\n        \"order_by\": []\n      }\n    ],\n    \"row_computed\": {\n      \"row_error_kg\": \"SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)\",\n      \"row_error_pct\": \"CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)) / SUM(long_bins.set_wt_kg) END\"\n    },\n    \"totals_math\": {\n      \"total_set_wt\": \"SUM(rows.row_set_wt)\",\n      \"total_ach_wt\": \"SUM(rows.row_ach_wt)\",\n      \"total_error_kg\": \"SUM(rows.row_error_kg)\",\n      \"total_error_pct\": \"SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0)\"\n    },\n    \"formatters\": {\n      \"row_error_pct\": \"percent(2)\",\n      \"total_error_pct\": \"percent(2)\",\n      \"print_date\": \"date(YYYY-MM-DD)\"\n    },\n    \"order_by\": {\n      \"rows\": [\n        \"UPPER(row_material_name) ASC\",\n        \"row_material_name ASC\"\n      ]\n    },\n    \"row_order\": [\n      \"ROWID\"\n    ],\n    \"header_tokens\": [\n      \"plant_name\",\n      \"location\",\n      \"print_date\",\n      \"from_date\",\n      \"to_date\",\n      \"recipe_code\",\n      \"footer_company\",\n      \"page_no\",\n      \"page_total\"\n    ],\n    \"row_tokens\": [\n      \"row_sl_no\",\n      \"row_material_name\",\n      \"row_set_wt\",\n      \"row_ach_wt\",\n      \"row_error_kg\",\n      \"row_error_pct\"\n    ],\n    \"totals\": {\n      \"total_set_wt\": \"SUM(rows.row_set_wt)\",\n      \"total_ach_wt\": \"SUM(rows.row_ach_wt)\",\n      \"total_error_kg\": \"SUM(rows.row_error_kg)\",\n      \"total_error_pct\": \"SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0)\"\n    }\n  },\n  \"sql_pack\": {\n    \"dialect\": \"sqlite\",\n    \"script\": \"-- HEADER SELECT --\\nSELECT :plant_name AS plant_name,\\n       :location AS location,\\n       :print_date AS print_date,\\n       :from_date AS from_date,\\n       :to_date AS to_date,\\n       :recipe_code AS recipe_code,\\n       :footer_company AS footer_company,\\n       :page_no AS page_no,\\n       :page_total AS page_total\\n-- ROWS SELECT --\\nSELECT ROW_NUMBER() OVER (ORDER BY UPPER(rows.row_material_name) ASC, rows.row_material_name ASC) AS row_sl_no,\\n       MIN(TRIM(long_bins.material_name)) AS row_material_name,\\n       SUM(long_bins.set_wt_kg) AS row_set_wt,\\n       SUM(long_bins.ach_wt_kg) AS row_ach_wt,\\n       SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg) AS row_error_kg,\\n       CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)) / SUM(long_bins.set_wt_kg) END AS row_error_pct\\nFROM (\\n  SELECT TRIM(recipes.bin1_content) AS material_name, COALESCE(recipes.bin1_sp, 0) AS set_wt_kg, COALESCE(recipes.bin1_act, 0) AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin2_content), COALESCE(recipes.bin2_sp, 0), COALESCE(recipes.bin2_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin3_content), COALESCE(recipes.bin3_sp, 0), COALESCE(recipes.bin3_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin4_content), COALESCE(recipes.bin4_sp, 0), COALESCE(recipes.bin4_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin5_content), COALESCE(recipes.bin5_sp, 0), COALESCE(recipes.bin5_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin6_content), COALESCE(recipes.bin6_sp, 0), COALESCE(recipes.bin6_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin7_content), COALESCE(recipes.bin7_sp, 0), COALESCE(recipes.bin7_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin8_content), COALESCE(recipes.bin8_sp, 0), COALESCE(recipes.bin8_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin9_content), COALESCE(recipes.bin9_sp, 0), COALESCE(recipes.bin9_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin10_content), COALESCE(recipes.bin10_sp, 0), COALESCE(recipes.bin10_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin11_content), COALESCE(recipes.bin11_sp, 0), COALESCE(recipes.bin11_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin12_content), COALESCE(recipes.bin12_sp, 0), COALESCE(recipes.bin12_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n) long_bins\\nGROUP BY TRIM(long_bins.material_name)\\nORDER BY UPPER(row_material_name) ASC, row_material_name ASC\\n-- TOTALS SELECT --\\nSELECT SUM(rows.row_set_wt) AS total_set_wt,\\n       SUM(rows.row_ach_wt) AS total_ach_wt,\\n       SUM(rows.row_error_kg) AS total_error_kg,\\n       SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0) AS total_error_pct\\nFROM (\\n  SELECT ROW_NUMBER() OVER (ORDER BY UPPER(rows.row_material_name) ASC, rows.row_material_name ASC) AS row_sl_no,\\n         MIN(TRIM(long_bins.material_name)) AS row_material_name,\\n         SUM(long_bins.set_wt_kg) AS row_set_wt,\\n         SUM(long_bins.ach_wt_kg) AS row_ach_wt,\\n         SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg) AS row_error_kg,\\n         CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)) / SUM(long_bins.set_wt_kg) END AS row_error_pct\\n  FROM (\\n    SELECT TRIM(recipes.bin1_content) AS material_name, COALESCE(recipes.bin1_sp, 0) AS set_wt_kg, COALESCE(recipes.bin1_act, 0) AS ach_wt_kg\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin2_content), COALESCE(recipes.bin2_sp, 0), COALESCE(recipes.bin2_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin3_content), COALESCE(recipes.bin3_sp, 0), COALESCE(recipes.bin3_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin4_content), COALESCE(recipes.bin4_sp, 0), COALESCE(recipes.bin4_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin5_content), COALESCE(recipes.bin5_sp, 0), COALESCE(recipes.bin5_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin6_content), COALESCE(recipes.bin6_sp, 0), COALESCE(recipes.bin6_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin7_content), COALESCE(recipes.bin7_sp, 0), COALESCE(recipes.bin7_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin8_content), COALESCE(recipes.bin8_sp, 0), COALESCE(recipes.bin8_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin9_content), COALESCE(recipes.bin9_sp, 0), COALESCE(recipes.bin9_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin10_content), COALESCE(recipes.bin10_sp, 0), COALESCE(recipes.bin10_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin11_content), COALESCE(recipes.bin11_sp, 0), COALESCE(recipes.bin11_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin12_content), COALESCE(recipes.bin12_sp, 0), COALESCE(recipes.bin12_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  ) long_bins\\n  GROUP BY TRIM(long_bins.material_name)\\n  ORDER BY UPPER(row_material_name) ASC, row_material_name ASC\\n) rows\\n\",\n    \"entrypoints\": {\n      \"header\": \"SELECT :plant_name AS plant_name,\\n       :location AS location,\\n       :print_date AS print_date,\\n       :from_date AS from_date,\\n       :to_date AS to_date,\\n       :recipe_code AS recipe_code,\\n       :footer_company AS footer_company,\\n       :page_no AS page_no,\\n       :page_total AS page_total\",\n      \"rows\": \"SELECT ROW_NUMBER() OVER (ORDER BY UPPER(rows.row_material_name) ASC, rows.row_material_name ASC) AS row_sl_no,\\n       MIN(TRIM(long_bins.material_name)) AS row_material_name,\\n       SUM(long_bins.set_wt_kg) AS row_set_wt,\\n       SUM(long_bins.ach_wt_kg) AS row_ach_wt,\\n       SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg) AS row_error_kg,\\n       CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)) / SUM(long_bins.set_wt_kg) END AS row_error_pct\\nFROM (\\n  SELECT TRIM(recipes.bin1_content) AS material_name, COALESCE(recipes.bin1_sp, 0) AS set_wt_kg, COALESCE(recipes.bin1_act, 0) AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin2_content), COALESCE(recipes.bin2_sp, 0), COALESCE(recipes.bin2_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin3_content), COALESCE(recipes.bin3_sp, 0), COALESCE(recipes.bin3_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin4_content), COALESCE(recipes.bin4_sp, 0), COALESCE(recipes.bin4_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin5_content), COALESCE(recipes.bin5_sp, 0), COALESCE(recipes.bin5_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin6_content), COALESCE(recipes.bin6_sp, 0), COALESCE(recipes.bin6_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin7_content), COALESCE(recipes.bin7_sp, 0), COALESCE(recipes.bin7_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin8_content), COALESCE(recipes.bin8_sp, 0), COALESCE(recipes.bin8_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin9_content), COALESCE(recipes.bin9_sp, 0), COALESCE(recipes.bin9_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin10_content), COALESCE(recipes.bin10_sp, 0), COALESCE(recipes.bin10_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin11_content), COALESCE(recipes.bin11_sp, 0), COALESCE(recipes.bin11_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  UNION ALL\\n  SELECT TRIM(recipes.bin12_content), COALESCE(recipes.bin12_sp, 0), COALESCE(recipes.bin12_act, 0)\\n  FROM recipes\\n  WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n) long_bins\\nGROUP BY TRIM(long_bins.material_name)\\nORDER BY UPPER(row_material_name) ASC, row_material_name ASC\",\n      \"totals\": \"SELECT SUM(rows.row_set_wt) AS total_set_wt,\\n       SUM(rows.row_ach_wt) AS total_ach_wt,\\n       SUM(rows.row_error_kg) AS total_error_kg,\\n       SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0) AS total_error_pct\\nFROM (\\n  SELECT ROW_NUMBER() OVER (ORDER BY UPPER(rows.row_material_name) ASC, rows.row_material_name ASC) AS row_sl_no,\\n         MIN(TRIM(long_bins.material_name)) AS row_material_name,\\n         SUM(long_bins.set_wt_kg) AS row_set_wt,\\n         SUM(long_bins.ach_wt_kg) AS row_ach_wt,\\n         SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg) AS row_error_kg,\\n         CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)) / SUM(long_bins.set_wt_kg) END AS row_error_pct\\n  FROM (\\n    SELECT TRIM(recipes.bin1_content) AS material_name, COALESCE(recipes.bin1_sp, 0) AS set_wt_kg, COALESCE(recipes.bin1_act, 0) AS ach_wt_kg\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin2_content), COALESCE(recipes.bin2_sp, 0), COALESCE(recipes.bin2_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin3_content), COALESCE(recipes.bin3_sp, 0), COALESCE(recipes.bin3_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin4_content), COALESCE(recipes.bin4_sp, 0), COALESCE(recipes.bin4_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin5_content), COALESCE(recipes.bin5_sp, 0), COALESCE(recipes.bin5_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin6_content), COALESCE(recipes.bin6_sp, 0), COALESCE(recipes.bin6_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin7_content), COALESCE(recipes.bin7_sp, 0), COALESCE(recipes.bin7_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin8_content), COALESCE(recipes.bin8_sp, 0), COALESCE(recipes.bin8_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin9_content), COALESCE(recipes.bin9_sp, 0), COALESCE(recipes.bin9_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin10_content), COALESCE(recipes.bin10_sp, 0), COALESCE(recipes.bin10_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin11_content), COALESCE(recipes.bin11_sp, 0), COALESCE(recipes.bin11_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n    UNION ALL\\n    SELECT TRIM(recipes.bin12_content), COALESCE(recipes.bin12_sp, 0), COALESCE(recipes.bin12_act, 0)\\n    FROM recipes\\n    WHERE recipes.start_time >= :from_date AND recipes.start_time <= :to_date\\n  ) long_bins\\n  GROUP BY TRIM(long_bins.material_name)\\n  ORDER BY UPPER(row_material_name) ASC, row_material_name ASC\\n) rows\"\n    },\n    \"params\": {\n      \"required\": [\n        \"from_date\",\n        \"to_date\"\n      ],\n      \"optional\": [\n        \"recipe_code\",\n        \"plant_name\",\n        \"location\",\n        \"print_date\",\n        \"footer_company\",\n        \"page_no\",\n        \"page_total\"\n      ]\n    }\n  },\n  \"dialect\": \"sqlite\",\n  \"invalid\": false\n}",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762792308,
  "model": "gpt-4o-mini-2024-07-18",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": "fp_560af6e559",
  "usage": {
    "completion_tokens": 5596,
    "prompt_tokens": 7359,
    "total_tokens": 12955,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 0,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 0
    }
  }
}
```

## 2025-11-10T16:44:25Z - v2

```json
{
  "id": "chatcmpl-CaPFK9utrswDPMoAQS7DsFUGw9koj",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "{\n  \"overview_md\": \"Executive Summary\\nThe Consumption report aggregates recipe bin consumptions across a date range and a selected recipe code. It unpivots recipes.bin1..bin12 (content, set point, actual) into a long form, filters blanks, groups by trimmed material name, and computes per-material set/achieved weights, error (kg) and error (%). Totals are computed as sums over the rows dataset for consistency. Header values are mostly pass-through parameters; date filtering uses recipes.start_time, and recipe_code is a required equality filter.\\n\\nToken Inventory\\nScalars: plant_name, location, print_date, from_date, to_date, recipe_code, footer_company, page_no, page_total\\nRow tokens: row_sl_no, row_material_name, row_set_wt, row_ach_wt, row_error_kg, row_error_pct\\nTotals: total_set_wt, total_ach_wt, total_error_kg, total_error_pct\\n\\nMapping Table\\n| Token | Source |\\n|---|---|\\n| plant_name | PARAM:plant_name |\\n| location | PARAM:location |\\n| print_date | PARAM:print_date |\\n| from_date | PARAM:from_date |\\n| to_date | PARAM:to_date |\\n| recipe_code | PARAM:recipe_code |\\n| footer_company | 'Indian Industrial Machines Pvt. Ltd.' |\\n| page_no | PARAM:page_no |\\n| page_total | PARAM:page_total |\\n| row_sl_no | ROW_NUMBER() OVER (ORDER BY TRIM(long_bins.material_name) ASC) |\\n| row_material_name | TRIM(long_bins.material_name) |\\n| row_set_wt | SUM(long_bins.set_wt_kg) |\\n| row_ach_wt | SUM(long_bins.ach_wt_kg) |\\n| row_error_kg | SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg) |\\n| row_error_pct | CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg))/SUM(long_bins.set_wt_kg) END |\\n| total_set_wt | SUM(rows.row_set_wt) |\\n| total_ach_wt | SUM(rows.row_ach_wt) |\\n| total_error_kg | SUM(rows.row_error_kg) |\\n| total_error_pct | SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0) |\\n\\nJoin & Date Rules\\n- Tables: recipes (no joins; all columns from allow-list).\\n- Date column: recipes.start_time is the reporting timestamp.\\n- Filters: Apply BETWEEN from_date and to_date on recipes.start_time. Apply recipe_code equality to recipes.recipe_name. Filter recipes before unpivot.\\n\\nTransformations\\n- Unpivot/Union: Create long_bins by UNION ALL of 12 bin columns: material_name from recipes.bin{n}_content; set_wt_kg from recipes.bin{n}_sp; ach_wt_kg from recipes.bin{n}_act for n=1..12. Apply pre-aggregation filters: (a) TRIM(material_name) not empty, (b) at least one of set_wt_kg or ach_wt_kg non-null/non-zero.\\n- Grouping: Group long_bins by TRIM(material_name) to produce one row per material. Aggregate SUM(set_wt_kg) and SUM(ach_wt_kg); derive error_kg and error_pct with NULLIF/guard.\\n- Row numbering: Add row_sl_no using ROW_NUMBER() OVER (ORDER BY TRIM(material_name) ASC) in the outer select over grouped rows.\\n- Totals: Compute totals from the rows dataset to ensure consistency with filters and grouping.\\n\\nParameters\\n- Required: from_date (date), to_date (date), recipe_code (string). Required filters must be applied in header, rows, and totals entrypoints.\\n- Optional/pass-through: plant_name (string), location (string), print_date (date), page_no (integer), page_total (integer). Used only for display; not used in SQL filtering.\\n- Semantics:\\n  - Date range: Apply recipes.start_time BETWEEN from_date AND to_date when both provided; if only one bound is provided, apply that single-sided predicate.\\n  - recipe_code: Equality predicate recipes.recipe_name = :recipe_code; required.\\n\\nChecklist for Step 5\\n- Datasets:\\n  - header columns order: [plant_name, location, print_date, from_date, to_date, recipe_code, footer_company, page_no, page_total].\\n  - rows columns order: [row_sl_no, row_material_name, row_set_wt, row_ach_wt, row_error_kg, row_error_pct].\\n  - totals columns order: [total_set_wt, total_ach_wt, total_error_kg, total_error_pct].\\n- Apply filters to recipes before unpivot: date range on recipes.start_time and equality on recipes.recipe_name.\\n- Reshape: UNION ALL bin1..bin12 into long_bins(material_name, set_wt_kg, ach_wt_kg). Drop blank material names and zero-only lines before grouping.\\n- Group rows by TRIM(material_name). Order rows by row_material_name ASC for stable pagination. Use the same ordering for row_sl_no window function.\\n- Use NULLIF/CASE guards to avoid divide-by-zero in percentages.\\n- Totals must be computed by summing rows to match the presented detail.\\n\",\n  \"step5_requirements\": {\n    \"datasets\": {\n      \"header\": {\n        \"description\": \"One-row header dataset\",\n        \"columns\": [\n          \"plant_name\",\n          \"location\",\n          \"print_date\",\n          \"from_date\",\n          \"to_date\",\n          \"recipe_code\",\n          \"footer_company\",\n          \"page_no\",\n          \"page_total\"\n        ]\n      },\n      \"rows\": {\n        \"description\": \"Detail rows dataset\",\n        \"columns\": [\n          \"row_sl_no\",\n          \"row_material_name\",\n          \"row_set_wt\",\n          \"row_ach_wt\",\n          \"row_error_kg\",\n          \"row_error_pct\"\n        ],\n        \"grouping\": [\n          \"Group by TRIM(material_name) from long_bins to consolidate materials.\",\n          \"Deduplicate implicitly via GROUP BY; no additional dedup required.\"\n        ],\n        \"ordering\": [\n          \"Stable ascending by row_material_name (i.e., ORDER BY TRIM(material_name) ASC).\",\n          \"Use the same ordering inside ROW_NUMBER() to compute row_sl_no deterministically.\"\n        ]\n      },\n      \"totals\": {\n        \"description\": \"Aggregate totals dataset\",\n        \"columns\": [\n          \"total_set_wt\",\n          \"total_ach_wt\",\n          \"total_error_kg\",\n          \"total_error_pct\"\n        ]\n      }\n    },\n    \"semantics\": \"Required filters: recipe_code must match recipes.recipe_name; from_date/to_date constrain recipes.start_time. Optional/pass-through parameters (plant_name, location, print_date, page_no, page_total) are not used in SQL. Date range is inclusive; if only one bound is given, apply single-sided condition.\",\n    \"parameters\": {\n      \"required\": [\n        {\n          \"name\": \"from_date\",\n          \"type\": \"date\"\n        },\n        {\n          \"name\": \"to_date\",\n          \"type\": \"date\"\n        },\n        {\n          \"name\": \"recipe_code\",\n          \"type\": \"string\"\n        }\n      ],\n      \"optional\": [\n        {\n          \"name\": \"plant_name\",\n          \"type\": \"string\"\n        },\n        {\n          \"name\": \"location\",\n          \"type\": \"string\"\n        },\n        {\n          \"name\": \"print_date\",\n          \"type\": \"date\"\n        },\n        {\n          \"name\": \"page_no\",\n          \"type\": \"integer\"\n        },\n        {\n          \"name\": \"page_total\",\n          \"type\": \"integer\"\n        }\n      ]\n    },\n    \"transformations\": [\n      \"Build long_bins via UNION ALL over bin1..bin12: (material_name=recipes.binN_content, set_wt_kg=recipes.binN_sp, ach_wt_kg=recipes.binN_act).\",\n      \"Apply filters to recipes before UNION: recipes.start_time BETWEEN :from_date AND :to_date; recipes.recipe_name = :recipe_code.\",\n      \"Drop rows where TRIM(material_name) is empty OR COALESCE(set_wt_kg,0)=0 AND COALESCE(ach_wt_kg,0)=0.\",\n      \"Aggregate long_bins by TRIM(material_name) to compute row_set_wt=SUM(set_wt_kg), row_ach_wt=SUM(ach_wt_kg).\",\n      \"Compute row_error_kg = SUM(ach_wt_kg) - SUM(set_wt_kg).\",\n      \"Compute row_error_pct = CASE WHEN SUM(set_wt_kg)=0 THEN NULL ELSE (SUM(ach_wt_kg)-SUM(set_wt_kg))/SUM(set_wt_kg) END.\",\n      \"Add row_sl_no using ROW_NUMBER() OVER (ORDER BY TRIM(material_name) ASC) in the final select.\",\n      \"Totals computed as SUM over rows: total_set_wt, total_ach_wt, total_error_kg; and total_error_pct = total_error_kg / NULLIF(total_set_wt, 0).\"\n    ]\n  },\n  \"contract\": {\n    \"tokens\": {\n      \"scalars\": [\n        \"plant_name\",\n        \"location\",\n        \"print_date\",\n        \"from_date\",\n        \"to_date\",\n        \"recipe_code\",\n        \"footer_company\",\n        \"page_no\",\n        \"page_total\"\n      ],\n      \"row_tokens\": [\n        \"row_sl_no\",\n        \"row_material_name\",\n        \"row_set_wt\",\n        \"row_ach_wt\",\n        \"row_error_kg\",\n        \"row_error_pct\"\n      ],\n      \"totals\": [\n        \"total_set_wt\",\n        \"total_ach_wt\",\n        \"total_error_kg\",\n        \"total_error_pct\"\n      ]\n    },\n    \"mapping\": {\n      \"plant_name\": \"PARAM:plant_name\",\n      \"location\": \"PARAM:location\",\n      \"print_date\": \"PARAM:print_date\",\n      \"from_date\": \"PARAM:from_date\",\n      \"to_date\": \"PARAM:to_date\",\n      \"recipe_code\": \"PARAM:recipe_code\",\n      \"footer_company\": \"'Indian Industrial Machines Pvt. Ltd.'\",\n      \"page_no\": \"PARAM:page_no\",\n      \"page_total\": \"PARAM:page_total\",\n      \"row_sl_no\": \"ROW_NUMBER() OVER (ORDER BY TRIM(long_bins.material_name) ASC)\",\n      \"row_material_name\": \"TRIM(long_bins.material_name)\",\n      \"row_set_wt\": \"SUM(long_bins.set_wt_kg)\",\n      \"row_ach_wt\": \"SUM(long_bins.ach_wt_kg)\",\n      \"row_error_kg\": \"SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)\",\n      \"row_error_pct\": \"CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg))/SUM(long_bins.set_wt_kg) END\",\n      \"total_set_wt\": \"SUM(rows.row_set_wt)\",\n      \"total_ach_wt\": \"SUM(rows.row_ach_wt)\",\n      \"total_error_kg\": \"SUM(rows.row_error_kg)\",\n      \"total_error_pct\": \"SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0)\"\n    },\n    \"unresolved\": [],\n    \"join\": {\n      \"parent_table\": \"recipes\",\n      \"parent_key\": \"id\",\n      \"child_table\": null,\n      \"child_key\": null\n    },\n    \"date_columns\": {\n      \"recipes\": \"start_time\"\n    },\n    \"filters\": {\n      \"required\": {\n        \"recipe_code\": \"recipes.recipe_name\"\n      },\n      \"optional\": {\n        \"from_date\": \"recipes.start_time\",\n        \"to_date\": \"recipes.start_time\"\n      }\n    },\n    \"reshape_rules\": [\n      {\n        \"purpose\": \"Produce rows dataset\",\n        \"strategy\": \"UNION_ALL\",\n        \"explain\": \"Union bin1..bin12 columns into long form, trim material names, drop blanks/zero-only before grouping\",\n        \"columns\": [\n          {\n            \"as\": \"material_name\",\n            \"from\": [\n              \"recipes.bin1_content\",\n              \"recipes.bin2_content\",\n              \"recipes.bin3_content\",\n              \"recipes.bin4_content\",\n              \"recipes.bin5_content\",\n              \"recipes.bin6_content\",\n              \"recipes.bin7_content\",\n              \"recipes.bin8_content\",\n              \"recipes.bin9_content\",\n              \"recipes.bin10_content\",\n              \"recipes.bin11_content\",\n              \"recipes.bin12_content\"\n            ]\n          },\n          {\n            \"as\": \"set_wt_kg\",\n            \"from\": [\n              \"recipes.bin1_sp\",\n              \"recipes.bin2_sp\",\n              \"recipes.bin3_sp\",\n              \"recipes.bin4_sp\",\n              \"recipes.bin5_sp\",\n              \"recipes.bin6_sp\",\n              \"recipes.bin7_sp\",\n              \"recipes.bin8_sp\",\n              \"recipes.bin9_sp\",\n              \"recipes.bin10_sp\",\n              \"recipes.bin11_sp\",\n              \"recipes.bin12_sp\"\n            ]\n          },\n          {\n            \"as\": \"ach_wt_kg\",\n            \"from\": [\n              \"recipes.bin1_act\",\n              \"recipes.bin2_act\",\n              \"recipes.bin3_act\",\n              \"recipes.bin4_act\",\n              \"recipes.bin5_act\",\n              \"recipes.bin6_act\",\n              \"recipes.bin7_act\",\n              \"recipes.bin8_act\",\n              \"recipes.bin9_act\",\n              \"recipes.bin10_act\",\n              \"recipes.bin11_act\",\n              \"recipes.bin12_act\"\n            ]\n          }\n        ],\n        \"pre_filters\": [\n          \"recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date\",\n          \"recipes.recipe_name = PARAM:recipe_code\"\n        ],\n        \"row_filters\": [\n          \"NULLIF(TRIM(material_name), '') IS NOT NULL\",\n          \"NOT (COALESCE(set_wt_kg, 0)=0 AND COALESCE(ach_wt_kg, 0)=0)\"\n        ],\n        \"group_by\": [\n          \"TRIM(material_name)\"\n        ],\n        \"ordering\": [\n          \"TRIM(material_name) ASC\"\n        ]\n      }\n    ],\n    \"row_computed\": {\n      \"row_error_kg\": \"SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)\",\n      \"row_error_pct\": \"CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg))/SUM(long_bins.set_wt_kg) END\"\n    },\n    \"totals_math\": {\n      \"total_set_wt\": \"SUM(rows.row_set_wt)\",\n      \"total_ach_wt\": \"SUM(rows.row_ach_wt)\",\n      \"total_error_kg\": \"SUM(rows.row_error_kg)\",\n      \"total_error_percent\": \"SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0)\"\n    },\n    \"formatters\": {\n      \"row_error_pct\": \"percent(2)\",\n      \"total_error_pct\": \"percent(2)\",\n      \"print_date\": \"date(DD/MM/YYYY)\"\n    },\n    \"order_by\": {\n      \"rows\": [\n        \"row_material_name ASC\"\n      ]\n    },\n    \"notes\": \"Compute rows by unpivoting 12 recipe bins, filter blanks/zeros pre-aggregation, group by trimmed material name, and order alphabetically. Apply required recipe_code equality and date range on recipes.start_time to all entrypoints.\"\n  },\n  \"validation\": {\n    \"unknown_tokens\": [],\n    \"unknown_columns\": [],\n    \"token_coverage\": {\n      \"scalars_mapped_pct\": 100,\n      \"row_tokens_mapped_pct\": 100,\n      \"totals_mapped_pct\": 100\n    }\n  }\n}",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762792890,
  "model": "gpt-5-2025-08-07",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": null,
  "usage": {
    "completion_tokens": 9370,
    "prompt_tokens": 7989,
    "total_tokens": 17359,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 5888,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 0
    }
  }
}
```

## 2025-11-10T16:46:44Z - generator_assets_v1

```json
{
  "id": "chatcmpl-CaPIAuQbvNVxoGNztMknJVLuq9ss2",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "{\n  \"contract\": {\n    \"tokens\": {\n      \"scalars\": [\n        \"plant_name\",\n        \"location\",\n        \"print_date\",\n        \"from_date\",\n        \"to_date\",\n        \"recipe_code\",\n        \"footer_company\",\n        \"page_no\",\n        \"page_total\"\n      ],\n      \"row_tokens\": [\n        \"row_sl_no\",\n        \"row_material_name\",\n        \"row_set_wt\",\n        \"row_ach_wt\",\n        \"row_error_kg\",\n        \"row_error_pct\"\n      ],\n      \"totals\": [\n        \"total_set_wt\",\n        \"total_ach_wt\",\n        \"total_error_kg\",\n        \"total_error_pct\"\n      ]\n    },\n    \"mapping\": {\n      \"plant_name\": \"PARAM:plant_name\",\n      \"location\": \"PARAM:location\",\n      \"print_date\": \"PARAM:print_date\",\n      \"from_date\": \"PARAM:from_date\",\n      \"to_date\": \"PARAM:to_date\",\n      \"recipe_code\": \"PARAM:recipe_code\",\n      \"footer_company\": \"'Indian Industrial Machines Pvt. Ltd.'\",\n      \"page_no\": \"PARAM:page_no\",\n      \"page_total\": \"PARAM:page_total\",\n      \"row_sl_no\": \"ROW_NUMBER() OVER (ORDER BY TRIM(long_bins.material_name) ASC)\",\n      \"row_material_name\": \"TRIM(long_bins.material_name)\",\n      \"row_set_wt\": \"SUM(long_bins.set_wt_kg)\",\n      \"row_ach_wt\": \"SUM(long_bins.ach_wt_kg)\",\n      \"row_error_kg\": \"SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)\",\n      \"row_error_pct\": \"CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg))/SUM(long_bins.set_wt_kg) END\",\n      \"total_set_wt\": \"SUM(rows.row_set_wt)\",\n      \"total_ach_wt\": \"SUM(rows.row_ach_wt)\",\n      \"total_error_kg\": \"SUM(rows.row_error_kg)\",\n      \"total_error_pct\": \"SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0)\"\n    },\n    \"join\": {\n      \"parent_table\": \"recipes\",\n      \"parent_key\": \"id\",\n      \"child_table\": \"recipes\",\n      \"child_key\": \"id\"\n    },\n    \"date_columns\": {\n      \"recipes\": \"start_time\"\n    },\n    \"filters\": {\n      \"required\": {\n        \"recipe_code\": \"recipes.recipe_name\"\n      },\n      \"optional\": {\n        \"from_date\": \"recipes.start_time\",\n        \"to_date\": \"recipes.start_time\"\n      }\n    },\n    \"reshape_rules\": [\n      {\n        \"purpose\": \"Produce rows dataset\",\n        \"strategy\": \"UNION_ALL\",\n        \"explain\": \"Union bin1..bin12 columns into long form, trim material names, drop blanks/zero-only before grouping\",\n        \"columns\": [\n          {\n            \"as\": \"material_name\",\n            \"from\": [\n              \"recipes.bin1_content\",\n              \"recipes.bin2_content\",\n              \"recipes.bin3_content\",\n              \"recipes.bin4_content\",\n              \"recipes.bin5_content\",\n              \"recipes.bin6_content\",\n              \"recipes.bin7_content\",\n              \"recipes.bin8_content\",\n              \"recipes.bin9_content\",\n              \"recipes.bin10_content\",\n              \"recipes.bin11_content\",\n              \"recipes.bin12_content\"\n            ]\n          },\n          {\n            \"as\": \"set_wt_kg\",\n            \"from\": [\n              \"recipes.bin1_sp\",\n              \"recipes.bin2_sp\",\n              \"recipes.bin3_sp\",\n              \"recipes.bin4_sp\",\n              \"recipes.bin5_sp\",\n              \"recipes.bin6_sp\",\n              \"recipes.bin7_sp\",\n              \"recipes.bin8_sp\",\n              \"recipes.bin9_sp\",\n              \"recipes.bin10_sp\",\n              \"recipes.bin11_sp\",\n              \"recipes.bin12_sp\"\n            ]\n          },\n          {\n            \"as\": \"ach_wt_kg\",\n            \"from\": [\n              \"recipes.bin1_act\",\n              \"recipes.bin2_act\",\n              \"recipes.bin3_act\",\n              \"recipes.bin4_act\",\n              \"recipes.bin5_act\",\n              \"recipes.bin6_act\",\n              \"recipes.bin7_act\",\n              \"recipes.bin8_act\",\n              \"recipes.bin9_act\",\n              \"recipes.bin10_act\",\n              \"recipes.bin11_act\",\n              \"recipes.bin12_act\"\n            ]\n          }\n        ],\n        \"pre_filters\": [\n          \"recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date\",\n          \"recipes.recipe_name = PARAM:recipe_code\"\n        ],\n        \"row_filters\": [\n          \"NULLIF(TRIM(material_name), '') IS NOT NULL\",\n          \"NOT (COALESCE(set_wt_kg, 0)=0 AND COALESCE(ach_wt_kg, 0)=0)\"\n        ],\n        \"group_by\": [\n          \"TRIM(material_name)\"\n        ],\n        \"ordering\": [\n          \"TRIM(material_name) ASC\"\n        ],\n        \"order_by\": []\n      }\n    ],\n    \"row_computed\": {\n      \"row_error_kg\": \"SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)\",\n      \"row_error_pct\": \"CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg))/SUM(long_bins.set_wt_kg) END\"\n    },\n    \"totals_math\": {\n      \"total_set_wt\": \"SUM(rows.row_set_wt)\",\n      \"total_ach_wt\": \"SUM(rows.row_ach_wt)\",\n      \"total_error_kg\": \"SUM(rows.row_error_kg)\",\n      \"total_error_pct\": \"SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0)\"\n    },\n    \"formatters\": {\n      \"row_error_pct\": \"percent(2)\",\n      \"total_error_pct\": \"percent(2)\",\n      \"print_date\": \"date(DD/MM/YYYY)\"\n    },\n    \"order_by\": {\n      \"rows\": [\n        \"row_material_name ASC\"\n      ]\n    },\n    \"header_tokens\": [\n      \"plant_name\",\n      \"location\",\n      \"print_date\",\n      \"from_date\",\n      \"to_date\",\n      \"recipe_code\",\n      \"footer_company\",\n      \"page_no\",\n      \"page_total\"\n    ],\n    \"row_tokens\": [\n      \"row_sl_no\",\n      \"row_material_name\",\n      \"row_set_wt\",\n      \"row_ach_wt\",\n      \"row_error_kg\",\n      \"row_error_pct\"\n    ],\n    \"totals\": {\n      \"total_set_wt\": \"SUM(rows.row_set_wt)\",\n      \"total_ach_wt\": \"SUM(rows.row_ach_wt)\",\n      \"total_error_kg\": \"SUM(rows.row_error_kg)\",\n      \"total_error_pct\": \"SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0)\"\n    },\n    \"row_order\": [\n      \"ROWID\"\n    ]\n  },\n  \"sql_pack\": {\n    \"dialect\": \"sqlite\",\n    \"script\": \"-- HEADER SELECT --\\nSELECT PARAM:plant_name AS plant_name, PARAM:location AS location, PARAM:print_date AS print_date, PARAM:from_date AS from_date, PARAM:to_date AS to_date, PARAM:recipe_code AS recipe_code, 'Indian Industrial Machines Pvt. Ltd.' AS footer_company, PARAM:page_no AS page_no, PARAM:page_total AS page_total\\n-- ROWS SELECT --\\nSELECT ROW_NUMBER() OVER (ORDER BY TRIM(long_bins.material_name) ASC) AS row_sl_no, TRIM(long_bins.material_name) AS row_material_name, SUM(long_bins.set_wt_kg) AS row_set_wt, SUM(long_bins.ach_wt_kg) AS row_ach_wt, SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg) AS row_error_kg, CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg))/SUM(long_bins.set_wt_kg) END AS row_error_pct FROM (SELECT TRIM(recipes.bin1_content) AS material_name, recipes.bin1_sp AS set_wt_kg, recipes.bin1_act AS ach_wt_kg FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin2_content), recipes.bin2_sp, recipes.bin2_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin3_content), recipes.bin3_sp, recipes.bin3_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin4_content), recipes.bin4_sp, recipes.bin4_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin5_content), recipes.bin5_sp, recipes.bin5_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin6_content), recipes.bin6_sp, recipes.bin6_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin7_content), recipes.bin7_sp, recipes.bin7_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin8_content), recipes.bin8_sp, recipes.bin8_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin9_content), recipes.bin9_sp, recipes.bin9_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin10_content), recipes.bin10_sp, recipes.bin10_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin11_content), recipes.bin11_sp, recipes.bin11_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin12_content), recipes.bin12_sp, recipes.bin12_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code) AS long_bins WHERE NULLIF(TRIM(material_name), '') IS NOT NULL AND NOT (COALESCE(set_wt_kg, 0)=0 AND COALESCE(ach_wt_kg, 0)=0) GROUP BY TRIM(material_name) ORDER BY TRIM(material_name) ASC\\n-- TOTALS SELECT --\\nSELECT SUM(rows.row_set_wt) AS total_set_wt, SUM(rows.row_ach_wt) AS total_ach_wt, SUM(rows.row_error_kg) AS total_error_kg, SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0) AS total_error_pct FROM (SELECT ROW_NUMBER() OVER (ORDER BY TRIM(long_bins.material_name) ASC) AS row_sl_no, TRIM(long_bins.material_name) AS row_material_name, SUM(long_bins.set_wt_kg) AS row_set_wt, SUM(long_bins.ach_wt_kg) AS row_ach_wt, SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg) AS row_error_kg, CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg))/SUM(long_bins.set_wt_kg) END AS row_error_pct FROM (SELECT TRIM(recipes.bin1_content) AS material_name, recipes.bin1_sp AS set_wt_kg, recipes.bin1_act AS ach_wt_kg FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin2_content), recipes.bin2_sp, recipes.bin2_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin3_content), recipes.bin3_sp, recipes.bin3_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin4_content), recipes.bin4_sp, recipes.bin4_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin5_content), recipes.bin5_sp, recipes.bin5_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin6_content), recipes.bin6_sp, recipes.bin6_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin7_content), recipes.bin7_sp, recipes.bin7_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin8_content), recipes.bin8_sp, recipes.bin8_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin9_content), recipes.bin9_sp, recipes.bin9_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin10_content), recipes.bin10_sp, recipes.bin10_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin11_content), recipes.bin11_sp, recipes.bin11_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin12_content), recipes.bin12_sp, recipes.bin12_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code) AS long_bins WHERE NULLIF(TRIM(material_name), '') IS NOT NULL AND NOT (COALESCE(set_wt_kg, 0)=0 AND COALESCE(ach_wt_kg, 0)=0) GROUP BY TRIM(material_name) ORDER BY TRIM(material_name) ASC) AS rows;\",\n    \"entrypoints\": {\n      \"header\": \"SELECT PARAM:plant_name AS plant_name, PARAM:location AS location, PARAM:print_date AS print_date, PARAM:from_date AS from_date, PARAM:to_date AS to_date, PARAM:recipe_code AS recipe_code, 'Indian Industrial Machines Pvt. Ltd.' AS footer_company, PARAM:page_no AS page_no, PARAM:page_total AS page_total\",\n      \"rows\": \"SELECT ROW_NUMBER() OVER (ORDER BY TRIM(long_bins.material_name) ASC) AS row_sl_no, TRIM(long_bins.material_name) AS row_material_name, SUM(long_bins.set_wt_kg) AS row_set_wt, SUM(long_bins.ach_wt_kg) AS row_ach_wt, SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg) AS row_error_kg, CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg))/SUM(long_bins.set_wt_kg) END AS row_error_pct FROM (SELECT TRIM(recipes.bin1_content) AS material_name, recipes.bin1_sp AS set_wt_kg, recipes.bin1_act AS ach_wt_kg FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin2_content), recipes.bin2_sp, recipes.bin2_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin3_content), recipes.bin3_sp, recipes.bin3_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin4_content), recipes.bin4_sp, recipes.bin4_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin5_content), recipes.bin5_sp, recipes.bin5_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin6_content), recipes.bin6_sp, recipes.bin6_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin7_content), recipes.bin7_sp, recipes.bin7_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin8_content), recipes.bin8_sp, recipes.bin8_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin9_content), recipes.bin9_sp, recipes.bin9_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin10_content), recipes.bin10_sp, recipes.bin10_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin11_content), recipes.bin11_sp, recipes.bin11_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin12_content), recipes.bin12_sp, recipes.bin12_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code) AS long_bins WHERE NULLIF(TRIM(material_name), '') IS NOT NULL AND NOT (COALESCE(set_wt_kg, 0)=0 AND COALESCE(ach_wt_kg, 0)=0) GROUP BY TRIM(material_name) ORDER BY TRIM(material_name) ASC\",\n      \"totals\": \"SELECT SUM(rows.row_set_wt) AS total_set_wt, SUM(rows.row_ach_wt) AS total_ach_wt, SUM(rows.row_error_kg) AS total_error_kg, SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0) AS total_error_pct FROM (SELECT ROW_NUMBER() OVER (ORDER BY TRIM(long_bins.material_name) ASC) AS row_sl_no, TRIM(long_bins.material_name) AS row_material_name, SUM(long_bins.set_wt_kg) AS row_set_wt, SUM(long_bins.ach_wt_kg) AS row_ach_wt, SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg) AS row_error_kg, CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg))/SUM(long_bins.set_wt_kg) END AS row_error_pct FROM (SELECT TRIM(recipes.bin1_content) AS material_name, recipes.bin1_sp AS set_wt_kg, recipes.bin1_act AS ach_wt_kg FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin2_content), recipes.bin2_sp, recipes.bin2_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin3_content), recipes.bin3_sp, recipes.bin3_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin4_content), recipes.bin4_sp, recipes.bin4_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin5_content), recipes.bin5_sp, recipes.bin5_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin6_content), recipes.bin6_sp, recipes.bin6_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin7_content), recipes.bin7_sp, recipes.bin7_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin8_content), recipes.bin8_sp, recipes.bin8_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin9_content), recipes.bin9_sp, recipes.bin9_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin10_content), recipes.bin10_sp, recipes.bin10_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin11_content), recipes.bin11_sp, recipes.bin11_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code UNION ALL SELECT TRIM(recipes.bin12_content), recipes.bin12_sp, recipes.bin12_act FROM recipes WHERE recipes.start_time BETWEEN PARAM:from_date AND PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code) AS long_bins WHERE NULLIF(TRIM(material_name), '') IS NOT NULL AND NOT (COALESCE(set_wt_kg, 0)=0 AND COALESCE(ach_wt_kg, 0)=0) GROUP BY TRIM(material_name) ORDER BY TRIM(material_name) ASC) AS rows;\"\n    },\n    \"params\": {\n      \"required\": [\n        \"from_date\",\n        \"to_date\",\n        \"recipe_code\"\n      ],\n      \"optional\": [\n        \"plant_name\",\n        \"location\",\n        \"print_date\",\n        \"page_no\",\n        \"page_total\"\n      ]\n    }\n  },\n  \"dialect\": \"sqlite\",\n  \"invalid\": false\n}",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762793066,
  "model": "gpt-4o-mini-2024-07-18",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": "fp_560af6e559",
  "usage": {
    "completion_tokens": 5018,
    "prompt_tokens": 7592,
    "total_tokens": 12610,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 0,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 0
    }
  }
}
```

## 2025-11-10T20:38:18Z - template_initial_html

```json
{
  "id": "chatcmpl-CaSu920YriJkO22qhizKl6Lf9YKwD",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "<!--BEGIN_HTML-->\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\" />\n<title>{report_title}</title>\n<style>\n  @page {\n    size: A4;\n    margin: 14mm;\n  }\n  :root{\n    --col-sl: 12mm;\n    --col-mat: 94mm;\n    --col-set: 26mm;\n    --col-ach: 26mm;\n    --col-err: 18mm;\n    --col-pct: 14mm;\n    --row-gap: 2mm;\n  }\n  html, body {\n    height: 100%;\n  }\n  body{\n    margin:0;\n    font-family: \"Times New Roman\", Georgia, serif;\n    font-size: 11pt;\n    color:#000;\n    line-height:1.25;\n  }\n  /* Header */\n  #report-header{\n    border:1px solid #000;\n    padding:6mm 6mm 3mm 6mm;\n    margin-bottom:6mm;\n  }\n  #report-header .top-row{\n    display:flex;\n    gap:10mm;\n    align-items:flex-start;\n  }\n  #report-header .left-info{\n    flex:1 1 60%;\n  }\n  #report-header .right-info{\n    flex:1 1 40%;\n    text-align:right;\n  }\n  .kv{\n    width:100%;\n    border-collapse:separate;\n    border-spacing:0;\n    table-layout:fixed;\n  }\n  .kv td{\n    padding:1mm 0;\n    vertical-align:top;\n    white-space:nowrap;\n  }\n  .kv .label{ width:30mm; }\n  .kv .sep{ width:3mm; text-align:center; }\n  .kv .value{ width:auto; white-space:normal; }\n  #report-header .right-info .value,\n  #report-header .right-info td{\n    white-space:nowrap;\n  }\n  #report-header .title{\n    text-align:center;\n    font-weight:700;\n    font-size:18pt;\n    margin:2mm 0 1.5mm 0;\n  }\n  #report-header .divider{\n    border-top:1px solid #000;\n  }\n\n  /* Main table */\n  #data-table{\n    width:100%;\n    border-collapse:collapse;\n    table-layout:fixed;\n  }\n  #data-table col:nth-child(1){ width:var(--col-sl); }\n  #data-table col:nth-child(2){ width:var(--col-mat); }\n  #data-table col:nth-child(3){ width:var(--col-set); }\n  #data-table col:nth-child(4){ width:var(--col-ach); }\n  #data-table col:nth-child(5){ width:var(--col-err); }\n  #data-table col:nth-child(6){ width:var(--col-pct); }\n\n  #data-table th,\n  #data-table td{\n    border:1px solid #000;\n    padding:1.6mm 2mm;\n    overflow-wrap:break-word;\n    word-break:break-word;\n  }\n  #data-table thead th{\n    background:#f0f0f0;\n    font-weight:600;\n    text-align:left;\n  }\n  #data-table .ar{ text-align:right; }\n  #data-table tbody td:nth-child(n+3),\n  #data-table thead th:nth-child(n+3){\n    text-align:right;\n  }\n  #data-table tbody td:nth-child(2),\n  #data-table thead th:nth-child(2){\n    text-align:left;\n  }\n  #data-table tfoot td{\n    font-weight:700;\n    background:#fafafa;\n  }\n\n  /* Footer */\n  #page-footer{\n    position:fixed;\n    left:14mm;\n    right:14mm;\n    bottom:10mm;\n    font-size:10pt;\n  }\n  #page-footer .row{\n    display:grid;\n    grid-template-columns: 1fr 1fr 1fr;\n    align-items:center;\n  }\n  #page-footer .left{ text-align:left; }\n  #page-footer .center{ text-align:center; }\n  #page-footer .right{ text-align:right; }\n</style>\n</head>\n<body>\n\n<header id=\"report-header\">\n  <div class=\"top-row\">\n    <div class=\"left-info\">\n      <table class=\"kv\">\n        <tr>\n          <td class=\"label\">Plant name</td>\n          <td class=\"sep\">:</td>\n          <td class=\"value\">{plant_name}</td>\n        </tr>\n        <tr>\n          <td class=\"label\">Location</td>\n          <td class=\"sep\">:</td>\n          <td class=\"value\">{location}</td>\n        </tr>\n        <tr>\n          <td class=\"label\">Print Date</td>\n          <td class=\"sep\">:</td>\n          <td class=\"value\">{print_date}</td>\n        </tr>\n      </table>\n    </div>\n    <div class=\"right-info\">\n      <table class=\"kv\" style=\"margin-left:auto;\">\n        <tr>\n          <td class=\"value\">From Date : {from_date} &nbsp;&nbsp; To {to_date}</td>\n        </tr>\n        <tr>\n          <td class=\"value\">Recipe code : {recipe_code}</td>\n        </tr>\n      </table>\n    </div>\n  </div>\n\n  <div class=\"title\">{report_title}</div>\n  <div class=\"divider\"></div>\n</header>\n\n<main>\n  <table id=\"data-table\">\n    <colgroup>\n      <col /><col /><col /><col /><col /><col />\n    </colgroup>\n    <thead>\n      <tr>\n        <th data-label=\"sl_no\">Sl. No.</th>\n        <th data-label=\"material_name\">Material name</th>\n        <th data-label=\"set_wt_kg\">Set. wt(Kg)</th>\n        <th data-label=\"ach_wt_kg\">Ach. wt(Kg)</th>\n        <th data-label=\"error_kg\">Error(Kg)</th>\n        <th data-label=\"error_pct\">Error %</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr>\n        <td>{row_sl_no}</td>\n        <td>{row_material_name}</td>\n        <td class=\"ar\">{row_set_wt}</td>\n        <td class=\"ar\">{row_ach_wt}</td>\n        <td class=\"ar\">{row_error_kg}</td>\n        <td class=\"ar\">{row_error_pct}</td>\n      </tr>\n    </tbody>\n    <tfoot id=\"report-totals\">\n      <tr>\n        <td colspan=\"2\">Total</td>\n        <td class=\"ar\">{total_set_wt}</td>\n        <td class=\"ar\">{total_ach_wt}</td>\n        <td class=\"ar\">{total_error_kg}</td>\n        <td class=\"ar\">{total_error_pct}</td>\n      </tr>\n    </tfoot>\n  </table>\n</main>\n\n<footer id=\"page-footer\">\n  <div class=\"row\">\n    <div class=\"left\">{company_name}</div>\n    <div class=\"center\">{page_info}</div>\n    <div class=\"right\"></div>\n  </div>\n</footer>\n\n</body>\n</html>\n<!--END_HTML-->\n\n<!--BEGIN_SCHEMA_JSON-->\n{\n  \"scalars\": [\n    \"report_title\",\n    \"plant_name\",\n    \"location\",\n    \"print_date\",\n    \"from_date\",\n    \"to_date\",\n    \"recipe_code\",\n    \"company_name\",\n    \"page_info\"\n  ],\n  \"row_tokens\": [\n    \"row_sl_no\",\n    \"row_material_name\",\n    \"row_set_wt\",\n    \"row_ach_wt\",\n    \"row_error_kg\",\n    \"row_error_pct\"\n  ],\n  \"totals\": [\n    \"total_set_wt\",\n    \"total_ach_wt\",\n    \"total_error_kg\",\n    \"total_error_pct\"\n  ],\n  \"notes\": \"\"\n}\n<!--END_SCHEMA_JSON-->",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762806953,
  "model": "gpt-5-2025-08-07",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": null,
  "usage": {
    "completion_tokens": 5783,
    "prompt_tokens": 1544,
    "total_tokens": 7327,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 4032,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 0
    }
  }
}
```

## 2025-11-10T20:41:20Z - template_initial_html

```json
{
  "id": "chatcmpl-CaSxs4F3qKSaEy1C1IffOHKHqWDCW",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "<!--BEGIN_HTML-->\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<title>{report_title}</title>\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<style>\n  @page { size: A4; margin: 12mm 14mm 16mm 14mm; }\n  :root{\n    --kv-label-w: 32mm;\n    --row-gap: 2mm;\n\n    --col-sl: 16mm;\n    --col-name: 86mm;\n    --col-set: 28mm;\n    --col-ach: 28mm;\n    --col-errkg: 22mm;\n    --col-errpct: 17mm;\n  }\n\n  body{\n    font-family: \"Times New Roman\", Times, serif;\n    font-size: 12.5px;\n    line-height: 1.25;\n    color: #000;\n  }\n\n  #report-header{\n    display: grid;\n    grid-template-columns: 1fr auto;\n    align-items: start;\n    column-gap: 8mm;\n  }\n\n  /* left key/value block */\n  #report-header .kv{\n    width: 100%;\n    border-collapse: separate;\n    border-spacing: 0 1.2mm;\n  }\n  #report-header .kv td{\n    padding: 0;\n    vertical-align: top;\n  }\n  #report-header .kv td.label{\n    width: var(--kv-label-w);\n    padding-right: 2mm;\n  }\n  #report-header .kv td.value{\n    font-weight: bold;\n    letter-spacing: 0.1px;\n  }\n\n  /* right box (date and recipe) */\n  #report-header .right-box{\n    border: 1px solid #000;\n    padding: 2.5mm 3mm;\n    min-width: 70mm;\n  }\n  #report-header .right-box table{\n    width: 100%;\n    border-collapse: collapse;\n    table-layout: fixed;\n  }\n  #report-header .right-box td{\n    padding: 0.2mm 0.8mm;\n    white-space: nowrap;\n  }\n  #report-header .right-box td.label{\n    text-align: right;\n  }\n  #report-header .right-box td.value{\n    font-weight: bold;\n  }\n\n  /* report title */\n  #report-title{\n    text-align: center;\n    font-size: 21px;\n    font-weight: 700;\n    margin: 1.5mm 0 2mm 0;\n  }\n\n  .rule{\n    border-top: 1px solid #000;\n    margin: 1.5mm 0 3mm 0;\n    height: 0;\n  }\n\n  /* main data table */\n  #data-table{\n    width: 100%;\n    border-collapse: collapse;\n    table-layout: fixed;\n    margin-top: 1mm;\n  }\n  #data-table col.sl{ width: var(--col-sl); }\n  #data-table col.name{ width: var(--col-name); }\n  #data-table col.set{ width: var(--col-set); }\n  #data-table col.ach{ width: var(--col-ach); }\n  #data-table col.errkg{ width: var(--col-errkg); }\n  #data-table col.errpct{ width: var(--col-errpct); }\n\n  #data-table th,\n  #data-table td{\n    border: 1px solid #000;\n    padding: 3.2px 5px;\n    vertical-align: top;\n  }\n  #data-table th{\n    text-align: left;\n    font-weight: 700;\n  }\n  #data-table td.num,\n  #data-table th.num{\n    text-align: right;\n  }\n\n  /* totals row */\n  #report-totals td{\n    font-weight: 700;\n  }\n\n  /* footer */\n  #page-footer{\n    position: fixed;\n    left: 14mm; right: 14mm; bottom: 10mm;\n    display: flex;\n    font-size: 11.5px;\n  }\n  #page-footer .left{ flex: 1; }\n  #page-footer .center{ flex: 0 0 auto; margin: 0 auto; }\n  #page-footer .right{ flex: 1; text-align: right; }\n</style>\n</head>\n<body>\n\n<header id=\"report-header\">\n  <table class=\"kv\" aria-label=\"Header details\">\n    <tr>\n      <td class=\"label\">Plant name</td>\n      <td class=\"label\">:</td>\n      <td class=\"value\">{plant_name}</td>\n    </tr>\n    <tr>\n      <td class=\"label\">Location</td>\n      <td class=\"label\">:</td>\n      <td class=\"value\">{location}</td>\n    </tr>\n    <tr>\n      <td class=\"label\">Print Date</td>\n      <td class=\"label\">:</td>\n      <td class=\"value\">{print_date}</td>\n    </tr>\n  </table>\n\n  <div class=\"right-box\">\n    <table aria-label=\"Range and recipe\">\n      <tr>\n        <td class=\"label\">From Date :</td>\n        <td class=\"value\">{from_date}</td>\n        <td class=\"label\" style=\"padding-left:6mm;\">To</td>\n        <td class=\"value\">{to_date}</td>\n      </tr>\n      <tr>\n        <td class=\"label\">Recipe code :</td>\n        <td class=\"value\" colspan=\"3\">{recipe_code}</td>\n      </tr>\n    </table>\n  </div>\n</header>\n\n<div id=\"report-title\">{report_title}</div>\n<div class=\"rule\" aria-hidden=\"true\"></div>\n\n<table id=\"data-table\">\n  <colgroup>\n    <col class=\"sl\">\n    <col class=\"name\">\n    <col class=\"set\">\n    <col class=\"ach\">\n    <col class=\"errkg\">\n    <col class=\"errpct\">\n  </colgroup>\n  <thead>\n    <tr>\n      <th data-label=\"sl_no\">Sl. No.</th>\n      <th data-label=\"material_name\">Material name</th>\n      <th class=\"num\" data-label=\"set_wt\">Set. wt(Kg)</th>\n      <th class=\"num\" data-label=\"ach_wt\">Ach. wt(Kg)</th>\n      <th class=\"num\" data-label=\"error_kg\">Error(Kg)</th>\n      <th class=\"num\" data-label=\"error_pct\">Error %</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>{sl_no}</td>\n      <td>{material_name}</td>\n      <td class=\"num\">{set_wt}</td>\n      <td class=\"num\">{ach_wt}</td>\n      <td class=\"num\">{error_kg}</td>\n      <td class=\"num\">{error_pct}</td>\n    </tr>\n  </tbody>\n  <tfoot id=\"report-totals\">\n    <tr>\n      <td colspan=\"2\">Total</td>\n      <td class=\"num\">{total_set_wt}</td>\n      <td class=\"num\">{total_ach_wt}</td>\n      <td class=\"num\">{total_error_kg}</td>\n      <td class=\"num\">{total_error_pct}</td>\n    </tr>\n  </tfoot>\n</table>\n\n<footer id=\"page-footer\">\n  <div class=\"left\">{footer_company}</div>\n  <div class=\"center\">{page_info}</div>\n  <div class=\"right\"></div>\n</footer>\n\n</body>\n</html>\n<!--END_HTML-->\n\n<!--BEGIN_SCHEMA_JSON-->\n{\n  \"scalars\": [\n    \"report_title\",\n    \"plant_name\",\n    \"location\",\n    \"print_date\",\n    \"from_date\",\n    \"to_date\",\n    \"recipe_code\",\n    \"footer_company\",\n    \"page_info\"\n  ],\n  \"row_tokens\": [\n    \"sl_no\",\n    \"material_name\",\n    \"set_wt\",\n    \"ach_wt\",\n    \"error_kg\",\n    \"error_pct\"\n  ],\n  \"totals\": [\n    \"total_set_wt\",\n    \"total_ach_wt\",\n    \"total_error_kg\",\n    \"total_error_pct\"\n  ],\n  \"notes\": \"\"\n}\n<!--END_SCHEMA_JSON-->",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762807184,
  "model": "gpt-5-2025-08-07",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": null,
  "usage": {
    "completion_tokens": 4304,
    "prompt_tokens": 1544,
    "total_tokens": 5848,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 2496,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 1408
    }
  }
}
```

## 2025-11-10T20:43:34Z - template_fix_html_call2

```json
{
  "id": "chatcmpl-CaSzaXEwdRxeo0TbQZvHW6iaKbXVy",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "<!--BEGIN_HTML-->\n<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"utf-8\" />\n<title>{report_title}</title>\n<meta />\n<style>\n  @page { size: A4; margin: 12mm 14mm 16mm 14mm; }\n\n  :root{\n    --kv-label-w: 30mm;\n    --row-gap: 2mm;\n\n    /* columns must exactly fit printable width (182mm) */\n    --col-sl: 12mm;\n    --col-name: 88mm;\n    --col-set: 24mm;\n    --col-ach: 24mm;\n    --col-errkg: 18mm;\n    --col-errpct: 16mm;\n  }\n\n  *{ box-sizing: border-box; }\n\n  body{\n    font-family: \"Times New Roman\", Times, serif;\n    font-size: 12px;\n    line-height: 1.3;\n    color: #000;\n    margin: 0;\n  }\n\n  #report-header{\n    display: grid;\n    grid-template-columns: 1fr auto;\n    align-items: start;\n    column-gap: 8mm;\n  }\n\n  /* left key/value block */\n  #report-header .kv{\n    width: 100%;\n    border-collapse: separate;\n    border-spacing: 0 1.2mm;\n  }\n  #report-header .kv td{\n    padding: 0;\n    vertical-align: top;\n    white-space: nowrap;\n  }\n  #report-header .kv td.label{\n    width: var(--kv-label-w);\n    padding-right: 2mm;\n  }\n  #report-header .kv td.colon{\n    width: 3mm;\n    text-align: center;\n  }\n  #report-header .kv td.value{\n    font-weight: 400;\n    letter-spacing: 0;\n  }\n\n  /* right box (date and recipe) */\n  #report-header .right-box{\n    border: 1px solid #000;\n    padding: 2.5mm 3mm;\n    width: 86mm;\n  }\n  #report-header .right-box table{\n    width: 100%;\n    border-collapse: collapse;\n    table-layout: fixed;\n  }\n  #report-header .right-box td{\n    padding: 0.2mm 0.8mm;\n    white-space: nowrap;\n    vertical-align: top;\n    font-weight: 400;\n  }\n  #report-header .right-box td.label{\n    text-align: right;\n  }\n  #report-header .right-box td.value{\n    font-weight: 400;\n  }\n\n  /* report title */\n  #report-title{\n    text-align: center;\n    font-size: 20px;\n    font-weight: 700;\n    margin: 1.2mm 0 1.8mm 0;\n  }\n\n  .rule{\n    border-top: 1px solid #000;\n    margin: 1.2mm 0 2.2mm 0;\n    height: 0;\n  }\n\n  /* main data table */\n  #data-table{\n    width: 100%;\n    border-collapse: collapse;\n    table-layout: fixed;\n    margin-top: 0.8mm;\n    font-variant-numeric: tabular-nums;\n    break-inside: avoid;\n    page-break-inside: avoid;\n  }\n  #data-table col.sl{ width: var(--col-sl); }\n  #data-table col.name{ width: var(--col-name); }\n  #data-table col.set{ width: var(--col-set); }\n  #data-table col.ach{ width: var(--col-ach); }\n  #data-table col.errkg{ width: var(--col-errkg); }\n  #data-table col.errpct{ width: var(--col-errpct); }\n\n  #data-table th,\n  #data-table td{\n    border: 1px solid #000;\n    padding: 1.4mm 2mm;\n    vertical-align: top;\n  }\n  #data-table thead th{\n    font-weight: 700;\n    text-align: left;\n  }\n  #data-table thead th.num{ text-align: left; }\n\n  #data-table td.num{ text-align: right; }\n\n  /* totals row */\n  #report-totals td{\n    font-weight: 700;\n  }\n\n  /* footer */\n  #page-footer{\n    position: fixed;\n    left: 14mm; right: 14mm; bottom: 10mm;\n    display: flex;\n    font-size: 11.5px;\n  }\n  #page-footer .left{ flex: 1; }\n  #page-footer .center{ flex: 0 0 auto; margin: 0 auto; }\n  #page-footer .right{ flex: 1; text-align: right; }\n</style>\n</head>\n<body>\n\n<header id=\"report-header\">\n  <table class=\"kv\">\n    <tr>\n      <td class=\"label\">Plant name</td>\n      <td class=\"colon\">:</td>\n      <td class=\"value\">{plant_name}</td>\n    </tr>\n    <tr>\n      <td class=\"label\">Location</td>\n      <td class=\"colon\">:</td>\n      <td class=\"value\">{location}</td>\n    </tr>\n    <tr>\n      <td class=\"label\">Print Date</td>\n      <td class=\"colon\">:</td>\n      <td class=\"value\">{print_date}</td>\n    </tr>\n  </table>\n\n  <div class=\"right-box\">\n    <table>\n      <tr>\n        <td class=\"label\">From Date :</td>\n        <td class=\"value\">{from_date}</td>\n        <td class=\"label\" style=\"padding-left:6mm;\">To</td>\n        <td class=\"value\">{to_date}</td>\n      </tr>\n      <tr>\n        <td class=\"label\">Recipe code :</td>\n        <td class=\"value\" colspan=\"3\">{recipe_code}</td>\n      </tr>\n    </table>\n  </div>\n</header>\n\n<div id=\"report-title\">{report_title}</div>\n<div class=\"rule\"></div>\n\n<table id=\"data-table\">\n  <colgroup>\n    <col class=\"sl\" />\n    <col class=\"name\" />\n    <col class=\"set\" />\n    <col class=\"ach\" />\n    <col class=\"errkg\" />\n    <col class=\"errpct\" />\n  </colgroup>\n  <thead>\n    <tr>\n      <th data-label=\"sl_no\">Sl. No.</th>\n      <th data-label=\"material_name\">Material name</th>\n      <th class=\"num\" data-label=\"set_wt\">Set. wt(Kg)</th>\n      <th class=\"num\" data-label=\"ach_wt\">Ach. wt(Kg)</th>\n      <th class=\"num\" data-label=\"error_kg\">Error(Kg)</th>\n      <th class=\"num\" data-label=\"error_pct\">Error %</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>{sl_no}</td>\n      <td>{material_name}</td>\n      <td class=\"num\">{set_wt}</td>\n      <td class=\"num\">{ach_wt}</td>\n      <td class=\"num\">{error_kg}</td>\n      <td class=\"num\">{error_pct}</td>\n    </tr>\n  </tbody>\n  <tfoot id=\"report-totals\">\n    <tr>\n      <td colspan=\"2\">Total</td>\n      <td class=\"num\">{total_set_wt}</td>\n      <td class=\"num\">{total_ach_wt}</td>\n      <td class=\"num\">{total_error_kg}</td>\n      <td class=\"num\">{total_error_pct}</td>\n    </tr>\n  </tfoot>\n</table>\n\n<footer id=\"page-footer\">\n  <div class=\"left\">{footer_company}</div>\n  <div class=\"center\">{page_info}</div>\n  <div class=\"right\"></div>\n</footer>\n\n</body>\n</html>\n<!--END_HTML-->",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762807290,
  "model": "gpt-5-2025-08-07",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": null,
  "usage": {
    "completion_tokens": 5009,
    "prompt_tokens": 3924,
    "total_tokens": 8933,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 3264,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 0
    }
  }
}
```

## 2025-11-10T20:46:55Z - llm_call_3_v7

```json
{
  "id": "chatcmpl-CaT1wW2w2WhZOiOOIpRH2nFzA7dph",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "{\n  \"mapping\": {\n    \"plant_name\": \"params.plant_name\",\n    \"location\": \"params.location\",\n    \"print_date\": \"params.print_date\",\n    \"from_date\": \"To Be Selected...\",\n    \"to_date\": \"To Be Selected...\",\n    \"recipe_code\": \"params.recipe_code\",\n    \"sl_no\": \"UNRESOLVED\",\n    \"material_name\": \"UNRESOLVED\",\n    \"set_wt\": \"UNRESOLVED\",\n    \"ach_wt\": \"UNRESOLVED\",\n    \"error_kg\": \"UNRESOLVED\",\n    \"error_pct\": \"UNRESOLVED\",\n    \"total_set_wt\": \"(COALESCE(recipes.bin1_sp,0) + COALESCE(recipes.bin2_sp,0) + COALESCE(recipes.bin3_sp,0) + COALESCE(recipes.bin4_sp,0) + COALESCE(recipes.bin5_sp,0) + COALESCE(recipes.bin6_sp,0) + COALESCE(recipes.bin7_sp,0) + COALESCE(recipes.bin8_sp,0) + COALESCE(recipes.bin9_sp,0) + COALESCE(recipes.bin10_sp,0) + COALESCE(recipes.bin11_sp,0) + COALESCE(recipes.bin12_sp,0))\",\n    \"total_ach_wt\": \"(COALESCE(recipes.bin1_act,0) + COALESCE(recipes.bin2_act,0) + COALESCE(recipes.bin3_act,0) + COALESCE(recipes.bin4_act,0) + COALESCE(recipes.bin5_act,0) + COALESCE(recipes.bin6_act,0) + COALESCE(recipes.bin7_act,0) + COALESCE(recipes.bin8_act,0) + COALESCE(recipes.bin9_act,0) + COALESCE(recipes.bin10_act,0) + COALESCE(recipes.bin11_act,0) + COALESCE(recipes.bin12_act,0))\",\n    \"total_error_kg\": \"((COALESCE(recipes.bin1_act,0) + COALESCE(recipes.bin2_act,0) + COALESCE(recipes.bin3_act,0) + COALESCE(recipes.bin4_act,0) + COALESCE(recipes.bin5_act,0) + COALESCE(recipes.bin6_act,0) + COALESCE(recipes.bin7_act,0) + COALESCE(recipes.bin8_act,0) + COALESCE(recipes.bin9_act,0) + COALESCE(recipes.bin10_act,0) + COALESCE(recipes.bin11_act,0) + COALESCE(recipes.bin12_act,0)) - (COALESCE(recipes.bin1_sp,0) + COALESCE(recipes.bin2_sp,0) + COALESCE(recipes.bin3_sp,0) + COALESCE(recipes.bin4_sp,0) + COALESCE(recipes.bin5_sp,0) + COALESCE(recipes.bin6_sp,0) + COALESCE(recipes.bin7_sp,0) + COALESCE(recipes.bin8_sp,0) + COALESCE(recipes.bin9_sp,0) + COALESCE(recipes.bin10_sp,0) + COALESCE(recipes.bin11_sp,0) + COALESCE(recipes.bin12_sp,0)))\",\n    \"total_error_pct\": \"(100.0 * ((COALESCE(recipes.bin1_act,0) + COALESCE(recipes.bin2_act,0) + COALESCE(recipes.bin3_act,0) + COALESCE(recipes.bin4_act,0) + COALESCE(recipes.bin5_act,0) + COALESCE(recipes.bin6_act,0) + COALESCE(recipes.bin7_act,0) + COALESCE(recipes.bin8_act,0) + COALESCE(recipes.bin9_act,0) + COALESCE(recipes.bin10_act,0) + COALESCE(recipes.bin11_act,0) + COALESCE(recipes.bin12_act,0)) - (COALESCE(recipes.bin1_sp,0) + COALESCE(recipes.bin2_sp,0) + COALESCE(recipes.bin3_sp,0) + COALESCE(recipes.bin4_sp,0) + COALESCE(recipes.bin5_sp,0) + COALESCE(recipes.bin6_sp,0) + COALESCE(recipes.bin7_sp,0) + COALESCE(recipes.bin8_sp,0) + COALESCE(recipes.bin9_sp,0) + COALESCE(recipes.bin10_sp,0) + COALESCE(recipes.bin11_sp,0) + COALESCE(recipes.bin12_sp,0))) / NULLIF((COALESCE(recipes.bin1_sp,0) + COALESCE(recipes.bin2_sp,0) + COALESCE(recipes.bin3_sp,0) + COALESCE(recipes.bin4_sp,0) + COALESCE(recipes.bin5_sp,0) + COALESCE(recipes.bin6_sp,0) + COALESCE(recipes.bin7_sp,0) + COALESCE(recipes.bin8_sp,0) + COALESCE(recipes.bin9_sp,0) + COALESCE(recipes.bin10_sp,0) + COALESCE(recipes.bin11_sp,0) + COALESCE(recipes.bin12_sp,0)), 0))\",\n    \"page_info\": \"To Be Selected...\"\n  },\n  \"token_samples\": {\n    \"report_title\": \"Consumption report\",\n    \"plant_name\": \"SSR AQUA\",\n    \"location\": \"Gudivada\",\n    \"print_date\": \"25/03/2024\",\n    \"from_date\": \"24/03/2024\",\n    \"to_date\": \"24/03/2024\",\n    \"recipe_code\": \"GANGADHAR-2024\",\n    \"sl_no\": \"1\",\n    \"material_name\": \"CM 100 + DORB 100 KRR\",\n    \"set_wt\": \"11,800.00\",\n    \"ach_wt\": \"11,803.20\",\n    \"error_kg\": \"3.20\",\n    \"error_pct\": \"0.0271\",\n    \"total_set_wt\": \"80,000.00\",\n    \"total_ach_wt\": \"80,016.00\",\n    \"total_error_kg\": \"16.00\",\n    \"total_error_pct\": \"0.0200\",\n    \"footer_company\": \"Indian Industrial Machines Pvt. Ltd.\",\n    \"page_info\": \"Page 1 of 1\"\n  },\n  \"meta\": {\n    \"unresolved\": [\n      \"sl_no\",\n      \"material_name\",\n      \"set_wt\",\n      \"ach_wt\",\n      \"error_kg\",\n      \"error_pct\"\n    ],\n    \"hints\": {\n      \"total_set_wt\": {\n        \"op\": \"SUM\",\n        \"over\": [\n          \"recipes.bin1_sp\",\n          \"recipes.bin2_sp\",\n          \"recipes.bin3_sp\",\n          \"recipes.bin4_sp\",\n          \"recipes.bin5_sp\",\n          \"recipes.bin6_sp\",\n          \"recipes.bin7_sp\",\n          \"recipes.bin8_sp\",\n          \"recipes.bin9_sp\",\n          \"recipes.bin10_sp\",\n          \"recipes.bin11_sp\",\n          \"recipes.bin12_sp\"\n        ]\n      },\n      \"total_ach_wt\": {\n        \"op\": \"SUM\",\n        \"over\": [\n          \"recipes.bin1_act\",\n          \"recipes.bin2_act\",\n          \"recipes.bin3_act\",\n          \"recipes.bin4_act\",\n          \"recipes.bin5_act\",\n          \"recipes.bin6_act\",\n          \"recipes.bin7_act\",\n          \"recipes.bin8_act\",\n          \"recipes.bin9_act\",\n          \"recipes.bin10_act\",\n          \"recipes.bin11_act\",\n          \"recipes.bin12_act\"\n        ]\n      }\n    }\n  }\n}",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762807436,
  "model": "gpt-5-2025-08-07",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": null,
  "usage": {
    "completion_tokens": 7420,
    "prompt_tokens": 3882,
    "total_tokens": 11302,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 5696,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 3840
    }
  }
}
```

## 2025-11-10T20:47:14Z - llm_call_3_v7

```json
{
  "id": "chatcmpl-CaT1wdloqhYZZMiEZbw9VDSVbRtUe",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "{\n  \"mapping\": {\n    \"plant_name\": \"params.plant_name\",\n    \"location\": \"params.location\",\n    \"print_date\": \"params.print_date\",\n    \"from_date\": \"To Be Selected...\",\n    \"to_date\": \"To Be Selected...\",\n    \"recipe_code\": \"params.recipe_code\",\n    \"sl_no\": \"UNRESOLVED\",\n    \"material_name\": \"UNRESOLVED\",\n    \"set_wt\": \"UNRESOLVED\",\n    \"ach_wt\": \"UNRESOLVED\",\n    \"error_kg\": \"UNRESOLVED\",\n    \"error_pct\": \"UNRESOLVED\",\n    \"total_set_wt\": \"SUM(recipes.bin1_sp + recipes.bin2_sp + recipes.bin3_sp + recipes.bin4_sp + recipes.bin5_sp + recipes.bin6_sp + recipes.bin7_sp + recipes.bin8_sp + recipes.bin9_sp + recipes.bin10_sp + recipes.bin11_sp + recipes.bin12_sp)\",\n    \"total_ach_wt\": \"SUM(recipes.bin1_act + recipes.bin2_act + recipes.bin3_act + recipes.bin4_act + recipes.bin5_act + recipes.bin6_act + recipes.bin7_act + recipes.bin8_act + recipes.bin9_act + recipes.bin10_act + recipes.bin11_act + recipes.bin12_act)\",\n    \"total_error_kg\": \"SUM(recipes.bin1_act + recipes.bin2_act + recipes.bin3_act + recipes.bin4_act + recipes.bin5_act + recipes.bin6_act + recipes.bin7_act + recipes.bin8_act + recipes.bin9_act + recipes.bin10_act + recipes.bin11_act + recipes.bin12_act) - SUM(recipes.bin1_sp + recipes.bin2_sp + recipes.bin3_sp + recipes.bin4_sp + recipes.bin5_sp + recipes.bin6_sp + recipes.bin7_sp + recipes.bin8_sp + recipes.bin9_sp + recipes.bin10_sp + recipes.bin11_sp + recipes.bin12_sp)\",\n    \"total_error_pct\": \"CASE WHEN SUM(recipes.bin1_sp + recipes.bin2_sp + recipes.bin3_sp + recipes.bin4_sp + recipes.bin5_sp + recipes.bin6_sp + recipes.bin7_sp + recipes.bin8_sp + recipes.bin9_sp + recipes.bin10_sp + recipes.bin11_sp + recipes.bin12_sp) = 0 THEN 0 ELSE (SUM(recipes.bin1_act + recipes.bin2_act + recipes.bin3_act + recipes.bin4_act + recipes.bin5_act + recipes.bin6_act + recipes.bin7_act + recipes.bin8_act + recipes.bin9_act + recipes.bin10_act + recipes.bin11_act + recipes.bin12_act) - SUM(recipes.bin1_sp + recipes.bin2_sp + recipes.bin3_sp + recipes.bin4_sp + recipes.bin5_sp + recipes.bin6_sp + recipes.bin7_sp + recipes.bin8_sp + recipes.bin9_sp + recipes.bin10_sp + recipes.bin11_sp + recipes.bin12_sp)) / SUM(recipes.bin1_sp + recipes.bin2_sp + recipes.bin3_sp + recipes.bin4_sp + recipes.bin5_sp + recipes.bin6_sp + recipes.bin7_sp + recipes.bin8_sp + recipes.bin9_sp + recipes.bin10_sp + recipes.bin11_sp + recipes.bin12_sp) * 100 END\",\n    \"page_info\": \"To Be Selected...\"\n  },\n  \"token_samples\": {\n    \"report_title\": \"Consumption report\",\n    \"plant_name\": \"SSR AQUA\",\n    \"location\": \"Gudivada\",\n    \"print_date\": \"25/03/2024\",\n    \"from_date\": \"24/03/2024\",\n    \"to_date\": \"24/03/2024\",\n    \"recipe_code\": \"GANGADHAR-2024\",\n    \"sl_no\": \"1\",\n    \"material_name\": \"CM 100 + DORB 100 KRR\",\n    \"set_wt\": \"11,800.00\",\n    \"ach_wt\": \"11,803.20\",\n    \"error_kg\": \"3.20\",\n    \"error_pct\": \"0.0271\",\n    \"total_set_wt\": \"80,000.00\",\n    \"total_ach_wt\": \"80,016.00\",\n    \"total_error_kg\": \"16.00\",\n    \"total_error_pct\": \"0.0200\",\n    \"footer_company\": \"Indian Industrial Machines Pvt. Ltd.\",\n    \"page_info\": \"Page 1 of 1\"\n  },\n  \"meta\": {\n    \"unresolved\": [\n      \"sl_no\",\n      \"material_name\",\n      \"set_wt\",\n      \"ach_wt\",\n      \"error_kg\",\n      \"error_pct\"\n    ],\n    \"hints\": {\n      \"total_set_wt\": {\n        \"op\": \"SUM\",\n        \"over\": [\n          \"recipes.bin1_sp\",\n          \"recipes.bin2_sp\",\n          \"recipes.bin3_sp\",\n          \"recipes.bin4_sp\",\n          \"recipes.bin5_sp\",\n          \"recipes.bin6_sp\",\n          \"recipes.bin7_sp\",\n          \"recipes.bin8_sp\",\n          \"recipes.bin9_sp\",\n          \"recipes.bin10_sp\",\n          \"recipes.bin11_sp\",\n          \"recipes.bin12_sp\"\n        ]\n      },\n      \"total_ach_wt\": {\n        \"op\": \"SUM\",\n        \"over\": [\n          \"recipes.bin1_act\",\n          \"recipes.bin2_act\",\n          \"recipes.bin3_act\",\n          \"recipes.bin4_act\",\n          \"recipes.bin5_act\",\n          \"recipes.bin6_act\",\n          \"recipes.bin7_act\",\n          \"recipes.bin8_act\",\n          \"recipes.bin9_act\",\n          \"recipes.bin10_act\",\n          \"recipes.bin11_act\",\n          \"recipes.bin12_act\"\n        ]\n      },\n      \"total_error_kg\": {\n        \"op\": \"SUM(act) - SUM(sp)\",\n        \"over_act\": [\n          \"recipes.bin1_act\",\n          \"recipes.bin2_act\",\n          \"recipes.bin3_act\",\n          \"recipes.bin4_act\",\n          \"recipes.bin5_act\",\n          \"recipes.bin6_act\",\n          \"recipes.bin7_act\",\n          \"recipes.bin8_act\",\n          \"recipes.bin9_act\",\n          \"recipes.bin10_act\",\n          \"recipes.bin11_act\",\n          \"recipes.bin12_act\"\n        ],\n        \"over_sp\": [\n          \"recipes.bin1_sp\",\n          \"recipes.bin2_sp\",\n          \"recipes.bin3_sp\",\n          \"recipes.bin4_sp\",\n          \"recipes.bin5_sp\",\n          \"recipes.bin6_sp\",\n          \"recipes.bin7_sp\",\n          \"recipes.bin8_sp\",\n          \"recipes.bin9_sp\",\n          \"recipes.bin10_sp\",\n          \"recipes.bin11_sp\",\n          \"recipes.bin12_sp\"\n        ]\n      },\n      \"total_error_pct\": {\n        \"op\": \"(SUM(act) - SUM(sp)) / SUM(sp) * 100\",\n        \"over_act\": [\n          \"recipes.bin1_act\",\n          \"recipes.bin2_act\",\n          \"recipes.bin3_act\",\n          \"recipes.bin4_act\",\n          \"recipes.bin5_act\",\n          \"recipes.bin6_act\",\n          \"recipes.bin7_act\",\n          \"recipes.bin8_act\",\n          \"recipes.bin9_act\",\n          \"recipes.bin10_act\",\n          \"recipes.bin11_act\",\n          \"recipes.bin12_act\"\n        ],\n        \"over_sp\": [\n          \"recipes.bin1_sp\",\n          \"recipes.bin2_sp\",\n          \"recipes.bin3_sp\",\n          \"recipes.bin4_sp\",\n          \"recipes.bin5_sp\",\n          \"recipes.bin6_sp\",\n          \"recipes.bin7_sp\",\n          \"recipes.bin8_sp\",\n          \"recipes.bin9_sp\",\n          \"recipes.bin10_sp\",\n          \"recipes.bin11_sp\",\n          \"recipes.bin12_sp\"\n        ]\n      }\n    }\n  }\n}",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762807436,
  "model": "gpt-5-2025-08-07",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": null,
  "usage": {
    "completion_tokens": 8226,
    "prompt_tokens": 3882,
    "total_tokens": 12108,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 6592,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 0
    }
  }
}
```

## 2025-11-10T20:50:15Z - v2

```json
{
  "id": "chatcmpl-CaT5dAbSJttsfAu88bLBOFNfmFfzk",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "{\n  \"overview_md\": \"Executive Summary\\nThe report renders a consumption summary for a selected recipe within a date range. It unpivots 12 bin columns (content/sp/act) from recipes into a long form, filters out blank materials, groups by material name, and computes per-material set weight, achieved weight, error (kg), and error (%). Totals are computed by summing the row metrics. A required equality filter on recipe_code (mapped to recipes.recipe_name) and an inclusive date-range filter on recipes.start_time are applied before aggregation. Ordering is stable by material name with deterministic tie-breakers.\\n\\nToken Inventory\\nScalars (header): plant_name, location, print_date, from_date, to_date, recipe_code, page_info\\nRow tokens: sl_no, material_name, set_wt, ach_wt, error_kg, error_pct\\nTotals: total_set_wt, total_ach_wt, total_error_kg, total_error_pct\\n\\nMapping Table\\n- plant_name -> PARAM:plant_name\\n- location -> PARAM:location\\n- print_date -> PARAM:print_date\\n- from_date -> PARAM:from_date\\n- to_date -> PARAM:to_date\\n- recipe_code -> PARAM:recipe_code\\n- page_info -> PARAM:page_info\\n- sl_no -> ROW_NUMBER() OVER (ORDER BY rows.row_material_name ASC, rows.row_first_seen_ts ASC, rows.row_recipe_id_min ASC)\\n- material_name -> rows.row_material_name\\n- set_wt -> rows.row_set_wt\\n- ach_wt -> rows.row_ach_wt\\n- error_kg -> rows.row_error_kg\\n- error_pct -> rows.row_error_pct\\n- total_set_wt -> SUM(rows.row_set_wt)\\n- total_ach_wt -> SUM(rows.row_ach_wt)\\n- total_error_kg -> SUM(rows.row_error_kg)\\n- total_error_pct -> 100.0 * SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0)\\n\\nJoin & Date Rules\\n- Tables: recipes only (no joins).\\n- Date column for filtering: recipes.start_time.\\n- Required filter: recipes.recipe_name = PARAM:recipe_code.\\n- Date filter: apply inclusive range on recipes.start_time when from_date/to_date are supplied; recommended as half-open [from_date, to_date + 1 day) for correctness across time components.\\n\\nTransformations\\n- Unpivot/Union: For each recipes row, UNION ALL 12 bin columns into long_bins(material_name, set_wt_kg, ach_wt_kg, bin_ordinal, recipe_id, start_time, recipe_name). Material names are TRIM()'d; weights use COALESCE(..., 0).\\n- Pre-aggregation filters: drop rows where TRIM(material_name) = '' or material_name IS NULL. Apply recipe_code equality and date-range filters here.\\n- Row computations: group by TRIM(material_name) to compute row_set_wt, row_ach_wt, row_error_kg = row_ach_wt - row_set_wt, row_error_pct = 100.0 * row_error_kg / NULLIF(row_set_wt, 0). Also compute row_first_seen_ts = MIN(start_time) and row_recipe_id_min = MIN(recipe_id) to stabilize ordering.\\n- Totals math: aggregate across rows dataset: totals are SUM of row metrics; total_error_pct derived from totals via NULLIF guard.\\n\\nParameters\\n- Required: recipe_code (string; equality filter), from_date (date), to_date (date).\\n- Optional/pass-through: plant_name (string), location (string), print_date (date/string), page_info (string).\\n- Semantics: recipe_code must be applied as an equality predicate on recipes.recipe_name in all entrypoints. Date range is inclusive; apply only when both from_date and to_date are non-empty. Header-only parameters are pass-through and do not affect SQL.\\n\\nChecklist for Step 5\\n- Use only recipes.* columns from catalog; no other tables.\\n- Build long_bins via UNION ALL across bin1..bin12 with TRIM() and COALESCE(,0).\\n- Filter: material_name non-blank; recipe_name = PARAM:recipe_code; start_time in inclusive date range when dates provided.\\n- Group rows by TRIM(material_name). Compute row_set_wt, row_ach_wt, row_error_kg, row_error_pct with NULLIF guard.\\n- Order rows by material_name ASC, then row_first_seen_ts ASC, then row_recipe_id_min ASC. Use same ordering in window for sl_no.\\n- Totals from rows: SUM of row fields; percent uses totals division with NULLIF guard.\\n- Ensure order_by.rows is populated and matches the described ordering.\\n- Maintain exact token names; no additions or renames.\\n\",\n  \"step5_requirements\": {\n    \"datasets\": {\n      \"header\": {\n        \"description\": \"One-row header dataset\",\n        \"columns\": [\n          \"plant_name\",\n          \"location\",\n          \"print_date\",\n          \"from_date\",\n          \"to_date\",\n          \"recipe_code\",\n          \"page_info\"\n        ]\n      },\n      \"rows\": {\n        \"description\": \"Detail rows dataset (materials aggregated from bins)\",\n        \"columns\": [\n          \"sl_no\",\n          \"material_name\",\n          \"set_wt\",\n          \"ach_wt\",\n          \"error_kg\",\n          \"error_pct\"\n        ],\n        \"grouping\": [\n          \"Group by TRIM(long_bins.material_name) to aggregate per material.\",\n          \"Use MIN(long_bins.start_time) and MIN(long_bins.recipe_id) to aid deterministic ordering.\",\n          \"Drop rows where TRIM(long_bins.material_name) = '' or material_name IS NULL before grouping.\"\n        ],\n        \"ordering\": [\n          \"Stable ascending order: material_name ASC, then first_seen_ts ASC, then recipe_id_min ASC.\",\n          \"Apply identical ordering in ROW_NUMBER() window for sl_no.\"\n        ]\n      },\n      \"totals\": {\n        \"description\": \"Aggregate totals dataset computed from rows\",\n        \"columns\": [\n          \"total_set_wt\",\n          \"total_ach_wt\",\n          \"total_error_kg\",\n          \"total_error_pct\"\n        ]\n      }\n    },\n    \"semantics\": \"recipe_code is a required user filter applied as equality on recipes.recipe_name for header, rows, and totals. from_date/to_date are required parameters used to constrain recipes.start_time to an inclusive range (recommended half-open implementation). Other parameters are pass-through for display only.\",\n    \"parameters\": {\n      \"required\": [\n        {\n          \"name\": \"recipe_code\",\n          \"type\": \"string\"\n        },\n        {\n          \"name\": \"from_date\",\n          \"type\": \"date\"\n        },\n        {\n          \"name\": \"to_date\",\n          \"type\": \"date\"\n        }\n      ],\n      \"optional\": [\n        {\n          \"name\": \"plant_name\",\n          \"type\": \"string\"\n        },\n        {\n          \"name\": \"location\",\n          \"type\": \"string\"\n        },\n        {\n          \"name\": \"print_date\",\n          \"type\": \"string\"\n        },\n        {\n          \"name\": \"page_info\",\n          \"type\": \"string\"\n        }\n      ]\n    },\n    \"transformations\": [\n      \"UNION ALL across bin1..bin12 to long_bins(material_name, set_wt_kg, ach_wt_kg, bin_ordinal, recipe_id, start_time, recipe_name).\",\n      \"Filter long_bins to remove blank material_name and apply recipe_code equality and date-range filters before grouping.\",\n      \"Group by TRIM(material_name) to produce row_set_wt = SUM(set_wt_kg), row_ach_wt = SUM(ach_wt_kg), row_error_kg = row_ach_wt - row_set_wt, row_error_pct = 100.0 * row_error_kg / NULLIF(row_set_wt, 0).\",\n      \"Compute ordering helpers row_first_seen_ts = MIN(start_time) and row_recipe_id_min = MIN(recipe_id) for stable ordering and sl_no window.\",\n      \"Totals computed from rows: total_set_wt = SUM(rows.row_set_wt), total_ach_wt = SUM(rows.row_ach_wt), total_error_kg = SUM(rows.row_error_kg), total_error_pct = 100.0 * total_error_kg / NULLIF(total_set_wt, 0).\"\n    ]\n  },\n  \"contract\": {\n    \"tokens\": {\n      \"scalars\": [\n        \"plant_name\",\n        \"location\",\n        \"print_date\",\n        \"from_date\",\n        \"to_date\",\n        \"recipe_code\",\n        \"page_info\"\n      ],\n      \"row_tokens\": [\n        \"sl_no\",\n        \"material_name\",\n        \"set_wt\",\n        \"ach_wt\",\n        \"error_kg\",\n        \"error_pct\"\n      ],\n      \"totals\": [\n        \"total_set_wt\",\n        \"total_ach_wt\",\n        \"total_error_kg\",\n        \"total_error_pct\"\n      ]\n    },\n    \"mapping\": {\n      \"plant_name\": \"PARAM:plant_name\",\n      \"location\": \"PARAM:location\",\n      \"print_date\": \"PARAM:print_date\",\n      \"from_date\": \"PARAM:from_date\",\n      \"to_date\": \"PARAM:to_date\",\n      \"recipe_code\": \"PARAM:recipe_code\",\n      \"page_info\": \"PARAM:page_info\",\n      \"sl_no\": \"ROW_NUMBER() OVER (ORDER BY rows.row_material_name ASC, rows.row_first_seen_ts ASC, rows.row_recipe_id_min ASC)\",\n      \"material_name\": \"rows.row_material_name\",\n      \"set_wt\": \"rows.row_set_wt\",\n      \"ach_wt\": \"rows.row_ach_wt\",\n      \"error_kg\": \"rows.row_error_kg\",\n      \"error_pct\": \"rows.row_error_pct\",\n      \"total_set_wt\": \"SUM(rows.row_set_wt)\",\n      \"total_ach_wt\": \"SUM(rows.row_ach_wt)\",\n      \"total_error_kg\": \"SUM(rows.row_error_kg)\",\n      \"total_error_pct\": \"100.0 * SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0)\"\n    },\n    \"unresolved\": [],\n    \"join\": {\n      \"parent_table\": \"recipes\",\n      \"parent_key\": \"id\",\n      \"child_table\": null,\n      \"child_key\": null\n    },\n    \"date_columns\": {\n      \"recipes\": \"start_time\"\n    },\n    \"filters\": {\n      \"required\": {\n        \"recipe_code\": \"recipes.recipe_name\"\n      },\n      \"date_range\": {\n        \"column\": \"recipes.start_time\",\n        \"apply_when\": \"PARAM:from_date and PARAM:to_date non-empty\",\n        \"inclusive\": true\n      }\n    },\n    \"reshape_rules\": [\n      {\n        \"purpose\": \"Stage long-form material rows from 12 bins\",\n        \"strategy\": \"UNION_ALL\",\n        \"explain\": \"Union bin1..bin12 columns into long form, trim names, coalesce weights, carry keys.\",\n        \"columns\": [\n          {\n            \"as\": \"recipe_id\",\n            \"from\": [\n              \"recipes.id\"\n            ]\n          },\n          {\n            \"as\": \"start_time\",\n            \"from\": [\n              \"recipes.start_time\"\n            ]\n          },\n          {\n            \"as\": \"recipe_name\",\n            \"from\": [\n              \"recipes.recipe_name\"\n            ]\n          },\n          {\n            \"as\": \"bin_ordinal\",\n            \"from\": [\n              \"1..12 (literal per branch)\"\n            ]\n          },\n          {\n            \"as\": \"material_name\",\n            \"from\": [\n              \"recipes.bin1_content\",\n              \"recipes.bin2_content\",\n              \"recipes.bin3_content\",\n              \"recipes.bin4_content\",\n              \"recipes.bin5_content\",\n              \"recipes.bin6_content\",\n              \"recipes.bin7_content\",\n              \"recipes.bin8_content\",\n              \"recipes.bin9_content\",\n              \"recipes.bin10_content\",\n              \"recipes.bin11_content\",\n              \"recipes.bin12_content\"\n            ]\n          },\n          {\n            \"as\": \"set_wt_kg\",\n            \"from\": [\n              \"recipes.bin1_sp\",\n              \"recipes.bin2_sp\",\n              \"recipes.bin3_sp\",\n              \"recipes.bin4_sp\",\n              \"recipes.bin5_sp\",\n              \"recipes.bin6_sp\",\n              \"recipes.bin7_sp\",\n              \"recipes.bin8_sp\",\n              \"recipes.bin9_sp\",\n              \"recipes.bin10_sp\",\n              \"recipes.bin11_sp\",\n              \"recipes.bin12_sp\"\n            ]\n          },\n          {\n            \"as\": \"ach_wt_kg\",\n            \"from\": [\n              \"recipes.bin1_act\",\n              \"recipes.bin2_act\",\n              \"recipes.bin3_act\",\n              \"recipes.bin4_act\",\n              \"recipes.bin5_act\",\n              \"recipes.bin6_act\",\n              \"recipes.bin7_act\",\n              \"recipes.bin8_act\",\n              \"recipes.bin9_act\",\n              \"recipes.bin10_act\",\n              \"recipes.bin11_act\",\n              \"recipes.bin12_act\"\n            ]\n          }\n        ]\n      },\n      {\n        \"purpose\": \"Produce rows dataset\",\n        \"strategy\": \"AGGREGATE\",\n        \"explain\": \"Filter blanks and required predicates, then group by material and compute row metrics and ordering helpers.\",\n        \"columns\": [\n          {\n            \"as\": \"row_material_name\",\n            \"from\": [\n              \"TRIM(long_bins.material_name)\"\n            ]\n          },\n          {\n            \"as\": \"row_set_wt\",\n            \"from\": [\n              \"SUM(long_bins.set_wt_kg)\"\n            ]\n          },\n          {\n            \"as\": \"row_ach_wt\",\n            \"from\": [\n              \"SUM(long_bins.ach_wt_kg)\"\n            ]\n          },\n          {\n            \"as\": \"row_error_kg\",\n            \"from\": [\n              \"SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)\"\n            ]\n          },\n          {\n            \"as\": \"row_error_pct\",\n            \"from\": [\n              \"CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE 100.0 * (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)) / SUM(long_bins.set_wt_kg) END\"\n            ]\n          },\n          {\n            \"as\": \"row_first_seen_ts\",\n            \"from\": [\n              \"MIN(long_bins.start_time)\"\n            ]\n          },\n          {\n            \"as\": \"row_recipe_id_min\",\n            \"from\": [\n              \"MIN(long_bins.recipe_id)\"\n            ]\n          }\n        ]\n      }\n    ],\n    \"row_computed\": {\n      \"row_material_name\": \"TRIM(long_bins.material_name)\",\n      \"row_set_wt\": \"SUM(long_bins.set_wt_kg)\",\n      \"row_ach_wt\": \"SUM(long_bins.ach_wt_kg)\",\n      \"row_error_kg\": \"SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)\",\n      \"row_error_pct\": \"CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE 100.0 * (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)) / SUM(long_bins.set_wt_kg) END\",\n      \"row_first_seen_ts\": \"MIN(long_bins.start_time)\",\n      \"row_recipe_id_min\": \"MIN(long_bins.recipe_id)\"\n    },\n    \"totals_math\": {\n      \"total_set_wt\": \"SUM(rows.row_set_wt)\",\n      \"total_ach_wt\": \"SUM(rows.row_ach_wt)\",\n      \"total_error_kg\": \"SUM(rows.row_error_kg)\",\n      \"total_error_pct\": \"100.0 * SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0)\"\n    },\n    \"formatters\": {\n      \"error_pct\": \"percent(2)\",\n      \"total_error_pct\": \"percent(2)\",\n      \"print_date\": \"date(YYYY-MM-DD)\"\n    },\n    \"order_by\": {\n      \"rows\": [\n        \"rows.row_material_name ASC\",\n        \"rows.row_first_seen_ts ASC\",\n        \"rows.row_recipe_id_min ASC\"\n      ]\n    },\n    \"notes\": \"Use only recipes.* columns. Apply recipe_code equality and inclusive date range before unpivot aggregation. Remove blank material names. Ensure consistent ordering for sl_no.\"\n  },\n  \"validation\": {\n    \"unknown_tokens\": [],\n    \"unknown_columns\": [],\n    \"token_coverage\": {\n      \"scalars_mapped_pct\": 100,\n      \"row_tokens_mapped_pct\": 100,\n      \"totals_mapped_pct\": 100\n    }\n  }\n}",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762807665,
  "model": "gpt-5-2025-08-07",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": null,
  "usage": {
    "completion_tokens": 8951,
    "prompt_tokens": 9743,
    "total_tokens": 18694,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 5376,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 0
    }
  }
}
```

## 2025-11-10T20:51:02Z - generator_assets_v1

```json
{
  "id": "chatcmpl-CaT84JLxOhcVwi4pxp1Xwc6ZmINQ8",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "{\n  \"contract\": {\n    \"tokens\": {\n      \"scalars\": [\n        \"plant_name\",\n        \"location\",\n        \"print_date\",\n        \"from_date\",\n        \"to_date\",\n        \"recipe_code\",\n        \"page_info\"\n      ],\n      \"row_tokens\": [\n        \"sl_no\",\n        \"material_name\",\n        \"set_wt\",\n        \"ach_wt\",\n        \"error_kg\",\n        \"error_pct\"\n      ],\n      \"totals\": [\n        \"total_set_wt\",\n        \"total_ach_wt\",\n        \"total_error_kg\",\n        \"total_error_pct\"\n      ]\n    },\n    \"mapping\": {\n      \"plant_name\": \"PARAM:plant_name\",\n      \"location\": \"PARAM:location\",\n      \"print_date\": \"PARAM:print_date\",\n      \"from_date\": \"PARAM:from_date\",\n      \"to_date\": \"PARAM:to_date\",\n      \"recipe_code\": \"PARAM:recipe_code\",\n      \"page_info\": \"PARAM:page_info\",\n      \"sl_no\": \"ROW_NUMBER() OVER (ORDER BY rows.row_material_name ASC, rows.row_first_seen_ts ASC, rows.row_recipe_id_min ASC)\",\n      \"material_name\": \"rows.row_material_name\",\n      \"set_wt\": \"rows.row_set_wt\",\n      \"ach_wt\": \"rows.row_ach_wt\",\n      \"error_kg\": \"rows.row_error_kg\",\n      \"error_pct\": \"rows.row_error_pct\",\n      \"total_set_wt\": \"SUM(rows.row_set_wt)\",\n      \"total_ach_wt\": \"SUM(rows.row_ach_wt)\",\n      \"total_error_kg\": \"SUM(rows.row_error_kg)\",\n      \"total_error_pct\": \"100.0 * SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0)\"\n    },\n    \"join\": {\n      \"parent_table\": \"recipes\",\n      \"parent_key\": \"id\",\n      \"child_table\": \"recipes\",\n      \"child_key\": \"id\"\n    },\n    \"date_columns\": {\n      \"recipes\": \"start_time\"\n    },\n    \"filters\": {\n      \"required\": {\n        \"recipe_code\": \"recipes.recipe_name\"\n      },\n      \"date_range\": {\n        \"column\": \"recipes.start_time\",\n        \"apply_when\": \"PARAM:from_date and PARAM:to_date non-empty\",\n        \"inclusive\": true\n      }\n    },\n    \"reshape_rules\": [\n      {\n        \"purpose\": \"Stage long-form material rows from 12 bins\",\n        \"strategy\": \"UNION_ALL\",\n        \"columns\": [\n          {\n            \"as\": \"recipe_id\",\n            \"from\": [\n              \"recipes.id\"\n            ]\n          },\n          {\n            \"as\": \"start_time\",\n            \"from\": [\n              \"recipes.start_time\"\n            ]\n          },\n          {\n            \"as\": \"recipe_name\",\n            \"from\": [\n              \"recipes.recipe_name\"\n            ]\n          },\n          {\n            \"as\": \"bin_ordinal\",\n            \"from\": [\n              \"1..12 (literal per branch)\"\n            ]\n          },\n          {\n            \"as\": \"material_name\",\n            \"from\": [\n              \"recipes.bin1_content\",\n              \"recipes.bin2_content\",\n              \"recipes.bin3_content\",\n              \"recipes.bin4_content\",\n              \"recipes.bin5_content\",\n              \"recipes.bin6_content\",\n              \"recipes.bin7_content\",\n              \"recipes.bin8_content\",\n              \"recipes.bin9_content\",\n              \"recipes.bin10_content\",\n              \"recipes.bin11_content\",\n              \"recipes.bin12_content\"\n            ]\n          },\n          {\n            \"as\": \"set_wt_kg\",\n            \"from\": [\n              \"recipes.bin1_sp\",\n              \"recipes.bin2_sp\",\n              \"recipes.bin3_sp\",\n              \"recipes.bin4_sp\",\n              \"recipes.bin5_sp\",\n              \"recipes.bin6_sp\",\n              \"recipes.bin7_sp\",\n              \"recipes.bin8_sp\",\n              \"recipes.bin9_sp\",\n              \"recipes.bin10_sp\",\n              \"recipes.bin11_sp\",\n              \"recipes.bin12_sp\"\n            ]\n          },\n          {\n            \"as\": \"ach_wt_kg\",\n            \"from\": [\n              \"recipes.bin1_act\",\n              \"recipes.bin2_act\",\n              \"recipes.bin3_act\",\n              \"recipes.bin4_act\",\n              \"recipes.bin5_act\",\n              \"recipes.bin6_act\",\n              \"recipes.bin7_act\",\n              \"recipes.bin8_act\",\n              \"recipes.bin9_act\",\n              \"recipes.bin10_act\",\n              \"recipes.bin11_act\",\n              \"recipes.bin12_act\"\n            ]\n          }\n        ],\n        \"order_by\": []\n      },\n      {\n        \"purpose\": \"Produce rows dataset\",\n        \"strategy\": \"AGGREGATE\",\n        \"columns\": [\n          {\n            \"as\": \"row_material_name\",\n            \"from\": [\n              \"TRIM(long_bins.material_name)\"\n            ]\n          },\n          {\n            \"as\": \"row_set_wt\",\n            \"from\": [\n              \"SUM(long_bins.set_wt_kg)\"\n            ]\n          },\n          {\n            \"as\": \"row_ach_wt\",\n            \"from\": [\n              \"SUM(long_bins.ach_wt_kg)\"\n            ]\n          },\n          {\n            \"as\": \"row_error_kg\",\n            \"from\": [\n              \"SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)\"\n            ]\n          },\n          {\n            \"as\": \"row_error_pct\",\n            \"from\": [\n              \"CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE 100.0 * (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)) / SUM(long_bins.set_wt_kg) END\"\n            ]\n          },\n          {\n            \"as\": \"row_first_seen_ts\",\n            \"from\": [\n              \"MIN(long_bins.start_time)\"\n            ]\n          },\n          {\n            \"as\": \"row_recipe_id_min\",\n            \"from\": [\n              \"MIN(long_bins.recipe_id)\"\n            ]\n          }\n        ],\n        \"order_by\": []\n      }\n    ],\n    \"row_computed\": {\n      \"row_material_name\": \"TRIM(long_bins.material_name)\",\n      \"row_set_wt\": \"SUM(long_bins.set_wt_kg)\",\n      \"row_ach_wt\": \"SUM(long_bins.ach_wt_kg)\",\n      \"row_error_kg\": \"SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)\",\n      \"row_error_pct\": \"CASE WHEN SUM(long_bins.set_wt_kg)=0 THEN NULL ELSE 100.0 * (SUM(long_bins.ach_wt_kg) - SUM(long_bins.set_wt_kg)) / SUM(long_bins.set_wt_kg) END\",\n      \"row_first_seen_ts\": \"MIN(long_bins.start_time)\",\n      \"row_recipe_id_min\": \"MIN(long_bins.recipe_id)\"\n    },\n    \"totals_math\": {\n      \"total_set_wt\": \"SUM(rows.row_set_wt)\",\n      \"total_ach_wt\": \"SUM(rows.row_ach_wt)\",\n      \"total_error_kg\": \"SUM(rows.row_error_kg)\",\n      \"total_error_pct\": \"100.0 * SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0)\"\n    },\n    \"formatters\": {\n      \"error_pct\": \"percent(2)\",\n      \"total_error_pct\": \"percent(2)\",\n      \"print_date\": \"date(YYYY-MM-DD)\"\n    },\n    \"order_by\": {\n      \"rows\": [\n        \"rows.row_material_name ASC\",\n        \"rows.row_first_seen_ts ASC\",\n        \"rows.row_recipe_id_min ASC\"\n      ]\n    },\n    \"row_order\": [\n      \"ROWID\"\n    ],\n    \"header_tokens\": [\n      \"plant_name\",\n      \"location\",\n      \"print_date\",\n      \"from_date\",\n      \"to_date\",\n      \"recipe_code\",\n      \"page_info\"\n    ],\n    \"row_tokens\": [\n      \"sl_no\",\n      \"material_name\",\n      \"set_wt\",\n      \"ach_wt\",\n      \"error_kg\",\n      \"error_pct\"\n    ],\n    \"totals\": {\n      \"total_set_wt\": \"SUM(rows.row_set_wt)\",\n      \"total_ach_wt\": \"SUM(rows.row_ach_wt)\",\n      \"total_error_kg\": \"SUM(rows.row_error_kg)\",\n      \"total_error_pct\": \"100.0 * SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0)\"\n    }\n  },\n  \"sql_pack\": {\n    \"dialect\": \"sqlite\",\n    \"script\": \"-- HEADER SELECT --\\nSELECT :plant_name AS plant_name, :location AS location, :print_date AS print_date, :from_date AS from_date, :to_date AS to_date, :recipe_code AS recipe_code, :page_info AS page_info;\\n-- ROWS SELECT --\\nSELECT ROW_NUMBER() OVER (ORDER BY rows.row_material_name ASC, rows.row_first_seen_ts ASC, rows.row_recipe_id_min ASC) AS sl_no,\\n       rows.row_material_name AS material_name,\\n       rows.row_set_wt AS set_wt,\\n       rows.row_ach_wt AS ach_wt,\\n       rows.row_error_kg AS error_kg,\\n       rows.row_error_pct AS error_pct\\nFROM long_bins\\nWHERE TRIM(long_bins.material_name) != ''\\n  AND recipes.recipe_name = :recipe_code\\n  AND recipes.start_time BETWEEN :from_date AND :to_date;\\n-- TOTALS SELECT --\\nSELECT SUM(rows.row_set_wt) AS total_set_wt,\\n       SUM(rows.row_ach_wt) AS total_ach_wt,\\n       SUM(rows.row_error_kg) AS total_error_kg,\\n       100.0 * SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0) AS total_error_pct\\nFROM rows;\",\n    \"entrypoints\": {\n      \"header\": \"SELECT :plant_name AS plant_name, :location AS location, :print_date AS print_date, :from_date AS from_date, :to_date AS to_date, :recipe_code AS recipe_code, :page_info AS page_info;\",\n      \"rows\": \"SELECT ROW_NUMBER() OVER (ORDER BY rows.row_material_name ASC, rows.row_first_seen_ts ASC, rows.row_recipe_id_min ASC) AS sl_no,\\n       rows.row_material_name AS material_name,\\n       rows.row_set_wt AS set_wt,\\n       rows.row_ach_wt AS ach_wt,\\n       rows.row_error_kg AS error_kg,\\n       rows.row_error_pct AS error_pct\\nFROM long_bins\\nWHERE TRIM(long_bins.material_name) != ''\\n  AND recipes.recipe_name = :recipe_code\\n  AND recipes.start_time BETWEEN :from_date AND :to_date;\",\n      \"totals\": \"SELECT SUM(rows.row_set_wt) AS total_set_wt,\\n       SUM(rows.row_ach_wt) AS total_ach_wt,\\n       SUM(rows.row_error_kg) AS total_error_kg,\\n       100.0 * SUM(rows.row_error_kg) / NULLIF(SUM(rows.row_set_wt), 0) AS total_error_pct\\nFROM rows;\"\n    },\n    \"params\": {\n      \"required\": [\n        \"recipe_code\",\n        \"from_date\",\n        \"to_date\"\n      ],\n      \"optional\": [\n        \"plant_name\",\n        \"location\",\n        \"print_date\",\n        \"page_info\"\n      ]\n    }\n  },\n  \"dialect\": \"sqlite\",\n  \"invalid\": false\n}",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762807816,
  "model": "gpt-4o-mini-2024-07-18",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": "fp_51db84afab",
  "usage": {
    "completion_tokens": 2467,
    "prompt_tokens": 7839,
    "total_tokens": 10306,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 0,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 0
    }
  }
}
```

## 2025-11-10T21:14:29Z - template_initial_html

```json
{
  "id": "chatcmpl-CaTTBR8GV2IbnVIhVOcxbOesZX98J",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "<!--BEGIN_HTML-->\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<title>{report_title}</title>\n<style>\n  @page { size: A4; margin: 14mm; }\n  :root{\n    --page-gap: 6mm;\n    --row-gap: 2mm;\n    --label-w: 32mm;\n    --col-slno: 14mm;\n    --col-material: 60mm;\n    --col-setwt: 28mm;\n    --col-achwt: 28mm;\n    --col-errkg: 24mm;\n    --col-errpct: 22mm;\n  }\n  *{ box-sizing: border-box; }\n  body{\n    margin:0;\n    color:#000;\n    font-family:\"Times New Roman\", serif;\n    font-size:12px;\n    line-height:1.25;\n  }\n  #report-header{\n    margin-bottom: 5mm;\n  }\n  #report-header .meta-table{\n    width:100%;\n    border:1px solid #000;\n    border-collapse:collapse;\n    table-layout:fixed;\n  }\n  #report-header .meta-table td{\n    padding:3mm 4mm;\n    vertical-align:top;\n  }\n  #report-header .meta-left{\n    width:70%;\n    white-space:pre-line;\n  }\n  #report-header .meta-right{\n    text-align:right;\n    width:30%;\n  }\n  #report-header .title{\n    text-align:center;\n    font-size:20px;\n    font-weight:700;\n    margin: 3mm 0 2mm 0;\n  }\n  #report-header .rule{\n    border-bottom:2px solid #000;\n    margin-bottom: 4mm;\n  }\n\n  /* Main data table */\n  #data-table{\n    width:100%;\n    border:1px solid #000;\n    border-collapse:collapse;\n    table-layout:fixed;\n    margin-top: 2mm;\n  }\n  #data-table col.c-slno{ width: var(--col-slno); }\n  #data-table col.c-material{ width: var(--col-material); }\n  #data-table col.c-set{ width: var(--col-setwt); }\n  #data-table col.c-ach{ width: var(--col-achwt); }\n  #data-table col.c-errkg{ width: var(--col-errkg); }\n  #data-table col.c-errpct{ width: var(--col-errpct); }\n\n  #data-table th,\n  #data-table td{\n    border:1px solid #000;\n    padding:3mm 3mm;\n  }\n  #data-table thead th{\n    font-weight:700;\n    text-align:center;\n  }\n  #data-table td.num{ text-align:right; }\n  #data-table td.center{ text-align:center; }\n  #data-table td.material{ white-space:pre-wrap; }\n\n  /* Totals */\n  #report-totals tr td{\n    font-weight:700;\n  }\n  #report-totals tr td:first-child{\n    text-align:center;\n  }\n\n  /* Footer */\n  footer{\n    position:fixed;\n    bottom:10mm;\n    left:14mm;\n    right:14mm;\n    font-size:12px;\n  }\n  footer .f-left{ float:left; }\n  footer .f-right{ float:right; }\n  footer:after{ content:\"\"; display:block; clear:both; }\n</style>\n</head>\n<body>\n\n<div id=\"report-header\">\n  <table class=\"meta-table\">\n    <tr>\n      <td class=\"meta-left\">\n        Plant name  : {plant_name}\n        <br>\n        Location    : {location}\n      </td>\n      <td class=\"meta-right\">\n        From Date: {from_date} &nbsp;&nbsp; To {to_date}\n      </td>\n    </tr>\n    <tr>\n      <td class=\"meta-left\">\n        Print Date  : {print_date}\n      </td>\n      <td class=\"meta-right\">\n        Recipe code : {recipe_code}\n      </td>\n    </tr>\n  </table>\n\n  <div class=\"title\">{report_title}</div>\n  <div class=\"rule\"></div>\n</div>\n\n<table id=\"data-table\">\n  <colgroup>\n    <col class=\"c-slno\">\n    <col class=\"c-material\">\n    <col class=\"c-set\">\n    <col class=\"c-ach\">\n    <col class=\"c-errkg\">\n    <col class=\"c-errpct\">\n  </colgroup>\n  <thead>\n    <tr>\n      <th data-label=\"sl_no\">Sl. No.</th>\n      <th data-label=\"material_name\">Material name</th>\n      <th data-label=\"set_wt\">Set. wt(Kg)</th>\n      <th data-label=\"ach_wt\">Ach. wt(Kg)</th>\n      <th data-label=\"error_kg\">Error(Kg)</th>\n      <th data-label=\"error_pct\">Error %</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td class=\"center\">{sl_no}</td>\n      <td class=\"material\">{material_name}</td>\n      <td class=\"num\">{set_wt}</td>\n      <td class=\"num\">{ach_wt}</td>\n      <td class=\"num\">{error_kg}</td>\n      <td class=\"num\">{error_pct}</td>\n    </tr>\n  </tbody>\n  <tfoot id=\"report-totals\">\n    <tr>\n      <td colspan=\"2\">Total</td>\n      <td class=\"num\">{total_set_wt}</td>\n      <td class=\"num\">{total_ach_wt}</td>\n      <td class=\"num\">{total_error_kg}</td>\n      <td class=\"num\">{total_error_pct}</td>\n    </tr>\n  </tfoot>\n</table>\n\n<footer>\n  <div class=\"f-left\">{footer_company}</div>\n  <div class=\"f-right\">{page_info}</div>\n</footer>\n\n</body>\n</html>\n<!--END_HTML-->\n\n<!--BEGIN_SCHEMA_JSON-->\n{\n  \"scalars\": [\n    \"plant_name\",\n    \"location\",\n    \"from_date\",\n    \"to_date\",\n    \"print_date\",\n    \"recipe_code\",\n    \"report_title\",\n    \"footer_company\",\n    \"page_info\"\n  ],\n  \"row_tokens\": [\n    \"sl_no\",\n    \"material_name\",\n    \"set_wt\",\n    \"ach_wt\",\n    \"error_kg\",\n    \"error_pct\"\n  ],\n  \"totals\": [\n    \"total_set_wt\",\n    \"total_ach_wt\",\n    \"total_error_kg\",\n    \"total_error_pct\"\n  ],\n  \"notes\": \"\"\n}\n<!--END_SCHEMA_JSON-->",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762809125,
  "model": "gpt-5-2025-08-07",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": null,
  "usage": {
    "completion_tokens": 4860,
    "prompt_tokens": 1544,
    "total_tokens": 6404,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 3392,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 0
    }
  }
}
```

## 2025-11-10T21:16:57Z - template_fix_html_call2

```json
{
  "id": "chatcmpl-CaTVgbNUOUHKnfh7FLvK85p3tRjh8",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "<!--BEGIN_HTML-->\n<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"utf-8\" />\n<title>{report_title}</title>\n<style>\n  @page { size: A4; margin: 14mm; }\n  :root{\n    --page-gap: 6mm;\n    --row-gap: 2mm;\n    --label-w: 32mm;\n    --col-slno: 12mm;\n    --col-material: 82mm;\n    --col-setwt: 28mm;\n    --col-achwt: 28mm;\n    --col-errkg: 20mm;\n    --col-errpct: 12mm;\n  }\n  *{ box-sizing: border-box; }\n  html,body{ height:100%; }\n  body{\n    margin:0;\n    color:#000;\n    font-family:\"Times New Roman\", serif;\n    font-size:12px;\n    line-height:1.22;\n  }\n\n  /* Header block */\n  #report-header{\n    margin-bottom: 3mm;\n  }\n  #report-header .meta-table{\n    width:100%;\n    border:1px solid #000;\n    border-collapse:separate;\n    border-spacing:0;\n    table-layout:fixed;\n  }\n  #report-header .meta-table td{\n    padding:2.2mm 3mm;\n    vertical-align:top;\n    border:none;\n  }\n  #report-header .meta-left{\n    width:62%;\n    white-space:pre-line;\n  }\n  #report-header .meta-right{\n    text-align:right;\n    width:38%;\n    white-space:nowrap;\n  }\n  #report-header .title{\n    text-align:center;\n    font-size:18.5px;\n    font-weight:700;\n    margin: 2mm 0 1.6mm 0;\n  }\n  #report-header .rule{\n    border-bottom:1px solid #000;\n    margin-bottom: 1.8mm;\n  }\n\n  /* Main data table */\n  #data-table{\n    width:100%;\n    border:1px solid #000;\n    border-collapse:collapse;\n    table-layout:fixed;\n    margin-top: 0;\n    font-variant-numeric: tabular-nums;\n    -webkit-font-smoothing: antialiased;\n    break-inside: avoid;\n    page-break-inside: avoid;\n  }\n  #data-table col.c-slno{ width: var(--col-slno); }\n  #data-table col.c-material{ width: var(--col-material); }\n  #data-table col.c-set{ width: var(--col-setwt); }\n  #data-table col.c-ach{ width: var(--col-achwt); }\n  #data-table col.c-errkg{ width: var(--col-errkg); }\n  #data-table col.c-errpct{ width: var(--col-errpct); }\n\n  #data-table th,\n  #data-table td{\n    border:1px solid #000;\n    padding:2.2mm 2.4mm;\n    vertical-align:top;\n  }\n  #data-table thead th{\n    font-weight:700;\n    text-align:center;\n    line-height:1.15;\n    vertical-align:middle;\n  }\n  #data-table td.num{ text-align:right; }\n  #data-table td.center{ text-align:center; }\n  #data-table td.material{ white-space:pre-wrap; }\n\n  /* Totals */\n  #report-totals tr td{\n    font-weight:700;\n  }\n  #report-totals tr td:first-child{\n    text-align:center;\n  }\n\n  /* Footer */\n  footer{\n    position:fixed;\n    bottom:14mm;\n    left:14mm;\n    right:14mm;\n    font-size:12px;\n  }\n  footer .f-left{ float:left; }\n  footer .f-right{ float:right; }\n  footer:after{ content:\"\"; display:block; clear:both; }\n</style>\n</head>\n<body>\n\n<div id=\"report-header\">\n  <table class=\"meta-table\">\n    <tr>\n      <td class=\"meta-left\">\n        Plant name  : {plant_name}\n        <br />\n        Location    : {location}\n      </td>\n      <td class=\"meta-right\">\n        From Date: {from_date}   To {to_date}\n      </td>\n    </tr>\n    <tr>\n      <td class=\"meta-left\">\n        Print Date  : {print_date}\n      </td>\n      <td class=\"meta-right\">\n        Recipe code : {recipe_code}\n      </td>\n    </tr>\n  </table>\n\n  <div class=\"title\">{report_title}</div>\n  <div class=\"rule\"></div>\n</div>\n\n<table id=\"data-table\">\n  <colgroup>\n    <col class=\"c-slno\" />\n    <col class=\"c-material\" />\n    <col class=\"c-set\" />\n    <col class=\"c-ach\" />\n    <col class=\"c-errkg\" />\n    <col class=\"c-errpct\" />\n  </colgroup>\n  <thead>\n    <tr>\n      <th data-label=\"sl_no\">Sl. No.</th>\n      <th data-label=\"material_name\">Material name</th>\n      <th data-label=\"set_wt\">Set. wt(Kg)</th>\n      <th data-label=\"ach_wt\">Ach. wt(Kg)</th>\n      <th data-label=\"error_kg\">Error(Kg)</th>\n      <th data-label=\"error_pct\">Error %</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td class=\"center\">{sl_no}</td>\n      <td class=\"material\">{material_name}</td>\n      <td class=\"num\">{set_wt}</td>\n      <td class=\"num\">{ach_wt}</td>\n      <td class=\"num\">{error_kg}</td>\n      <td class=\"num\">{error_pct}</td>\n    </tr>\n  </tbody>\n  <tfoot id=\"report-totals\">\n    <tr>\n      <td colspan=\"2\">Total</td>\n      <td class=\"num\">{total_set_wt}</td>\n      <td class=\"num\">{total_ach_wt}</td>\n      <td class=\"num\">{total_error_kg}</td>\n      <td class=\"num\">{total_error_pct}</td>\n    </tr>\n  </tfoot>\n</table>\n\n<footer>\n  <div class=\"f-left\">{footer_company}</div>\n  <div class=\"f-right\">{page_info}</div>\n</footer>\n\n</body>\n</html>\n<!--END_HTML-->",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762809280,
  "model": "gpt-5-2025-08-07",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": null,
  "usage": {
    "completion_tokens": 5134,
    "prompt_tokens": 3611,
    "total_tokens": 8745,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 3712,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 0
    }
  }
}
```

## 2025-11-10T21:21:14Z - llm_call_3_v7

```json
{
  "id": "chatcmpl-CaTYDelPoXXej18GRFtM4uQgRP5Ua",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "{\n  \"mapping\": {\n    \"plant_name\": \"params.plant_name\",\n    \"location\": \"params.location\",\n    \"from_date\": \"To Be Selected...\",\n    \"to_date\": \"To Be Selected...\",\n    \"print_date\": \"params.print_date\",\n    \"recipe_code\": \"params.recipe_code\",\n    \"sl_no\": \"UNRESOLVED\",\n    \"material_name\": \"UNRESOLVED\",\n    \"set_wt\": \"UNRESOLVED\",\n    \"ach_wt\": \"UNRESOLVED\",\n    \"error_kg\": \"UNRESOLVED\",\n    \"error_pct\": \"UNRESOLVED\",\n    \"total_set_wt\": \"(COALESCE(recipes.bin1_sp,0)+COALESCE(recipes.bin2_sp,0)+COALESCE(recipes.bin3_sp,0)+COALESCE(recipes.bin4_sp,0)+COALESCE(recipes.bin5_sp,0)+COALESCE(recipes.bin6_sp,0)+COALESCE(recipes.bin7_sp,0)+COALESCE(recipes.bin8_sp,0)+COALESCE(recipes.bin9_sp,0)+COALESCE(recipes.bin10_sp,0)+COALESCE(recipes.bin11_sp,0)+COALESCE(recipes.bin12_sp,0))\",\n    \"total_ach_wt\": \"(COALESCE(recipes.bin1_act,0)+COALESCE(recipes.bin2_act,0)+COALESCE(recipes.bin3_act,0)+COALESCE(recipes.bin4_act,0)+COALESCE(recipes.bin5_act,0)+COALESCE(recipes.bin6_act,0)+COALESCE(recipes.bin7_act,0)+COALESCE(recipes.bin8_act,0)+COALESCE(recipes.bin9_act,0)+COALESCE(recipes.bin10_act,0)+COALESCE(recipes.bin11_act,0)+COALESCE(recipes.bin12_act,0))\",\n    \"total_error_kg\": \"((COALESCE(recipes.bin1_act,0)+COALESCE(recipes.bin2_act,0)+COALESCE(recipes.bin3_act,0)+COALESCE(recipes.bin4_act,0)+COALESCE(recipes.bin5_act,0)+COALESCE(recipes.bin6_act,0)+COALESCE(recipes.bin7_act,0)+COALESCE(recipes.bin8_act,0)+COALESCE(recipes.bin9_act,0)+COALESCE(recipes.bin10_act,0)+COALESCE(recipes.bin11_act,0)+COALESCE(recipes.bin12_act,0))-(COALESCE(recipes.bin1_sp,0)+COALESCE(recipes.bin2_sp,0)+COALESCE(recipes.bin3_sp,0)+COALESCE(recipes.bin4_sp,0)+COALESCE(recipes.bin5_sp,0)+COALESCE(recipes.bin6_sp,0)+COALESCE(recipes.bin7_sp,0)+COALESCE(recipes.bin8_sp,0)+COALESCE(recipes.bin9_sp,0)+COALESCE(recipes.bin10_sp,0)+COALESCE(recipes.bin11_sp,0)+COALESCE(recipes.bin12_sp,0)))\",\n    \"total_error_pct\": \"CASE WHEN (COALESCE(recipes.bin1_sp,0)+COALESCE(recipes.bin2_sp,0)+COALESCE(recipes.bin3_sp,0)+COALESCE(recipes.bin4_sp,0)+COALESCE(recipes.bin5_sp,0)+COALESCE(recipes.bin6_sp,0)+COALESCE(recipes.bin7_sp,0)+COALESCE(recipes.bin8_sp,0)+COALESCE(recipes.bin9_sp,0)+COALESCE(recipes.bin10_sp,0)+COALESCE(recipes.bin11_sp,0)+COALESCE(recipes.bin12_sp,0)) <> 0 THEN ((COALESCE(recipes.bin1_act,0)+COALESCE(recipes.bin2_act,0)+COALESCE(recipes.bin3_act,0)+COALESCE(recipes.bin4_act,0)+COALESCE(recipes.bin5_act,0)+COALESCE(recipes.bin6_act,0)+COALESCE(recipes.bin7_act,0)+COALESCE(recipes.bin8_act,0)+COALESCE(recipes.bin9_act,0)+COALESCE(recipes.bin10_act,0)+COALESCE(recipes.bin11_act,0)+COALESCE(recipes.bin12_act,0))-(COALESCE(recipes.bin1_sp,0)+COALESCE(recipes.bin2_sp,0)+COALESCE(recipes.bin3_sp,0)+COALESCE(recipes.bin4_sp,0)+COALESCE(recipes.bin5_sp,0)+COALESCE(recipes.bin6_sp,0)+COALESCE(recipes.bin7_sp,0)+COALESCE(recipes.bin8_sp,0)+COALESCE(recipes.bin9_sp,0)+COALESCE(recipes.bin10_sp,0)+COALESCE(recipes.bin11_sp,0)+COALESCE(recipes.bin12_sp,0))) / (COALESCE(recipes.bin1_sp,0)+COALESCE(recipes.bin2_sp,0)+COALESCE(recipes.bin3_sp,0)+COALESCE(recipes.bin4_sp,0)+COALESCE(recipes.bin5_sp,0)+COALESCE(recipes.bin6_sp,0)+COALESCE(recipes.bin7_sp,0)+COALESCE(recipes.bin8_sp,0)+COALESCE(recipes.bin9_sp,0)+COALESCE(recipes.bin10_sp,0)+COALESCE(recipes.bin11_sp,0)+COALESCE(recipes.bin12_sp,0)) ELSE NULL END\",\n    \"page_info\": \"To Be Selected...\"\n  },\n  \"token_samples\": {\n    \"plant_name\": \"SSR AQUA\",\n    \"location\": \"Gudivada\",\n    \"from_date\": \"24/03/2024\",\n    \"to_date\": \"24/03/2024\",\n    \"print_date\": \"25/03/2024\",\n    \"recipe_code\": \"GANGADHAR-2024\",\n    \"report_title\": \"Consumption report\",\n    \"sl_no\": \"1\",\n    \"material_name\": \"CM 100 + DORB 100 KRR\",\n    \"set_wt\": \"11,800.00\",\n    \"ach_wt\": \"11,803.20\",\n    \"error_kg\": \"3.20\",\n    \"error_pct\": \"0.0271\",\n    \"total_set_wt\": \"80,000.00\",\n    \"total_ach_wt\": \"80,016.00\",\n    \"total_error_kg\": \"16.00\",\n    \"total_error_pct\": \"0.0200\",\n    \"footer_company\": \"Indian Industrial Machines Pvt. Ltd.\",\n    \"page_info\": \"Page 1 of 1\"\n  },\n  \"meta\": {\n    \"unresolved\": [\n      \"sl_no\",\n      \"material_name\",\n      \"set_wt\",\n      \"ach_wt\",\n      \"error_kg\",\n      \"error_pct\"\n    ],\n    \"hints\": {\n      \"total_set_wt\": {\n        \"op\": \"SUM\",\n        \"over\": [\n          \"recipes.bin1_sp\",\n          \"recipes.bin2_sp\",\n          \"recipes.bin3_sp\",\n          \"recipes.bin4_sp\",\n          \"recipes.bin5_sp\",\n          \"recipes.bin6_sp\",\n          \"recipes.bin7_sp\",\n          \"recipes.bin8_sp\",\n          \"recipes.bin9_sp\",\n          \"recipes.bin10_sp\",\n          \"recipes.bin11_sp\",\n          \"recipes.bin12_sp\"\n        ]\n      },\n      \"total_ach_wt\": {\n        \"op\": \"SUM\",\n        \"over\": [\n          \"recipes.bin1_act\",\n          \"recipes.bin2_act\",\n          \"recipes.bin3_act\",\n          \"recipes.bin4_act\",\n          \"recipes.bin5_act\",\n          \"recipes.bin6_act\",\n          \"recipes.bin7_act\",\n          \"recipes.bin8_act\",\n          \"recipes.bin9_act\",\n          \"recipes.bin10_act\",\n          \"recipes.bin11_act\",\n          \"recipes.bin12_act\"\n        ]\n      }\n    }\n  }\n}",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762809437,
  "model": "gpt-5-2025-08-07",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": null,
  "usage": {
    "completion_tokens": 6834,
    "prompt_tokens": 3584,
    "total_tokens": 10418,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 5056,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 3456
    }
  }
}
```

## 2025-11-10T21:21:43Z - llm_call_3_v7

```json
{
  "id": "chatcmpl-CaTYCcEZu3tw6MdtHnlXigPZaWYIX",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "{\n  \"mapping\": {\n    \"plant_name\": \"params.plant_name\",\n    \"location\": \"params.location\",\n    \"from_date\": \"To Be Selected...\",\n    \"to_date\": \"To Be Selected...\",\n    \"print_date\": \"params.print_date\",\n    \"recipe_code\": \"recipes.recipe_name\",\n    \"sl_no\": \"ROW_NUMBER() OVER (ORDER BY recipes.id)\",\n    \"material_name\": \"UNRESOLVED\",\n    \"set_wt\": \"UNRESOLVED\",\n    \"ach_wt\": \"UNRESOLVED\",\n    \"error_kg\": \"UNRESOLVED\",\n    \"error_pct\": \"UNRESOLVED\",\n    \"total_set_wt\": \"SUM(recipes.bin1_sp + recipes.bin2_sp + recipes.bin3_sp + recipes.bin4_sp + recipes.bin5_sp + recipes.bin6_sp + recipes.bin7_sp + recipes.bin8_sp + recipes.bin9_sp + recipes.bin10_sp + recipes.bin11_sp + recipes.bin12_sp)\",\n    \"total_ach_wt\": \"SUM(recipes.bin1_act + recipes.bin2_act + recipes.bin3_act + recipes.bin4_act + recipes.bin5_act + recipes.bin6_act + recipes.bin7_act + recipes.bin8_act + recipes.bin9_act + recipes.bin10_act + recipes.bin11_act + recipes.bin12_act)\",\n    \"total_error_kg\": \"SUM(recipes.bin1_act + recipes.bin2_act + recipes.bin3_act + recipes.bin4_act + recipes.bin5_act + recipes.bin6_act + recipes.bin7_act + recipes.bin8_act + recipes.bin9_act + recipes.bin10_act + recipes.bin11_act + recipes.bin12_act) - SUM(recipes.bin1_sp + recipes.bin2_sp + recipes.bin3_sp + recipes.bin4_sp + recipes.bin5_sp + recipes.bin6_sp + recipes.bin7_sp + recipes.bin8_sp + recipes.bin9_sp + recipes.bin10_sp + recipes.bin11_sp + recipes.bin12_sp)\",\n    \"total_error_pct\": \"CASE WHEN SUM(recipes.bin1_sp + recipes.bin2_sp + recipes.bin3_sp + recipes.bin4_sp + recipes.bin5_sp + recipes.bin6_sp + recipes.bin7_sp + recipes.bin8_sp + recipes.bin9_sp + recipes.bin10_sp + recipes.bin11_sp + recipes.bin12_sp) = 0 THEN NULL ELSE 100 * (SUM(recipes.bin1_act + recipes.bin2_act + recipes.bin3_act + recipes.bin4_act + recipes.bin5_act + recipes.bin6_act + recipes.bin7_act + recipes.bin8_act + recipes.bin9_act + recipes.bin10_act + recipes.bin11_act + recipes.bin12_act) - SUM(recipes.bin1_sp + recipes.bin2_sp + recipes.bin3_sp + recipes.bin4_sp + recipes.bin5_sp + recipes.bin6_sp + recipes.bin7_sp + recipes.bin8_sp + recipes.bin9_sp + recipes.bin10_sp + recipes.bin11_sp + recipes.bin12_sp)) / SUM(recipes.bin1_sp + recipes.bin2_sp + recipes.bin3_sp + recipes.bin4_sp + recipes.bin5_sp + recipes.bin6_sp + recipes.bin7_sp + recipes.bin8_sp + recipes.bin9_sp + recipes.bin10_sp + recipes.bin11_sp + recipes.bin12_sp) END\",\n    \"page_info\": \"To Be Selected...\"\n  },\n  \"token_samples\": {\n    \"report_title\": \"Consumption report\",\n    \"plant_name\": \"SSR AQUA\",\n    \"location\": \"Gudivada\",\n    \"from_date\": \"24/03/2024\",\n    \"to_date\": \"24/03/2024\",\n    \"print_date\": \"25/03/2024\",\n    \"recipe_code\": \"GANGADHAR-2024\",\n    \"sl_no\": \"1\",\n    \"material_name\": \"CM 100 + DORB 100 KRR\",\n    \"set_wt\": \"11,800.00\",\n    \"ach_wt\": \"11,803.20\",\n    \"error_kg\": \"3.20\",\n    \"error_pct\": \"0.0271\",\n    \"total_set_wt\": \"80,000.00\",\n    \"total_ach_wt\": \"80,016.00\",\n    \"total_error_kg\": \"16.00\",\n    \"total_error_pct\": \"0.0200\",\n    \"footer_company\": \"Indian Industrial Machines Pvt. Ltd.\",\n    \"page_info\": \"Page 1 of 1\"\n  },\n  \"meta\": {\n    \"unresolved\": [\n      \"material_name\",\n      \"set_wt\",\n      \"ach_wt\",\n      \"error_kg\",\n      \"error_pct\"\n    ],\n    \"hints\": {\n      \"material_name\": { \"op\": \"ENUMERATE\", \"over\": [\"recipes.bin1_content\",\"recipes.bin2_content\",\"recipes.bin3_content\",\"recipes.bin4_content\",\"recipes.bin5_content\",\"recipes.bin6_content\",\"recipes.bin7_content\",\"recipes.bin8_content\",\"recipes.bin9_content\",\"recipes.bin10_content\",\"recipes.bin11_content\",\"recipes.bin12_content\"] },\n      \"set_wt\": { \"op\": \"ENUMERATE\", \"over\": [\"recipes.bin1_sp\",\"recipes.bin2_sp\",\"recipes.bin3_sp\",\"recipes.bin4_sp\",\"recipes.bin5_sp\",\"recipes.bin6_sp\",\"recipes.bin7_sp\",\"recipes.bin8_sp\",\"recipes.bin9_sp\",\"recipes.bin10_sp\",\"recipes.bin11_sp\",\"recipes.bin12_sp\"] },\n      \"ach_wt\": { \"op\": \"ENUMERATE\", \"over\": [\"recipes.bin1_act\",\"recipes.bin2_act\",\"recipes.bin3_act\",\"recipes.bin4_act\",\"recipes.bin5_act\",\"recipes.bin6_act\",\"recipes.bin7_act\",\"recipes.bin8_act\",\"recipes.bin9_act\",\"recipes.bin10_act\",\"recipes.bin11_act\",\"recipes.bin12_act\"] },\n      \"error_kg\": { \"op\": \"DIFF_PER_BIN\", \"over\": [\"recipes.bin1_act - recipes.bin1_sp\",\"recipes.bin2_act - recipes.bin2_sp\",\"recipes.bin3_act - recipes.bin3_sp\",\"recipes.bin4_act - recipes.bin4_sp\",\"recipes.bin5_act - recipes.bin5_sp\",\"recipes.bin6_act - recipes.bin6_sp\",\"recipes.bin7_act - recipes.bin7_sp\",\"recipes.bin8_act - recipes.bin8_sp\",\"recipes.bin9_act - recipes.bin9_sp\",\"recipes.bin10_act - recipes.bin10_sp\",\"recipes.bin11_act - recipes.bin11_sp\",\"recipes.bin12_act - recipes.bin12_sp\"] },\n      \"total_set_wt\": { \"op\": \"SUM\", \"over\": [\"recipes.bin1_sp\",\"recipes.bin2_sp\",\"recipes.bin3_sp\",\"recipes.bin4_sp\",\"recipes.bin5_sp\",\"recipes.bin6_sp\",\"recipes.bin7_sp\",\"recipes.bin8_sp\",\"recipes.bin9_sp\",\"recipes.bin10_sp\",\"recipes.bin11_sp\",\"recipes.bin12_sp\"] },\n      \"total_ach_wt\": { \"op\": \"SUM\", \"over\": [\"recipes.bin1_act\",\"recipes.bin2_act\",\"recipes.bin3_act\",\"recipes.bin4_act\",\"recipes.bin5_act\",\"recipes.bin6_act\",\"recipes.bin7_act\",\"recipes.bin8_act\",\"recipes.bin9_act\",\"recipes.bin10_act\",\"recipes.bin11_act\",\"recipes.bin12_act\"] },\n      \"total_error_kg\": { \"op\": \"SUM_DIFF\", \"over\": [\"recipes.bin1_act - recipes.bin1_sp\",\"recipes.bin2_act - recipes.bin2_sp\",\"recipes.bin3_act - recipes.bin3_sp\",\"recipes.bin4_act - recipes.bin4_sp\",\"recipes.bin5_act - recipes.bin5_sp\",\"recipes.bin6_act - recipes.bin6_sp\",\"recipes.bin7_act - recipes.bin7_sp\",\"recipes.bin8_act - recipes.bin8_sp\",\"recipes.bin9_act - recipes.bin9_sp\",\"recipes.bin10_act - recipes.bin10_sp\",\"recipes.bin11_act - recipes.bin11_sp\",\"recipes.bin12_act - recipes.bin12_sp\"] },\n      \"total_error_pct\": { \"op\": \"PCT_OF_TOTAL\", \"over\": [\"recipes.bin1_sp\",\"recipes.bin2_sp\",\"recipes.bin3_sp\",\"recipes.bin4_sp\",\"recipes.bin5_sp\",\"recipes.bin6_sp\",\"recipes.bin7_sp\",\"recipes.bin8_sp\",\"recipes.bin9_sp\",\"recipes.bin10_sp\",\"recipes.bin11_sp\",\"recipes.bin12_sp\",\"recipes.bin1_act\",\"recipes.bin2_act\",\"recipes.bin3_act\",\"recipes.bin4_act\",\"recipes.bin5_act\",\"recipes.bin6_act\",\"recipes.bin7_act\",\"recipes.bin8_act\",\"recipes.bin9_act\",\"recipes.bin10_act\",\"recipes.bin11_act\",\"recipes.bin12_act\"] }\n    }\n  }\n}",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762809436,
  "model": "gpt-5-2025-08-07",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": null,
  "usage": {
    "completion_tokens": 7386,
    "prompt_tokens": 3584,
    "total_tokens": 10970,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 5568,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 0
    }
  }
}
```

## 2025-11-10T21:24:24Z - v4

```json
{
  "id": "chatcmpl-CaTdgnkCdXVFAjE5M676pPfxlSxSq",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "{\n  \"final_template_html\": \"\\n<html>\\n<head>\\n<meta charset=\\\"utf-8\\\" />\\n<title>Consumption report</title>\\n<style>\\n  @page { size: A4; margin: 14mm; }\\n  :root{\\n    --page-gap: 6mm;\\n    --row-gap: 2mm;\\n    --label-w: 32mm;\\n    --col-slno: 12mm;\\n    --col-material: 82mm;\\n    --col-setwt: 28mm;\\n    --col-achwt: 28mm;\\n    --col-errkg: 20mm;\\n    --col-errpct: 12mm;\\n  }\\n  *{ box-sizing: border-box; }\\n  html,body{ height:100%; }\\n  body{\\n    margin:0;\\n    color:#000;\\n    font-family:\\\"Times New Roman\\\", serif;\\n    font-size:12px;\\n    line-height:1.22;\\n  }\\n\\n  /* Header block */\\n  #report-header{\\n    margin-bottom: 3mm;\\n  }\\n  #report-header .meta-table{\\n    width:100%;\\n    border:1px solid #000;\\n    border-collapse:separate;\\n    border-spacing:0;\\n    table-layout:fixed;\\n  }\\n  #report-header .meta-table td{\\n    padding:2.2mm 3mm;\\n    vertical-align:top;\\n    border:none;\\n  }\\n  #report-header .meta-left{\\n    width:62%;\\n    white-space:pre-line;\\n  }\\n  #report-header .meta-right{\\n    text-align:right;\\n    width:38%;\\n    white-space:nowrap;\\n  }\\n  #report-header .title{\\n    text-align:center;\\n    font-size:18.5px;\\n    font-weight:700;\\n    margin: 2mm 0 1.6mm 0;\\n  }\\n  #report-header .rule{\\n    border-bottom:1px solid #000;\\n    margin-bottom: 1.8mm;\\n  }\\n\\n  /* Main data table */\\n  #data-table{\\n    width:100%;\\n    border:1px solid #000;\\n    border-collapse:collapse;\\n    table-layout:fixed;\\n    margin-top: 0;\\n    font-variant-numeric: tabular-nums;\\n    -webkit-font-smoothing: antialiased;\\n    break-inside: avoid;\\n    page-break-inside: avoid;\\n  }\\n  #data-table col.c-slno{ width: var(--col-slno); }\\n  #data-table col.c-material{ width: var(--col-material); }\\n  #data-table col.c-set{ width: var(--col-setwt); }\\n  #data-table col.c-ach{ width: var(--col-achwt); }\\n  #data-table col.c-errkg{ width: var(--col-errkg); }\\n  #data-table col.c-errpct{ width: var(--col-errpct); }\\n\\n  #data-table th,\\n  #data-table td{\\n    border:1px solid #000;\\n    padding:2.2mm 2.4mm;\\n    vertical-align:top;\\n  }\\n  #data-table thead th{\\n    font-weight:700;\\n    text-align:center;\\n    line-height:1.15;\\n    vertical-align:middle;\\n  }\\n  #data-table td.num{ text-align:right; }\\n  #data-table td.center{ text-align:center; }\\n  #data-table td.material{ white-space:pre-wrap; }\\n\\n  /* Totals */\\n  #report-totals tr td{\\n    font-weight:700;\\n  }\\n  #report-totals tr td:first-child{\\n    text-align:center;\\n  }\\n\\n  /* Footer */\\n  footer{\\n    position:fixed;\\n    bottom:14mm;\\n    left:14mm;\\n    right:14mm;\\n    font-size:12px;\\n  }\\n  footer .f-left{ float:left; }\\n  footer .f-right{ float:right; }\\n  footer:after{ content:\\\"\\\"; display:block; clear:both; }\\n</style>\\n</head>\\n<body>\\n\\n<div id=\\\"report-header\\\">\\n  <table class=\\\"meta-table\\\">\\n    <tr>\\n      <td class=\\\"meta-left\\\">\\n        Plant name  : SSR AQUA\\n        <br />\\n        Location    : Gudivada\\n      </td>\\n      <td class=\\\"meta-right\\\">\\n        From Date: {from_date}   To {to_date}\\n      </td>\\n    </tr>\\n    <tr>\\n      <td class=\\\"meta-left\\\">\\n        Print Date  : 25/03/2024\\n      </td>\\n      <td class=\\\"meta-right\\\">\\n        Recipe code : {recipe_code}\\n      </td>\\n    </tr>\\n  </table>\\n\\n  <div class=\\\"title\\\">Consumption report</div>\\n  <div class=\\\"rule\\\"></div>\\n</div>\\n\\n<table id=\\\"data-table\\\">\\n  <colgroup>\\n    <col class=\\\"c-slno\\\" />\\n    <col class=\\\"c-material\\\" />\\n    <col class=\\\"c-set\\\" />\\n    <col class=\\\"c-ach\\\" />\\n    <col class=\\\"c-errkg\\\" />\\n    <col class=\\\"c-errpct\\\" />\\n  </colgroup>\\n  <thead>\\n    <tr>\\n      <th data-label=\\\"sl_no\\\">Sl. No.</th>\\n      <th data-label=\\\"material_name\\\">Material name</th>\\n      <th data-label=\\\"set_wt\\\">Set. wt(Kg)</th>\\n      <th data-label=\\\"ach_wt\\\">Ach. wt(Kg)</th>\\n      <th data-label=\\\"error_kg\\\">Error(Kg)</th>\\n      <th data-label=\\\"error_pct\\\">Error %</th>\\n    </tr>\\n  </thead>\\n  <tbody>\\n    <tr>\\n      <td class=\\\"center\\\">{sl_no}</td>\\n      <td class=\\\"material\\\">{material_name}</td>\\n      <td class=\\\"num\\\">{set_wt}</td>\\n      <td class=\\\"num\\\">{ach_wt}</td>\\n      <td class=\\\"num\\\">{error_kg}</td>\\n      <td class=\\\"num\\\">{error_pct}</td>\\n    </tr>\\n  </tbody>\\n  <tfoot id=\\\"report-totals\\\">\\n    <tr>\\n      <td colspan=\\\"2\\\">Total</td>\\n      <td class=\\\"num\\\">{total_set_wt}</td>\\n      <td class=\\\"num\\\">{total_ach_wt}</td>\\n      <td class=\\\"num\\\">{total_error_kg}</td>\\n      <td class=\\\"num\\\">{total_error_pct}</td>\\n    </tr>\\n  </tfoot>\\n</table>\\n\\n<footer>\\n  <div class=\\\"f-left\\\">Indian Industrial Machines Pvt. Ltd.</div>\\n  <div class=\\\"f-right\\\">{page_info}</div>\\n</footer>\\n\\n</body>\\n</html>\",\n  \"page_summary\": \"This is a single-page Consumption report template for a manufacturing plant. Constants have been inlined where the mapping marks them as INPUT_SAMPLE: Plant name = \\\"SSR AQUA\\\" and Location = \\\"Gudivada\\\" in the header, and Print Date = \\\"25/03/2024\\\". The report title remains \\\"Consumption report\\\" (already literal), and the footer company remains \\\"Indian Industrial Machines Pvt. Ltd.\\\" (already literal). The remaining placeholders are dynamic/unresolved: From Date {from_date} and To {to_date} are LATER_SELECTED (sample suggests both 24/03/2024, but they remain tokens); Recipe code {recipe_code} is mapped to recipes.recipe_name; row fields {sl_no} (ROW_NUMBER() OVER (ORDER BY recipes.id)), {material_name} (unresolved; likely enumerates recipes.bin1_content \u2026 bin12_content), {set_wt} (unresolved; likely recipes.binX_sp), {ach_wt} (unresolved; likely recipes.binX_act), {error_kg} (unresolved; likely per-bin act minus sp), and {error_pct} (unresolved calculation per row). Totals in the footer row remain tokens tied to SQL expressions: {total_set_wt} and {total_ach_wt} are sums across bins; {total_error_kg} is total achieved minus total set; {total_error_pct} is the percent of total deviation with 0-division guard. Page information {page_info} is LATER_SELECTED (sample shows \\\"Page 1 of 1\\\" but left dynamic). No structural changes were made; the table retains a single prototype row in <tbody> for repetition, and all other tokens are preserved verbatim for data binding.\"\n}",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762809776,
  "model": "gpt-5-2025-08-07",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": null,
  "usage": {
    "completion_tokens": 3739,
    "prompt_tokens": 5926,
    "total_tokens": 9665,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 1728,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 0
    }
  }
}
```

## 2025-11-10T21:28:25Z - v2

```json
{
  "id": "chatcmpl-CaTgF7rVmLCaOW0GFD8LZ6CWEd4Yi",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "{\n  \"overview_md\": \"Executive Summary\\nThis report lists material-wise Set/Achieved consumption and error for a selected recipe within a date range. Source data lives in recipes with 12 per-row bin columns for content, setpoint (sp), and achieved (act). We unpivot those 12 bin columns into a long form (one row per bin per recipe), clean/standardize material names, and then aggregate by material to produce the rows dataset. Totals are computed from the rows dataset to ensure footer matches displayed detail. Required user filters: date range and recipe_code. plant_name is accepted as a required parameter per key_tokens but is not filterable with the current catalog; it is pass-through only.\\n\\nToken Inventory\\nScalars: plant_name, location, from_date, to_date, print_date, recipe_code, report_title, footer_company, page_info\\nRows: sl_no, material_name, set_wt, ach_wt, error_kg, error_pct\\nTotals: total_set_wt, total_ach_wt, total_error_kg, total_error_pct\\n\\nMapping Table\\n- plant_name -> PARAM:plant_name\\n- location -> PARAM:location\\n- from_date -> PARAM:from_date\\n- to_date -> PARAM:to_date\\n- print_date -> PARAM:print_date\\n- recipe_code -> PARAM:recipe_code\\n- report_title -> 'Consumption report'\\n- footer_company -> 'Indian Industrial Machines Pvt. Ltd.'\\n- page_info -> PARAM:page_info\\n- sl_no -> ROW_NUMBER() OVER (ORDER BY rows.row_material_name ASC, rows.row_set_wt DESC, rows.row_ach_wt DESC, rows.row_error_kg DESC)\\n- material_name -> rows.row_material_name\\n- set_wt -> rows.row_set_wt\\n- ach_wt -> rows.row_ach_wt\\n- error_kg -> rows.row_error_kg\\n- error_pct -> rows.row_error_pct\\n- total_set_wt -> totals.total_set_wt\\n- total_ach_wt -> totals.total_ach_wt\\n- total_error_kg -> totals.total_error_kg\\n- total_error_pct -> totals.total_error_pct\\n\\nJoin & Date Rules\\n- Tables: only recipes is used. No joins to other tables.\\n- Date filtering applies to recipes.start_time (inclusive range): recipes.start_time >= from_date and recipes.start_time <= to_date. Use the engine\u2019s date casting if needed; date_columns specifies start_time as the primary filterable date field.\\n- Recipe filter: recipes.recipe_name = :recipe_code (exact match; case sensitivity per DB collation).\\n\\nTransformations\\n- Unpivot/Union: Convert 12 bin columns (content, sp, act) into a long form staging dataset long_bins with columns: recipe_id, recipe_name, start_time, bin_index (1..12), material_name_raw, set_wt_kg, ach_wt_kg. Build via UNION ALL over the 12 bin triplets.\\n- Cleaning: row-level material name normalization material_name = COALESCE(NULLIF(TRIM(material_name_raw), ''), '(Unspecified)'). This preserves all weight while grouping unnamed bins under a stable label.\\n- Pre-aggregation filters: Apply required date and recipe filters before unpivot. Keep all bins; do not drop rows solely due to blank names, to keep detail-to-total reconciliation exact. Optionally ignore bins where both set and achieved are NULL; treat NULLs as 0 in sums via COALESCE.\\n- Row aggregation: Group long_bins by normalized material_name. Compute set_wt and ach_wt as SUM; compute error_kg = ach - set; error_pct = CASE WHEN set=0 THEN NULL ELSE 100 * error_kg / set END.\\n- Totals: Aggregate from rows dataset to ensure the footer sums match what is displayed: total_set_wt = SUM(rows.row_set_wt), total_ach_wt = SUM(rows.row_ach_wt), total_error_kg = SUM(rows.row_error_kg), total_error_pct = CASE WHEN SUM(rows.row_set_wt)=0 THEN NULL ELSE 100 * SUM(rows.row_error_kg)/SUM(rows.row_set_wt) END.\\n\\nParameters\\n- Required: from_date (date), to_date (date), recipe_code (string), plant_name (string). Apply equality predicate for recipe_code; plant_name is pass-through only (no corresponding column in catalog) and does not affect SQL filters.\\n- Optional: location (string), print_date (date/string), page_info (string). Optional parameters populate header/footer but do not affect SQL.\\n- Filter semantics: Date range is inclusive; recipe_code equality applies to parent/rows/totals query paths. Optional filters apply only when non-empty.\\n\\nChecklist for Step 5\\n- Construct long_bins via UNION ALL for bin1..bin12 (content/sp/act), and include bin_index for tie-breaking if needed.\\n- Apply filters before unpivot: recipes.start_time BETWEEN :from_date AND :to_date; recipes.recipe_name = :recipe_code.\\n- Normalize material names using COALESCE(NULLIF(TRIM(...), ''), '(Unspecified)').\\n- Aggregate rows by normalized material_name; compute row metrics with COALESCE/NULLIF guards.\\n- Totals must be computed from rows to match the displayed detail.\\n- Stable ordering for rows: ORDER BY material_name ASC, set_wt DESC, ach_wt DESC, error_kg DESC. Use identical ORDER BY for row_number window and final select; mirror this in order_by.rows and row_order.\\n- Ensure sl_no uses the same ordering as the final rows ordering.\\n- Use only columns from the catalog allow-list.\\n- Date column for filtering: recipes.start_time.\\n\",\n  \"step5_requirements\": {\n    \"datasets\": {\n      \"header\": {\n        \"description\": \"One-row header dataset\",\n        \"columns\": [\n          \"plant_name\",\n          \"location\",\n          \"from_date\",\n          \"to_date\",\n          \"print_date\",\n          \"recipe_code\",\n          \"report_title\",\n          \"footer_company\",\n          \"page_info\"\n        ]\n      },\n      \"rows\": {\n        \"description\": \"Detail rows dataset\",\n        \"columns\": [\n          \"sl_no\",\n          \"material_name\",\n          \"set_wt\",\n          \"ach_wt\",\n          \"error_kg\",\n          \"error_pct\"\n        ],\n        \"grouping\": [\n          \"Group by normalized material name: COALESCE(NULLIF(TRIM(long_bins.material_name_raw), ''), '(Unspecified)')\",\n          \"Prior to grouping, apply required filters on recipes.start_time and recipes.recipe_name\",\n          \"Treat NULL set/achieved as 0 in sums via COALESCE\"\n        ],\n        \"ordering\": [\n          \"Stable sort: material_name ASC, then set_wt DESC, ach_wt DESC, error_kg DESC; case-insensitive via TRIM applied in normalization\"\n        ]\n      },\n      \"totals\": {\n        \"description\": \"Aggregate totals dataset\",\n        \"columns\": [\n          \"total_set_wt\",\n          \"total_ach_wt\",\n          \"total_error_kg\",\n          \"total_error_pct\"\n        ]\n      }\n    },\n    \"semantics\": \"Required filters: from_date/to_date applied to recipes.start_time (inclusive), and recipe_code applied as recipes.recipe_name = :recipe_code. plant_name is required per key_tokens but is pass-through only (no filter applied due to missing catalog column). Optional header/footer parameters do not affect SQL. Optional filters apply only when provided and non-empty.\",\n    \"parameters\": {\n      \"required\": [\n        {\n          \"name\": \"from_date\",\n          \"type\": \"date\"\n        },\n        {\n          \"name\": \"to_date\",\n          \"type\": \"date\"\n        },\n        {\n          \"name\": \"recipe_code\",\n          \"type\": \"string\"\n        },\n        {\n          \"name\": \"plant_name\",\n          \"type\": \"string\"\n        }\n      ],\n      \"optional\": [\n        {\n          \"name\": \"location\",\n          \"type\": \"string\"\n        },\n        {\n          \"name\": \"print_date\",\n          \"type\": \"string\"\n        },\n        {\n          \"name\": \"page_info\",\n          \"type\": \"string\"\n        }\n      ]\n    },\n    \"transformations\": [\n      \"Build long_bins via UNION ALL over bins 1..12: select recipe id, recipe_name, start_time, bin_index, material_name_raw (recipes.binX_content), set_wt_kg (recipes.binX_sp), ach_wt_kg (recipes.binX_act)\",\n      \"Apply filters before union: recipes.start_time BETWEEN :from_date AND :to_date (inclusive), and recipes.recipe_name = :recipe_code\",\n      \"Normalize material name: material_name = COALESCE(NULLIF(TRIM(material_name_raw), ''), '(Unspecified)')\",\n      \"Rows aggregation: GROUP BY material_name; set_wt = SUM(COALESCE(set_wt_kg,0)); ach_wt = SUM(COALESCE(ach_wt_kg,0)); error_kg = ach_wt - set_wt; error_pct = CASE WHEN set_wt = 0 THEN NULL ELSE 100.0 * error_kg / set_wt END\",\n      \"Totals dataset: total_set_wt = SUM(rows.row_set_wt); total_ach_wt = SUM(rows.row_ach_wt); total_error_kg = SUM(rows.row_error_kg); total_error_pct = CASE WHEN SUM(rows.row_set_wt)=0 THEN NULL ELSE 100.0 * SUM(rows.row_error_kg)/SUM(rows.row_set_wt) END\",\n      \"Compute sl_no using ROW_NUMBER() OVER the exact final ordering: material_name ASC, set_wt DESC, ach_wt DESC, error_kg DESC\"\n    ]\n  },\n  \"contract\": {\n    \"tokens\": {\n      \"scalars\": [\n        \"plant_name\",\n        \"location\",\n        \"from_date\",\n        \"to_date\",\n        \"print_date\",\n        \"recipe_code\",\n        \"report_title\",\n        \"footer_company\",\n        \"page_info\"\n      ],\n      \"row_tokens\": [\n        \"sl_no\",\n        \"material_name\",\n        \"set_wt\",\n        \"ach_wt\",\n        \"error_kg\",\n        \"error_pct\"\n      ],\n      \"totals\": [\n        \"total_set_wt\",\n        \"total_ach_wt\",\n        \"total_error_kg\",\n        \"total_error_pct\"\n      ]\n    },\n    \"mapping\": {\n      \"plant_name\": \"PARAM:plant_name\",\n      \"location\": \"PARAM:location\",\n      \"from_date\": \"PARAM:from_date\",\n      \"to_date\": \"PARAM:to_date\",\n      \"print_date\": \"PARAM:print_date\",\n      \"recipe_code\": \"PARAM:recipe_code\",\n      \"report_title\": \"'Consumption report'\",\n      \"footer_company\": \"'Indian Industrial Machines Pvt. Ltd.'\",\n      \"page_info\": \"PARAM:page_info\",\n      \"sl_no\": \"ROW_NUMBER() OVER (ORDER BY rows.row_material_name ASC, rows.row_set_wt DESC, rows.row_ach_wt DESC, rows.row_error_kg DESC)\",\n      \"material_name\": \"rows.row_material_name\",\n      \"set_wt\": \"rows.row_set_wt\",\n      \"ach_wt\": \"rows.row_ach_wt\",\n      \"error_kg\": \"rows.row_error_kg\",\n      \"error_pct\": \"rows.row_error_pct\",\n      \"total_set_wt\": \"totals.total_set_wt\",\n      \"total_ach_wt\": \"totals.total_ach_wt\",\n      \"total_error_kg\": \"totals.total_error_kg\",\n      \"total_error_pct\": \"totals.total_error_pct\"\n    },\n    \"unresolved\": [],\n    \"join\": {\n      \"parent_table\": \"recipes\",\n      \"parent_key\": \"id\",\n      \"child_table\": null,\n      \"child_key\": null\n    },\n    \"date_columns\": {\n      \"recipes\": \"start_time\"\n    },\n    \"filters\": {\n      \"required\": {\n        \"from_date\": \"recipes.start_time >= PARAM:from_date\",\n        \"to_date\": \"recipes.start_time <= PARAM:to_date\",\n        \"recipe_code\": \"recipes.recipe_name = PARAM:recipe_code\"\n      },\n      \"optional\": {\n        \"plant_name\": null\n      }\n    },\n    \"reshape_rules\": [\n      {\n        \"purpose\": \"Produce rows dataset\",\n        \"strategy\": \"UNION_ALL\",\n        \"explain\": \"Union bin1..bin12 columns into long form, normalize names, then group by material\",\n        \"columns\": [\n          {\n            \"as\": \"material_name_raw\",\n            \"from\": [\n              \"recipes.bin1_content\",\n              \"recipes.bin2_content\",\n              \"recipes.bin3_content\",\n              \"recipes.bin4_content\",\n              \"recipes.bin5_content\",\n              \"recipes.bin6_content\",\n              \"recipes.bin7_content\",\n              \"recipes.bin8_content\",\n              \"recipes.bin9_content\",\n              \"recipes.bin10_content\",\n              \"recipes.bin11_content\",\n              \"recipes.bin12_content\"\n            ]\n          },\n          {\n            \"as\": \"set_wt_kg\",\n            \"from\": [\n              \"recipes.bin1_sp\",\n              \"recipes.bin2_sp\",\n              \"recipes.bin3_sp\",\n              \"recipes.bin4_sp\",\n              \"recipes.bin5_sp\",\n              \"recipes.bin6_sp\",\n              \"recipes.bin7_sp\",\n              \"recipes.bin8_sp\",\n              \"recipes.bin9_sp\",\n              \"recipes.bin10_sp\",\n              \"recipes.bin11_sp\",\n              \"recipes.bin12_sp\"\n            ]\n          },\n          {\n            \"as\": \"ach_wt_kg\",\n            \"from\": [\n              \"recipes.bin1_act\",\n              \"recipes.bin2_act\",\n              \"recipes.bin3_act\",\n              \"recipes.bin4_act\",\n              \"recipes.bin5_act\",\n              \"recipes.bin6_act\",\n              \"recipes.bin7_act\",\n              \"recipes.bin8_act\",\n              \"recipes.bin9_act\",\n              \"recipes.bin10_act\",\n              \"recipes.bin11_act\",\n              \"recipes.bin12_act\"\n            ]\n          }\n        ]\n      }\n    ],\n    \"row_computed\": {\n      \"row_material_name\": \"COALESCE(NULLIF(TRIM(long_bins.material_name_raw), ''), '(Unspecified)')\",\n      \"row_set_wt\": \"SUM(COALESCE(long_bins.set_wt_kg, 0))\",\n      \"row_ach_wt\": \"SUM(COALESCE(long_bins.ach_wt_kg, 0))\",\n      \"row_error_kg\": \"SUM(COALESCE(long_bins.ach_wt_kg, 0)) - SUM(COALESCE(long_bins.set_wt_kg, 0))\",\n      \"row_error_pct\": \"CASE WHEN SUM(COALESCE(long_bins.set_wt_kg, 0)) = 0 THEN NULL ELSE 100.0 * (SUM(COALESCE(long_bins.ach_wt_kg, 0)) - SUM(COALESCE(long_bins.set_wt_kg, 0))) / SUM(COALESCE(long_bins.set_wt_kg, 0)) END\"\n    },\n    \"totals_math\": {\n      \"total_set_wt\": \"SUM(rows.row_set_wt)\",\n      \"total_ach_wt\": \"SUM(rows.row_ach_wt)\",\n      \"total_error_kg\": \"SUM(rows.row_error_kg)\",\n      \"total_error_pct\": \"CASE WHEN SUM(rows.row_set_wt) = 0 THEN NULL ELSE 100.0 * SUM(rows.row_error_kg) / SUM(rows.row_set_wt) END\"\n    },\n    \"formatters\": {\n      \"error_pct\": \"percent(2)\",\n      \"total_error_pct\": \"percent(2)\",\n      \"print_date\": \"date(DD/MM/YYYY)\"\n    },\n    \"order_by\": {\n      \"rows\": [\n        \"material_name ASC\",\n        \"set_wt DESC\",\n        \"ach_wt DESC\",\n        \"error_kg DESC\"\n      ]\n    },\n    \"row_order\": [\n      \"material_name ASC\",\n      \"set_wt DESC\",\n      \"ach_wt DESC\",\n      \"error_kg DESC\"\n    ],\n    \"notes\": \"plant_name is a required key token but has no corresponding column in the provided catalog; it is pass-through only and not used in SQL filtering. All totals are computed from the rows dataset to exactly match displayed detail. Filters apply to recipes.start_time and recipes.recipe_name only.\"\n  },\n  \"validation\": {\n    \"unknown_tokens\": [],\n    \"unknown_columns\": [],\n    \"token_coverage\": {\n      \"scalars_mapped_pct\": 100,\n      \"row_tokens_mapped_pct\": 100,\n      \"totals_mapped_pct\": 100\n    }\n  }\n}",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762809935,
  "model": "gpt-5-2025-08-07",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": null,
  "usage": {
    "completion_tokens": 11365,
    "prompt_tokens": 10703,
    "total_tokens": 22068,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 7808,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 0
    }
  }
}
```

## 2025-11-10T21:29:54Z - generator_assets_v1

```json
{
  "id": "chatcmpl-CaTj00jZCinlYRvmTaxx40EVwzLtx",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "{\n  \"contract\": {\n    \"tokens\": {\n      \"scalars\": [\n        \"plant_name\",\n        \"location\",\n        \"from_date\",\n        \"to_date\",\n        \"print_date\",\n        \"recipe_code\",\n        \"report_title\",\n        \"footer_company\",\n        \"page_info\"\n      ],\n      \"row_tokens\": [\n        \"sl_no\",\n        \"material_name\",\n        \"set_wt\",\n        \"ach_wt\",\n        \"error_kg\",\n        \"error_pct\"\n      ],\n      \"totals\": [\n        \"total_set_wt\",\n        \"total_ach_wt\",\n        \"total_error_kg\",\n        \"total_error_pct\"\n      ]\n    },\n    \"mapping\": {\n      \"plant_name\": \"PARAM:plant_name\",\n      \"location\": \"PARAM:location\",\n      \"from_date\": \"PARAM:from_date\",\n      \"to_date\": \"PARAM:to_date\",\n      \"print_date\": \"PARAM:print_date\",\n      \"recipe_code\": \"PARAM:recipe_code\",\n      \"report_title\": \"'Consumption report'\",\n      \"footer_company\": \"'Indian Industrial Machines Pvt. Ltd.'\",\n      \"page_info\": \"PARAM:page_info\",\n      \"sl_no\": \"ROW_NUMBER() OVER (ORDER BY rows.row_material_name ASC, rows.row_set_wt DESC, rows.row_ach_wt DESC, rows.row_error_kg DESC)\",\n      \"material_name\": \"rows.row_material_name\",\n      \"set_wt\": \"rows.row_set_wt\",\n      \"ach_wt\": \"rows.row_ach_wt\",\n      \"error_kg\": \"rows.row_error_kg\",\n      \"error_pct\": \"rows.row_error_pct\",\n      \"total_set_wt\": \"totals.total_set_wt\",\n      \"total_ach_wt\": \"totals.total_ach_wt\",\n      \"total_error_kg\": \"totals.total_error_kg\",\n      \"total_error_pct\": \"totals.total_error_pct\"\n    },\n    \"join\": {\n      \"parent_table\": \"recipes\",\n      \"parent_key\": \"id\",\n      \"child_table\": \"recipes\",\n      \"child_key\": \"id\"\n    },\n    \"date_columns\": {\n      \"recipes\": \"start_time\"\n    },\n    \"filters\": {\n      \"required\": {\n        \"from_date\": \"recipes.start_time >= PARAM:from_date\",\n        \"to_date\": \"recipes.start_time <= PARAM:to_date\",\n        \"recipe_code\": \"recipes.recipe_name = PARAM:recipe_code\"\n      },\n      \"optional\": {\n        \"plant_name\": null\n      }\n    },\n    \"reshape_rules\": [\n      {\n        \"purpose\": \"Produce rows dataset\",\n        \"strategy\": \"UNION_ALL\",\n        \"columns\": [\n          {\n            \"as\": \"material_name_raw\",\n            \"from\": [\n              \"recipes.bin1_content\",\n              \"recipes.bin2_content\",\n              \"recipes.bin3_content\",\n              \"recipes.bin4_content\",\n              \"recipes.bin5_content\",\n              \"recipes.bin6_content\",\n              \"recipes.bin7_content\",\n              \"recipes.bin8_content\",\n              \"recipes.bin9_content\",\n              \"recipes.bin10_content\",\n              \"recipes.bin11_content\",\n              \"recipes.bin12_content\"\n            ]\n          },\n          {\n            \"as\": \"set_wt_kg\",\n            \"from\": [\n              \"recipes.bin1_sp\",\n              \"recipes.bin2_sp\",\n              \"recipes.bin3_sp\",\n              \"recipes.bin4_sp\",\n              \"recipes.bin5_sp\",\n              \"recipes.bin6_sp\",\n              \"recipes.bin7_sp\",\n              \"recipes.bin8_sp\",\n              \"recipes.bin9_sp\",\n              \"recipes.bin10_sp\",\n              \"recipes.bin11_sp\",\n              \"recipes.bin12_sp\"\n            ]\n          },\n          {\n            \"as\": \"ach_wt_kg\",\n            \"from\": [\n              \"recipes.bin1_act\",\n              \"recipes.bin2_act\",\n              \"recipes.bin3_act\",\n              \"recipes.bin4_act\",\n              \"recipes.bin5_act\",\n              \"recipes.bin6_act\",\n              \"recipes.bin7_act\",\n              \"recipes.bin8_act\",\n              \"recipes.bin9_act\",\n              \"recipes.bin10_act\",\n              \"recipes.bin11_act\",\n              \"recipes.bin12_act\"\n            ]\n          }\n        ],\n        \"order_by\": []\n      }\n    ],\n    \"row_computed\": {\n      \"row_material_name\": \"COALESCE(NULLIF(TRIM(long_bins.material_name_raw), ''), '(Unspecified)')\",\n      \"row_set_wt\": \"SUM(COALESCE(long_bins.set_wt_kg, 0))\",\n      \"row_ach_wt\": \"SUM(COALESCE(long_bins.ach_wt_kg, 0))\",\n      \"row_error_kg\": \"SUM(COALESCE(long_bins.ach_wt_kg, 0)) - SUM(COALESCE(long_bins.set_wt_kg, 0))\",\n      \"row_error_pct\": \"CASE WHEN SUM(COALESCE(long_bins.set_wt_kg, 0)) = 0 THEN NULL ELSE 100.0 * (SUM(COALESCE(long_bins.ach_wt_kg, 0)) - SUM(COALESCE(long_bins.set_wt_kg, 0))) / SUM(COALESCE(long_bins.set_wt_kg, 0)) END\"\n    },\n    \"totals_math\": {\n      \"total_set_wt\": \"SUM(rows.row_set_wt)\",\n      \"total_ach_wt\": \"SUM(rows.row_ach_wt)\",\n      \"total_error_kg\": \"SUM(rows.row_error_kg)\",\n      \"total_error_pct\": \"CASE WHEN SUM(rows.row_set_wt) = 0 THEN NULL ELSE 100.0 * SUM(rows.row_error_kg) / SUM(rows.row_set_wt) END\"\n    },\n    \"formatters\": {\n      \"error_pct\": \"percent(2)\",\n      \"total_error_pct\": \"percent(2)\",\n      \"print_date\": \"date(DD/MM/YYYY)\"\n    },\n    \"order_by\": {\n      \"rows\": [\n        \"material_name ASC\",\n        \"set_wt DESC\",\n        \"ach_wt DESC\",\n        \"error_kg DESC\"\n      ]\n    },\n    \"row_order\": [\n      \"material_name ASC\",\n      \"set_wt DESC\",\n      \"ach_wt DESC\",\n      \"error_kg DESC\"\n    ],\n    \"header_tokens\": [\n      \"plant_name\",\n      \"location\",\n      \"from_date\",\n      \"to_date\",\n      \"print_date\",\n      \"recipe_code\",\n      \"report_title\",\n      \"footer_company\",\n      \"page_info\"\n    ],\n    \"row_tokens\": [\n      \"sl_no\",\n      \"material_name\",\n      \"set_wt\",\n      \"ach_wt\",\n      \"error_kg\",\n      \"error_pct\"\n    ],\n    \"totals\": {\n      \"total_set_wt\": \"totals.total_set_wt\",\n      \"total_ach_wt\": \"totals.total_ach_wt\",\n      \"total_error_kg\": \"totals.total_error_kg\",\n      \"total_error_pct\": \"totals.total_error_pct\"\n    }\n  },\n  \"sql_pack\": {\n    \"dialect\": \"sqlite\",\n    \"script\": \"-- HEADER SELECT --\\nSELECT PARAM:plant_name, PARAM:location, PARAM:from_date, PARAM:to_date, PARAM:print_date, PARAM:recipe_code, 'Consumption report' AS report_title, 'Indian Industrial Machines Pvt. Ltd.' AS footer_company, PARAM:page_info\\n-- ROWS SELECT --\\nWITH long_bins AS (\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 1 AS bin_index, recipes.bin1_content AS material_name_raw, recipes.bin1_sp AS set_wt_kg, recipes.bin1_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 2 AS bin_index, recipes.bin2_content AS material_name_raw, recipes.bin2_sp AS set_wt_kg, recipes.bin2_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 3 AS bin_index, recipes.bin3_content AS material_name_raw, recipes.bin3_sp AS set_wt_kg, recipes.bin3_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 4 AS bin_index, recipes.bin4_content AS material_name_raw, recipes.bin4_sp AS set_wt_kg, recipes.bin4_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 5 AS bin_index, recipes.bin5_content AS material_name_raw, recipes.bin5_sp AS set_wt_kg, recipes.bin5_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 6 AS bin_index, recipes.bin6_content AS material_name_raw, recipes.bin6_sp AS set_wt_kg, recipes.bin6_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 7 AS bin_index, recipes.bin7_content AS material_name_raw, recipes.bin7_sp AS set_wt_kg, recipes.bin7_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 8 AS bin_index, recipes.bin8_content AS material_name_raw, recipes.bin8_sp AS set_wt_kg, recipes.bin8_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 9 AS bin_index, recipes.bin9_content AS material_name_raw, recipes.bin9_sp AS set_wt_kg, recipes.bin9_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 10 AS bin_index, recipes.bin10_content AS material_name_raw, recipes.bin10_sp AS set_wt_kg, recipes.bin10_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 11 AS bin_index, recipes.bin11_content AS material_name_raw, recipes.bin11_sp AS set_wt_kg, recipes.bin11_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 12 AS bin_index, recipes.bin12_content AS material_name_raw, recipes.bin12_sp AS set_wt_kg, recipes.bin12_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n)\\nSELECT ROW_NUMBER() OVER (ORDER BY row_material_name ASC, row_set_wt DESC, row_ach_wt DESC, row_error_kg DESC) AS sl_no,\\n       row_material_name,\\n       row_set_wt,\\n       row_ach_wt,\\n       row_error_kg,\\n       row_error_pct\\nFROM (\\n  SELECT COALESCE(NULLIF(TRIM(material_name_raw), ''), '(Unspecified)') AS row_material_name,\\n         SUM(COALESCE(set_wt_kg, 0)) AS row_set_wt,\\n         SUM(COALESCE(ach_wt_kg, 0)) AS row_ach_wt,\\n         SUM(COALESCE(ach_wt_kg, 0)) - SUM(COALESCE(set_wt_kg, 0)) AS row_error_kg,\\n         CASE WHEN SUM(COALESCE(set_wt_kg, 0)) = 0 THEN NULL ELSE 100.0 * (SUM(COALESCE(ach_wt_kg, 0)) - SUM(COALESCE(set_wt_kg, 0))) / SUM(COALESCE(set_wt_kg, 0)) END AS row_error_pct\\n  FROM long_bins\\n  GROUP BY row_material_name\\n) AS rows\\n-- TOTALS SELECT --\\nSELECT SUM(rows.row_set_wt) AS total_set_wt,\\n       SUM(rows.row_ach_wt) AS total_ach_wt,\\n       SUM(rows.row_error_kg) AS total_error_kg,\\n       CASE WHEN SUM(rows.row_set_wt) = 0 THEN NULL ELSE 100.0 * SUM(rows.row_error_kg) / SUM(rows.row_set_wt) END AS total_error_pct\\nFROM rows\",\n    \"entrypoints\": {\n      \"header\": \"SELECT PARAM:plant_name AS plant_name, PARAM:location AS location, PARAM:from_date AS from_date, PARAM:to_date AS to_date, PARAM:print_date AS print_date, PARAM:recipe_code AS recipe_code, 'Consumption report' AS report_title, 'Indian Industrial Machines Pvt. Ltd.' AS footer_company, PARAM:page_info AS page_info\",\n      \"rows\": \"WITH long_bins AS (\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 1 AS bin_index, recipes.bin1_content AS material_name_raw, recipes.bin1_sp AS set_wt_kg, recipes.bin1_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 2 AS bin_index, recipes.bin2_content AS material_name_raw, recipes.bin2_sp AS set_wt_kg, recipes.bin2_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 3 AS bin_index, recipes.bin3_content AS material_name_raw, recipes.bin3_sp AS set_wt_kg, recipes.bin3_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 4 AS bin_index, recipes.bin4_content AS material_name_raw, recipes.bin4_sp AS set_wt_kg, recipes.bin4_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 5 AS bin_index, recipes.bin5_content AS material_name_raw, recipes.bin5_sp AS set_wt_kg, recipes.bin5_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 6 AS bin_index, recipes.bin6_content AS material_name_raw, recipes.bin6_sp AS set_wt_kg, recipes.bin6_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 7 AS bin_index, recipes.bin7_content AS material_name_raw, recipes.bin7_sp AS set_wt_kg, recipes.bin7_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 8 AS bin_index, recipes.bin8_content AS material_name_raw, recipes.bin8_sp AS set_wt_kg, recipes.bin8_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 9 AS bin_index, recipes.bin9_content AS material_name_raw, recipes.bin9_sp AS set_wt_kg, recipes.bin9_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 10 AS bin_index, recipes.bin10_content AS material_name_raw, recipes.bin10_sp AS set_wt_kg, recipes.bin10_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 11 AS bin_index, recipes.bin11_content AS material_name_raw, recipes.bin11_sp AS set_wt_kg, recipes.bin11_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n  UNION ALL\\n  SELECT recipes.id AS recipe_id, recipes.recipe_name AS recipe_name, recipes.start_time AS start_time, 12 AS bin_index, recipes.bin12_content AS material_name_raw, recipes.bin12_sp AS set_wt_kg, recipes.bin12_act AS ach_wt_kg\\n  FROM recipes\\n  WHERE recipes.start_time >= PARAM:from_date AND recipes.start_time <= PARAM:to_date AND recipes.recipe_name = PARAM:recipe_code\\n)\\nSELECT ROW_NUMBER() OVER (ORDER BY row_material_name ASC, row_set_wt DESC, row_ach_wt DESC, row_error_kg DESC) AS sl_no,\\n       row_material_name,\\n       row_set_wt,\\n       row_ach_wt,\\n       row_error_kg,\\n       row_error_pct\\nFROM (\\n  SELECT COALESCE(NULLIF(TRIM(material_name_raw), ''), '(Unspecified)') AS row_material_name,\\n         SUM(COALESCE(set_wt_kg, 0)) AS row_set_wt,\\n         SUM(COALESCE(ach_wt_kg, 0)) AS row_ach_wt,\\n         SUM(COALESCE(ach_wt_kg, 0)) - SUM(COALESCE(set_wt_kg, 0)) AS row_error_kg,\\n         CASE WHEN SUM(COALESCE(set_wt_kg, 0)) = 0 THEN NULL ELSE 100.0 * (SUM(COALESCE(ach_wt_kg, 0)) - SUM(COALESCE(set_wt_kg, 0))) / SUM(COALESCE(set_wt_kg, 0)) END AS row_error_pct\\n  FROM long_bins\\n  GROUP BY row_material_name\\n) AS rows\",\n      \"totals\": \"SELECT SUM(rows.row_set_wt) AS total_set_wt,\\n       SUM(rows.row_ach_wt) AS total_ach_wt,\\n       SUM(rows.row_error_kg) AS total_error_kg,\\n       CASE WHEN SUM(rows.row_set_wt) = 0 THEN NULL ELSE 100.0 * SUM(rows.row_error_kg) / SUM(rows.row_set_wt) END AS total_error_pct\\nFROM rows\"\n    },\n    \"params\": {\n      \"required\": [\n        \"from_date\",\n        \"to_date\",\n        \"recipe_code\",\n        \"plant_name\"\n      ],\n      \"optional\": [\n        \"location\",\n        \"print_date\",\n        \"page_info\"\n      ]\n    }\n  },\n  \"dialect\": \"sqlite\",\n  \"invalid\": false\n}",
        "refusal": null,
        "role": "assistant",
        "annotations": [],
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ],
  "created": 1762810106,
  "model": "gpt-4o-mini-2024-07-18",
  "object": "chat.completion",
  "service_tier": "default",
  "system_fingerprint": "fp_560af6e559",
  "usage": {
    "completion_tokens": 4818,
    "prompt_tokens": 7417,
    "total_tokens": 12235,
    "completion_tokens_details": {
      "accepted_prediction_tokens": 0,
      "audio_tokens": 0,
      "reasoning_tokens": 0,
      "rejected_prediction_tokens": 0
    },
    "prompt_tokens_details": {
      "audio_tokens": 0,
      "cached_tokens": 0
    }
  }
}
```

