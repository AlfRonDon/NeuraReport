import{e as _e,b as Le,a4 as Fe,d as Be,u as de,r as a,R as N,I as O,f as Ae,bu as $e,ay as oe,aC as He,j as o,S as P,B as S,T as x,n as R,as as re,q as Ne,A as se,P as Oe,ai as ae,aj as ne,a3 as j,a1 as Ue,E as ue,J as u,k as i,o as pe,p as n,s as he,an as We,bs as Me,aD as Ye,aH as le,Z as Xe,t as Ve,v as Ge,K as Y}from"./index-B8Eu23bA.js";import{P as Ke}from"./Visibility-DQVh5lRN.js";import{P as fe}from"./PictureAsPdf-Cva09OSx.js";import{A as Je}from"./Article-B2tsd32U.js";import{D as qe}from"./DataTable-_yVGBakl.js";import{C as Ze}from"./ConfirmModal-Bm9QL03g.js";import"./KeyboardArrowDown-C4qqpONU.js";import"./FilterList-lKi4AKs9.js";import"./Check-BATZaRrq.js";import"./MoreVert-BRjwX6CI.js";import"./TableRow-Gv3OwSlT.js";import"./TableContainer-CxteWhu6.js";import"./KeyboardArrowRight-BOQXGjwe.js";import"./CheckCircleOutline-BKKyaL-x.js";import"./WarningAmber-DtVJgAFk.js";const X=Y`
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
`,Qe=Y`
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
`;Y`
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.05); opacity: 0.8; }
`;const et=u(S)(({theme:t})=>({padding:t.spacing(3),maxWidth:1400,margin:"0 auto",width:"100%",minHeight:"100vh",backgroundColor:t.palette.background.default})),tt=u(S)(({theme:t})=>({marginBottom:t.spacing(3),animation:`${X} 0.5s ease-out`})),ot=u(x)(({theme:t})=>({fontSize:"1.75rem",fontWeight:700,letterSpacing:"-0.02em",color:t.palette.mode==="dark"?i[300]:i[1200]})),rt=u(P)(({theme:t})=>({marginBottom:t.spacing(3),animation:`${X} 0.5s ease-out 0.1s both`})),ie=u(We)(({theme:t})=>({minWidth:150,"& .MuiOutlinedInput-root":{borderRadius:8,backgroundColor:n(t.palette.background.paper,.6),transition:"all 0.2s ease","&:hover":{backgroundColor:n(t.palette.background.paper,.8)},"&.Mui-focused":{backgroundColor:t.palette.background.paper,boxShadow:`0 0 0 3px ${n(t.palette.text.primary,.08)}`}},"& .MuiInputLabel-root":{fontWeight:500}})),st=u(S)(({theme:t})=>({backgroundColor:n(t.palette.background.paper,.8),backdropFilter:"blur(20px)",borderRadius:8,border:`1px solid ${n(t.palette.divider,.1)}`,boxShadow:`0 8px 32px ${n(t.palette.common.black,.08)}`,overflow:"hidden",animation:`${X} 0.6s ease-out 0.2s both`})),ce=u(S)(({theme:t})=>({padding:t.spacing(8,4),textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center"})),at=u(Me)(({theme:t})=>({fontSize:64,color:n(t.palette.text.secondary,.3),marginBottom:t.spacing(2),animation:`${Qe} 3s ease-in-out infinite`})),nt=u(pe)(({theme:t})=>({color:t.palette.text.secondary,transition:"all 0.2s ease","&:hover":{color:t.palette.text.primary,backgroundColor:t.palette.mode==="dark"?n(t.palette.text.primary,.08):i[300]}})),lt=u(he)(({theme:t})=>({borderRadius:8,textTransform:"none",fontWeight:600,fontSize:"0.875rem",padding:t.spacing(1,2.5),background:t.palette.mode==="dark"?i[1100]:i[1200],color:"#fff",boxShadow:`0 4px 14px ${n(t.palette.common.black,.15)}`,transition:"all 0.2s ease","&:hover":{background:t.palette.mode==="dark"?i[1e3]:i[1100],boxShadow:`0 6px 20px ${n(t.palette.common.black,.2)}`,transform:"translateY(-2px)"}})),it=u(he)(({theme:t})=>({borderRadius:8,textTransform:"none",fontWeight:500,fontSize:"0.875rem",borderColor:n(t.palette.divider,.3),transition:"all 0.2s ease","&:hover":{borderColor:t.palette.mode==="dark"?i[1e3]:i[1100],backgroundColor:t.palette.mode==="dark"?n(t.palette.text.primary,.04):i[200]}})),ct=u(S,{shouldForwardProp:t=>t!=="iconColor"})(({theme:t})=>({width:36,height:36,borderRadius:8,backgroundColor:t.palette.mode==="dark"?n(t.palette.text.primary,.08):i[300],display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"})),dt=u(Ge,{shouldForwardProp:t=>!["statusColor","statusBg"].includes(t)})(({theme:t,statusColor:m,statusBg:l})=>({borderRadius:8,fontWeight:600,fontSize:"0.6875rem",backgroundColor:l,color:m,"& .MuiChip-icon":{marginLeft:t.spacing(.5),color:m}})),U=u(pe)(({theme:t})=>({transition:"all 0.2s ease","&:hover":{transform:"translateY(-2px)"}})),ut=(t,m)=>{const l={completed:{icon:Ve,color:t.palette.text.secondary,bgColor:t.palette.mode==="dark"?n(t.palette.text.primary,.1):i[300],label:"Completed"},failed:{icon:Xe,color:t.palette.text.secondary,bgColor:t.palette.mode==="dark"?n(t.palette.text.primary,.1):i[300],label:"Failed"},running:{icon:le,color:t.palette.text.secondary,bgColor:t.palette.mode==="dark"?n(t.palette.text.primary,.1):i[300],label:"Running"},pending:{icon:le,color:t.palette.text.secondary,bgColor:t.palette.mode==="dark"?n(t.palette.text.primary,.08):i[200],label:"Pending"},cancelled:{icon:Ye,color:t.palette.text.secondary,bgColor:n(t.palette.text.secondary,.08),label:"Cancelled"}};return l[m]||l.pending},pt=(t,m)=>{const l={pdf:{icon:fe,color:t.palette.text.secondary},excel:{icon:ue,color:t.palette.text.secondary}};return l[m]||l.pdf};function ht(){const t=_e(),m=Le(),[l,V]=Fe(),f=Be(),{execute:g}=de(),E=a.useCallback((e,r,s={})=>m(e,{label:r,intent:{from:"history",...s}}),[m]),c=a.useCallback((e,r,s={})=>g({type:O.EXECUTE,label:e,reversibility:N.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{from:"history",...s},action:r}),[g]),T=a.useCallback((e,r,s={})=>g({type:O.DOWNLOAD,label:e,reversibility:N.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{from:"history",...s},action:r}),[g]),xe=Ae(e=>e.templates),W=a.useRef(!1),w=a.useRef(null),me=l.get("status")||"",ge=l.get("template")||"",[v,z]=a.useState([]),[_,G]=a.useState(!0),[M,L]=a.useState(0),[F,B]=a.useState(0),[I,ye]=a.useState(25),[y,K]=a.useState(me),[b,J]=a.useState(ge),[C,q]=a.useState([]),[be,A]=a.useState(!1),[Ce,Z]=a.useState(!1),k=a.useCallback(async()=>{G(!0);try{const e=await $e({limit:I,offset:F*I,status:y||void 0,templateId:b||void 0});z(e?.history||[]),L(e?.total||0)}catch(e){f.show(e.message||"Failed to load report history","error")}finally{G(!1)}},[F,I,y,b,f]);a.useEffect(()=>{W.current||(W.current=!0,k())},[k]),a.useEffect(()=>{const e=l.get("status")||"",r=l.get("template")||"";e!==y&&K(e),r!==b&&J(r)},[l,y,b]),a.useEffect(()=>{W.current&&k()},[F,I,y,b,k]);const $=a.useCallback((e,r)=>{const s=new URLSearchParams(l);e?s.set("status",e):s.delete("status"),r?s.set("template",r):s.delete("template"),V(s,{replace:!0})},[l,V]),Q=a.useCallback((e,r)=>T("Download report output",()=>{const s=e.artifacts||{};let h=null;r==="pdf"&&s.pdf_url?h=s.pdf_url:r==="html"&&s.html_url?h=s.html_url:r==="docx"&&s.docx_url?h=s.docx_url:r==="xlsx"&&s.xlsx_url&&(h=s.xlsx_url),h?window.open(oe(h),"_blank"):f.show("Download not available","warning")},{reportId:e?.id,format:r}),[T,f]),H=a.useCallback((e,r,s)=>{e.stopPropagation(),Q(r,s)},[Q]),ke=a.useCallback(e=>{const r=e.artifacts||{};if(r.html_url||r.pdf_url){const s=r.html_url||r.pdf_url;return T("Open report output",()=>{window.open(oe(s),"_blank")},{reportId:e?.id,format:r.html_url?"html":"pdf"})}return E("/jobs","Open jobs",{reportId:e?.id})},[T,E]),je=a.useCallback(async()=>{if(!C.length)return;const e=[...C],r=v.filter(d=>e.includes(d.id)),s=v,h=M;if(!r.length){A(!1);return}A(!1),q([]),w.current?.timeoutId&&(clearTimeout(w.current.timeoutId),w.current=null),z(d=>d.filter(D=>!e.includes(D.id))),L(d=>Math.max(0,d-r.length));let p=!1;const ee=setTimeout(async()=>{p||await g({type:O.DELETE,label:"Delete history records",reversibility:N.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{jobIds:e,action:"bulk_delete_history"},action:async()=>{Z(!0);try{const d=await He(e),D=d?.deletedCount??d?.deleted?.length??0,te=d?.failedCount??d?.failed?.length??0;return te>0?f.show(`Removed ${D} record${D!==1?"s":""}, ${te} failed`,"warning"):f.show(`Removed ${D} history record${D!==1?"s":""}`,"success"),k(),d}catch(d){throw z(s),L(h),f.show(d.message||"Failed to delete history records","error"),d}finally{Z(!1),w.current=null}}})},5e3);w.current={timeoutId:ee,ids:e,records:r},f.showWithUndo(`Removed ${e.length} history record${e.length!==1?"s":""}`,()=>{p=!0,clearTimeout(ee),w.current=null,z(s),L(h),f.show("History restored","success")},{severity:"info"})},[C,v,M,f,k,g]),Se=a.useCallback(()=>{if(C.length)return c("Review delete history",()=>A(!0),{count:C.length})},[c,C]),we=a.useCallback(()=>c("Close delete history",()=>A(!1)),[c]),ve=a.useCallback(e=>c("Select history entries",()=>q(e),{count:e.length}),[c]),De=a.useCallback(e=>c("Filter history by status",()=>{K(e),B(0),$(e,b)},{status:e}),[c,$,b]),Ie=a.useCallback(e=>c("Filter history by template",()=>{J(e),B(0),$(y,e)},{templateId:e}),[c,$,y]),Re=a.useCallback(()=>g({type:O.EXECUTE,label:"Refresh history",reversibility:N.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{from:"history",action:"refresh_history"},action:async()=>{await k()}}),[g,k]),Pe=a.useCallback(e=>c("Change history page",()=>B(e),{page:e}),[c]),Ee=a.useCallback(e=>c("Change history page size",()=>{ye(e),B(0)},{rowsPerPage:e}),[c]),Te=[{label:"Delete Selected",icon:o.jsx(Ue,{sx:{fontSize:16}}),color:"error",onClick:Se}],ze=[{field:"templateName",headerName:"Design",renderCell:(e,r)=>{const s=r.templateKind||"pdf",p=pt(t,s).icon;return o.jsxs(P,{direction:"row",alignItems:"center",spacing:1.5,children:[o.jsx(ct,{children:o.jsx(p,{sx:{fontSize:18,color:"text.secondary"}})}),o.jsxs(S,{children:[o.jsx(x,{sx:{fontSize:"0.8125rem",fontWeight:500,color:"text.primary"},children:e||"Unknown"}),o.jsx(x,{sx:{fontSize:"0.6875rem",color:"text.secondary"},children:s.toUpperCase()})]})]})}},{field:"status",headerName:"Status",width:130,renderCell:e=>{const r=ut(t,e),s=r.icon;return o.jsx(dt,{icon:o.jsx(s,{sx:{fontSize:14}}),label:r.label,size:"small",statusColor:r.color,statusBg:r.bgColor})}},{field:"createdAt",headerName:"Started",width:160,renderCell:e=>o.jsx(x,{sx:{fontSize:"0.8125rem",color:"text.secondary"},children:e?new Date(e).toLocaleString():"-"})},{field:"completedAt",headerName:"Completed",width:160,renderCell:e=>o.jsx(x,{sx:{fontSize:"0.8125rem",color:"text.secondary"},children:e?new Date(e).toLocaleString():"-"})},{field:"artifacts",headerName:"Downloads",width:150,renderCell:(e,r)=>{const s=e||{};return s.pdf_url||s.html_url||s.docx_url||s.xlsx_url?o.jsxs(P,{direction:"row",spacing:.5,children:[s.pdf_url&&o.jsx(R,{title:"Download PDF",children:o.jsx(U,{size:"small",onClick:p=>H(p,r,"pdf"),sx:{color:"text.secondary"},"aria-label":"Download PDF",children:o.jsx(fe,{sx:{fontSize:18}})})}),s.html_url&&o.jsx(R,{title:"View HTML",children:o.jsx(U,{size:"small",onClick:p=>H(p,r,"html"),sx:{color:"text.secondary"},"aria-label":"View HTML",children:o.jsx(Ke,{sx:{fontSize:18}})})}),s.docx_url&&o.jsx(R,{title:"Download DOCX",children:o.jsx(U,{size:"small",onClick:p=>H(p,r,"docx"),sx:{color:"text.secondary"},"aria-label":"Download DOCX",children:o.jsx(Je,{sx:{fontSize:18}})})}),s.xlsx_url&&o.jsx(R,{title:"Download XLSX",children:o.jsx(U,{size:"small",onClick:p=>H(p,r,"xlsx"),sx:{color:"text.secondary"},"aria-label":"Download XLSX",children:o.jsx(ue,{sx:{fontSize:18}})})})]}):o.jsx(x,{sx:{fontSize:"0.75rem",color:"text.disabled"},children:r.status==="completed"?"No files":"-"})}}];return o.jsxs(et,{children:[o.jsx(tt,{children:o.jsxs(P,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[o.jsxs(S,{children:[o.jsx(ot,{children:"Report History"}),o.jsx(x,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:"View and download previously generated reports"})]}),o.jsxs(P,{direction:"row",spacing:1.5,children:[o.jsx(R,{title:"Refresh history",children:o.jsx("span",{children:o.jsx(nt,{onClick:Re,disabled:_,"aria-label":"Refresh history",children:_?o.jsx(re,{size:20}):o.jsx(Ne,{})})})}),o.jsx(lt,{onClick:()=>E("/reports","Open reports"),startIcon:o.jsx(se,{}),children:"Generate New"})]})]})}),o.jsx(Oe,{severity:"info",sx:{mb:2,borderRadius:1},children:"History lists completed report outputs. Deleting a history record only removes the entry here; downloaded files are not affected."}),o.jsxs(rt,{direction:"row",spacing:2,children:[o.jsxs(ie,{size:"small",children:[o.jsx(ae,{children:"Status"}),o.jsxs(ne,{value:y,onChange:e=>{const r=e.target.value;De(r)},label:"Status",children:[o.jsx(j,{value:"",children:"All"}),o.jsx(j,{value:"completed",children:"Completed"}),o.jsx(j,{value:"failed",children:"Failed"}),o.jsx(j,{value:"running",children:"Running"}),o.jsx(j,{value:"cancelled",children:"Cancelled"})]})]}),o.jsxs(ie,{size:"small",sx:{minWidth:200},children:[o.jsx(ae,{children:"Design"}),o.jsxs(ne,{value:b,onChange:e=>{const r=e.target.value;Ie(r)},label:"Design",children:[o.jsx(j,{value:"",children:"All Designs"}),xe.map(e=>o.jsx(j,{value:e.id,children:e.name||e.id.slice(0,12)},e.id))]})]})]}),o.jsx(st,{children:_&&v.length===0?o.jsxs(ce,{children:[o.jsx(re,{size:40}),o.jsx(x,{sx:{mt:2,fontSize:"0.875rem",color:"text.secondary"},children:"Loading history..."})]}):v.length===0?o.jsxs(ce,{children:[o.jsx(at,{}),o.jsx(x,{sx:{fontSize:"1rem",fontWeight:600,color:"text.secondary"},children:"No report history found"}),o.jsx(x,{sx:{fontSize:"0.875rem",color:"text.disabled",mt:.5},children:"Generate reports to see them here"}),o.jsx(it,{variant:"outlined",onClick:()=>E("/reports","Open reports"),sx:{mt:3},startIcon:o.jsx(se,{}),children:"Generate Report"})]}):o.jsx(qe,{columns:ze,data:v,loading:_,searchPlaceholder:"Search reports...",onRowClick:ke,selectable:!0,onSelectionChange:ve,bulkActions:Te,pagination:{page:F,rowsPerPage:I,total:M,onPageChange:Pe,onRowsPerPageChange:Ee}})}),o.jsx(Ze,{open:be,onClose:we,onConfirm:je,title:"Delete History Records",message:`Remove ${C.length} history record${C.length!==1?"s":""}? You can undo within a few seconds. Downloaded files are not affected.`,confirmLabel:"Delete",severity:"error",loading:Ce})]})}function Pt(){return de(),o.jsx(ht,{})}export{Pt as default};
