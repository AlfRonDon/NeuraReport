import{b2 as Te,b3 as Ae,r as a,b4 as Re,b9 as pe,b5 as ue,j as e,b6 as Pe,J as q,bL as Ke,b8 as ie,c as Ee,ck as Fe,bF as He,cl as Ve,ba as ne,cm as Ye,c1 as ye,B as w,T as u,O as he,k as i,S as G,aM as Y,s as W,d as le,u as ce,f as L,Y as Je,X as qe,R as X,I as ee,v as $,p as U,aJ as me,P as J,w as Qe,t as re,A as Ze,g as Xe,b as De,cn as et,y as tt,E as xe,D as st,F as ot,be as ve,co as at,cp as nt,N as rt,aN as it,Q as lt,C as ct,cq as dt,a4 as pt}from"./index-B8Eu23bA.js";import{A as ut,T as mt,a as je}from"./ArrowBack-Cc4DCRzt.js";import{A as xt}from"./ArrowForward-DPnjhzEH.js";import{C as Ce}from"./Check-BATZaRrq.js";import{C as te}from"./Container-nBfdHHf8.js";import{S as ht}from"./Science-CnGLc7vs.js";import{C as ft}from"./Cloud-BjXKCnvy.js";import{D as gt,C as bt}from"./ConnectionForm-hEATkMM4.js";import{C as se,a as oe}from"./CardContent-xJVpuEbT.js";import{P as yt}from"./PictureAsPdf-Cva09OSx.js";import{R as vt}from"./ReceiptLong-Dexlf27p.js";import{S as jt}from"./Summarize-Dxk1U5WB.js";import{G as ke}from"./Grid-5L9Rvqba.js";import{A as Ct}from"./AutoFixHigh-C6xFegD4.js";import{T as kt,a as It,b as Ie,c as V,d as St}from"./TableRow-Gv3OwSlT.js";import{R as wt}from"./ReportGlossaryNotice-BhvvMaX1.js";import"./Switch-CKmzMGzD.js";import"./Article-B2tsd32U.js";function Tt(t){return Te("MuiCardActionArea",t)}const de=Ae("MuiCardActionArea",["root","focusVisible","focusHighlight"]),At=t=>{const{classes:n}=t;return Pe({root:["root"],focusHighlight:["focusHighlight"]},Tt,n)},Rt=q(Ke,{name:"MuiCardActionArea",slot:"Root"})(ie(({theme:t})=>({display:"block",textAlign:"inherit",borderRadius:"inherit",width:"100%",[`&:hover .${de.focusHighlight}`]:{opacity:(t.vars||t).palette.action.hoverOpacity,"@media (hover: none)":{opacity:0}},[`&.${de.focusVisible} .${de.focusHighlight}`]:{opacity:(t.vars||t).palette.action.focusOpacity}}))),Pt=q("span",{name:"MuiCardActionArea",slot:"FocusHighlight"})(ie(({theme:t})=>({overflow:"hidden",pointerEvents:"none",position:"absolute",top:0,right:0,bottom:0,left:0,borderRadius:"inherit",opacity:0,backgroundColor:"currentcolor",transition:t.transitions.create("opacity",{duration:t.transitions.duration.short})}))),ae=a.forwardRef(function(n,x){const c=Re({props:n,name:"MuiCardActionArea"}),{children:r,className:R,focusVisibleClassName:h,slots:D={},slotProps:v={},..._}=c,f=c,b=At(f),P={slots:D,slotProps:v},[g,k]=pe("root",{elementType:Rt,externalForwardedProps:{...P,..._},shouldForwardComponentProp:!0,ownerState:f,ref:x,className:ue(b.root,R),additionalProps:{focusVisibleClassName:ue(h,b.focusVisible)}}),[M,E]=pe("focusHighlight",{elementType:Pt,externalForwardedProps:P,ownerState:f,className:b.focusHighlight});return e.jsxs(g,{...k,children:[r,e.jsx(M,{...E})]})}),Et=Ee(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),Ft=Ee(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"})),Dt=q("span",{name:"MuiRadioButtonIcon",shouldForwardProp:Fe})({position:"relative",display:"flex"}),_t=q(Et,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),Nt=q(Ft,{name:"MuiRadioButtonIcon"})(ie(({theme:t})=>({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}}]})));function _e(t){const{checked:n=!1,classes:x={},fontSize:c}=t,r={...t,checked:n};return e.jsxs(Dt,{className:x.root,ownerState:r,children:[e.jsx(_t,{fontSize:c,className:x.background,ownerState:r}),e.jsx(Nt,{fontSize:c,className:x.dot,ownerState:r})]})}const Mt=a.createContext(void 0);function Bt(){return a.useContext(Mt)}function Ut(t){return Te("MuiRadio",t)}const Se=Ae("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),Lt=t=>{const{classes:n,color:x,size:c}=t,r={root:["root",`color${ne(x)}`,c!=="medium"&&`size${ne(c)}`]};return{...n,...Pe(r,Ut,n)}},Ot=q(Ye,{shouldForwardProp:t=>Fe(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:x}=t;return[n.root,x.size!=="medium"&&n[`size${ne(x.size)}`],n[`color${ne(x.color)}`]]}})(ie(({theme:t})=>({color:(t.vars||t).palette.text.secondary,[`&.${Se.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.alpha((t.vars||t).palette.action.active,(t.vars||t).palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(ye()).map(([n])=>({props:{color:n,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.alpha((t.vars||t).palette[n].main,(t.vars||t).palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(ye()).map(([n])=>({props:{color:n,disabled:!1},style:{[`&.${Se.checked}`]:{color:(t.vars||t).palette[n].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function zt(t,n){return typeof n=="object"&&n!==null?t===n:String(t)===String(n)}const Wt=e.jsx(_e,{checked:!0}),Gt=e.jsx(_e,{}),Ne=a.forwardRef(function(n,x){const c=Re({props:n,name:"MuiRadio"}),{checked:r,checkedIcon:R=Wt,color:h="primary",icon:D=Gt,name:v,onChange:_,size:f="medium",className:b,disabled:P,disableRipple:g=!1,slots:k={},slotProps:M={},inputProps:E,...I}=c,A=He();let N=P;A&&typeof N>"u"&&(N=A.disabled),N??=!1;const C={...c,disabled:N,disableRipple:g,color:h,size:f},F=Lt(C),s=Bt();let j=r;const B=Ve(_,s&&s.onChange);let O=v;s&&(typeof j>"u"&&(j=zt(s.value,c.value)),typeof O>"u"&&(O=s.name));const l=M.input??E,[d,p]=pe("root",{ref:x,elementType:Ot,className:ue(F.root,b),shouldForwardComponentProp:!0,externalForwardedProps:{slots:k,slotProps:M,...I},getSlotProps:T=>({...T,onChange:(Q,...H)=>{T.onChange?.(Q,...H),B(Q,...H)}}),ownerState:C,additionalProps:{type:"radio",icon:a.cloneElement(D,{fontSize:D.props.fontSize??f}),checkedIcon:a.cloneElement(R,{fontSize:R.props.fontSize??f}),disabled:N,name:O,checked:j,slots:k,slotProps:{input:typeof l=="function"?l(C):l}}});return e.jsx(d,{...p,classes:F})});function $t({title:t,subtitle:n,steps:x,currentStep:c,onNext:r,onPrev:R,onComplete:h,nextLabel:D="Next",prevLabel:v="Back",completeLabel:_="Complete",nextDisabled:f=!1,loading:b=!1,children:P}){const g=(c+1)/x.length*100,k=c===x.length-1,M=c===0;return e.jsxs(w,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",bgcolor:"background.default"},children:[e.jsx(w,{sx:{borderBottom:1,borderColor:"divider",bgcolor:"background.paper",py:2},children:e.jsxs(te,{maxWidth:"md",children:[e.jsx(u,{variant:"h5",fontWeight:600,children:t}),n&&e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:n})]})}),e.jsx(he,{variant:"determinate",value:g,sx:{height:4,bgcolor:"action.hover","& .MuiLinearProgress-bar":{bgcolor:E=>E.palette.mode==="dark"?i[1e3]:i[1200]}}}),e.jsx(w,{sx:{borderBottom:1,borderColor:"divider",bgcolor:"background.paper"},children:e.jsx(te,{maxWidth:"md",children:e.jsx(G,{direction:"row",spacing:0,sx:{py:2},children:x.map((E,I)=>e.jsxs(w,{sx:{flex:1,display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(w,{sx:{width:28,height:28,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:A=>I<c?A.palette.mode==="dark"?i[1100]:i[1200]:I===c?A.palette.mode==="dark"?i[1e3]:i[1100]:"action.disabledBackground",color:I<=c?"white":"text.disabled",fontSize:"0.75rem",fontWeight:600},children:I<c?e.jsx(Ce,{sx:{fontSize:16}}):I+1}),e.jsxs(w,{sx:{flex:1},children:[e.jsx(u,{variant:"body2",fontWeight:I===c?600:400,color:I===c?"text.primary":"text.secondary",children:E.label}),E.description&&e.jsx(u,{variant:"caption",color:"text.disabled",children:E.description})]}),I<x.length-1&&e.jsx(w,{sx:{width:40,height:2,bgcolor:A=>I<c?A.palette.mode==="dark"?i[1100]:i[1200]:A.palette.divider,mx:1}})]},E.key))})})}),e.jsx(w,{sx:{flex:1,py:4},children:e.jsx(te,{maxWidth:"md",children:e.jsx(Y,{elevation:0,sx:{p:4,border:1,borderColor:"divider",borderRadius:1},children:P})})}),e.jsx(w,{sx:{borderTop:1,borderColor:"divider",bgcolor:"background.paper",py:2},children:e.jsx(te,{maxWidth:"md",children:e.jsxs(G,{direction:"row",justifyContent:"space-between",children:[e.jsx(W,{variant:"outlined",startIcon:e.jsx(ut,{}),onClick:R,disabled:M||b,children:v}),e.jsx(W,{variant:"contained",endIcon:k?e.jsx(Ce,{}):e.jsx(xt,{}),onClick:k?h:r,disabled:f||b,children:k?_:D})]})})})]})}const K={id:"demo-connection",name:"Sample Database (Demo)",db_type:"demo",database:"sample_data",status:"connected",summary:"Pre-loaded sample data for testing",isDemo:!0};function Kt({wizardState:t,updateWizardState:n,onComplete:x,setLoading:c}){const r=le(),{execute:R}=ce(),h=L(s=>s.savedConnections),D=L(s=>s.setSavedConnections),v=L(s=>s.addSavedConnection),_=L(s=>s.setActiveConnectionId),f=L(s=>s.activeConnection),[b,P]=a.useState(t.connectionId||f?.id||null),[g,k]=a.useState(!1),[M,E]=a.useState(!1);a.useEffect(()=>{const s=async()=>{try{const j=await Xe();j?.connections&&D(j.connections)}catch(j){console.error("Failed to fetch connections:",j),r.show("Failed to load saved connections","warning")}};h.length===0&&s()},[h.length,D,r]);const I=a.useCallback(s=>{P(s),n({connectionId:s}),_(s)},[n,_]),A=a.useCallback(()=>{k(!0)},[]),N=a.useCallback(async s=>{E(!0);try{await R({type:ee.CREATE,label:`Add connection "${s?.name||s?.db_url||"connection"}"`,reversibility:X.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,blocksNavigation:!1,intent:{connectionName:s?.name,dbType:s?.db_type},action:async()=>{try{const j=await Je(s);if(!j.ok)throw new Error(j.detail||"Connection test failed");const B=await qe({id:j.connection_id,name:s.name,dbType:s.db_type,dbUrl:s.db_url,database:s.database,status:"connected",latencyMs:j.latency_ms});return v(B),I(B.id),r.show("Connection added","success"),k(!1),B}catch(j){throw r.show(j.message||"Failed to save connection","error"),j}}})}finally{E(!1)}},[v,I,r,R]);a.useCallback(()=>{b&&x()},[b,x]);const C=a.useCallback(()=>{P(K.id),n({connectionId:K.id,isDemo:!0}),h.find(s=>s.id===K.id)||v(K),_(K.id),r.show("Demo mode activated! Using sample data.","success")},[n,h,v,_,r]),F=a.useCallback(()=>{n({connectionId:null,skippedConnection:!0}),x()},[n,x]);return e.jsxs(w,{children:[e.jsx(u,{variant:"h6",fontWeight:600,sx:{mb:1},children:"Connect Your Data"}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Choose where your report data comes from. You can always change this later."}),e.jsxs(w,{sx:{mb:4},children:[e.jsx(u,{variant:"subtitle2",fontWeight:600,color:"text.secondary",sx:{mb:2,textTransform:"uppercase",fontSize:"0.75rem",letterSpacing:"0.05em"},children:"Quick Start"}),e.jsxs(G,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(se,{variant:"outlined",sx:{flex:1,border:2,borderColor:b===K.id?s=>s.palette.mode==="dark"?i[1e3]:i[1100]:"divider",bgcolor:b===K.id?s=>s.palette.mode==="dark"?U(s.palette.text.primary,.04):i[200]:"transparent",transition:"all 0.2s","&:hover":{borderColor:s=>s.palette.mode==="dark"?i[1e3]:i[1100],bgcolor:s=>s.palette.mode==="dark"?U(s.palette.text.primary,.04):i[200]}},children:e.jsx(ae,{onClick:C,sx:{height:"100%"},children:e.jsxs(oe,{sx:{textAlign:"center",py:3},children:[e.jsx(ht,{sx:{fontSize:40,color:"text.secondary",mb:1}}),e.jsx(u,{variant:"subtitle1",fontWeight:600,children:"Try Demo Mode"}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Explore with sample data — no setup needed"}),e.jsx($,{label:"Recommended for first-time users",size:"small",variant:"outlined",sx:{bgcolor:s=>s.palette.mode==="dark"?U(s.palette.text.primary,.1):i[400],color:"text.secondary"}})]})})}),e.jsx(se,{variant:"outlined",sx:{flex:1,border:2,borderColor:"divider",transition:"all 0.2s","&:hover":{borderColor:"secondary.main"}},children:e.jsx(ae,{onClick:F,sx:{height:"100%"},children:e.jsxs(oe,{sx:{textAlign:"center",py:3},children:[e.jsx(ft,{sx:{fontSize:40,color:"text.secondary",mb:1}}),e.jsx(u,{variant:"subtitle1",fontWeight:600,children:"Skip for Now"}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"Set up data source later and explore templates first"})]})})})]})]}),e.jsx(me,{sx:{my:3},children:e.jsx($,{label:"Or connect your own data",size:"small"})}),h.length===0||h.every(s=>s.isDemo)?e.jsx(J,{severity:"info",sx:{mb:3},children:"No database connections yet. Add one below or try demo mode above."}):e.jsx(G,{spacing:2,sx:{mb:3},children:h.map(s=>e.jsx(se,{variant:"outlined",sx:{border:2,borderColor:b===s.id?j=>j.palette.mode==="dark"?i[1e3]:i[1100]:"divider",transition:"border-color 0.2s"},children:e.jsx(ae,{onClick:()=>I(s.id),children:e.jsxs(oe,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ne,{checked:b===s.id,sx:{p:0}}),e.jsx(Qe,{sx:{color:"text.secondary"}}),e.jsxs(w,{sx:{flex:1},children:[e.jsx(u,{variant:"subtitle1",fontWeight:500,children:s.name}),e.jsxs(u,{variant:"body2",color:"text.secondary",children:[s.db_type," • ",s.summary||s.database]})]}),e.jsxs(G,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx($,{size:"small",label:s.status==="connected"?"Connected":"Disconnected",variant:"outlined",sx:{bgcolor:j=>j.palette.mode==="dark"?U(j.palette.text.primary,.1):i[400],color:"text.secondary"}}),b===s.id&&e.jsx(re,{sx:{color:"text.secondary"}})]})]})})},s.id))}),e.jsx(me,{sx:{my:3}}),e.jsx(W,{variant:"outlined",startIcon:e.jsx(Ze,{}),onClick:A,fullWidth:!0,sx:{py:1.5,borderStyle:"dashed"},children:"Add New Connection"}),e.jsx(gt,{open:g,onClose:()=>k(!1),title:"New Connection",subtitle:"Configure your database connection",width:520,children:e.jsx(bt,{onSave:N,onCancel:()=>k(!1),loading:M})})]})}const Ht=[{id:"gallery-invoice",name:"Invoice Report",description:"Professional invoice template with line items, totals, and company branding",kind:"pdf",icon:vt,popular:!0},{id:"gallery-sales",name:"Sales Summary",description:"Weekly/monthly sales report with charts, metrics, and trends",kind:"excel",icon:tt,popular:!0},{id:"gallery-inventory",name:"Inventory Report",description:"Stock levels, reorder points, and inventory movement tracking",kind:"excel",icon:xe,popular:!1},{id:"gallery-executive",name:"Executive Summary",description:"High-level business metrics and KPIs for leadership review",kind:"pdf",icon:jt,popular:!1},{id:"gallery-blank-pdf",name:"Blank PDF Template",description:"Start from scratch with a customizable PDF layout",kind:"pdf",icon:st,popular:!1},{id:"gallery-blank-excel",name:"Blank Excel Template",description:"Start from scratch with a customizable spreadsheet",kind:"excel",icon:xe,popular:!1}];function Vt({wizardState:t,updateWizardState:n,onComplete:x,setLoading:c}){const r=le(),{execute:R}=ce(),h=De(),D=a.useCallback((o,y,S={})=>h(o,{label:y,intent:{from:"setup-step-template",...S}}),[h]),v=a.useRef(null),_=L(o=>o.activeConnection),f=L(o=>o.setTemplateId),b=L(o=>o.setVerifyArtifacts),P=L(o=>o.addTemplate),[g,k]=a.useState(t.templateKind||"pdf"),[M,E]=a.useState(!1),[I,A]=a.useState(0),[N,C]=a.useState(null),[F,s]=a.useState(null),[j,B]=a.useState(null),[O,l]=a.useState(!1),[d,p]=a.useState(null),[T,Q]=a.useState(null),[H,ge]=a.useState(!1);a.useEffect(()=>{if(!d)return;let o=!1;const y=async()=>{try{const m=await at(d);if(o||!m)return;if(typeof m.progress=="number"&&A(Math.round(m.progress)),m.status==="completed"){const z=m.result||{},Z=z.template_id||z.templateId;if(!Z){B("Template verification completed but no template ID was returned."),r.show("Template verification completed without a template ID.","error"),p(null);return}s(z),f(Z),b(z.artifacts),n({templateId:Z}),P({id:Z,name:N?.name||`Template ${Z}`,kind:g,status:"pending",created_at:new Date().toISOString()}),r.show("Template verified successfully","success"),p(null)}else if(m.status==="failed"||m.status==="cancelled"){const z=m.error||"Template verification failed";B(z),r.show(z,"error"),p(null)}}catch(m){if(o)return;const z=m.message||"Failed to load queued job status";B(z),r.show(z,"error"),p(null)}};y();const S=setInterval(y,3e3);return()=>{o=!0,clearInterval(S)}},[d,g,N,f,b,n,P,r]);const Me=a.useCallback((o,y)=>{y&&(k(y),n({templateKind:y}))},[n]),Be=a.useCallback(o=>{o.preventDefault();const y=o.dataTransfer?.files;y?.length>0&&be(y[0])},[]),Ue=a.useCallback(o=>{o.preventDefault()},[]),Le=a.useCallback(o=>{const y=o.target.files;y?.length>0&&be(y[0])},[]),be=a.useCallback(async o=>{B(null),C(o),E(!0),A(0),p(null);try{const y=t.connectionId||_?.id;if(!y){const S="Please connect to a database before verifying templates.";B(S),r.show(S,"warning"),E(!1),A(0);return}await R({type:ee.UPLOAD,label:`Verify ${g.toUpperCase()} template`,reversibility:X.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,blocksNavigation:!0,intent:{connectionId:y,templateKind:g,fileName:o?.name,action:"verify_template"},action:async()=>{try{const S=await et({file:o,connectionId:y,kind:g,background:O,onProgress:m=>{if(m.event==="stage"){const z=m.progress||0;A(z)}},onUploadProgress:m=>{A(m)}});if(O){const m=S?.job_id||S?.jobId||null;return p(m),r.show("Template verification queued. Track progress in Jobs.","success"),S}return s(S),f(S.template_id),b(S.artifacts),n({templateId:S.template_id}),P({id:S.template_id,name:o.name,kind:g,status:"pending",created_at:new Date().toISOString()}),r.show("Template verified successfully","success"),S}catch(S){throw B(S.message||"Failed to verify template"),r.show(S.message||"Failed to verify template","error"),S}}})}finally{E(!1),A(100)}},[t.connectionId,_?.id,g,O,f,b,n,P,r,R]),Oe=a.useCallback(()=>{v.current?.click()},[]),ze=g==="pdf"?".pdf":".xlsx,.xls",We=a.useCallback(o=>{Q(o),k(o.kind),n({templateKind:o.kind,galleryTemplate:o})},[n]),Ge=a.useCallback(async()=>{T&&await R({type:ee.CREATE,label:`Use "${T.name}" template`,reversibility:X.FULLY_REVERSIBLE,suppressSuccessToast:!0,intent:{galleryId:T.id,kind:T.kind,action:"use_gallery_template"},action:async()=>{c(!0);try{const o=await void 0,y=o.template_id||o.templateId||`gallery-${T.id}`;return f(y),n({templateId:y,galleryTemplate:T}),P({id:y,name:T.name,kind:T.kind,status:"approved",created_at:new Date().toISOString(),isGalleryTemplate:!0}),r.show(`"${T.name}" template ready!`,"success"),s({template_id:y}),o}finally{c(!1)}}})},[T,t.connectionId,f,n,P,r,c,R]),$e=Ht.filter(o=>g==="all"||o.kind===g);return e.jsxs(w,{children:[e.jsx(u,{variant:"h6",fontWeight:600,sx:{mb:1},children:"Choose a Report Template"}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Pick from our gallery or upload your own design. Templates define how your reports will look."}),e.jsx(w,{sx:{mb:3},children:e.jsxs(mt,{value:g,exclusive:!0,onChange:Me,size:"small",children:[e.jsxs(je,{value:"pdf",sx:{px:3},children:[e.jsx(yt,{sx:{mr:1,fontSize:18}}),"PDF Reports"]}),e.jsxs(je,{value:"excel",sx:{px:3},children:[e.jsx(xe,{sx:{mr:1,fontSize:18}}),"Excel Reports"]})]})}),!H&&!F&&e.jsxs(w,{sx:{mb:3},children:[e.jsxs(u,{variant:"subtitle2",fontWeight:600,color:"text.secondary",sx:{mb:2,textTransform:"uppercase",fontSize:"0.75rem",letterSpacing:"0.05em"},children:[e.jsx(ot,{sx:{fontSize:14,mr:.5,verticalAlign:"middle"}}),"Template Gallery"]}),e.jsx(ke,{container:!0,spacing:2,children:$e.map(o=>{const y=o.icon,S=T?.id===o.id;return e.jsx(ke,{item:!0,xs:12,sm:6,md:4,children:e.jsx(se,{variant:"outlined",sx:{height:"100%",border:2,borderColor:S?m=>m.palette.mode==="dark"?i[1e3]:i[1100]:"divider",bgcolor:S?m=>m.palette.mode==="dark"?U(m.palette.text.primary,.04):i[200]:"transparent",transition:"all 0.2s","&:hover":{borderColor:m=>m.palette.mode==="dark"?i[1e3]:i[1100],transform:"translateY(-2px)",boxShadow:2}},children:e.jsx(ae,{onClick:()=>We(o),sx:{height:"100%",display:"flex",flexDirection:"column",alignItems:"stretch"},children:e.jsxs(oe,{sx:{flex:1},children:[e.jsxs(G,{direction:"row",alignItems:"flex-start",spacing:1,sx:{mb:1},children:[e.jsx(Ne,{checked:S,size:"small",sx:{p:0,mr:.5}}),e.jsx(y,{sx:{fontSize:24,color:"text.secondary"}}),e.jsxs(w,{sx:{flex:1},children:[e.jsxs(G,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(u,{variant:"subtitle2",fontWeight:600,children:o.name}),o.popular&&e.jsx($,{label:"Popular",size:"small",sx:{height:18,fontSize:"0.65rem",bgcolor:m=>m.palette.mode==="dark"?U(m.palette.text.primary,.1):i[400],color:"text.secondary"}})]}),e.jsx($,{label:o.kind.toUpperCase(),size:"small",variant:"outlined",sx:{height:18,fontSize:"0.6rem",mt:.5,bgcolor:m=>m.palette.mode==="dark"?U(m.palette.text.primary,.1):i[400],color:"text.secondary"}})]})]}),e.jsx(u,{variant:"caption",color:"text.secondary",children:o.description})]})})})},o.id)})}),T&&e.jsxs(w,{sx:{mt:2},children:[e.jsxs(W,{variant:"contained",onClick:Ge,startIcon:e.jsx(re,{}),sx:{mr:2},children:['Use "',T.name,'"']}),e.jsx(W,{variant:"text",onClick:()=>Q(null),children:"Clear Selection"})]}),e.jsx(me,{sx:{my:3},children:e.jsx($,{label:"Or upload your own",size:"small"})}),e.jsx(W,{variant:"outlined",startIcon:e.jsx(ve,{}),onClick:()=>ge(!0),sx:{borderStyle:"dashed"},children:"Upload Custom Template"})]}),(H||F)&&e.jsxs(e.Fragment,{children:[H&&!F&&e.jsx(W,{variant:"text",onClick:()=>ge(!1),sx:{mb:2},children:"← Back to Gallery"}),j&&e.jsx(J,{severity:"error",sx:{mb:3},onClose:()=>B(null),children:j}),d&&e.jsxs(J,{severity:"info",sx:{mb:3},action:e.jsx(W,{size:"small",onClick:()=>D("/jobs","Open jobs"),sx:{textTransform:"none"},children:"View Jobs"}),children:["Template verification queued. Job ID: ",d]}),F?e.jsx(Y,{sx:{p:3,border:2,borderColor:o=>U(o.palette.divider,.3),bgcolor:o=>o.palette.mode==="dark"?U(o.palette.text.primary,.04):i[200]},children:e.jsxs(G,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(re,{sx:{fontSize:48,color:"text.secondary"}}),e.jsxs(w,{children:[e.jsx(u,{variant:"subtitle1",fontWeight:600,children:"Template Verified"}),e.jsx(u,{variant:"body2",color:"text.secondary",children:N?.name}),e.jsxs(u,{variant:"caption",color:"text.secondary",children:["ID: ",F.template_id]})]})]})}):e.jsxs(Y,{onDrop:Be,onDragOver:Ue,sx:{p:4,border:2,borderStyle:"dashed",borderColor:"divider",bgcolor:"action.hover",textAlign:"center",cursor:"pointer",transition:"border-color 0.2s, background-color 0.2s","&:hover":{borderColor:o=>o.palette.mode==="dark"?i[1e3]:i[1100],bgcolor:o=>o.palette.mode==="dark"?U(o.palette.text.primary,.04):i[200]}},onClick:Oe,children:[e.jsx(G,{direction:"row",justifyContent:"center",sx:{mb:2},children:e.jsx(W,{variant:O?"contained":"outlined",size:"small",onClick:o=>{o.stopPropagation(),l(y=>!y)},sx:{textTransform:"none"},children:O?"Queue in background: On":"Queue in background: Off"})}),e.jsx("input",{ref:v,type:"file",accept:ze,onChange:Le,hidden:!0}),M?e.jsxs(w,{children:[e.jsx(u,{variant:"body1",sx:{mb:2},children:"Uploading and verifying..."}),e.jsx(he,{variant:"determinate",value:I,sx:{maxWidth:300,mx:"auto",bgcolor:o=>o.palette.mode==="dark"?U(o.palette.text.primary,.1):i[300],"& .MuiLinearProgress-bar":{bgcolor:o=>o.palette.mode==="dark"?i[1e3]:i[1100]}}}),e.jsxs(u,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:[I,"%"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{sx:{fontSize:48,color:"text.disabled",mb:2}}),e.jsxs(u,{variant:"body1",sx:{mb:1},children:["Drag and drop your ",g.toUpperCase()," file here"]}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"or click to browse"}),e.jsx(W,{variant:"outlined",size:"small",children:"Browse Files"})]})]}),F?.artifacts?.png_url&&e.jsxs(w,{sx:{mt:3},children:[e.jsx(u,{variant:"subtitle2",fontWeight:600,sx:{mb:1},children:"Preview"}),e.jsx(Y,{sx:{p:2,bgcolor:"background.default"},children:e.jsx("img",{src:F.artifacts.png_url,alt:"Template preview",style:{maxWidth:"100%",height:"auto",borderRadius:4}})})]})]})]})}function Yt({wizardState:t,updateWizardState:n,onComplete:x,setLoading:c}){const r=le(),{execute:R}=ce(),h=L(l=>l.templateId)||t.templateId,D=L(l=>l.activeConnection),v=L(l=>l.setLastApprovedTemplate),[_,f]=a.useState(!1),[b,P]=a.useState(t.mapping||{}),[g,k]=a.useState(t.keys||[]),[M,E]=a.useState(!1),[I,A]=a.useState(!1),[N,C]=a.useState(!1),[F,s]=a.useState(null);a.useEffect(()=>{const l=async()=>{if(h){f(!0);try{const d=t.connectionId||D?.id;await R({type:ee.ANALYZE,label:"Load mapping preview",reversibility:X.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,blocksNavigation:!1,intent:{connectionId:d,templateId:h,templateKind:t.templateKind||"pdf",action:"mapping_preview"},action:async()=>{try{const p=await dt(h,d,{kind:t.templateKind||"pdf"});return p.mapping&&(P(p.mapping),n({mapping:p.mapping})),p.keys&&(k(p.keys),n({keys:p.keys})),p}catch(p){throw s(p.message||"Failed to load mapping"),p}}})}finally{f(!1)}}};t.mapping||l()},[h,t.connectionId,t.templateKind,t.mapping,D?.id,n,R]);const j=a.useCallback((l,d,p)=>{P(T=>({...T,[l]:{...T[l],[d]:p}}))},[]),B=a.useCallback(async()=>{A(!0),s(null);try{const l=t.connectionId||D?.id;await R({type:ee.UPDATE,label:"Approve template mapping",reversibility:X.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,blocksNavigation:!0,intent:{connectionId:l,templateId:h,templateKind:t.templateKind||"pdf",action:"mapping_approve"},action:async()=>{try{const d=await nt(h,b,{connectionId:l,keys:g,kind:t.templateKind||"pdf",onProgress:()=>{}});return d.ok&&(C(!0),v({id:h,name:t.templateName,kind:t.templateKind}),r.show("Template approved and ready to use!","success")),d}catch(d){throw s(d.message||"Failed to approve mapping"),r.show(d.message||"Failed to approve mapping","error"),d}}})}finally{A(!1)}},[h,b,g,t,D?.id,v,r,R]),O=Object.entries(b);return e.jsxs(w,{children:[e.jsx(u,{variant:"h6",fontWeight:600,sx:{mb:1},children:"Configure Field Mapping"}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Map template placeholders to your database columns for automatic data insertion."}),F&&e.jsx(J,{severity:"error",sx:{mb:3},onClose:()=>s(null),children:F}),N&&e.jsx(J,{severity:"success",icon:e.jsx(re,{}),sx:{mb:3},children:"Template mapping approved! You can now generate reports."}),_?e.jsxs(w,{sx:{py:4},children:[e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mb:2,textAlign:"center"},children:"Loading mapping configuration..."}),e.jsx(he,{})]}):O.length===0?e.jsx(J,{severity:"info",children:"No mappings found. The template may not have any placeholder tokens."}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{variant:"outlined",sx:{overflow:"hidden"},children:e.jsxs(kt,{size:"small",children:[e.jsx(It,{children:e.jsxs(Ie,{sx:{bgcolor:"action.hover"},children:[e.jsx(V,{sx:{fontWeight:600},children:"Template Field"}),e.jsx(V,{sx:{fontWeight:600},children:"Database Column"}),e.jsx(V,{sx:{fontWeight:600},children:"Status"})]})}),e.jsx(St,{children:O.map(([l,d])=>e.jsxs(Ie,{children:[e.jsx(V,{children:e.jsx($,{label:l,size:"small",variant:"outlined",sx:{fontFamily:"monospace"}})}),e.jsx(V,{children:e.jsx(rt,{size:"small",value:d?.column||d?.expression||"",onChange:p=>j(l,"column",p.target.value),placeholder:"Enter column name",fullWidth:!0,disabled:N})}),e.jsx(V,{children:d?.column||d?.expression?e.jsx($,{label:"Mapped",size:"small",variant:"outlined",sx:{bgcolor:p=>p.palette.mode==="dark"?U(p.palette.text.primary,.1):i[400],color:"text.secondary"}}):e.jsx($,{label:"Unmapped",size:"small",variant:"outlined",sx:{bgcolor:p=>p.palette.mode==="dark"?U(p.palette.text.primary,.1):i[400],color:"text.secondary"}})})]},l))})]})}),e.jsxs(w,{sx:{mt:3},children:[e.jsx(W,{variant:"text",size:"small",onClick:()=>E(l=>!l),endIcon:M?e.jsx(it,{}):e.jsx(lt,{}),sx:{textTransform:"none",fontWeight:500},children:"Advanced Settings"}),e.jsx(ct,{in:M,children:e.jsxs(Y,{sx:{mt:2,p:2,bgcolor:"action.hover"},children:[e.jsx(u,{variant:"subtitle2",fontWeight:600,sx:{mb:2},children:"Key Fields"}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Select fields that will be used as filter keys when generating reports."}),e.jsx(G,{direction:"row",spacing:1,flexWrap:"wrap",gap:1,children:O.map(([l])=>e.jsx($,{label:l,size:"small",variant:g.includes(l)?"filled":"outlined",sx:g.includes(l)?{bgcolor:d=>d.palette.mode==="dark"?U(d.palette.text.primary,.1):i[400],color:"text.secondary"}:{},onClick:()=>{g.includes(l)?k(d=>d.filter(p=>p!==l)):k(d=>[...d,l])},disabled:N},l))})]})})]}),!N&&e.jsx(w,{sx:{mt:4,textAlign:"center"},children:e.jsx(W,{variant:"contained",size:"large",onClick:B,disabled:I,startIcon:e.jsx(Ct,{}),children:I?"Approving...":"Approve Mapping"})})]})]})}const fe="neurareport_wizard_state",Jt=t=>{try{sessionStorage.setItem(fe,JSON.stringify(t))}catch{}},qt=()=>{try{const t=sessionStorage.getItem(fe);return t?JSON.parse(t):null}catch{return null}},Qt=()=>{try{sessionStorage.removeItem(fe)}catch{}},we=[{key:"connection",label:"Connect Data Source",description:"Select or create a data source for reports"},{key:"template",label:"Upload Report Design",description:"Upload a PDF or Excel design"},{key:"mapping",label:"Map Fields",description:"Match design fields to data columns (no SQL required)"}],Zt={connection:0,template:1,mapping:2},Xt=["connection","template","mapping"];function es(){const t=De(),[n,x]=pt(),c=a.useCallback((C,F,s={})=>t(C,{label:F,intent:{from:"setup-wizard",...s}}),[t]),r=le(),[R,h]=a.useState(!1),D=n.get("step")||"connection",[v,_]=a.useState(()=>Zt[D]??0),[f,b]=a.useState(()=>qt()||{connectionId:null,templateId:null,templateKind:"pdf",mapping:null,keys:[]}),P=L(C=>C.activeConnection),g=L(C=>C.templateId);a.useEffect(()=>{Jt(f)},[f]),a.useEffect(()=>{const C=new URLSearchParams(n);C.set("step",Xt[v]),x(C,{replace:!0})},[v,n,x]);const k=a.useCallback(C=>{b(F=>({...F,...C}))},[]),M=a.useCallback(()=>{v<we.length-1&&_(C=>C+1)},[v]),E=a.useCallback(()=>{v>0&&_(C=>C-1)},[v]),I=a.useCallback(()=>{Qt(),r.show("Report design ready. You can run it from Reports.","success"),c("/reports","Open reports")},[t,r]),A=()=>{switch(v){case 0:return e.jsx(Kt,{wizardState:f,updateWizardState:k,onComplete:M,setLoading:h});case 1:return e.jsx(Vt,{wizardState:f,updateWizardState:k,onComplete:M,setLoading:h});case 2:return e.jsx(Yt,{wizardState:f,updateWizardState:k,onComplete:I,setLoading:h});default:return null}},N=()=>{switch(v){case 0:return!f.connectionId&&!P?.id;case 1:return!f.templateId&&!g;case 2:return!1;default:return!1}};return e.jsx($t,{title:"Set Up Report Design",subtitle:"Connect your data source and prepare a report design for runs",steps:we,currentStep:v,onNext:M,onPrev:E,onComplete:I,nextDisabled:N(),loading:R,children:e.jsxs(G,{spacing:2,children:[e.jsx(wt,{dense:!0,showChips:!1}),A()]})})}function ys(){return ce(),e.jsx(es,{})}export{ys as default};
