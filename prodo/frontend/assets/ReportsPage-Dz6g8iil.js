import{g as Ue,j as e,a as je,r as a,v as Ke,R as O,I as B,c2 as yt,c3 as jt,P as ie,B as b,q as d,c1 as Fe,n as l,s as ge,o as u,T as vt,e as kt,ba as Qe,bb as Xe,bc as fe,aJ as Ze,K as W,C as Me,V as Je,aZ as et,A as ye,a2 as tt,f as n,p as N,u as St,Z as Ct,w as wt,l as ee,c4 as It,c5 as Rt,c6 as zt,bh as me,D as We,H as _e,m as qe,S as Oe,M as he,ak as Tt,aY as Dt,bP as Et,c7 as At,aU as Pt,E as Be,$ as te,aV as Ne,c8 as Lt,c9 as Ft,ca as Mt,N as C,bQ as Wt}from"./index-DeRHNZar.js";import{A as _t}from"./Article-qoKRFYGy.js";import{A as qt}from"./ArrowForward-B-_3cE5M.js";import{F as $e}from"./FilterList-D07PuMFv.js";import{P as Ot}from"./PageHeader-DsMdeV49.js";import{P as st}from"./PictureAsPdf-5BCEcUNz.js";import{C as Bt}from"./Check-D18rRUYU.js";import{u as Nt,S as $t}from"./SuccessCelebration-BQPuSKkv.js";import{A as Ht}from"./AiUsageNotice-BgIrRfUH.js";import{C as Vt}from"./ConnectionSelector-DMISq3nq.js";import{g as Gt,q as Yt}from"./summary-oVzSlhUW.js";import{C as Ut}from"./Container-BG8lhrz1.js";const Kt=Ue(e.jsx("path",{d:"M9 11H7v2h2zm4 0h-2v2h2zm4 0h-2v2h2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V9h14z"})),He=Ue(e.jsx("path",{d:"M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V8h14zM7 10h5v5H7z"})),Qt={pdf:st,excel:tt};function Xt({onSelectTemplate:s}){const{execute:m}=je(),[g,i]=a.useState(!1),[x,E]=a.useState(""),[h,y]=a.useState(!1),[_,$]=a.useState(!1),[c,q]=a.useState([]),[S,z]=a.useState(null),v=Ke(),T=a.useCallback((o,j,f={})=>m({type:B.EXECUTE,label:o,reversibility:O.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"template_recommender",...f},action:j}),[m]),I=a.useCallback(()=>{const o=x.trim();if(o)return m({type:B.ANALYZE,label:"Recommend templates",reversibility:O.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"template_recommender",action:"recommend_templates",requirement:o},action:async()=>{y(!0),z(null),q([]);try{const j=await yt({requirement:o,limit:5}),f=Array.isArray(j)?j:[];return q(f),f.length||z("No matching templates found. Try a different description."),f}catch(j){throw z(j.message||"Failed to get recommendations"),j}finally{y(!1)}}})},[m,x]),H=a.useCallback(()=>{const o=x.trim();if(o)return m({type:B.GENERATE,label:"Queue template recommendations",reversibility:O.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"template_recommender",action:"queue_recommendations",requirement:o},action:async()=>{$(!0),z(null);try{const j=await jt({requirement:o,limit:5});return j?.job_id?v.show("Recommendation job queued. Track it in Jobs.","success"):v.show("Failed to queue recommendation job.","error"),j}catch(j){throw v.show(j.message||"Failed to queue recommendations","error"),j}finally{$(!1)}}})},[m,x,v]),R=a.useCallback(o=>T("Select recommended template",()=>{s?.(o),i(!1)},{templateId:o?.id}),[T,s]),V=a.useCallback(o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),I())},[I]);return e.jsxs(ie,{sx:{border:1,borderColor:"divider",borderStyle:g?"solid":"dashed",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)",overflow:"hidden"},children:[e.jsxs(b,{sx:{px:2,py:1.5,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",bgcolor:g?"action.selected":"transparent","&:hover":{bgcolor:"action.hover"}},onClick:()=>T("Toggle template recommender",()=>i(o=>!o)),children:[e.jsxs(d,{direction:"row",alignItems:"center",spacing:1.5,children:[e.jsx(Fe,{sx:{width:32,height:32,bgcolor:o=>o.palette.mode==="dark"?"rgba(255,255,255,0.08)":l[100]},children:e.jsx(ge,{sx:{color:"text.secondary",fontSize:18}})}),e.jsxs(b,{children:[e.jsx(u,{variant:"subtitle2",fontWeight:600,children:"AI Template Picker"}),e.jsx(u,{variant:"caption",color:"text.secondary",children:"Describe what you need and let AI find the best template"})]})]}),e.jsx(vt,{title:g?"Collapse":"Expand",children:e.jsx(kt,{size:"small","aria-label":g?"Collapse":"Expand",children:g?e.jsx(Qe,{}):e.jsx(Xe,{})})})]}),e.jsx(fe,{in:g,children:e.jsx(b,{sx:{px:2,pb:2},children:e.jsxs(d,{spacing:2,children:[e.jsxs(d,{direction:"row",spacing:1,children:[e.jsx(Ze,{fullWidth:!0,size:"small",placeholder:"e.g., monthly sales report with charts, inventory tracking spreadsheet...",value:x,onChange:o=>E(o.target.value),onKeyDown:V,disabled:h,sx:{"& .MuiOutlinedInput-root":{bgcolor:"background.paper"}}}),e.jsx(W,{variant:"contained",onClick:I,disabled:h||_||!x.trim(),startIcon:h?e.jsx(Me,{size:16,color:"inherit"}):e.jsx(ge,{}),sx:{minWidth:120,textTransform:"none"},children:h?"Searching...":"Find"}),e.jsx(W,{variant:"outlined",onClick:H,disabled:h||_||!x.trim(),startIcon:_?e.jsx(Me,{size:16,color:"inherit"}):e.jsx(Je,{}),sx:{minWidth:120,textTransform:"none"},children:_?"Queueing...":"Queue"})]}),h&&e.jsx(et,{}),S&&e.jsx(ye,{severity:"info",onClose:()=>T("Dismiss recommendations error",()=>z(null)),children:S}),c.length>0&&e.jsxs(d,{spacing:1.5,children:[e.jsxs(u,{variant:"caption",color:"text.secondary",children:[c.length," template",c.length!==1?"s":""," found"]}),c.map((o,j)=>{const f=o.template||o,G=f.kind||"pdf",K=Qt[G]||st,P=typeof o.score=="number"?o.score:null;return e.jsx(ie,{variant:"outlined",sx:{p:2,cursor:"pointer",transition:"all 0.15s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{borderColor:k=>k.palette.mode==="dark"?l[500]:l[700],bgcolor:"action.hover"}},onClick:()=>R(f),children:e.jsxs(d,{direction:"row",alignItems:"flex-start",spacing:2,children:[e.jsx(Fe,{variant:"rounded",sx:{width:40,height:40,bgcolor:k=>k.palette.mode==="dark"?n(k.palette.text.primary,.08):l[100]},children:e.jsx(K,{sx:{color:"text.secondary"}})}),e.jsxs(b,{sx:{flex:1,minWidth:0},children:[e.jsxs(d,{direction:"row",alignItems:"center",spacing:1,sx:{mb:.5},children:[e.jsx(u,{variant:"subtitle2",fontWeight:600,children:f.name||f.id}),e.jsx(N,{label:G.toUpperCase(),size:"small",variant:"outlined",sx:{height:20,fontSize:"10px",bgcolor:k=>k.palette.mode==="dark"?n(k.palette.text.primary,.1):l[200],color:"text.secondary"}}),P!==null&&e.jsx(N,{label:`${Math.round(P*100)}% match`,size:"small",sx:{height:20,fontSize:"10px",bgcolor:k=>k.palette.mode==="dark"?n(k.palette.text.primary,.1):l[200],color:"text.secondary"}})]}),o.explanation&&e.jsx(u,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:o.explanation}),!o.explanation&&f.description&&e.jsx(u,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:f.description})]}),e.jsx(W,{size:"small",variant:"outlined",startIcon:e.jsx(Bt,{}),onClick:k=>{k.stopPropagation(),R(f)},sx:{textTransform:"none",whiteSpace:"nowrap"},children:"Select"})]})},f.id||j)})]}),!h&&c.length===0&&e.jsxs(b,{children:[e.jsx(u,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"Try these examples:"}),e.jsx(d,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:["monthly financial report","inventory tracking","sales summary with charts","equipment status report"].map(o=>e.jsx(N,{label:o,size:"small",variant:"outlined",onClick:()=>T("Set example requirement",()=>E(o),{example:o}),sx:{cursor:"pointer"}},o))})]})]})})})]})}const se=C(u)(({theme:s})=>({fontSize:"0.8125rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.08em",color:s.palette.text.primary,marginBottom:s.spacing(1.5),display:"flex",alignItems:"center",gap:s.spacing(1),"&::after":{content:'""',flex:1,height:1,backgroundColor:n(s.palette.divider,.3)}})),Ve=C(Ze)(({theme:s})=>({"& .MuiOutlinedInput-root":{borderRadius:12,backgroundColor:n(s.palette.background.paper,.6),transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{backgroundColor:n(s.palette.background.paper,.8)},"&.Mui-focused":{backgroundColor:s.palette.background.paper,boxShadow:`0 0 0 3px ${n(s.palette.text.primary,.08)}`}}})),Ge=C(N,{shouldForwardProp:s=>s!=="selected"})(({theme:s,selected:m})=>({borderRadius:10,fontWeight:500,fontSize:"0.75rem",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)",cursor:"pointer",...m&&{background:s.palette.mode==="dark"?l[700]:l[900],color:s.palette.common.white,boxShadow:`0 4px 12px ${n(s.palette.common.black,.15)}`,"& .MuiChip-icon":{color:s.palette.common.white}},...!m&&{backgroundColor:s.palette.mode==="dark"?n(s.palette.text.primary,.08):l[100],color:s.palette.text.primary,border:`1px solid ${n(s.palette.divider,.3)}`,"& .MuiChip-icon":{color:s.palette.text.secondary},"&:hover":{backgroundColor:s.palette.mode==="dark"?n(s.palette.text.primary,.14):l[200],transform:"translateY(-1px)"}}})),Ye=C(N)(({theme:s})=>({borderRadius:8,fontWeight:600,fontSize:"0.75rem",backgroundColor:s.palette.mode==="dark"?n(s.palette.text.primary,.08):l[100],color:s.palette.text.secondary,border:`1px solid ${n(s.palette.divider,.2)}`})),Zt=C(b)(({theme:s})=>({maxHeight:200,overflow:"auto",borderRadius:12,border:`1px solid ${n(s.palette.divider,.15)}`,backgroundColor:n(s.palette.background.paper,.4),"&::-webkit-scrollbar":{width:6},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:n(s.palette.text.primary,.2),borderRadius:8}})),Jt=C(Wt,{shouldForwardProp:s=>s!=="selected"})(({theme:s,selected:m})=>({padding:s.spacing(1,1.5),cursor:"pointer",transition:"all 0.15s cubic-bezier(0.22, 1, 0.36, 1)",borderBottom:`1px solid ${n(s.palette.divider,.1)}`,...m&&{backgroundColor:s.palette.mode==="dark"?n(s.palette.text.primary,.08):l[100]},"&:hover":{backgroundColor:s.palette.mode==="dark"?n(s.palette.text.primary,.05):l[50]},"&:last-child":{borderBottom:"none"}})),es=C(W)(({theme:s})=>({borderRadius:12,textTransform:"none",fontWeight:600,fontSize:"0.875rem",padding:s.spacing(1.25,3),background:s.palette.mode==="dark"?l[700]:l[900],color:s.palette.common.white,boxShadow:`0 4px 14px ${n(s.palette.common.black,.15)}`,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{background:s.palette.mode==="dark"?l[500]:l[700],boxShadow:`0 6px 20px ${n(s.palette.common.black,.2)}`,transform:"translateY(-2px)"},"&:active":{transform:"translateY(0)"},"&:disabled":{background:s.palette.action.disabledBackground,color:s.palette.action.disabled,boxShadow:"none"}})),re=C(W)(({theme:s})=>({borderRadius:12,textTransform:"none",fontWeight:500,fontSize:"0.875rem",padding:s.spacing(1.25,2.5),borderColor:n(s.palette.divider,.3),color:s.palette.text.primary,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{borderColor:s.palette.mode==="dark"?l[500]:l[700],backgroundColor:s.palette.mode==="dark"?n(s.palette.text.primary,.04):l[50],transform:"translateY(-1px)"}})),ae=C(W)(({theme:s})=>({borderRadius:8,textTransform:"none",fontWeight:500,fontSize:"0.75rem",padding:s.spacing(.5,1.5),color:s.palette.text.secondary,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{backgroundColor:s.palette.mode==="dark"?n(s.palette.text.primary,.08):l[100],color:s.palette.text.primary}})),ts=C(ie,{shouldForwardProp:s=>s!=="selected"})(({theme:s,selected:m})=>({padding:s.spacing(2),borderRadius:12,cursor:"pointer",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)",border:`1px solid ${m?s.palette.mode==="dark"?l[500]:l[700]:n(s.palette.divider,.2)}`,backgroundColor:m?s.palette.mode==="dark"?n(s.palette.text.primary,.05):l[50]:"transparent","&:hover":{borderColor:n(s.palette.divider,.4),backgroundColor:s.palette.mode==="dark"?n(s.palette.text.primary,.03):l[50],"& .view-summary-hint":{opacity:1,color:s.palette.text.primary}}})),oe=C(et)(({theme:s})=>({borderRadius:4,height:6,backgroundColor:n(s.palette.text.primary,.1),"& .MuiLinearProgress-bar":{borderRadius:4,background:s.palette.mode==="dark"?l[500]:l[900]}})),U=C(W)(({theme:s})=>({borderRadius:8,textTransform:"none",fontWeight:500,fontSize:"0.75rem",padding:s.spacing(.5,1.5),borderColor:n(s.palette.divider,.3),transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{borderColor:s.palette.mode==="dark"?l[500]:l[700],backgroundColor:s.palette.mode==="dark"?n(s.palette.text.primary,.04):l[50]}})),ss=C(b)(({theme:s})=>({display:"flex",alignItems:"center",justifyContent:"space-between",padding:s.spacing(1.5,0),cursor:"pointer",color:s.palette.text.secondary,transition:"color 0.2s ease","&:hover":{color:s.palette.text.primary}})),A=s=>s.toISOString().split("T")[0],be=()=>{const s=new Date,m=new Date(s);m.setDate(s.getDate()-s.getDay());const g=new Date(s.getFullYear(),s.getMonth(),1),i=new Date(s.getFullYear(),s.getMonth()-1,1),x=new Date(s.getFullYear(),s.getMonth(),0);return{today:{label:"Today",start:A(s),end:A(s)},thisWeek:{label:"This Week",start:A(m),end:A(s)},thisMonth:{label:"This Month",start:A(g),end:A(s)},lastMonth:{label:"Last Month",start:A(i),end:A(x)}}};function ne(s,m){fetch(s).then(g=>{if(!g.ok)throw new Error(`Download failed: ${g.status}`);return g.blob()}).then(g=>{const i=URL.createObjectURL(g),x=document.createElement("a");x.href=i,x.download=m||"download",document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(i)}).catch(g=>console.error("[download]",g))}function rs(){const s=St(),[m]=Ct(),g=wt(),i=Ke(),{execute:x}=je(),E=a.useCallback((t,r,p={})=>g(t,{label:r,intent:{from:"reports",...p}}),[g]),h=ee(t=>t.templates),y=ee(t=>t.activeConnection),_=ee(t=>t.setActiveConnectionId),$=ee(t=>t.setTemplates),[c,q]=a.useState(m.get("template")||""),[S,z]=a.useState(""),[v,T]=a.useState(""),[I,H]=a.useState("thisMonth"),[R,V]=a.useState({}),[o,j]=a.useState(!1),[f,G]=a.useState(!1),[K,P]=a.useState(null),[k,le]=a.useState(null),[ve,rt]=a.useState({}),[Q,ke]=a.useState(!1),[w,ce]=a.useState(null),[L,Y]=a.useState([]),[de,Se]=a.useState(!1),[Ce,at]=a.useState([]),[D,we]=a.useState(null),[F,X]=a.useState(null),[pe,Ie]=a.useState(!1),[Re,ze]=a.useState(!1),[Te,ot]=a.useState(!1),[nt,De]=a.useState(null);h.find(t=>t.id===c)?.kind?.toUpperCase();const{celebrating:it,celebrate:Ee,onComplete:lt}=Nt(),ue=a.useRef(0),Z=a.useRef(0);a.useEffect(()=>{!c&&h.length>0&&q(h[0].id)},[h,c]),a.useEffect(()=>{const t=async()=>{j(!0);try{const r=await Ft();$(r)}catch(r){i.show(r.message||"Failed to load designs","error")}finally{j(!1)}};h.length===0&&t()},[h.length,$,i]),a.useEffect(()=>{(async()=>{if(!c||!y?.id)return;const r=++ue.current;try{const p=h.find(J=>J.id===c),M=await Mt(c,{connectionId:y.id,kind:p?.kind||"pdf"});r===ue.current&&rt(M.keys||{})}catch(p){r===ue.current&&(console.error("Failed to fetch key options:",p),i.show("Could not load filter options. You can still generate reports.","warning"))}})()},[c,y?.id,h,i]);const ct=a.useCallback(t=>{q(t.target.value),V({}),P(null),ce(null),Y([])},[]),dt=a.useCallback(t=>{t?.id&&(q(t.id),V({}),P(null),i.show(`Selected: ${t.name||t.id}`,"success"))},[i]),pt=a.useCallback((t,r)=>{V(p=>({...p,[t]:r}))},[]),Ae=a.useCallback(t=>{if(H(t),t!=="custom"){const p=be()[t];p&&(z(p.start),T(p.end))}},[]);a.useEffect(()=>{if(!S&&!v&&I!=="custom"){const r=be()[I];r&&(z(r.start),T(r.end))}},[]);const Pe=a.useCallback(async()=>{if(!c||!y?.id){i.show("Please select a design and connect to a data source first","error");return}if(w&&L.length===0){i.show("Select at least one batch to run","error");return}if(S&&v&&new Date(S)>new Date(v)){i.show("Start date must be before or equal to end date","error");return}await x({type:B.EXECUTE,label:"Generate report",reversibility:O.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{templateId:c,connectionId:y?.id,action:"run_report"},action:async()=>{G(!0),le(null),P(null);try{const t=h.find(ft=>ft.id===c),r=w?.batches||[],p=r.length>0&&L.length===r.length,M=r.length>0&&L.length>0&&!p,J=await It({templateId:c,templateName:t?.name,connectionId:y.id,startDate:S||void 0,endDate:v||void 0,keyValues:Object.keys(R).length>0?R:void 0,batchIds:M?L:void 0,kind:t?.kind||"pdf",xlsx:t?.kind==="excel"});return P(J),i.show("Report generation started!","success"),Ee(),J}catch(t){throw le(t.message||"Failed to generate report"),i.show(t.message||"Failed to generate report","error"),t}finally{G(!1)}}})},[c,y?.id,h,S,v,R,w,L,i,Ee,x]),Le=Object.keys(ve),ut=a.useCallback(async()=>{if(!c||!y?.id){i.show("Select a design and data source first","error");return}if(!S||!v){i.show("Provide a start and end date to discover batches","error");return}if(new Date(S)>new Date(v)){i.show("Start date must be before or equal to end date","error");return}await x({type:B.ANALYZE,label:"Discover batches",reversibility:O.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{templateId:c,connectionId:y?.id,action:"discover_batches"},action:async()=>{ke(!0),ce(null);try{const t=h.find(M=>M.id===c),r=await Rt({templateId:c,connectionId:y.id,startDate:S,endDate:v,keyValues:Object.keys(R).length>0?R:void 0,kind:t?.kind||"pdf"});ce(r);const p=Array.isArray(r?.batches)?r.batches.map(M=>M.id):[];return Y(p),r}catch(t){throw i.show(t.message||"Failed to discover batches","error"),t}finally{ke(!1)}}})},[c,y?.id,S,v,R,h,i,x]),xe=a.useCallback(async()=>{Se(!0);try{const t=await zt({limit:10});at(t)}catch(t){console.error("Failed to load run history:",t),i.show("Failed to load run history","warning")}finally{Se(!1)}},[i]);a.useEffect(()=>{xe()},[xe]);const xt=a.useCallback(t=>{Y(r=>r.includes(t)?r.filter(p=>p!==t):[...r,t])},[]),mt=a.useCallback(async t=>{if(D?.id===t.id){we(null),De(null),X(null);return}if(we(t),De(t.id),X(null),t?.id){const r=++Z.current;Ie(!0);try{const p=await Gt(t.id);r===Z.current&&X(p.summary||p)}catch(p){r===Z.current&&(console.error("Failed to fetch summary:",p),X(null))}finally{r===Z.current&&Ie(!1)}}},[D?.id]),ht=a.useCallback(async()=>{D?.id&&await x({type:B.GENERATE,label:"Queue summary",reversibility:O.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{runId:D?.id,action:"queue_report_summary"},action:async()=>{ze(!0);try{const t=await Yt(D.id);return t?.job_id||t?.jobId||null?i.show("Summary queued. Track progress in Report Progress.","success"):i.show("Failed to queue summary.","error"),t}catch(t){throw i.show(t?.message||"Failed to queue summary.","error"),t}finally{ze(!1)}}})},[D?.id,i,x]),bt=a.useCallback(()=>{const t=Array.isArray(w?.batches)?w.batches.map(r=>r.id):[];Y(t)},[w]),gt=a.useCallback(()=>{Y([])},[]);return e.jsxs(b,{sx:{minHeight:"100vh",p:3,bgcolor:"background.default"},children:[e.jsx($t,{trigger:it,onComplete:lt}),e.jsxs(Ut,{maxWidth:"lg",children:[e.jsx(Ot,{title:"Run a Report",description:"Choose a design, set your date range, and generate a report.",actions:e.jsx(re,{variant:"outlined",startIcon:e.jsx(Je,{}),disabled:!c||f,onClick:()=>E(`/schedules?template=${c}`,"Open schedules",{templateId:c}),children:"Schedule"})}),e.jsxs(d,{spacing:3,children:[e.jsxs(me,{children:[e.jsxs(se,{children:[e.jsx(We,{sx:{fontSize:14}}),"Design & Data Source"]}),e.jsxs(d,{direction:{xs:"column",md:"row"},spacing:2,children:[e.jsx(b,{sx:{flex:1},children:e.jsxs(_e,{fullWidth:!0,children:[e.jsx(qe,{children:"Report Design"}),e.jsx(Oe,{value:c,onChange:ct,label:"Report Design",children:h.map(t=>e.jsx(he,{value:t.id,children:e.jsxs(d,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx("span",{children:t.name||t.id}),e.jsx(N,{label:t.kind?.toUpperCase()||"PDF",size:"small",variant:"outlined",sx:{borderRadius:6,fontSize:"10px",height:20}})]})},t.id))})]})}),e.jsxs(b,{sx:{flex:1},children:[e.jsx(Vt,{value:y?.id||"",onChange:t=>_(t),label:"Data Source",showStatus:!0}),!y&&e.jsxs(u,{variant:"caption",color:"warning.main",sx:{mt:.75,display:"block"},children:["No data source selected."," ",e.jsx(u,{component:"span",variant:"caption",sx:{color:"primary.main",cursor:"pointer",textDecoration:"underline"},onClick:()=>E("/connections","Open connections"),children:"Add one"})]})]})]}),e.jsx(b,{sx:{mt:2},children:e.jsx(Xt,{onSelectTemplate:dt})})]}),e.jsxs(me,{children:[e.jsxs(se,{children:[e.jsx(He,{sx:{fontSize:14}}),"Time Period"]}),e.jsxs(d,{direction:"row",spacing:1,sx:{mb:2,flexWrap:"wrap",gap:1},children:[Object.entries(be()).map(([t,r])=>e.jsx(Ge,{label:r.label,icon:e.jsx(He,{sx:{fontSize:14}}),onClick:()=>Ae(t),selected:I===t,variant:I===t?"filled":"outlined"},t)),e.jsx(Ge,{label:"Custom",icon:e.jsx(Kt,{sx:{fontSize:14}}),onClick:()=>Ae("custom"),selected:I==="custom",variant:I==="custom"?"filled":"outlined"})]}),e.jsxs(d,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(Ve,{label:"Start Date",type:"date",value:S,onChange:t=>{z(t.target.value),H("custom")},InputLabelProps:{shrink:!0},fullWidth:!0,size:"small"}),e.jsx(Ve,{label:"End Date",type:"date",value:v,onChange:t=>{T(t.target.value),H("custom")},InputLabelProps:{shrink:!0},fullWidth:!0,size:"small"})]}),Le.length>0&&e.jsxs(b,{sx:{mt:3},children:[e.jsx(Tt,{sx:{mb:2,borderColor:n(s.palette.divider,.2)}}),e.jsxs(se,{children:[e.jsx($e,{sx:{fontSize:14}}),"Filter Parameters"]}),e.jsx(d,{spacing:2,children:Le.map(t=>e.jsxs(_e,{fullWidth:!0,size:"small",children:[e.jsx(qe,{children:t}),e.jsxs(Oe,{value:R[t]||"",onChange:r=>pt(t,r.target.value),label:t,children:[e.jsx(he,{value:"",children:e.jsx("em",{children:"All"})}),(ve[t]||[]).map(r=>e.jsx(he,{value:r,children:r},r))]})]},t))})]})]}),e.jsxs(b,{children:[k&&e.jsx(ye,{severity:"error",sx:{mb:2,borderRadius:1},onClose:()=>le(null),action:e.jsx(ae,{color:"inherit",size:"small",onClick:Pe,disabled:f,children:"Try Again"}),children:k}),f&&e.jsxs(b,{sx:{mb:2},children:[e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Generating report..."}),e.jsx(oe,{})]}),K&&e.jsx(ye,{severity:"success",sx:{mb:2,borderRadius:1},children:e.jsxs(d,{direction:"row",spacing:2,alignItems:"center",flexWrap:"wrap",children:[e.jsxs(u,{variant:"body2",children:["Report started! ID: ",K.job_id?.slice(0,8),"..."]}),e.jsx(re,{size:"small",variant:"outlined",onClick:()=>E("/jobs","Open jobs"),children:"View Progress"})]})}),e.jsxs(d,{direction:"row",spacing:2,alignItems:"center",justifyContent:"flex-end",children:[e.jsxs(u,{variant:"caption",color:"text.secondary",sx:{flex:1},children:["Reports run in the background."," ",e.jsx(u,{component:"span",variant:"caption",sx:{color:"primary.main",cursor:"pointer",textDecoration:"underline"},onClick:()=>E("/jobs","Open jobs"),children:"Track progress"})]}),e.jsx(es,{startIcon:e.jsx(Dt,{}),onClick:Pe,disabled:!c||!y||f,sx:{px:4,py:1.5},children:"Generate Report"})]})]}),e.jsxs(b,{children:[e.jsxs(ss,{onClick:()=>ot(t=>!t),children:[e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx($e,{sx:{fontSize:16}}),e.jsx(u,{variant:"subtitle2",fontWeight:500,children:"Advanced: Find Data Batches"})]}),Te?e.jsx(Qe,{sx:{fontSize:20}}):e.jsx(Xe,{sx:{fontSize:20}})]}),e.jsx(fe,{in:Te,children:e.jsx(me,{sx:{mt:1},children:e.jsxs(d,{spacing:2,children:[e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsx(u,{variant:"body2",color:"text.secondary",children:"Discover available data batches for the selected design and date range."}),e.jsx(re,{variant:"outlined",size:"small",onClick:ut,disabled:Q||!c||!y,children:Q?"Searching...":"Find Batches"})]}),Q&&e.jsx(oe,{}),!Q&&w&&e.jsxs(d,{spacing:2,children:[e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Ye,{label:`${w.batches_count||w.batches?.length||0} batches`}),e.jsx(Ye,{label:`${w.rows_total||0} rows`})]}),e.jsxs(d,{direction:"row",spacing:1,children:[e.jsx(ae,{size:"small",onClick:bt,children:"Select all"}),e.jsx(ae,{size:"small",onClick:gt,children:"Clear"})]}),e.jsx(Zt,{children:e.jsx(Et,{dense:!0,disablePadding:!0,children:(w.batches||[]).map(t=>e.jsxs(Jt,{disableGutters:!0,onClick:()=>xt(t.id),selected:L.includes(t.id),children:[e.jsx(At,{checked:L.includes(t.id),sx:{p:.5,mr:1}}),e.jsx(Pt,{primary:`${t.id}`,secondary:`${t.rows||0} rows`,primaryTypographyProps:{variant:"body2",fontWeight:500},secondaryTypographyProps:{variant:"caption"}})]},t.id))})})]})]})})})]}),e.jsxs(b,{children:[e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",sx:{mb:2},children:[e.jsxs(se,{sx:{mb:0,flex:1},children:[e.jsx(Be,{sx:{fontSize:14}}),"Recent Runs"]}),e.jsx(ae,{size:"small",onClick:xe,disabled:de,startIcon:e.jsx(Be,{sx:{fontSize:14}}),children:"Refresh"})]}),de&&e.jsx(oe,{sx:{mb:2}}),!de&&Ce.length===0&&e.jsxs(b,{sx:{py:4,textAlign:"center"},children:[e.jsx(We,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(u,{variant:"body2",color:"text.secondary",children:c?"No recent runs for this design yet.":"No report runs yet. Generate a report to get started."})]}),e.jsx(b,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2},children:Ce.map(t=>e.jsxs(b,{children:[e.jsx(ts,{selected:D?.id===t.id,onClick:()=>mt(t),title:"Click to view summary",children:e.jsxs(d,{spacing:.5,children:[e.jsxs(d,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(u,{variant:"body2",fontWeight:600,children:t.templateName||t.templateId}),e.jsxs(d,{direction:"row",alignItems:"center",spacing:.5,className:"view-summary-hint",sx:{opacity:.6,transition:"all 0.2s"},children:[e.jsx(u,{variant:"caption",color:"text.secondary",children:D?.id===t.id?"Collapse":"Summary"}),e.jsx(qt,{sx:{fontSize:12,transform:D?.id===t.id?"rotate(90deg)":"none",transition:"transform 0.2s"}})]})]}),e.jsxs(u,{variant:"caption",color:"text.secondary",children:[new Date(t.createdAt).toLocaleString()," Â· ",t.startDate," to ",t.endDate]}),e.jsxs(d,{direction:"row",spacing:1,sx:{mt:.5},flexWrap:"wrap",useFlexGap:!0,children:[t.artifacts?.pdf_url&&e.jsx(U,{size:"small",variant:"outlined",startIcon:e.jsx(Ne,{sx:{fontSize:14}}),onClick:r=>{r.stopPropagation(),ne(te(t.artifacts.pdf_url),`${t.templateName||"report"}.pdf`)},children:"PDF"}),t.artifacts?.html_url&&e.jsx(U,{size:"small",variant:"outlined",startIcon:e.jsx(Ne,{sx:{fontSize:14}}),onClick:r=>{r.stopPropagation(),ne(te(t.artifacts.html_url),`${t.templateName||"report"}.html`)},children:"HTML"}),t.artifacts?.xlsx_url&&e.jsx(U,{size:"small",variant:"outlined",startIcon:e.jsx(tt,{sx:{fontSize:14}}),onClick:r=>{r.stopPropagation(),ne(te(t.artifacts.xlsx_url),`${t.templateName||"report"}.xlsx`)},children:"XLSX"}),t.artifacts?.docx_url&&e.jsx(U,{size:"small",variant:"outlined",startIcon:e.jsx(_t,{sx:{fontSize:14}}),onClick:r=>{r.stopPropagation(),ne(te(t.artifacts.docx_url),`${t.templateName||"report"}.docx`)},children:"DOCX"}),e.jsx(U,{size:"small",variant:"outlined",startIcon:e.jsx(Lt,{sx:{fontSize:14}}),onClick:r=>{r.stopPropagation(),E(`/agents?analyzeRunId=${t.id}`,"Analyze with AI",{runId:t.id})},"data-testid":`analyze-ai-${t.id}`,children:"Analyze"})]})]})}),e.jsx(fe,{in:nt===t.id,children:e.jsxs(b,{sx:{mt:1,ml:2,pl:2,borderLeft:2,borderColor:"divider"},children:[e.jsx(Ht,{title:"AI summary",description:"Summaries are generated from the selected report run. Review before sharing.",chips:[{label:"Source: Selected run",color:"info",variant:"outlined"},{label:"Confidence: Review required",color:"warning",variant:"outlined"}],dense:!0,sx:{mb:1.5}}),pe&&e.jsx(oe,{sx:{mb:1}}),!pe&&F?e.jsxs(ie,{sx:{p:2,borderRadius:1.5,bgcolor:s.palette.mode==="dark"?n(s.palette.text.primary,.04):l[50],border:1,borderColor:"divider"},children:[e.jsx(u,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:typeof F=="string"?F:F.text||F.content||"No summary available"}),F.key_points&&e.jsxs(b,{sx:{mt:1.5},children:[e.jsx(u,{variant:"caption",fontWeight:600,color:"text.primary",children:"Key Points:"}),e.jsx("ul",{style:{margin:"4px 0",paddingLeft:20},children:F.key_points.map((r,p)=>e.jsx("li",{children:e.jsx(u,{variant:"caption",children:r})},p))})]})]}):!pe&&e.jsxs(d,{spacing:1,children:[e.jsx(u,{variant:"body2",color:"text.secondary",children:"No summary available for this run."}),e.jsx(re,{size:"small",variant:"outlined",startIcon:e.jsx(ge,{sx:{fontSize:14}}),onClick:ht,disabled:Re,sx:{alignSelf:"flex-start"},children:Re?"Queueing...":"Generate summary"})]})]})})]},t.id))})]})]})]})]})}function gs(){return je(),e.jsx(rs,{})}export{gs as default};
