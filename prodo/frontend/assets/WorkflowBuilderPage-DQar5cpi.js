import{c as R,j as e,e as ke,d as me,u as te,cf as je,r as n,R as h,I as g,x as ve,cg as Ce,t as Ee,w as Se,B as r,T as c,v as We,bs as Ae,aI as Ie,A as Q,aJ as Te,aM as C,s as k,bi as De,k as w,p as d,o as D,a1 as Ne,q as Re,ak as Le,al as ze,am as _e,N as Me,ao as Pe,P as Be,J as f}from"./index-B8Eu23bA.js";import{C as oe}from"./Code-C_kZAZjt.js";import{E as $e}from"./Email-Dwi3AvV1.js";import{G as N}from"./AccountTree-Cae7_7GH.js";import{S as Z}from"./Stop-5bZ1q-Dg.js";import{S as Ue}from"./Save-CpotRqw9.js";import{a as Ye,C as Ge}from"./CardContent-xJVpuEbT.js";const Fe=R(e.jsx("path",{d:"m14 4 2.29 2.29-2.88 2.88 1.42 1.42 2.88-2.88L20 10V4zm-4 0H4v6l2.29-2.29 4.71 4.7V20h2v-8.41l-5.29-5.3z"})),Oe=R(e.jsx("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8m0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4z"})),Ve=R(e.jsx("path",{d:"M10 15h5.88c.27-.31.67-.5 1.12-.5.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5c-.44 0-.84-.19-1.12-.5H11.9c-.46 2.28-2.48 4-4.9 4-2.76 0-5-2.24-5-5 0-2.42 1.72-4.44 4-4.9v2.07c-1.16.41-2 1.53-2 2.83 0 1.65 1.35 3 3 3s3-1.35 3-3zm2.5-11c1.65 0 3 1.35 3 3h2c0-2.76-2.24-5-5-5s-5 2.24-5 5c0 1.43.6 2.71 1.55 3.62l-2.35 3.9c-.68.14-1.2.75-1.2 1.48 0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5c0-.16-.02-.31-.07-.45l3.38-5.63C10.49 9.61 9.5 8.42 9.5 7c0-1.65 1.35-3 3-3m4.5 9c-.64 0-1.23.2-1.72.54l-3.05-5.07C11.53 8.35 11 7.74 11 7c0-.83.67-1.5 1.5-1.5S14 6.17 14 7c0 .15-.02.29-.06.43l2.19 3.65c.28-.05.57-.08.87-.08 2.76 0 5 2.24 5 5s-2.24 5-5 5c-1.85 0-3.47-1.01-4.33-2.5h2.67c.48.32 1.05.5 1.66.5 1.65 0 3-1.35 3-3s-1.35-3-3-3"})),Xe=f(r)(({theme:o})=>({display:"flex",flexDirection:"column",height:"calc(100vh - 64px)",backgroundColor:o.palette.background.default})),He=f(r)(({theme:o})=>({display:"flex",alignItems:"center",justifyContent:"space-between",padding:o.spacing(1.5,2),borderBottom:`1px solid ${d(o.palette.divider,.1)}`,backgroundColor:d(o.palette.background.paper,.8)})),Je=f(r)(({theme:o})=>({flex:1,display:"flex",overflow:"hidden"})),qe=f(r)(({theme:o})=>({width:260,flexShrink:0,borderRight:`1px solid ${d(o.palette.divider,.1)}`,backgroundColor:d(o.palette.background.paper,.6),padding:o.spacing(2),overflow:"auto"})),Ke=f(r)(({theme:o})=>({flex:1,padding:o.spacing(3),overflow:"auto",backgroundColor:o.palette.background.default,backgroundImage:`radial-gradient(${d(o.palette.divider,.15)} 1px, transparent 1px)`,backgroundSize:"20px 20px"})),Qe=f(r)(({theme:o})=>({width:300,flexShrink:0,borderLeft:`1px solid ${d(o.palette.divider,.1)}`,backgroundColor:d(o.palette.background.paper,.6),display:"flex",flexDirection:"column"})),Ze=f(Ge)(({theme:o})=>({cursor:"grab",transition:"all 0.2s ease",marginBottom:o.spacing(1),"&:hover":{transform:"translateX(4px)",boxShadow:`0 4px 12px ${d(o.palette.common.black,.1)}`}})),et=f(C)(({theme:o})=>({padding:o.spacing(2),minWidth:200,borderRadius:8,border:`2px solid ${d(o.palette.divider,.3)}`,cursor:"pointer",transition:"all 0.2s ease","&:hover":{borderColor:o.palette.mode==="dark"?w[1e3]:w[1100],boxShadow:`0 4px 20px ${d(o.palette.common.black,.1)}`}})),tt=f(C)(({theme:o,status:i})=>({padding:o.spacing(2),marginBottom:o.spacing(1),borderLeft:`4px solid ${i==="completed"?o.palette.mode==="dark"?w[1e3]:w[1100]:i==="running"?o.palette.mode==="dark"?w[600]:w[900]:i==="failed"?o.palette.text.secondary:o.palette.grey[400]}`})),y=f(k)(({theme:o})=>({borderRadius:8,textTransform:"none",fontWeight:500})),ot=f(r)(({theme:o})=>({flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:o.spacing(4),textAlign:"center"})),ee=[{type:"trigger",label:"Trigger",icon:ve,color:"warning",category:"Triggers"},{type:"webhook",label:"Webhook",icon:Ve,color:"info",category:"Triggers"},{type:"action",label:"Action",icon:oe,color:"primary",category:"Actions"},{type:"email",label:"Send Email",icon:$e,color:"secondary",category:"Actions"},{type:"notify",label:"Notification",icon:Ce,color:"success",category:"Actions"},{type:"condition",label:"Condition",icon:Fe,color:"info",category:"Logic"},{type:"loop",label:"Loop",icon:Oe,color:"warning",category:"Logic"},{type:"approval",label:"Approval",icon:Ee,color:"success",category:"Logic"},{type:"data",label:"Data Transform",icon:Se,color:"primary",category:"Data"}];function st(){const o=ke(),i=me(),{execute:a}=te(),{workflows:L,currentWorkflow:s,executions:z,currentExecution:rt,pendingApprovals:E,loading:se,executing:S,error:_,fetchWorkflows:M,createWorkflow:P,getWorkflow:B,updateWorkflow:$,deleteWorkflow:nt,executeWorkflow:U,fetchExecutions:m,cancelExecution:Y,retryExecution:G,fetchPendingApprovals:F,approveStep:O,rejectStep:V,reset:j}=je(),[re,W]=n.useState(!1),[b,X]=n.useState(""),[x,A]=n.useState([]),[I,H]=n.useState(null),[v,J]=n.useState(!1);n.useEffect(()=>(M(),F(),()=>j()),[M,F,j]),n.useEffect(()=>{s?.nodes&&A(s.nodes)},[s]);const p=n.useCallback((t,l,u={})=>a({type:g.EXECUTE,label:t,reversibility:h.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"workflows",...u},action:l}),[a]),q=n.useCallback(()=>p("Open create workflow",()=>W(!0)),[p]),K=n.useCallback(()=>p("Close create workflow",()=>W(!1)),[p]),ne=n.useCallback(()=>{if(b)return a({type:g.CREATE,label:"Create workflow",reversibility:h.SYSTEM_MANAGED,intent:{source:"workflows",name:b},action:async()=>{const t=await P({name:b,nodes:[],edges:[],triggers:[]});return t&&(W(!1),X(""),i.show("Workflow created","success")),t}})},[P,a,b,i]),ae=n.useCallback(t=>{if(s)return p("Add workflow node",()=>{const l={id:`node_${Date.now()}`,type:t.type,label:t.label,config:{},position:{x:100+x.length*50,y:100+x.length*50}};A([...x,l]),i.show(`${t.label} node added`,"success")},{workflowId:s.id,nodeType:t.type})},[s,p,i,x]),le=n.useCallback(t=>a({type:g.DELETE,label:"Remove workflow node",reversibility:h.SYSTEM_MANAGED,intent:{source:"workflows",nodeId:t},action:async()=>{A(x.filter(l=>l.id!==t)),I?.id===t&&H(null),i.show("Node removed","success")}}),[a,I?.id,i,x]),ie=n.useCallback(t=>p("Select workflow node",()=>H(t),{nodeId:t?.id}),[p]),ce=n.useCallback(()=>{if(s)return a({type:g.UPDATE,label:"Save workflow",reversibility:h.SYSTEM_MANAGED,intent:{source:"workflows",workflowId:s.id},action:async()=>{await $(s.id,{nodes:x}),i.show("Workflow saved","success")}})},[s,a,i,$,x]),de=n.useCallback(()=>{if(s)return a({type:g.EXECUTE,label:"Run workflow",reversibility:h.FULLY_REVERSIBLE,blocksNavigation:!0,intent:{source:"workflows",workflowId:s.id},action:async()=>{const t=await U(s.id);return t&&(i.show("Workflow execution started","success"),J(!0),m(s.id)),t}})},[s,a,U,m,i]),xe=n.useCallback(t=>{if(s)return a({type:g.UPDATE,label:"Cancel execution",reversibility:h.SYSTEM_MANAGED,intent:{source:"workflows",workflowId:s.id,executionId:t},action:async()=>{await Y(s.id,t),i.show("Execution cancelled","info")}})},[Y,s,a,i]),pe=n.useCallback(t=>{if(s)return a({type:g.UPDATE,label:"Retry execution",reversibility:h.SYSTEM_MANAGED,intent:{source:"workflows",workflowId:s.id,executionId:t},action:async()=>{await G(s.id,t),i.show("Retry started","success")}})},[s,a,G,i]),ue=n.useCallback(()=>{if(s)return p("Toggle executions",()=>{const t=!v;J(t),t&&m(s.id)},{workflowId:s.id,open:!v})},[s,p,m,v]),fe=n.useCallback((t,l)=>a({type:g.UPDATE,label:"Approve step",reversibility:h.SYSTEM_MANAGED,intent:{source:"workflows",executionId:t,stepId:l},action:async()=>{await O(t,l)}}),[O,a]),he=n.useCallback((t,l)=>a({type:g.UPDATE,label:"Reject step",reversibility:h.SYSTEM_MANAGED,intent:{source:"workflows",executionId:t,stepId:l},action:async()=>{await V(t,l,"Rejected")}}),[a,V]),ge=n.useCallback(t=>a({type:g.EXECUTE,label:"Open workflow",reversibility:h.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"workflows",workflowId:t},action:async()=>{await B(t)}}),[a,B]),we=n.useCallback(()=>p("Dismiss workflow error",()=>j()),[p,j]),be=ee.reduce((t,l)=>(t[l.category]||(t[l.category]=[]),t[l.category].push(l),t),{});return e.jsxs(Xe,{children:[e.jsxs(He,{children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(N,{sx:{color:"text.secondary"}}),e.jsx(c,{variant:"subtitle1",sx:{fontWeight:600},children:s?.name||"Workflows"}),s&&e.jsx(We,{size:"small",label:`${x.length} nodes`,sx:{borderRadius:1}})]}),e.jsx(r,{sx:{display:"flex",gap:1},children:s?e.jsxs(e.Fragment,{children:[e.jsx(y,{size:"small",startIcon:e.jsx(Ae,{}),onClick:ue,children:"Executions"}),e.jsx(y,{size:"small",variant:"outlined",sx:{color:"text.secondary"},startIcon:S?e.jsx(Z,{}):e.jsx(Ie,{}),onClick:de,disabled:S||x.length===0,children:S?"Running...":"Run"}),e.jsx(y,{variant:"contained",size:"small",startIcon:e.jsx(Ue,{}),onClick:ce,children:"Save"})]}):e.jsx(y,{variant:"contained",size:"small",startIcon:e.jsx(Q,{}),onClick:q,children:"New Workflow"})})]}),e.jsx(Je,{children:s?e.jsxs(e.Fragment,{children:[e.jsxs(qe,{children:[e.jsx(c,{variant:"subtitle2",sx:{mb:2,fontWeight:600},children:"Add Node"}),Object.entries(be).map(([t,l])=>e.jsxs(r,{sx:{mb:2},children:[e.jsx(c,{variant:"caption",color:"text.secondary",sx:{fontWeight:600},children:t}),l.map(u=>e.jsx(Ze,{variant:"outlined",onClick:()=>ae(u),children:e.jsx(Ye,{sx:{p:1.5,"&:last-child":{pb:1.5}},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(u.icon,{color:u.color,fontSize:"small"}),e.jsx(c,{variant:"body2",children:u.label})]})})},u.type))]},t)),E.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Te,{sx:{my:2}}),e.jsxs(c,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:["Pending Approvals (",E.length,")"]}),E.map(t=>e.jsxs(C,{variant:"outlined",sx:{p:1.5,mb:1},children:[e.jsx(c,{variant:"caption",sx:{fontWeight:500},children:t.workflow_name}),e.jsxs(r,{sx:{display:"flex",gap:1,mt:1},children:[e.jsx(k,{size:"small",variant:"contained",onClick:()=>fe(t.execution_id,t.step_id),children:"Approve"}),e.jsx(k,{size:"small",variant:"outlined",sx:{color:"text.secondary"},onClick:()=>he(t.execution_id,t.step_id),children:"Reject"})]})]},t.id))]})]}),e.jsx(Ke,{children:x.length>0?e.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:2,alignItems:"center"},children:x.map((t,l)=>{const u=ee.find(T=>T.type===t.type),ye=u?.icon||oe;return e.jsxs(De.Fragment,{children:[e.jsx(et,{onClick:()=>ie(t),sx:{borderColor:I?.id===t.id?o.palette.mode==="dark"?w[1e3]:w[1100]:void 0},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(r,{sx:{width:36,height:36,borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:d(o.palette[u?.color||"primary"].main,.1)},children:e.jsx(ye,{color:u?.color||"primary"})}),e.jsxs(r,{sx:{flex:1},children:[e.jsx(c,{variant:"subtitle2",sx:{fontWeight:600},children:t.label}),e.jsx(c,{variant:"caption",color:"text.secondary",children:t.type})]}),e.jsx(D,{size:"small",onClick:T=>{T.stopPropagation(),le(t.id)},children:e.jsx(Ne,{fontSize:"small"})})]})}),l<x.length-1&&e.jsx(r,{sx:{width:2,height:40,bgcolor:d(o.palette.divider,.5),borderRadius:1}})]},t.id)})}):e.jsx(r,{sx:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(c,{color:"text.secondary",children:"Add nodes from the palette to build your workflow"})})}),v&&e.jsxs(Qe,{children:[e.jsx(r,{sx:{p:2,borderBottom:`1px solid ${d(o.palette.divider,.1)}`},children:e.jsx(c,{variant:"subtitle1",sx:{fontWeight:600},children:"Executions"})}),e.jsx(r,{sx:{flex:1,overflow:"auto",p:2},children:z.length>0?z.map(t=>e.jsx(tt,{status:t.status,variant:"outlined",children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(r,{children:[e.jsx(c,{variant:"body2",sx:{fontWeight:500},children:t.status}),e.jsx(c,{variant:"caption",color:"text.secondary",children:new Date(t.started_at).toLocaleString()})]}),e.jsxs(r,{sx:{display:"flex",gap:.5},children:[t.status==="running"&&e.jsx(D,{size:"small",onClick:()=>xe(t.id),children:e.jsx(Z,{fontSize:"small"})}),t.status==="failed"&&e.jsx(D,{size:"small",onClick:()=>pe(t.id),children:e.jsx(Re,{fontSize:"small"})})]})]})},t.id)):e.jsx(c,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:4},children:"No executions yet"})})]})]}):e.jsxs(ot,{sx:{width:"100%"},children:[e.jsx(N,{sx:{fontSize:80,color:"text.disabled",mb:2}}),e.jsx(c,{variant:"h5",sx:{fontWeight:600,mb:1},children:"No Workflow Selected"}),e.jsx(c,{color:"text.secondary",sx:{mb:3},children:"Create a new workflow to automate your processes."}),e.jsx(y,{variant:"contained",startIcon:e.jsx(Q,{}),onClick:q,children:"Create Workflow"}),L.length>0&&e.jsxs(r,{sx:{mt:4,width:"100%",maxWidth:400},children:[e.jsx(c,{variant:"subtitle2",sx:{mb:2},children:"Recent Workflows"}),L.slice(0,5).map(t=>e.jsxs(C,{sx:{p:2,mb:1,cursor:"pointer",display:"flex",alignItems:"center",gap:2,"&:hover":{bgcolor:o.palette.mode==="dark"?d(o.palette.text.primary,.05):w[200]}},variant:"outlined",onClick:()=>ge(t.id),children:[e.jsx(N,{sx:{color:"text.secondary"}}),e.jsxs(r,{children:[e.jsx(c,{variant:"body2",sx:{fontWeight:500},children:t.name}),e.jsxs(c,{variant:"caption",color:"text.secondary",children:[t.nodes?.length||0," nodes"]})]})]},t.id))]})]})}),e.jsxs(Le,{open:re,onClose:K,maxWidth:"xs",fullWidth:!0,children:[e.jsx(ze,{children:"Create New Workflow"}),e.jsx(_e,{children:e.jsx(Me,{autoFocus:!0,fullWidth:!0,label:"Workflow Name",value:b,onChange:t=>X(t.target.value),sx:{mt:2}})}),e.jsxs(Pe,{children:[e.jsx(k,{onClick:K,children:"Cancel"}),e.jsx(k,{variant:"contained",onClick:ne,disabled:!b||se,children:"Create"})]})]}),_&&e.jsx(Be,{severity:"error",onClose:we,sx:{position:"fixed",bottom:16,right:16,maxWidth:400},children:_})]})}function ut(){return te(),e.jsx(st,{})}export{ut as default};
