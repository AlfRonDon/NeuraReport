import{g as pe,j as r,i as u,bN as fe,u as ye,v as me,a as te,r as h,R as J,I as Q,B as o,o as i,b6 as P,b5 as X,e as Z,C as ge,bc as be,P as ne,F as Se,m as je,S as ve,M as w,aJ as q,D as we,p as E,K as le,bP as ee,bQ as re,aU as ae,J as Ce,b0 as Ie,c7 as ke,A as Te,N as m,n as b,f as y}from"./index-CS2nn_Zr.js";import{s as Re}from"./sanitize-BsPzJ-uc.js";import{u as Ae}from"./useSharedData-DgpbyG0s.js";import{C as De}from"./ConnectionSelector-gPkx78kE.js";import{T as _e,a as ze}from"./Tabs-LJGpU9Kz.js";import{S as Fe}from"./Psychology-CUpVkmoQ.js";import{C as Ee}from"./Code-CjoVB2Yy.js";import{B as We}from"./DataObject-Dike15bf.js";import{C as Pe}from"./Clear-C_Rztneq.js";import{F as qe}from"./FilterList-DgjnEDJV.js";import{G as C}from"./Grid-B_V8L2Yi.js";import{S as Le}from"./Bookmark-DKXn3fGD.js";import"./KeyboardArrowRight-MNB0l_Vm.js";const He=pe(r.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2m0 15-5-2.18L7 18V5h10z"}));function oe(e,l=[]){if(Array.isArray(e))return e;if(!e||typeof e!="object")return[];for(const a of l)if(Array.isArray(e[a]))return e[a];return[]}function I(e,l=""){if(!e||typeof e!="object")return{query:l,results:[],total:0,facets:{}};const a=oe(e,["results","items","documents"]),t=e.total??e.total_results??e.count??a.length,n=e.facets,c=Array.isArray(n)?Object.fromEntries(n.filter(x=>x&&typeof x=="object").map((x,L)=>[x.field||x.name||`facet_${L}`,x.values||x.buckets||[]])):n&&typeof n=="object"?n:{};return{...e,query:e.query??l,results:a,total:t,facets:c}}async function Be(e,l={}){const a=await u.post("/search/search",{query:e,search_type:l.searchType||"fulltext",filters:l.filters||[],page:l.page||1,page_size:l.pageSize||20,highlight:l.highlight!==!1,facet_fields:l.facets||[]});return I(a.data,e)}async function Oe(e,l={}){const a=await u.post("/search/search/semantic",{query:e,search_type:"semantic",filters:l.filters||[],page:l.page||1,page_size:l.limit||20});return I(a.data,e)}async function $e(e,l={}){const a=await u.post("/search/search/regex",{query:e,search_type:"regex",filters:l.filters||[]});return I(a.data,e)}async function Me(e,l={}){const a=await u.post("/search/search/boolean",{query:e,search_type:"boolean",filters:l.filters||[]});return I(a.data,e)}async function Ne(e,l,a={}){return(await u.post("/search/search/replace",{search_query:e,replace_with:l,document_ids:a.documentIds||null,dry_run:a.previewOnly!==!1})).data}async function Ue(e,l={}){return(await u.get(`/search/documents/${e}/similar`,{params:{limit:l.limit||10,min_similarity:l.minSimilarity||.5}})).data}async function Ye(e,l,a,t={}){return(await u.post("/search/index",{document_id:e,title:l,content:a,metadata:t})).data}async function Ge(e){return(await u.delete(`/search/index/${e}`)).data}async function Ke(){return(await u.post("/search/index/reindex")).data}async function Ve(e,l,a={}){return(await u.post("/search/saved-searches",{name:e,query:l,filters:a.filters||[],notify_on_new:a.isAlert||!1})).data}async function Je(){const e=await u.get("/search/saved-searches");return oe(e.data,["searches","saved_searches","items","results"])}async function Qe(e){return(await u.get(`/search/saved-searches/${e}`)).data}async function Xe(e){return(await u.delete(`/search/saved-searches/${e}`)).data}async function Ze(e){const l=await u.post(`/search/saved-searches/${e}/run`);return I(l.data)}async function er(e={}){return(await u.get("/search/analytics",{params:{days:e.days||30}})).data}const rr=fe((e,l)=>({results:[],totalResults:0,facets:{},savedSearches:[],currentSearch:null,searchHistory:[],analytics:null,loading:!1,searching:!1,error:null,setLoading:a=>e({loading:a}),setError:a=>e({error:a}),search:async(a,t={})=>{e({searching:!0,error:null});try{const n=await Be(a,t);return e(c=>({results:n.results||[],totalResults:n.total||0,facets:n.facets||{},searchHistory:[{query:a,timestamp:new Date().toISOString(),resultCount:n.total},...c.searchHistory.slice(0,49)],searching:!1})),n}catch(n){return e({error:n.message,searching:!1}),null}},semanticSearch:async(a,t={})=>{e({searching:!0,error:null});try{const n=await Oe(a,t);return e({results:n.results||[],totalResults:n.results?.length||0,searching:!1}),n}catch(n){return e({error:n.message,searching:!1}),null}},regexSearch:async(a,t={})=>{e({searching:!0,error:null});try{const n=await $e(a,t);return e({results:n.results||[],totalResults:n.results?.length||0,searching:!1}),n}catch(n){return e({error:n.message,searching:!1}),null}},booleanSearch:async(a,t={})=>{e({searching:!0,error:null});try{const n=await Me(a,t);return e({results:n.results||[],totalResults:n.results?.length||0,searching:!1}),n}catch(n){return e({error:n.message,searching:!1}),null}},searchAndReplace:async(a,t,n={})=>{e({loading:!0,error:null});try{const c=await Ne(a,t,n);return e({loading:!1}),c}catch(c){return e({error:c.message,loading:!1}),null}},findSimilar:async(a,t={})=>{e({loading:!0,error:null});try{const n=await Ue(a,t);return e({loading:!1}),n}catch(n){return e({error:n.message,loading:!1}),null}},saveSearch:async(a,t,n={})=>{e({loading:!0,error:null});try{const c=await Ve(a,t,n);return e(x=>({savedSearches:[c,...x.savedSearches],loading:!1})),c}catch(c){return e({error:c.message,loading:!1}),null}},fetchSavedSearches:async()=>{e({loading:!0,error:null});try{const a=await Je();return e({savedSearches:a||[],loading:!1}),a}catch(a){return e({error:a.message,loading:!1}),[]}},deleteSavedSearch:async a=>{e({loading:!0,error:null});try{return await Xe(a),e(t=>({savedSearches:t.savedSearches.filter(n=>n.id!==a),loading:!1})),!0}catch(t){return e({error:t.message,loading:!1}),!1}},runSavedSearch:async a=>{e({searching:!0,error:null});try{const t=await Ze(a);return e({results:t.results||[],totalResults:t.total||0,searching:!1}),t}catch(t){return e({error:t.message,searching:!1}),null}},fetchAnalytics:async(a={})=>{e({loading:!0,error:null});try{const t=await er(a);return e({analytics:t,loading:!1}),t}catch(t){return e({error:t.message,loading:!1}),null}},indexDocument:async a=>{e({loading:!0,error:null});try{const t=await Ye(a);return e({loading:!1}),t}catch(t){return e({error:t.message,loading:!1}),null}},removeFromIndex:async a=>{e({loading:!0,error:null});try{return await Ge(a),e({loading:!1}),!0}catch(t){return e({error:t.message,loading:!1}),!1}},reindexAll:async()=>{e({loading:!0,error:null});try{const a=await Ke();return e({loading:!1}),a}catch(a){return e({error:a.message,loading:!1}),null}},getSavedSearch:async a=>{e({loading:!0,error:null});try{const t=await Qe(a);return e({currentSearch:t,loading:!1}),t}catch(t){return e({error:t.message,loading:!1}),null}},clearResults:()=>e({results:[],totalResults:0,facets:{},error:null}),clearHistory:()=>e({searchHistory:[]}),reset:()=>e({results:[],totalResults:0,facets:{},currentSearch:null,error:null})})),ar=m(o)(({theme:e})=>({display:"flex",flexDirection:"column",height:"calc(100vh - 64px)",backgroundColor:e.palette.background.default})),sr=m(o)(({theme:e})=>({padding:e.spacing(3),backgroundColor:e.palette.mode==="dark"?y(e.palette.text.primary,.05):b[50],borderBottom:`1px solid ${y(e.palette.divider,.1)}`})),tr=m(o)(({theme:e})=>({flex:1,display:"flex",overflow:"hidden"})),nr=m(o)(({theme:e})=>({flex:1,padding:e.spacing(3),overflow:"auto"})),lr=m(o)(({theme:e})=>({width:280,borderLeft:`1px solid ${y(e.palette.divider,.1)}`,backgroundColor:y(e.palette.background.paper,.6),display:"flex",flexDirection:"column"})),or=m(q)(({theme:e})=>({"& .MuiOutlinedInput-root":{backgroundColor:e.palette.mode==="dark"?y(e.palette.background.paper,.6):b[100],borderRadius:8,"& fieldset":{borderColor:e.palette.mode==="dark"?y(e.palette.text.primary,.12):b[200]},"&:hover":{"& fieldset":{borderColor:e.palette.mode==="dark"?y(e.palette.text.primary,.2):b[300]}},"&.Mui-focused":{"& fieldset":{borderColor:e.palette.mode==="dark"?e.palette.text.secondary:b[500],borderWidth:1}}}})),cr=m(ne)(({theme:e})=>({padding:e.spacing(2),marginBottom:e.spacing(2),cursor:"pointer",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{backgroundColor:e.palette.mode==="dark"?y(e.palette.text.primary,.05):b[50],borderColor:e.palette.mode==="dark"?b[500]:b[700]}})),W=m(o)(({theme:e})=>({padding:e.spacing(2),borderBottom:`1px solid ${y(e.palette.divider,.1)}`})),se=m(le)(({theme:e})=>({borderRadius:8,textTransform:"none",fontWeight:500})),ir=[{type:"fulltext",label:"Full Text",icon:P},{type:"semantic",label:"Semantic",icon:Fe},{type:"regex",label:"Regex",icon:Ee},{type:"boolean",label:"Boolean",icon:We}];function ur(){ye();const e=me(),{execute:l}=te();Ae();const{results:a,totalResults:t,facets:n,savedSearches:c,searchHistory:x,loading:L,searching:A,error:H,search:B,semanticSearch:O,regexSearch:$,booleanSearch:M,saveSearch:N,fetchSavedSearches:U,deleteSavedSearch:dr,runSavedSearch:Y,clearResults:G,reset:K}=rr(),[g,j]=h.useState(""),[f,D]=h.useState("fulltext"),[_,ce]=h.useState(!1),[p,z]=h.useState({}),[k,ie]=h.useState(""),[hr,xr]=h.useState(!1),[pr,V]=h.useState(!1),[T,ue]=h.useState("");h.useEffect(()=>(U(),()=>K()),[U,K]);const R=h.useCallback(async s=>{const d=(s??g).trim();if(!d)return;const S=k?{...p,connectionId:k}:p,F=async()=>{let v=null;switch(f){case"semantic":v=await O(d,{filters:S});break;case"regex":v=await $(d,{filters:S});break;case"boolean":v=await M(d,{filters:S});break;default:v=await B(d,{searchType:"fulltext",filters:S})}return v};return l({type:Q.EXECUTE,label:"Search documents",reversibility:J.FULLY_REVERSIBLE,suppressSuccessToast:!0,intent:{source:"search",query:d,searchType:f},action:F})},[M,l,p,g,$,B,f,k,O]),de=h.useCallback(s=>{s.key==="Enter"&&R()},[R]);h.useCallback(async()=>{if(!(!T.trim()||!g.trim()))return l({type:Q.CREATE,label:"Save search",reversibility:J.SYSTEM_MANAGED,intent:{source:"search",name:T},action:async()=>{await N(T,g,{searchType:f,filters:p}),e.show("Search saved","success"),ue(""),V(!1)}})},[l,p,g,N,T,f,e]);const he=h.useCallback(async s=>{j(s.query),D(s.search_type||"fulltext"),await Y(s.id)},[Y]),xe=h.useCallback(()=>{j(""),G()},[G]);return r.jsxs(ar,{children:[r.jsx(sr,{children:r.jsxs(o,{sx:{maxWidth:800,mx:"auto"},children:[r.jsx(i,{variant:"h5",sx:{fontWeight:600,mb:3},children:"Search & Discovery"}),r.jsx(_e,{value:f,onChange:(s,d)=>D(d),sx:{mb:2},children:ir.map(s=>r.jsx(ze,{value:s.type,label:s.label,icon:r.jsx(s.icon,{fontSize:"small"}),iconPosition:"start"},s.type))}),r.jsx(or,{fullWidth:!0,placeholder:f==="regex"?"Enter regex pattern...":f==="boolean"?"e.g., (revenue AND growth) OR profit":f==="semantic"?"Describe what you're looking for...":"Search documents...",value:g,onChange:s=>j(s.target.value),onKeyDown:de,inputProps:{"aria-label":"Search query"},InputProps:{startAdornment:r.jsx(X,{position:"start",children:r.jsx(P,{color:"action"})}),endAdornment:r.jsxs(X,{position:"end",children:[g&&r.jsx(Z,{size:"small",onClick:xe,children:r.jsx(Pe,{fontSize:"small"})}),r.jsx(Z,{onClick:()=>ce(!_),color:_?"primary":"default",children:r.jsx(qe,{})}),r.jsx(se,{variant:"contained",onClick:R,disabled:!g.trim()||A,sx:{ml:1},children:A?r.jsx(ge,{size:20}):"Search"})]})}}),r.jsx(be,{in:_,children:r.jsx(ne,{sx:{mt:2,p:2},children:r.jsxs(C,{container:!0,spacing:2,children:[r.jsx(C,{item:!0,xs:12,sm:4,children:r.jsx(De,{value:k,onChange:ie,label:"Data Source",size:"small"})}),r.jsx(C,{item:!0,xs:12,sm:4,children:r.jsxs(Se,{fullWidth:!0,size:"small",children:[r.jsx(je,{children:"Document Type"}),r.jsxs(ve,{value:p.documentType||"",label:"Document Type",onChange:s=>z({...p,documentType:s.target.value}),children:[r.jsx(w,{value:"",children:"All"}),r.jsx(w,{value:"pdf",children:"PDF"}),r.jsx(w,{value:"docx",children:"Word"}),r.jsx(w,{value:"xlsx",children:"Excel"}),r.jsx(w,{value:"txt",children:"Text"})]})]})}),r.jsx(C,{item:!0,xs:12,sm:4,children:r.jsx(q,{fullWidth:!0,size:"small",label:"Date From",type:"date",InputLabelProps:{shrink:!0},value:p.dateFrom||"",onChange:s=>z({...p,dateFrom:s.target.value})})}),r.jsx(C,{item:!0,xs:12,sm:4,children:r.jsx(q,{fullWidth:!0,size:"small",label:"Date To",type:"date",InputLabelProps:{shrink:!0},value:p.dateTo||"",onChange:s=>z({...p,dateTo:s.target.value})})})]})})})]})}),r.jsxs(tr,{children:[r.jsx(nr,{children:a.length>0?r.jsxs(r.Fragment,{children:[r.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[r.jsxs(i,{variant:"subtitle1",children:[t," results found"]}),r.jsx(se,{size:"small",startIcon:r.jsx(He,{}),onClick:()=>V(!0),children:"Save Search"})]}),a.map((s,d)=>r.jsx(cr,{variant:"outlined",children:r.jsxs(o,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[r.jsx(we,{color:"inherit"}),r.jsxs(o,{sx:{flex:1},children:[r.jsx(i,{variant:"subtitle1",sx:{fontWeight:600},children:s.title||s.filename||"Untitled"}),s.highlight&&r.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:.5},dangerouslySetInnerHTML:{__html:Re(s.highlight)}}),r.jsxs(o,{sx:{display:"flex",gap:1,mt:1},children:[s.score&&r.jsx(E,{size:"small",label:`Score: ${(s.score*100).toFixed(0)}%`}),s.type&&r.jsx(E,{size:"small",label:s.type.toUpperCase(),variant:"outlined"})]})]})]})},s.id||d))]}):A?null:r.jsxs(o,{sx:{height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",maxWidth:500,mx:"auto"},children:[r.jsx(P,{sx:{fontSize:64,color:"text.secondary",opacity:.3,mb:2}}),r.jsx(i,{variant:"h6",sx:{fontWeight:600,mb:1},children:"Search Your Documents"}),r.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Find what you need across all your documents using different search modes."}),r.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:1,width:"100%",maxWidth:300},children:[r.jsx(i,{variant:"caption",color:"text.secondary",sx:{textAlign:"left",mb:.5},children:"Try these example searches:"}),[{query:"quarterly revenue",type:"fulltext",label:"Full Text"},{query:"documents about marketing strategy",type:"semantic",label:"Semantic"},{query:"(budget AND 2024) OR forecast",type:"boolean",label:"Boolean"}].map(s=>r.jsxs(le,{variant:"outlined",size:"small",onClick:()=>{j(s.query),D(s.type)},sx:{justifyContent:"flex-start",textTransform:"none",textAlign:"left"},children:[r.jsx(E,{size:"small",label:s.label,sx:{mr:1,pointerEvents:"none"}}),r.jsx(i,{variant:"body2",noWrap:!0,children:s.query})]},s.query))]})]})}),r.jsxs(lr,{children:[r.jsxs(W,{children:[r.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[r.jsx(i,{variant:"subtitle2",sx:{fontWeight:600},children:"Saved Searches"}),r.jsx(Le,{fontSize:"small",color:"action"})]}),r.jsxs(ee,{dense:!0,children:[c.slice(0,5).map(s=>r.jsx(re,{button:!0,onClick:()=>he(s),sx:{borderRadius:1},children:r.jsx(ae,{primary:s.name,secondary:s.query,primaryTypographyProps:{variant:"body2"},secondaryTypographyProps:{noWrap:!0}})},s.id)),c.length===0&&r.jsx(i,{variant:"body2",color:"text.secondary",sx:{py:1},children:"No saved searches"})]})]}),r.jsxs(W,{children:[r.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[r.jsx(i,{variant:"subtitle2",sx:{fontWeight:600},children:"Recent Searches"}),r.jsx(Ce,{fontSize:"small",color:"action"})]}),r.jsxs(ee,{dense:!0,children:[x.slice(0,5).map((s,d)=>r.jsx(re,{button:!0,onClick:()=>{j(s.query),R(s.query)},sx:{borderRadius:1},children:r.jsx(ae,{primary:s.query,secondary:`${s.resultCount} results`,primaryTypographyProps:{variant:"body2",noWrap:!0}})},d)),x.length===0&&r.jsx(i,{variant:"body2",color:"text.secondary",sx:{py:1},children:"No recent searches"})]})]}),Object.keys(n).length>0&&r.jsxs(W,{children:[r.jsx(i,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:"Refine Results"}),Object.entries(n).map(([s,d])=>r.jsxs(o,{sx:{mb:2},children:[r.jsx(i,{variant:"caption",color:"text.secondary",children:s.replace(/_/g," ").toUpperCase()}),Object.entries(d).slice(0,5).map(([S,F])=>r.jsx(Ie,{control:r.jsx(ke,{size:"small"}),label:r.jsxs(i,{variant:"body2",children:[S," (",F,")"]})},S))]},s))]})]})]}),H&&r.jsx(Te,{severity:"error",sx:{m:2},children:H})]})}function Rr(){return te(),r.jsx(ur,{})}export{Rr as default};
