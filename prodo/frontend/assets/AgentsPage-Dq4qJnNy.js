import{g as Ae,j as e,i as S,cH as Je,bN as Be,u as He,v as Ve,Z as Me,a as Ie,r as x,b_ as Ke,c6 as Qe,R as Xe,I as Ye,B as p,c8 as Ze,o as m,J as et,n as U,f as j,ak as tt,P as J,A as we,aJ as O,C as ce,F as X,m as Y,S as Z,M as ee,p as Q,aY as rt,T as at,K as te,D as ue,e as st,bP as nt,bQ as ot,aU as lt,N as _,b3 as it,q,bU as ct,a7 as ut,ah as dt,aj as pt,al as mt,am as ht}from"./index-COTlR4Mk.js";import{u as gt}from"./useSharedData-CmfHiy_j.js";import{u as yt,F as _e,O as Te}from"./useCrossPageActions-B2ZCWXOL.js";import{C as xt}from"./ConnectionSelector-DIWHs3I4.js";import{S as ft}from"./SendToMenu-BMkSDk7u.js";import{S as bt}from"./Science-neLk2T8W.js";import{E as jt}from"./Email-BjD0Ml5R.js";import{P as vt}from"./Spellcheck-DpNm7jf8.js";import{G as W}from"./Grid-BMfuCMsI.js";import{C as kt}from"./CardContent-Cdyni_Bl.js";import{A as St}from"./Autocomplete-Bc71fcbE.js";import{C as wt}from"./ContentCopy-Sgu9Svo_.js";import{L as _t}from"./Lightbulb-BGaZkdEF.js";import{C as Tt}from"./CompareArrows-DWy7xJBX.js";import{T as Ct}from"./TrendingUp-iS6-zk1M.js";import{T as At}from"./TrendingDown-BblVF55f.js";import{T as It}from"./TrendingFlat-D7qu-L__.js";import"./SummarizeRounded-DKHAHydN.js";const Re=Ae(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2M9 17H7v-5h2zm4 0h-2v-3h2zm0-5h-2v-2h2zm4 5h-2V7h2z"})),Rt=Ae(e.jsx("path",{d:"M22 18v-2H8V4h2L7 1 4 4h2v2H2v2h4v8c0 1.1.9 2 2 2h8v2h-2l3 3 3-3h-2v-2zM10 8h6v6h2V8c0-1.1-.9-2-2-2h-6z"}));function de(t,s=[]){if(Array.isArray(t))return t;if(!t||typeof t!="object")return[];for(const r of s)if(Array.isArray(t[r]))return t[r];return[]}async function Dt(t,s={}){return(await S.post("/agents/research",{topic:t,depth:s.depth||"comprehensive",focus_areas:s.focusAreas||null,max_sections:s.maxSections||5})).data}async function Et(t,s,r={}){return(await S.post("/agents/data-analysis",{question:t,data:s,data_description:r.dataDescription||null,generate_charts:r.generateCharts!==!1})).data}async function zt(t,s,r={}){return(await S.post("/agents/email-draft",{context:t,purpose:s,tone:r.tone||"professional",recipient_info:r.recipientInfo||null,previous_emails:r.previousEmails||null})).data}async function Pt(t,s,r,o={}){return(await S.post("/agents/content-repurpose",{content:t,source_format:s,target_formats:r,preserve_key_points:o.preserveKeyPoints!==!1,adapt_length:o.adaptLength!==!1})).data}async function Ft(t,s={}){return(await S.post("/agents/proofread",{text:t,style_guide:s.styleGuide||null,focus_areas:s.focusAreas||null,preserve_voice:s.preserveVoice!==!1})).data}async function Wt(t){const r=(await S.get(`/agents/tasks/${t}`)).data;return r&&typeof r=="object"&&r.task?r.task:r}async function $t(t=null){const s=t?{agent_type:t}:{},r=await S.get("/agents/tasks",{params:s});return de(r.data,["tasks","items","results"])}async function Ot(){const s=(await S.get("/agents/types")).data;return Array.isArray(s)?{types:s}:s&&typeof s=="object"?{...s,types:de(s,["types","items","results"])}:{types:[]}}async function qt(){const s=(await S.get("/agents/formats/repurpose")).data;return Array.isArray(s)?{formats:s}:s&&typeof s=="object"?{...s,formats:de(s,["formats","items","results"])}:{formats:[]}}const D="/agents/v2",Nt=(t,s=[])=>{if(Array.isArray(t))return t;if(!t||typeof t!="object")return[];for(const r of s)if(Array.isArray(t[r]))return t[r];return[]};class I extends Error{constructor(s,r,o=!1,i={}){super(r),this.name="AgentError",this.code=s,this.retryable=o,this.details=i}}class Lt extends I{constructor(s,r=null){super("VALIDATION_ERROR",s,!1,{field:r}),this.name="ValidationError"}}class Gt extends I{constructor(s){super("TASK_NOT_FOUND",`Task ${s} not found`,!1,{taskId:s}),this.name="TaskNotFoundError"}}class Ut extends I{constructor(s){super("TASK_CONFLICT",s,!1),this.name="TaskConflictError"}}function N(t){if(t.response){const{status:s,data:r}=t.response,o=r?.detail||{};throw s===400?new Lt(o.message||"Invalid request",o.field):s===404?new Gt(o.taskId||"unknown"):s===409?new Ut(o.message||"Task conflict"):s===429?new I("RATE_LIMITED",o.message||"Rate limit exceeded",!0,{retryAfter:o.retry_after||60}):new I(o.code||"API_ERROR",o.message||t.message,o.retryable??!0)}throw new I("NETWORK_ERROR",t.message,!0)}async function Jt(t,s={}){try{return(await S.post(`${D}/report-analyst`,{run_id:t,analysis_type:s.analysisType||"summarize",question:s.question||null,compare_run_id:s.compareRunId||null,focus_areas:s.focusAreas||null,idempotency_key:s.idempotencyKey||null,priority:s.priority||0,webhook_url:s.webhookUrl||null,sync:s.sync!==!1})).data}catch(r){N(r)}}async function Bt(t,s={}){try{return(await S.post(`${D}/tasks/${t}/generate-report`,{template_id:s.templateId,connection_id:s.connectionId,start_date:s.startDate,end_date:s.endDate,key_values:s.keyValues||null,docx:s.docx||!1,xlsx:s.xlsx||!1})).data}catch(r){N(r)}}async function Ht(t,s=null){try{const o=(await S.post(`${D}/tasks/${t}/cancel`,{reason:s})).data;return o&&typeof o=="object"&&o.task?o.task:o}catch(r){N(r)}}async function Vt(t){try{const r=(await S.post(`${D}/tasks/${t}/retry`)).data;return r&&typeof r=="object"&&r.task?r.task:r}catch(s){N(s)}}async function Mt(t,s=100){try{const r=await S.get(`${D}/tasks/${t}/events`,{params:{limit:s}});return Nt(r.data,["events","items","results"])}catch(r){N(r)}}async function Kt(){try{return(await S.get(`${D}/stats`)).data}catch(t){N(t)}}function Qt(t,s={}){const{onProgress:r=null,onComplete:o=null,onError:i=null,pollInterval:u=.5,timeout:h=300}=s,T=new URLSearchParams({poll_interval:String(u),timeout:String(h)}),d=Je(`${D}/tasks/${t}/stream?${T}`),f=new EventSource(d);let w=!1;return f.onmessage=C=>{if(!w)try{const v=JSON.parse(C.data);if(v.event==="progress"&&r)r(v.data);else if(v.event==="complete")o&&o(v.data),f.close(),w=!0;else if(v.event!=="heartbeat"){if(v.event==="error"){if(v.data.code==="DB_ERROR")return;i&&i(new I(v.data.code||"STREAM_ERROR",v.data.message||"Stream error",!1)),f.close(),w=!0}}}catch(v){console.warn("Failed to parse SSE event:",v)}},f.onerror=C=>{w||f.readyState===EventSource.CLOSED&&(i&&i(new I("SSE_CONNECTION_CLOSED","SSE connection closed",!0)),w=!0)},{close(){w||(w=!0,f.close())}}}const M=t=>t?.id||t?.task_id||null,Xt=Be((t,s)=>({tasks:[],currentTask:null,agentTypes:[],repurposeFormats:[],loading:!1,executing:!1,error:null,setLoading:r=>t({loading:r}),setError:r=>t({error:r}),runResearch:async(r,o={})=>{t({executing:!0,error:null});try{const i=await Dt(r,o);return t(u=>({tasks:[i,...u.tasks].slice(0,200),currentTask:i,executing:!1})),i}catch(i){return t({error:i.message,executing:!1}),null}},runDataAnalysis:async(r,o,i={})=>{t({executing:!0,error:null});try{const u=await Et(r,o,i);return t(h=>({tasks:[u,...h.tasks].slice(0,200),currentTask:u,executing:!1})),u}catch(u){return t({error:u.message,executing:!1}),null}},runEmailDraft:async(r,o,i={})=>{t({executing:!0,error:null});try{const u=await zt(r,o,i);return t(h=>({tasks:[u,...h.tasks].slice(0,200),currentTask:u,executing:!1})),u}catch(u){return t({error:u.message,executing:!1}),null}},runContentRepurpose:async(r,o,i,u={})=>{t({executing:!0,error:null});try{const h=await Pt(r,o,i,u);return t(T=>({tasks:[h,...T.tasks].slice(0,200),currentTask:h,executing:!1})),h}catch(h){return t({error:h.message,executing:!1}),null}},runProofreading:async(r,o={})=>{t({executing:!0,error:null});try{const i=await Ft(r,o);return t(u=>({tasks:[i,...u.tasks].slice(0,200),currentTask:i,executing:!1})),i}catch(i){return t({error:i.message,executing:!1}),null}},runReportAnalyst:async(r,o={})=>{t({executing:!0,error:null});try{const i=await Jt(r,o);return t(u=>({tasks:[i,...u.tasks].slice(0,200),currentTask:i,executing:!1})),i}catch(i){return t({error:i.message,executing:!1}),null}},generateReportFromTask:async(r,o={})=>{t({executing:!0,error:null});try{const i=await Bt(r,o);return t({executing:!1}),i}catch(i){return t({error:i.message,executing:!1}),null}},fetchTasks:async(r=null)=>{t({loading:!0,error:null});try{const o=await $t(r);return t({tasks:o,loading:!1}),o}catch(o){return t({error:o.message,loading:!1}),[]}},getTask:async r=>{t({loading:!0,error:null});try{const o=await Wt(r);return t({currentTask:o,loading:!1}),o}catch(o){return t({error:o.message,loading:!1}),null}},fetchAgentTypes:async()=>{try{const r=await Ot();return t({agentTypes:r.types||[]}),r.types}catch(r){return t({error:r.message}),[]}},fetchRepurposeFormats:async()=>{try{const r=await qt();return t({repurposeFormats:r.formats||[]}),r.formats}catch(r){return t({error:r.message}),[]}},cancelTask:async r=>{try{return await Ht(r),t(o=>({tasks:o.tasks.map(i=>M(i)===r?{...i,status:"cancelled"}:i),currentTask:M(o.currentTask)===r?{...o.currentTask,status:"cancelled"}:o.currentTask})),!0}catch(o){return t({error:o.message}),!1}},retryTask:async r=>{t({executing:!0,error:null});try{const o=await Vt(r);return t(i=>({tasks:i.tasks.map(u=>M(u)===r?o:u),currentTask:M(i.currentTask)===r?o:i.currentTask,executing:!1})),o}catch(o){return t({error:o.message,executing:!1}),null}},getTaskEvents:async r=>{try{return await Mt(r)}catch(o){return t({error:o.message}),[]}},getAgentStats:async()=>{try{return await Kt()}catch(r){return t({error:r.message}),null}},streamTaskProgress:async(r,o)=>{try{return await Qt(r,o)}catch(i){return t({error:i.message}),null}},reset:()=>t({currentTask:null,error:null}),clearTasks:()=>t({tasks:[],currentTask:null})})),Yt=_(p)(({theme:t})=>({display:"flex",flexDirection:"column",height:"calc(100vh - 64px)",backgroundColor:t.palette.background.default})),Zt=_(p)(({theme:t})=>({padding:t.spacing(2,3),borderBottom:`1px solid ${j(t.palette.divider,.1)}`,backgroundColor:j(t.palette.background.paper,.8)})),er=_(p)(({theme:t})=>({flex:1,display:"flex",overflow:"hidden"})),tr=_(p)(({theme:t})=>({flex:1,padding:t.spacing(3),overflow:"auto"})),rr=_(p)(({theme:t})=>({width:350,borderLeft:`1px solid ${j(t.palette.divider,.1)}`,backgroundColor:j(t.palette.background.paper,.6),display:"flex",flexDirection:"column"})),ar=_(it)(({theme:t,selected:s})=>({cursor:"pointer",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)",border:s?`2px solid ${t.palette.mode==="dark"?U[500]:U[700]}`:`1px solid ${j(t.palette.divider,.2)}`,"&:hover":{transform:"translateY(-2px)",boxShadow:`0 8px 24px ${j(t.palette.text.primary,.15)}`}})),sr=_(J)(({theme:t})=>({padding:t.spacing(2),marginTop:t.spacing(2),backgroundColor:t.palette.mode==="dark"?j(t.palette.text.primary,.05):U[50],border:`1px solid ${j(t.palette.divider,.2)}`})),Ce=_(te)(({theme:t})=>({borderRadius:8,textTransform:"none",fontWeight:500})),nr=({trend:t})=>t==="up"?e.jsx(Ct,{fontSize:"small",color:"success"}):t==="down"?e.jsx(At,{fontSize:"small",color:"error"}):t==="stable"?e.jsx(It,{fontSize:"small",color:"action"}):null,$=_(m)(({theme:t})=>({fontWeight:600,fontSize:"0.875rem",display:"flex",alignItems:"center",gap:t.spacing(1),marginBottom:t.spacing(1)})),or=_(J)(({theme:t})=>({padding:t.spacing(1.5),backgroundColor:t.palette.mode==="dark"?j(t.palette.text.primary,.04):U[50],border:`1px solid ${j(t.palette.divider,.15)}`,borderRadius:8})),lr=_(p)(({theme:t})=>({display:"flex",alignItems:"center",justifyContent:"space-between",padding:t.spacing(1,1.5),borderBottom:`1px solid ${j(t.palette.divider,.1)}`,"&:last-child":{borderBottom:"none"}}));function ir({output:t}){if(!t||typeof t!="object")return null;const{summary:s,answer:r,key_findings:o,data_highlights:i,recommendations:u,comparison:h,analysis_type:T}=t;return e.jsxs(q,{spacing:2.5,children:[r&&e.jsxs(p,{children:[e.jsxs($,{children:[e.jsx(ct,{fontSize:"small",color:"primary"}),"Answer"]}),e.jsx(J,{sx:{p:2,bgcolor:d=>j(d.palette.primary.main,.06),borderRadius:2,border:"1px solid",borderColor:d=>j(d.palette.primary.main,.15)},children:e.jsx(m,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:r})})]}),s&&e.jsxs(p,{children:[e.jsxs($,{children:[e.jsx(ue,{fontSize:"small",color:"action"}),"Summary"]}),e.jsx(m,{variant:"body2",sx:{whiteSpace:"pre-wrap",lineHeight:1.7},children:s})]}),o?.length>0&&e.jsxs(p,{children:[e.jsxs($,{children:[e.jsx(_t,{fontSize:"small",sx:{color:"warning.main"}}),"Key Findings (",o.length,")"]}),e.jsx(q,{spacing:1,children:o.map((d,f)=>e.jsxs(or,{elevation:0,children:[e.jsxs(p,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:1},children:[e.jsx(m,{variant:"body2",children:d.finding||d}),d.confidence!=null&&e.jsx(Q,{label:`${Math.round(d.confidence*100)}%`,size:"small",color:d.confidence>=.8?"success":d.confidence>=.6?"warning":"default",variant:"outlined",sx:{flexShrink:0,fontSize:"12px",height:22}})]}),d.source_section&&e.jsxs(m,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:["Source: ",d.source_section]})]},f))})]}),i?.length>0&&e.jsxs(p,{children:[e.jsxs($,{children:[e.jsx(Re,{fontSize:"small",color:"info"}),"Data Highlights (",i.length,")"]}),e.jsx(J,{variant:"outlined",sx:{borderRadius:2,overflow:"hidden"},children:i.map((d,f)=>e.jsxs(lr,{children:[e.jsxs(p,{sx:{flex:1,minWidth:0},children:[e.jsx(m,{variant:"body2",fontWeight:600,noWrap:!0,children:d.metric}),d.context&&e.jsx(m,{variant:"caption",color:"text.secondary",children:d.context})]}),e.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1,flexShrink:0},children:[e.jsx(m,{variant:"body2",fontWeight:500,children:d.value}),e.jsx(nr,{trend:d.trend})]})]},f))})]}),h&&e.jsxs(p,{children:[e.jsxs($,{children:[e.jsx(Tt,{fontSize:"small",color:"secondary"}),"Comparison"]}),e.jsxs(q,{spacing:1,children:[h.report_a_period&&h.report_b_period&&e.jsxs(m,{variant:"caption",color:"text.secondary",children:["Comparing: ",h.report_a_period," vs ",h.report_b_period]}),h.improvements?.length>0&&e.jsxs(p,{children:[e.jsx(m,{variant:"caption",fontWeight:600,color:"success.main",children:"Improvements:"}),e.jsx("ul",{style:{margin:"4px 0",paddingLeft:20},children:h.improvements.map((d,f)=>e.jsx("li",{children:e.jsx(m,{variant:"caption",children:d})},f))})]}),h.regressions?.length>0&&e.jsxs(p,{children:[e.jsx(m,{variant:"caption",fontWeight:600,color:"error.main",children:"Regressions:"}),e.jsx("ul",{style:{margin:"4px 0",paddingLeft:20},children:h.regressions.map((d,f)=>e.jsx("li",{children:e.jsx(m,{variant:"caption",children:d})},f))})]})]})]}),u?.length>0&&e.jsxs(p,{children:[e.jsxs($,{children:[e.jsx(ut,{fontSize:"small",color:"success"}),"Recommendations (",u.length,")"]}),e.jsx(q,{spacing:.5,children:u.map((d,f)=>e.jsxs(p,{sx:{display:"flex",alignItems:"flex-start",gap:1,pl:.5},children:[e.jsxs(m,{variant:"body2",color:"text.secondary",sx:{minWidth:20,fontWeight:600},children:[f+1,"."]}),e.jsx(m,{variant:"body2",children:d})]},f))})]})]})}function cr({open:t,onClose:s,taskId:r,templates:o,connections:i,onGenerate:u}){const[h,T]=x.useState(""),[d,f]=x.useState(""),[w,C]=x.useState(""),[v,E]=x.useState(""),[z,L]=x.useState(!1);x.useEffect(()=>{if(t){T(o?.[0]?.id||""),f(i?.[0]?.id||"");const y=new Date().toISOString().split("T")[0],re=new Date(Date.now()-30*864e5).toISOString().split("T")[0];C(re),E(y)}},[t,o,i]);const B=async()=>{L(!0);try{await u(r,{templateId:h,connectionId:d,startDate:w,endDate:v}),s()}catch{}finally{L(!1)}};return e.jsxs(dt,{open:t,onClose:s,maxWidth:"sm",fullWidth:!0,children:[e.jsx(pt,{sx:{fontWeight:600},children:"Generate Report from Agent Result"}),e.jsx(mt,{children:e.jsxs(q,{spacing:2.5,sx:{mt:1},children:[e.jsxs(X,{fullWidth:!0,size:"small",children:[e.jsx(Y,{children:"Template"}),e.jsx(Z,{value:h,onChange:y=>T(y.target.value),label:"Template",children:(o||[]).map(y=>e.jsx(ee,{value:y.id,children:y.name||y.id},y.id))})]}),e.jsxs(X,{fullWidth:!0,size:"small",children:[e.jsx(Y,{children:"Connection"}),e.jsx(Z,{value:d,onChange:y=>f(y.target.value),label:"Connection",children:(i||[]).map(y=>e.jsx(ee,{value:y.id,children:y.name||y.id},y.id))})]}),e.jsxs(q,{direction:"row",spacing:2,children:[e.jsx(O,{label:"Start Date",type:"date",value:w,onChange:y=>C(y.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,size:"small"}),e.jsx(O,{label:"End Date",type:"date",value:v,onChange:y=>E(y.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,size:"small"})]})]})}),e.jsxs(ht,{children:[e.jsx(te,{onClick:s,children:"Cancel"}),e.jsx(te,{variant:"contained",onClick:B,disabled:!h||!d||z,startIcon:z?e.jsx(ce,{size:16}):e.jsx(ue,{}),children:z?"Generating...":"Generate Report"})]})]})}const K=[{type:"research",name:"Research Agent",description:"Deep-dive research and report compilation on any topic",icon:bt,color:"primary",fields:[{name:"topic",label:"Research Topic",type:"text",required:!0,multiline:!0},{name:"depth",label:"Depth",type:"select",options:["quick","standard","comprehensive","exhaustive"],default:"comprehensive"},{name:"maxSections",label:"Sections",type:"number",default:5,min:1,max:10}]},{type:"data_analyst",name:"Data Analyst",description:"Analyze data and answer questions with insights",icon:Re,color:"info",fields:[{name:"question",label:"What do you want to know?",type:"text",required:!0,multiline:!0,placeholder:"e.g., What are the top 5 products by revenue? Which month had the highest sales?"},{name:"dataSource",label:"Data Source",type:"select",options:["paste_spreadsheet","database_connection","sample_sales","sample_inventory","custom_json"],default:"paste_spreadsheet"},{name:"data",label:"Paste your data here (from Excel or Google Sheets)",type:"spreadsheet",required:!0,multiline:!0,rows:8,placeholder:"Tip: Copy cells from Excel or Google Sheets and paste here. We'll convert it automatically!"}]},{type:"email_draft",name:"Email Draft",description:"Compose professional emails based on context",icon:jt,color:"warning",fields:[{name:"context",label:"Context",type:"text",required:!0,multiline:!0},{name:"purpose",label:"Purpose",type:"text",required:!0},{name:"tone",label:"Tone",type:"select",options:["professional","friendly","formal","casual"],default:"professional"},{name:"recipientInfo",label:"Recipient Info",type:"text"}]},{type:"content_repurpose",name:"Content Repurpose",description:"Transform content into multiple formats",icon:Rt,color:"secondary",fields:[{name:"content",label:"Original Content",type:"text",required:!0,multiline:!0,rows:6},{name:"sourceFormat",label:"Source Format",type:"select",options:["blog","article","report","notes","transcript"],default:"blog"},{name:"targetFormats",label:"Target Formats",type:"multiselect",options:["tweet_thread","linkedin_post","blog_summary","slides","email_newsletter","video_script"]}]},{type:"proofreading",name:"Proofreading",description:"Grammar, style, and clarity improvements",icon:vt,color:"success",fields:[{name:"text",label:"Text to Proofread",type:"text",required:!0,multiline:!0,rows:8},{name:"styleGuide",label:"Style Guide",type:"select",options:["AP","Chicago","MLA","APA","None"],default:"None"}]},{type:"report_analyst",name:"Report Analyst",description:"Analyze, summarize, compare, or ask questions about generated reports",icon:Ke,color:"error",fields:[{name:"runId",label:"Report Run",type:"reportRunPicker",required:!0,placeholder:"Select or enter a report run ID"},{name:"analysisType",label:"Analysis Type",type:"select",options:["summarize","insights","compare","qa"],default:"summarize"},{name:"question",label:"Question (for Q&A mode)",type:"text",multiline:!0,placeholder:"What would you like to know about this report?"},{name:"compareRunId",label:"Comparison Run ID (for compare mode)",type:"reportRunPicker",placeholder:"Select second report to compare against"}]}];function ur(){const t=He(),s=Ve(),[r,o]=Me(),{execute:i}=Ie(),{tasks:u,currentTask:h,agentTypes:T,repurposeFormats:d,loading:f,executing:w,error:C,runResearch:v,runDataAnalysis:E,runEmailDraft:z,runContentRepurpose:L,runProofreading:B,runReportAnalyst:y,generateReportFromTask:re,fetchTasks:pe,fetchAgentTypes:me,fetchRepurposeFormats:he,reset:ge}=Xt(),{connections:De,templates:Ee,activeConnectionId:ze}=gt(),{registerOutput:Pe}=yt(_e.AGENTS),[H,Fe]=x.useState(ze),[b,ae]=x.useState(K[0]),[c,se]=x.useState({}),[ye,We]=x.useState(!1),[k,ne]=x.useState(null),[$e,xe]=x.useState([]),[fe,be]=x.useState(!1),[Oe,je]=x.useState(!1),ve=x.useRef(null);x.useEffect(()=>(me(),he(),pe(),()=>ge()),[me,he,pe,ge]),x.useEffect(()=>{const a=r.get("analyzeRunId");if(a){const n=K.find(l=>l.type==="report_analyst");if(n){ae(n),se({runId:a,analysisType:"summarize"});const l=new URLSearchParams(r);l.delete("analyzeRunId"),o(l,{replace:!0})}}},[]),x.useEffect(()=>{b?.type==="report_analyst"&&(be(!0),Qe({limit:20}).then(a=>xe(Array.isArray(a)?a:[])).catch(()=>xe([])).finally(()=>be(!1)))},[b?.type]);const qe=x.useCallback(a=>{ae(a),se({}),ne(null)},[]),R=x.useCallback((a,n)=>{se(l=>({...l,[a]:n}))},[]),Ne=x.useCallback(async()=>{if(!b)return;const a=async()=>{let n=null;switch(b.type){case"research":n=await v(c.topic,{depth:c.depth||"comprehensive",maxSections:c.maxSections||5});break;case"data_analyst":try{let l;const g=c.dataSource||"paste_spreadsheet";if(g==="sample_sales")l=[{product:"Widget A",revenue:15e3,units:300,month:"January"},{product:"Widget B",revenue:22e3,units:440,month:"January"},{product:"Widget A",revenue:18e3,units:360,month:"February"},{product:"Widget B",revenue:25e3,units:500,month:"February"},{product:"Widget C",revenue:12e3,units:200,month:"February"}];else if(g==="sample_inventory")l=[{item:"SKU-001",stock:150,reorder_point:50,supplier:"Acme Corp"},{item:"SKU-002",stock:25,reorder_point:30,supplier:"Beta Inc"},{item:"SKU-003",stock:200,reorder_point:75,supplier:"Acme Corp"},{item:"SKU-004",stock:10,reorder_point:20,supplier:"Gamma Ltd"}];else if(g==="database_connection"){if(!H)return s.show("Please select a database connection","warning"),null;n=await E(c.question,[],{connectionId:H})}else if(g==="custom_json")l=JSON.parse(c.data);else{const F=(c.data||"").trim().split(`
`);if(F.length<2)return s.show("Please paste data with at least a header row and one data row","warning"),null;const G=F[0].includes("	")?"	":",",oe=F[0].split(G).map(A=>A.trim().replace(/^["']|["']$/g,""));l=F.slice(1).map(A=>{const le=A.split(G).map(ie=>{const V=ie.trim().replace(/^["']|["']$/g,""),Se=parseFloat(V);return isNaN(Se)?V:Se}),ke={};return oe.forEach((ie,V)=>{ke[ie]=le[V]??""}),ke}).filter(A=>Object.values(A).some(le=>le!==""))}if(g!=="database_connection"){if(!l||!l.length)return s.show("No valid data found. Please check your input.","warning"),null;n=await E(c.question,l)}}catch{return s.show("Could not parse data. For custom JSON, ensure it's valid JSON format.","error"),null}break;case"email_draft":n=await z(c.context,c.purpose,{tone:c.tone||"professional",recipientInfo:c.recipientInfo});break;case"content_repurpose":n=await L(c.content,c.sourceFormat||"blog",c.targetFormats||["blog_summary"]);break;case"proofreading":n=await B(c.text,{styleGuide:c.styleGuide!=="None"?c.styleGuide:null});break;case"report_analyst":n=await y(c.runId,{analysisType:c.analysisType||"summarize",question:c.question||null,compareRunId:c.compareRunId||null});break}if(n)if(ne(n),n.status==="failed"||n.status==="error"){const l=(typeof n.error=="object"?n.error?.message:n.error)||n.message||"Agent task failed";s.show(l,"error")}else{const l=n.result||n.output,g=(typeof l=="string"?l:JSON.stringify(l,null,2))||"";Pe({type:Te.TEXT,title:`${b.name}: ${c.topic||c.question||c.purpose||"Result"}`,summary:g.substring(0,200),data:g,format:"text"}),s.show("Agent completed successfully","success")}return n};return i({type:Ye.EXECUTE,label:`Run ${b.name}`,reversibility:Xe.FULLY_REVERSIBLE,blocksNavigation:!0,intent:{source:"agents",agentType:b.type},action:a})},[i,c,L,E,z,B,y,v,b,H,s]),Le=x.useCallback(()=>{const a=k?.result||k?.output;a&&(navigator.clipboard.writeText(typeof a=="string"?a:JSON.stringify(a,null,2)),s.show("Copied to clipboard","success"))},[k,s]),Ge=x.useCallback(()=>{We(a=>!a)},[]),Ue=()=>b?b.fields.filter(a=>a.required).every(a=>c[a.name]?.toString().trim()):!1;return e.jsxs(Yt,{children:[e.jsx(Zt,{children:e.jsxs(p,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ze,{sx:{color:"text.secondary",fontSize:28}}),e.jsxs(p,{children:[e.jsx(m,{variant:"h6",sx:{fontWeight:600},children:"AI Agents"}),e.jsx(m,{variant:"body2",color:"text.secondary",children:"Specialized AI agents for research, analysis, writing, and more"})]})]}),e.jsxs(Ce,{startIcon:e.jsx(et,{}),onClick:Ge,variant:ye?"contained":"outlined",children:["History (",u.length,")"]})]})}),e.jsxs(er,{children:[e.jsxs(tr,{children:[e.jsx(m,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Select Agent"}),e.jsx(W,{container:!0,spacing:2,sx:{mb:4},children:K.map(a=>e.jsx(W,{item:!0,xs:12,sm:6,md:4,children:e.jsx(ar,{selected:b?.type===a.type,onClick:()=>qe(a),children:e.jsxs(kt,{children:[e.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1},children:[e.jsx(p,{sx:{width:40,height:40,borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:t.palette.mode==="dark"?j(t.palette.text.primary,.05):U[50]},children:e.jsx(a.icon,{color:"inherit",sx:{color:"text.secondary"}})}),e.jsx(m,{variant:"subtitle1",sx:{fontWeight:600},children:a.name})]}),e.jsx(m,{variant:"body2",color:"text.secondary",children:a.description})]})})},a.type))}),b&&e.jsxs(e.Fragment,{children:[e.jsx(tt,{sx:{mb:3}}),e.jsxs(m,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:[b.name," Configuration"]}),e.jsxs(J,{sx:{p:3},children:[e.jsx(W,{container:!0,spacing:2,children:b.fields.map(a=>{if(b.type==="data_analyst"&&a.name==="data"){const n=c.dataSource||"paste_spreadsheet";if(n==="sample_sales"||n==="sample_inventory")return e.jsx(W,{item:!0,xs:12,children:e.jsxs(we,{severity:"info",sx:{mt:1},children:["Using sample ",n==="sample_sales"?"sales":"inventory"," data. Just enter your question above!"]})},a.name);if(n==="database_connection")return e.jsx(W,{item:!0,xs:12,children:e.jsx(xt,{value:H,onChange:Fe,label:"Select Database",showStatus:!0})},a.name)}if(b.type==="report_analyst"){const n=c.analysisType||"summarize";if(a.name==="question"&&n!=="qa"||a.name==="compareRunId"&&n!=="compare")return null}return e.jsx(W,{item:!0,xs:12,md:a.multiline?12:6,children:a.type==="reportRunPicker"?e.jsx(St,{freeSolo:!0,options:$e,loading:fe,getOptionLabel:n=>{if(typeof n=="string")return n;const l=n.templateName||n.template_name||n.templateId||n.template_id||"",g=n.createdAt||n.created_at||"",P=g?new Date(g).toLocaleDateString():"";return`${l} — ${P} (${n.id?.slice(0,8)}...)`},value:c[a.name]||null,onChange:(n,l)=>{const g=typeof l=="string"?l:l?.id||"";R(a.name,g)},onInputChange:(n,l,g)=>{g==="input"&&R(a.name,l)},renderOption:(n,l)=>{const{key:g,...P}=n,F=l.templateName||l.template_name||l.templateId||l.template_id||"",G=l.createdAt||l.created_at||"",oe=G?new Date(G).toLocaleString():"",A=[l.startDate||l.start_date,l.endDate||l.end_date].filter(Boolean).join(" – ");return e.jsx("li",{...P,children:e.jsxs(p,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(m,{variant:"body2",fontWeight:500,children:F}),e.jsxs(m,{variant:"caption",color:"text.secondary",children:[oe,A?` | ${A}`:""," | ",l.id?.slice(0,12),"..."]})]})},g)},renderInput:n=>e.jsx(O,{...n,label:a.label,placeholder:a.placeholder,required:a.required,InputProps:{...n.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[fe?e.jsx(ce,{size:18}):null,n.InputProps.endAdornment]})}})}):a.type==="select"?e.jsxs(X,{fullWidth:!0,children:[e.jsx(Y,{children:a.label}),e.jsx(Z,{value:c[a.name]||a.default||"",label:a.label,onChange:n=>R(a.name,n.target.value),children:a.options.map(n=>{let l=n.replace(/_/g," ").replace(/\b\w/g,g=>g.toUpperCase());return n==="paste_spreadsheet"&&(l="Paste from Spreadsheet (Recommended)"),n==="database_connection"&&(l="Query Database Connection"),n==="sample_sales"&&(l="Use Sample Sales Data"),n==="sample_inventory"&&(l="Use Sample Inventory Data"),n==="custom_json"&&(l="Enter Raw JSON (Advanced)"),e.jsx(ee,{value:n,children:l},n)})})]}):a.type==="multiselect"?e.jsxs(X,{fullWidth:!0,children:[e.jsx(Y,{children:a.label}),e.jsx(Z,{multiple:!0,value:c[a.name]||[],label:a.label,onChange:n=>R(a.name,n.target.value),renderValue:n=>e.jsx(p,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:n.map(l=>e.jsx(Q,{label:l.replace(/_/g," "),size:"small"},l))}),children:a.options.map(n=>e.jsx(ee,{value:n,children:n.replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase())},n))})]}):a.type==="number"?e.jsx(O,{fullWidth:!0,type:"number",label:a.label,value:c[a.name]??a.default??"",onChange:n=>R(a.name,parseInt(n.target.value)),inputProps:{min:a.min,max:a.max},required:a.required}):a.type==="spreadsheet"?e.jsx(O,{fullWidth:!0,label:c.dataSource==="custom_json"?"JSON Data":a.label,value:c[a.name]||"",onChange:n=>R(a.name,n.target.value),multiline:!0,rows:a.rows||4,required:a.required,placeholder:c.dataSource==="custom_json"?'[{"name": "John", "value": 100}, {"name": "Jane", "value": 200}]':a.placeholder||"Copy from Excel/Sheets and paste here...",helperText:c.dataSource==="custom_json"?"Enter valid JSON array of objects":"Supports tab-separated (Excel) or comma-separated (CSV) data"}):e.jsx(O,{fullWidth:!0,label:a.label,value:c[a.name]||"",onChange:n=>R(a.name,n.target.value),multiline:a.multiline,rows:a.rows||4,required:a.required,placeholder:a.placeholder})},a.name)})}),e.jsx(p,{sx:{mt:3,display:"flex",justifyContent:"flex-end"},children:e.jsx(Ce,{variant:"contained",size:"large",startIcon:w?e.jsx(ce,{size:20,color:"inherit"}):e.jsx(rt,{}),onClick:Ne,disabled:!Ue()||w,children:w?"Running...":`Run ${b.name}`})})]}),k&&e.jsxs(sr,{ref:ve,children:[e.jsxs(p,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(m,{variant:"subtitle1",sx:{fontWeight:600},children:["Result",k.status&&e.jsx(Q,{label:k.status,size:"small",color:k.status==="completed"?"success":k.status==="failed"?"error":"default",sx:{ml:1,fontSize:"12px",height:22}})]}),e.jsxs(p,{sx:{display:"flex",gap:1,alignItems:"center"},children:[k.status==="completed"&&k.task_id&&e.jsx(at,{title:"Generate a report using this agent's output",arrow:!0,children:e.jsx(te,{size:"small",variant:"outlined",startIcon:e.jsx(ue,{fontSize:"small"}),onClick:()=>je(!0),sx:{textTransform:"none",mr:.5},"data-testid":"agent-generate-report-button",children:"Generate Report"})}),e.jsx(ft,{outputType:Te.TEXT,payload:{title:`${b.name} Result`,content:(()=>{const a=k.result||k.output;return typeof a=="string"?a:JSON.stringify(a,null,2)})()},sourceFeature:_e.AGENTS}),e.jsx(st,{size:"small",onClick:Le,"aria-label":"Copy result","data-testid":"agent-copy-result-button",children:e.jsx(wt,{fontSize:"small"})})]})]}),(()=>{const a=k.result||k.output;if(b.type==="report_analyst"&&a&&typeof a=="object")return e.jsx(ir,{output:a});const n=typeof a=="string"?a:JSON.stringify(a,null,2);return e.jsx(m,{variant:"body2",component:"pre",sx:{whiteSpace:"pre-wrap",fontFamily:"monospace",bgcolor:j(t.palette.background.default,.5),p:2,borderRadius:1,maxHeight:400,overflow:"auto"},children:n})})()]})]})]}),ye&&e.jsxs(rr,{children:[e.jsx(p,{sx:{p:2,borderBottom:`1px solid ${j(t.palette.divider,.1)}`},children:e.jsx(m,{variant:"subtitle1",sx:{fontWeight:600},children:"Task History"})}),e.jsx(p,{sx:{flex:1,overflow:"auto"},children:u.length>0?e.jsx(nt,{children:u.map(a=>{const n=a.id||a.task_id,l=(k?.id||k?.task_id)===n;return e.jsx(ot,{divider:!0,onClick:()=>{const g=K.find(P=>P.type===a.agent_type);g&&ae(g),ne(a),setTimeout(()=>ve.current?.scrollIntoView({behavior:"smooth",block:"start"}),100)},sx:{cursor:"pointer",bgcolor:l?j(t.palette.primary.main,.08):"transparent",borderLeft:l?`3px solid ${t.palette.primary.main}`:"3px solid transparent","&:hover":{bgcolor:j(t.palette.primary.main,.04)},transition:"all 0.15s cubic-bezier(0.22, 1, 0.36, 1)"},children:e.jsx(lt,{primary:a.agent_type?.replace(/_/g," ").replace(/\b\w/g,g=>g.toUpperCase()),secondary:e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:"small",label:a.status,color:a.status==="completed"?"success":a.status==="failed"?"error":"default",sx:{mr:1}}),new Date(a.created_at).toLocaleString()]})})},n)})}):e.jsx(p,{sx:{p:3,textAlign:"center"},children:e.jsx(m,{color:"text.secondary",children:"No tasks yet"})})})]})]}),C&&e.jsx(we,{severity:"error",sx:{m:2},children:C}),e.jsx(cr,{open:Oe,onClose:()=>je(!1),taskId:k?.task_id,templates:Ee,connections:De,onGenerate:async(a,n)=>{const l=await re(a,n);l&&s.show(`Report generation started! Job ID: ${l.job_id||"queued"}`,"success")}})]})}function Ir(){return Ie(),e.jsx(ur,{})}export{Ir as default};
