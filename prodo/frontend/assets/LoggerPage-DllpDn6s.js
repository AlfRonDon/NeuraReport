import{g as N,j as e,r as t,l as F,bd as k,be as O,bf as W,B as o,bg as y,bh as g,T as w,L as G,t as H,p as z,K as r,E as q,Y as U,F as Q,m as Y,S as K,M as T,C as R,A as P,o as i}from"./index-COTlR4Mk.js";import{P as V}from"./PageHeader-C65lV-AS.js";import{T as J,a as A}from"./ToggleButtonGroup-CkPncIAE.js";const _=N(e.jsx("path",{d:"M19.74 18.33C21.15 16.6 22 14.4 22 12c0-5.52-4.48-10-10-10S2 6.48 2 12s4.48 10 10 10c2.4 0 4.6-.85 6.33-2.26.27-.22.53-.46.78-.71.03-.03.05-.06.07-.08.2-.2.39-.41.56-.62M12 20c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8c0 1.85-.63 3.54-1.69 4.9l-1.43-1.43c.69-.98 1.1-2.17 1.1-3.46 0-3.31-2.69-6-6-6s-6 2.69-6 6 2.69 6 6 6c1.3 0 2.51-.42 3.49-1.13l1.42 1.42C15.54 19.37 13.85 20 12 20m1.92-7.49c.17-.66.02-1.38-.49-1.9l-.02-.02c-.77-.77-2-.78-2.78-.04-.01.01-.03.02-.05.04-.78.78-.78 2.05 0 2.83l.02.02c.52.51 1.25.67 1.91.49l1.51 1.51c-.6.36-1.29.58-2.04.58-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4c0 .73-.21 1.41-.56 2z"})),h="http://localhost:9847?embedded=true";function X(){const[x,E]=t.useState("plugin"),[f,C]=t.useState([]),[c,b]=t.useState(""),[u,L]=t.useState(!1),[S,m]=t.useState(null),[a,l]=t.useState("checking"),p=t.useRef(null),D=F(s=>s.setActiveConnectionId);t.useEffect(()=>{l("checking"),new Image;const s=setTimeout(()=>{l("offline")},5e3);return fetch(h,{mode:"no-cors"}).then(()=>{clearTimeout(s),l("online")}).catch(()=>{clearTimeout(s),l("offline")}),()=>clearTimeout(s)},[]),t.useEffect(()=>{k().then(s=>{const n=(s?.connections||[]).filter(j=>j.db_type==="postgresql"||j.db_type==="postgres");C(n),n.length>0&&!c&&b(n[0].id)}).catch(()=>{})},[]);const I=t.useCallback(async()=>{L(!0),m(null);try{const n=(await O())?.databases||[];if(n.length===0){m("No Logger databases found on the network.");return}for(const d of n)try{await W({name:d.name,dbType:"postgresql",dbUrl:d.db_url,database:d.database,status:"connected"})}catch{}const v=((await k())?.connections||[]).filter(d=>d.db_type==="postgresql"||d.db_type==="postgres");C(v),v.length>0&&!c&&b(v[0].id)}catch(s){m(s?.message||"Discovery failed")}finally{L(!1)}},[c]),M=t.useCallback(()=>{p.current&&(p.current.src=p.current.src)},[]),B=t.useCallback(s=>{b(s),D(s)},[D]);return e.jsxs(o,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column"},children:[e.jsx(V,{title:"Logger",subtitle:"PLC data logger — device management, schemas, and data pipeline",icon:e.jsx(y,{})}),e.jsxs(o,{sx:{px:4,py:2,maxWidth:1400,mx:"auto",width:"100%",flex:1,display:"flex",flexDirection:"column"},children:[e.jsxs(g,{sx:{mb:2,display:"flex",alignItems:"center",gap:2,flexWrap:"wrap",py:1.5},children:[e.jsxs(J,{value:x,exclusive:!0,onChange:(s,n)=>n&&E(n),size:"small",children:[e.jsx(A,{value:"plugin",children:e.jsx(w,{title:"Logger Dashboard — full device management UI",children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(G,{sx:{fontSize:18}}),e.jsx("span",{children:"Dashboard"})]})})}),e.jsx(A,{value:"data",children:e.jsx(w,{title:"Data Pipeline — select Logger database for reports & templates",children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(H,{sx:{fontSize:18}}),e.jsx("span",{children:"Data Pipeline"})]})})})]}),x==="plugin"&&e.jsxs(e.Fragment,{children:[e.jsx(z,{size:"small",label:a==="online"?"Logger Online":a==="checking"?"Checking...":"Logger Offline",color:a==="online"?"success":a==="checking"?"default":"error",variant:"outlined"}),e.jsx(r,{variant:"text",startIcon:e.jsx(q,{}),onClick:M,size:"small",disabled:a!=="online",children:"Refresh"}),e.jsx(r,{variant:"text",startIcon:e.jsx(U,{}),onClick:()=>window.open(h,"_blank"),size:"small",children:"Open in New Tab"})]}),x==="data"&&e.jsxs(e.Fragment,{children:[e.jsxs(Q,{size:"small",sx:{minWidth:300},children:[e.jsx(Y,{children:"Logger Database"}),e.jsxs(K,{value:c,label:"Logger Database",onChange:s=>B(s.target.value),children:[f.length===0&&e.jsx(T,{value:"",disabled:!0,children:"No PostgreSQL connections"}),f.map(s=>e.jsx(T,{value:s.id,children:s.name},s.id))]})]}),e.jsx(r,{variant:"outlined",startIcon:u?e.jsx(R,{size:16}):e.jsx(_,{}),onClick:I,disabled:u,size:"small",children:u?"Discovering...":"Discover Logger"})]})]}),S&&e.jsx(P,{severity:"warning",sx:{mb:2,borderRadius:2},onClose:()=>m(null),children:S}),x==="plugin"&&e.jsxs(o,{sx:{flex:1,minHeight:0,display:"flex",flexDirection:"column"},children:[a==="checking"&&e.jsxs(g,{sx:{textAlign:"center",py:6,flex:1},children:[e.jsx(R,{sx:{mb:2}}),e.jsx(i,{variant:"body1",color:"text.secondary",children:"Connecting to Logger..."})]}),a==="offline"&&e.jsxs(g,{sx:{textAlign:"center",py:6,flex:1},children:[e.jsx(y,{sx:{fontSize:64,color:"text.disabled",mb:2}}),e.jsx(i,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Logger Not Available"}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{mb:3,maxWidth:500,mx:"auto"},children:["The Logger frontend at ",e.jsx("strong",{children:h})," is not reachable. Make sure the Logger service is running."]}),e.jsx(r,{variant:"outlined",onClick:()=>{l("checking"),fetch(h,{mode:"no-cors"}).then(()=>l("online")).catch(()=>l("offline"))},children:"Retry Connection"})]}),a==="online"&&e.jsx(o,{sx:{flex:1,minHeight:600,borderRadius:2,overflow:"hidden",border:"1px solid",borderColor:"divider"},children:e.jsx("iframe",{ref:p,src:h,title:"Logger Dashboard",style:{width:"100%",height:"100%",border:"none",display:"block",minHeight:600}})})]}),x==="data"&&e.jsx(e.Fragment,{children:c?e.jsxs(g,{children:[e.jsx(i,{variant:"h6",fontWeight:600,sx:{mb:2},children:"Data Pipeline Integration"}),e.jsxs(P,{severity:"info",sx:{mb:3,borderRadius:2},children:["This Logger database is available as a data source throughout NeuraReport. You can select it in the ",e.jsx("strong",{children:"Reports"})," page, ",e.jsx("strong",{children:"Template Creator"}),", and any feature that uses the Data Source selector."]}),e.jsx(o,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:2},children:f.filter(s=>s.id===c).map(s=>e.jsxs(g,{sx:{"&:hover":{transform:"none"}},children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,sx:{mb:1},children:s.name}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{fontFamily:"monospace",fontSize:"0.75rem",mb:1},children:s.db_type}),e.jsx(z,{size:"small",label:s.status||"connected",color:s.status==="connected"||!s.status?"success":"default",variant:"outlined"})]},s.id))}),e.jsxs(o,{sx:{mt:3,display:"flex",gap:2},children:[e.jsx(r,{variant:"outlined",onClick:()=>window.location.href="/neurareport/reports",size:"small",children:"Go to Reports"}),e.jsx(r,{variant:"outlined",onClick:()=>window.location.href="/neurareport/templates/create",size:"small",children:"Create Template"}),e.jsx(r,{variant:"outlined",onClick:()=>window.location.href="/neurareport/connections",size:"small",children:"Manage Connections"})]})]}):e.jsxs(g,{sx:{textAlign:"center",py:6},children:[e.jsx(y,{sx:{fontSize:64,color:"text.disabled",mb:2}}),e.jsx(i,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Logger Database Selected"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:3},children:'Select an existing PostgreSQL connection or click "Discover Logger" to find Logger databases. Once connected, you can use Logger data in templates and reports.'}),e.jsx(r,{variant:"contained",startIcon:e.jsx(_,{}),onClick:I,disabled:u,children:"Discover Logger Databases"})]})})]})]})}function se(){return e.jsx(X,{})}export{se as default};
