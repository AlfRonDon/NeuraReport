import{g as Qe,j as e,u as Be,v as Ne,a as ye,l as Q,b1 as de,r as s,R as g,I as y,B as a,o as i,p as D,n as W,b2 as x,t as M,f,a7 as qe,a6 as He,T as w,e as T,E as Me,G as $e,ah as B,aj as N,al as q,aJ as h,am as H,K as m,C as ue,aY as xe,P as he,A as Ve,N as C,b3 as Pe}from"./index-COTlR4Mk.js";import{T as Ue,a as me}from"./Tabs-BjIVdfAN.js";import{C as fe}from"./Cloud-CH0KxCqx.js";import{G as I}from"./Grid-BMfuCMsI.js";import{C as Ce}from"./CardContent-Cdyni_Bl.js";import{C as pe}from"./CardActions-D_cqDeyn.js";import{C as Ge}from"./Code-CjS1zJxo.js";import"./KeyboardArrowRight-C1lIa1Bi.js";const Ye=Qe(e.jsx("path",{d:"M14 9v2h-3V9H8.5V7H11V1H4v6h2.5v2H4v6h2.5v2H4v6h7v-6H8.5v-2H11v-2h3v2h7V9z"})),Fe=C(a)(({theme:n})=>({display:"flex",flexDirection:"column",height:"calc(100vh - 64px)",backgroundColor:n.palette.background.default})),Xe=C(a)(({theme:n})=>({padding:n.spacing(3),borderBottom:`1px solid ${f(n.palette.divider,.1)}`,backgroundColor:f(n.palette.background.paper,.8)})),Je=C(a)(({theme:n})=>({flex:1,overflow:"auto",padding:n.spacing(3)})),be=C(Pe)(({theme:n})=>({height:"100%",display:"flex",flexDirection:"column",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{transform:"translateY(-4px)",boxShadow:`0 8px 30px ${f(n.palette.text.primary,.15)}`}})),Ze=C(a)(({theme:n})=>({width:48,height:48,borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:n.spacing(2)})),Ke=C(D)(({theme:n,status:r})=>({borderRadius:6,fontWeight:500,...r==="connected"&&{backgroundColor:n.palette.mode==="dark"?f(n.palette.text.primary,.1):W[200],color:n.palette.text.secondary},...r==="error"&&{backgroundColor:n.palette.mode==="dark"?f(n.palette.text.primary,.08):W[100],color:n.palette.text.secondary}})),je=C(m)(({theme:n})=>({borderRadius:8,textTransform:"none",fontWeight:500})),ge={database:{label:"Databases",icon:M,connectors:[{id:"postgresql",name:"PostgreSQL",color:x.slate[600]},{id:"mysql",name:"MySQL",color:x.cyan[700]},{id:"mongodb",name:"MongoDB",color:x.emerald[500]},{id:"sqlserver",name:"SQL Server",color:x.rose[600]},{id:"bigquery",name:"BigQuery",color:x.cyan[500]},{id:"snowflake",name:"Snowflake",color:x.cyan[400]}]},cloud_storage:{label:"Cloud Storage",icon:fe,connectors:[{id:"google_drive",name:"Google Drive",color:x.cyan[500]},{id:"dropbox",name:"Dropbox",color:x.violet[500]},{id:"s3",name:"Amazon S3",color:x.fuchsia[500]},{id:"azure_blob",name:"Azure Blob",color:x.teal[500]},{id:"onedrive",name:"OneDrive",color:x.slate[500]}]}};function et(){const n=Be(),r=Ne(),{execute:u}=ye(),R=Q(t=>t.addSavedConnection),_=Q(t=>t.setSavedConnections),A=Q(t=>t.removeSavedConnection),{connectorTypes:tt,connections:E,currentConnection:st,schema:$,queryResult:v,loading:ve,testing:V,querying:P,error:U,fetchConnectorTypes:G,fetchConnections:Y,testConnection:F,createConnection:X,deleteConnection:J,checkHealth:Z,fetchSchema:K,executeQuery:ee,reset:k}=de(),[te,Se]=s.useState(0),[Ee,z]=s.useState(!1),[d,O]=s.useState(null),[p,se]=s.useState(""),[c,b]=s.useState({}),[ke,ne]=s.useState(!1),[S,oe]=s.useState(""),[we,ae]=s.useState(!1);s.useEffect(()=>(G(),Y().then(()=>{const t=de.getState().connections;t?.length>0&&_&&_(t)}),()=>k()),[G,Y,k,_]);const l=s.useCallback((t,o,L={})=>u({type:y.EXECUTE,label:t,reversibility:g.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"connectors",...L},action:o}),[u]),Te=s.useCallback(t=>l("Open connector setup",()=>{O(t),se(""),b({}),z(!0)},{connectorId:t?.id}),[l]),re=s.useCallback(()=>l("Close connector setup",()=>z(!1)),[l]),Ie=s.useCallback(()=>{if(d)return u({type:y.EXECUTE,label:"Test connection",reversibility:g.SYSTEM_MANAGED,intent:{source:"connectors",connectorId:d.id},action:async()=>{const t=await F(d.id,c);return t?.success?r.show("Connection successful!","success"):r.show(`Connection failed: ${t?.error||"Unknown error"}`,"error"),t}})},[c,u,d,F,r]),De=s.useCallback(()=>{if(!(!d||!p))return u({type:y.CREATE,label:"Create connection",reversibility:g.SYSTEM_MANAGED,intent:{source:"connectors",connectorId:d.id,name:p},action:async()=>{const t=await X(d.id,p,c);return t&&(R&&R(t),z(!1),O(null),r.show("Connection created successfully","success")),t}})},[R,c,p,X,u,d,r]),We=s.useCallback(t=>u({type:y.DELETE,label:"Delete connection",reversibility:g.SYSTEM_MANAGED,intent:{source:"connectors",connectionId:t},action:async()=>{const o=await J(t);return o&&(A&&A(t),r.show("Connection deleted","success")),o}}),[J,u,A,r]),Re=s.useCallback(t=>u({type:y.EXECUTE,label:"Check connection health",reversibility:g.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"connectors",connectionId:t},action:async()=>{const o=await Z(t);return o?.success?r.show("Connection is healthy","success"):r.show(`Health check failed: ${o?.error}`,"error"),o}}),[Z,u,r]),_e=s.useCallback(t=>l("View schema",async()=>{await K(t),ae(!0)},{connectionId:t}),[l,K]),le=s.useCallback(()=>l("Close schema",()=>ae(!1)),[l]),Ae=s.useCallback(t=>l("Open query runner",()=>{O(t),oe(""),ne(!0)},{connectionId:t?.id}),[l]),ce=s.useCallback(()=>l("Close query runner",()=>ne(!1)),[l]),ze=s.useCallback(()=>{if(!(!d||!S))return u({type:y.EXECUTE,label:"Execute query",reversibility:g.IRREVERSIBLE,requiresConfirmation:!1,blocksNavigation:!0,intent:{source:"connectors",connectionId:d.id},action:async()=>{const t=await ee(d.id,S);return t?.error?r.show(`Query error: ${t.error}`,"error"):r.show(`Query executed: ${t?.row_count||0} rows`,"success"),t}})},[u,ee,S,d,r]),ie=s.useCallback(t=>l("Switch connector tab",()=>Se(t),{tab:t}),[l]),Oe=s.useCallback(()=>l("Dismiss connector error",()=>k()),[l,k]),Le=Object.keys(ge);return e.jsxs(Fe,{children:[e.jsxs(Xe,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(a,{children:[e.jsx(i,{variant:"h5",sx:{fontWeight:600},children:"Data Connectors"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:"Connect to databases and cloud storage services"})]}),e.jsx(D,{label:`${E.length} connections`,variant:"outlined",sx:{borderColor:n.palette.mode==="dark"?W[500]:W[700],color:"text.secondary"}})]}),e.jsxs(Ue,{value:te,onChange:(t,o)=>ie(o),sx:{mt:2},children:[e.jsx(me,{label:"Available Connectors"}),e.jsx(me,{label:`My Connections (${E.length})`})]})]}),e.jsx(Je,{children:te===0?e.jsx(a,{children:Le.map(t=>{const o=ge[t],L=o.icon;return e.jsxs(a,{sx:{mb:4},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(L,{color:"inherit",sx:{color:"text.secondary"}}),e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:o.label})]}),e.jsx(I,{container:!0,spacing:2,children:o.connectors.map(j=>e.jsx(I,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(be,{variant:"outlined",children:[e.jsxs(Ce,{children:[e.jsx(Ze,{sx:{bgcolor:f(j.color,.1)},children:t==="database"?e.jsx(M,{sx:{color:j.color}}):e.jsx(fe,{sx:{color:j.color}})}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600},children:j.name}),e.jsx(i,{variant:"caption",color:"text.secondary",children:t==="database"?"Database":"Cloud Storage"})]}),e.jsx(pe,{sx:{mt:"auto",p:2,pt:0},children:e.jsx(je,{fullWidth:!0,variant:"outlined",size:"small",onClick:()=>Te(j),"data-testid":"connector-connect-button",children:"Connect"})})]})},j.id))})]},t)})}):e.jsx(a,{children:E.length>0?e.jsx(I,{container:!0,spacing:2,children:E.map(t=>e.jsx(I,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(be,{children:[e.jsxs(Ce,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[e.jsxs(a,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600},children:t.name}),e.jsx(i,{variant:"caption",color:"text.secondary",children:t.connector_type})]}),e.jsx(Ke,{size:"small",status:t.status,label:t.status,icon:t.status==="connected"?e.jsx(qe,{}):e.jsx(He,{})})]}),t.latency_ms&&e.jsxs(i,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["Latency: ",t.latency_ms.toFixed(0),"ms"]})]}),e.jsxs(pe,{sx:{p:2,pt:0,gap:1},children:[e.jsx(w,{title:"Test connection",children:e.jsx(T,{size:"small",onClick:()=>Re(t.id),children:e.jsx(Me,{})})}),e.jsx(w,{title:"View schema",children:e.jsx(T,{size:"small",onClick:()=>_e(t.id),children:e.jsx(Ye,{})})}),e.jsx(w,{title:"Run query",children:e.jsx(T,{size:"small",onClick:()=>Ae(t),children:e.jsx(Ge,{})})}),e.jsx(a,{sx:{flex:1}}),e.jsx(w,{title:"Delete",children:e.jsx(T,{size:"small",sx:{color:"text.secondary"},onClick:()=>We(t.id),children:e.jsx($e,{})})})]})]})},t.id))}):e.jsxs(a,{sx:{textAlign:"center",py:8},children:[e.jsx(M,{sx:{fontSize:64,color:"text.disabled",mb:2}}),e.jsx(i,{variant:"h6",sx:{mb:1},children:"No connections yet"}),e.jsx(i,{color:"text.secondary",sx:{mb:3},children:"Connect to a database or cloud storage to get started."}),e.jsx(je,{variant:"contained",onClick:()=>ie(0),children:"Browse Connectors"})]})})}),e.jsxs(B,{open:Ee,onClose:re,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(N,{children:["Connect to ",d?.name]}),e.jsxs(q,{children:[e.jsx(h,{fullWidth:!0,label:"Connection Name",value:p,onChange:t=>se(t.target.value),sx:{mt:2,mb:2}}),e.jsx(h,{fullWidth:!0,label:"Host",value:c.host||"",onChange:t=>b({...c,host:t.target.value}),sx:{mb:2}}),e.jsx(h,{fullWidth:!0,label:"Port",type:"number",value:c.port||"",onChange:t=>b({...c,port:parseInt(t.target.value)}),sx:{mb:2}}),e.jsx(h,{fullWidth:!0,label:"Database",value:c.database||"",onChange:t=>b({...c,database:t.target.value}),sx:{mb:2}}),e.jsx(h,{fullWidth:!0,label:"Username",value:c.username||"",onChange:t=>b({...c,username:t.target.value}),sx:{mb:2}}),e.jsx(h,{fullWidth:!0,label:"Password",type:"password",value:c.password||"",onChange:t=>b({...c,password:t.target.value})})]}),e.jsxs(H,{sx:{p:2},children:[e.jsx(m,{onClick:re,children:"Cancel"}),e.jsx(m,{variant:"outlined",onClick:Ie,disabled:V,startIcon:V?e.jsx(ue,{size:16}):e.jsx(xe,{}),children:"Test"}),e.jsx(m,{variant:"contained",onClick:De,disabled:!p||ve,"data-testid":"connector-create-button",children:"Connect"})]})]}),e.jsxs(B,{open:ke,onClose:ce,maxWidth:"md",fullWidth:!0,children:[e.jsx(N,{children:"Run Query"}),e.jsxs(q,{children:[e.jsx(h,{fullWidth:!0,multiline:!0,rows:6,label:"SQL Query",value:S,onChange:t=>oe(t.target.value),placeholder:"SELECT * FROM table_name LIMIT 100",sx:{mt:2}}),v&&e.jsxs(a,{sx:{mt:2},children:[e.jsxs(i,{variant:"subtitle2",sx:{mb:1},children:["Results (",v.row_count," rows, ",v.execution_time_ms?.toFixed(0),"ms)"]}),e.jsx(he,{variant:"outlined",sx:{p:2,maxHeight:300,overflow:"auto"},children:v.columns?.length>0?e.jsx(a,{component:"pre",sx:{fontSize:12,m:0},children:JSON.stringify(v.rows?.slice(0,10),null,2)}):e.jsx(i,{color:"text.secondary",children:"No results"})})]})]}),e.jsxs(H,{children:[e.jsx(m,{onClick:ce,children:"Close"}),e.jsx(m,{variant:"contained",onClick:ze,disabled:!S||P,startIcon:P?e.jsx(ue,{size:16}):e.jsx(xe,{}),children:"Execute"})]})]}),e.jsxs(B,{open:we,onClose:le,maxWidth:"md",fullWidth:!0,children:[e.jsx(N,{children:"Database Schema"}),e.jsx(q,{children:$?.tables?.length>0?e.jsx(a,{sx:{mt:2},children:$.tables.map(t=>e.jsxs(he,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsxs(i,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:[t.name,t.row_count&&e.jsx(D,{size:"small",label:`${t.row_count} rows`,sx:{ml:1}})]}),e.jsx(a,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:t.columns?.map(o=>e.jsx(D,{size:"small",variant:"outlined",label:`${o.name}: ${o.data_type}`},o.name))})]},t.name))}):e.jsx(i,{color:"text.secondary",sx:{mt:2},children:"No schema information available"})}),e.jsx(H,{children:e.jsx(m,{onClick:le,children:"Close"})})]}),U&&e.jsx(Ve,{severity:"error",onClose:Oe,sx:{position:"fixed",bottom:16,right:16,maxWidth:400},children:U})]})}function ut(){return ye(),e.jsx(et,{})}export{ut as default};
