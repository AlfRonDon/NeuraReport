import{g as G,j as e,ad as L,r as s,l as $,B as n,o as i,K as q,b4 as F,C as O,p as u,t as V,aJ as Q,b5 as J,b6 as K,T as U,e as X,E as Y,N as y,f as b,a as Z}from"./index-COTlR4Mk.js";import{P as h}from"./PageHeader-C65lV-AS.js";import{r as ee,V as te,W as ne}from"./WidgetRenderer-TOHO749H.js";import"./MoreVert-C6fI3_5K.js";import"./Fullscreen-9PYix0sL.js";import"./TrendingUp-iS6-zk1M.js";import"./TrendingDown-BblVF55f.js";import"./TrendingFlat-D7qu-L__.js";import"./Lock-BbyCXl5N.js";import"./Hub-CA-9CjKl.js";const oe=G(e.jsx("path",{d:"M17 7h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.43-.98 2.63-2.31 2.98l1.46 1.46C20.88 15.61 22 13.95 22 12c0-2.76-2.24-5-5-5m-1 4h-2.19l2 2H16zM2 4.27l3.11 3.11C3.29 8.12 2 9.91 2 12c0 2.76 2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1 0-1.59 1.21-2.9 2.76-3.07L8.73 11H8v2h2.73L13 15.27V17h1.73l4.01 4L20 19.74 3.27 3z"})),se=80,ie=y(n)({display:"grid",gridTemplateColumns:"repeat(12, 1fr)",gridAutoRows:se,gap:12,width:"100%"}),ae=y(n)(({theme:o})=>({position:"relative",borderRadius:10,border:`1px solid ${b(o.palette.divider,.12)}`,backgroundColor:o.palette.background.paper,overflow:"hidden",transition:"box-shadow 0.2s cubic-bezier(0.22, 1, 0.36, 1), border-color 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{boxShadow:`0 4px 24px ${b(o.palette.common.black,.08)}`,borderColor:b(o.palette.primary.main,.3)}})),re=y(n)(({theme:o})=>({position:"absolute",bottom:0,left:0,right:0,padding:o.spacing(.75,1.5),background:`linear-gradient(transparent, ${b(o.palette.background.paper,.92)})`,display:"flex",alignItems:"center",gap:o.spacing(.5),opacity:0,transition:"opacity 0.2s cubic-bezier(0.22, 1, 0.36, 1)",".MuiBox-root:hover > &":{opacity:1}}));function le(){const o=L(),[d,R]=s.useState([]),[a,_]=s.useState(null),[p,k]=s.useState(null),[m,v]=s.useState(!1),[C,w]=s.useState(null),[f,A]=s.useState("overview"),r=$(t=>t.activeConnectionId),g=$(t=>t.activeConnection)?.name||r||"",l=s.useCallback(()=>{r&&(v(!0),w(null),ee({connectionId:r,query:f,maxWidgets:12}).then(t=>{R(t.widgets||[]),_(t.grid||null),k(t.profile||null)}).catch(t=>{console.error("[WidgetsPage] Recommendation failed:",t),w(t.userMessage||t.message||"Failed to get widget recommendations")}).finally(()=>{v(!1)}))},[r,f]);s.useEffect(()=>{l()},[l]);const T=s.useCallback(t=>{t.preventDefault(),l()},[l]),B=s.useMemo(()=>{const t={};if(a?.cells)for(const x of a.cells)t[x.widget_id]=x;return t},[a]);if(!r)return e.jsxs(n,{sx:{p:3,maxWidth:1400,mx:"auto"},children:[e.jsx(h,{title:"Widget Intelligence",description:"Dynamic data-driven widget recommendations"}),e.jsxs(n,{sx:{py:10,textAlign:"center",border:1,borderColor:"divider",borderRadius:2,borderStyle:"dashed"},children:[e.jsx(oe,{sx:{fontSize:48,color:"text.disabled",mb:2}}),e.jsx(i,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No database connected"}),e.jsx(i,{variant:"body2",color:"text.disabled",sx:{mb:2},children:"Connect a database from the Connections page to see intelligent widget recommendations tailored to your data."}),e.jsx(q,{variant:"contained",startIcon:e.jsx(F,{}),onClick:()=>o("/connections"),sx:{textTransform:"none"},children:"Go to Connections"})]})]});if(m&&d.length===0)return e.jsxs(n,{sx:{p:3,maxWidth:1400,mx:"auto"},children:[e.jsx(h,{title:"Widget Intelligence",description:`Analyzing ${g}...`}),e.jsxs(n,{sx:{py:8,display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[e.jsx(O,{}),e.jsx(i,{variant:"body2",color:"text.secondary",children:"Analyzing database schema and recommending widgets..."})]})]});if(C&&d.length===0)return e.jsxs(n,{sx:{p:3,maxWidth:1400,mx:"auto"},children:[e.jsx(h,{title:"Widget Intelligence",description:g}),e.jsxs(n,{sx:{py:8,textAlign:"center"},children:[e.jsx(i,{variant:"h6",color:"error",gutterBottom:!0,children:"Recommendation failed"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:2},children:C}),e.jsx(u,{label:"Retry",onClick:l,color:"primary",clickable:!0})]})]});const W=p?[`${p.table_count} tables`,`${p.numeric_columns} numeric cols`,p.has_timeseries?"timeseries":"no timeseries"]:[];return e.jsxs(n,{sx:{p:3,maxWidth:1400,mx:"auto"},children:[e.jsx(h,{title:"Widget Intelligence",description:`${d.length} widgets recommended for ${g}`}),W.length>0&&e.jsxs(n,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[e.jsx(u,{icon:e.jsx(V,{}),label:g,size:"small",color:"primary",variant:"outlined"}),W.map(t=>e.jsx(u,{label:t,size:"small",variant:"outlined"},t))]}),e.jsxs(n,{component:"form",onSubmit:T,sx:{display:"flex",alignItems:"center",gap:1,mb:3},children:[e.jsx(Q,{size:"small",placeholder:"Describe what you want to see... (e.g. 'show trends and alerts')",value:f,onChange:t=>A(t.target.value),slotProps:{input:{startAdornment:e.jsx(J,{position:"start",children:e.jsx(K,{sx:{fontSize:18}})})}},sx:{flex:1,minWidth:240}}),e.jsx(U,{title:"Refresh recommendations",children:e.jsx(X,{onClick:l,disabled:m,size:"small",children:e.jsx(Y,{sx:{animation:m?"spin 1s linear infinite":"none"}})})})]}),e.jsx(ie,{children:d.map(t=>{const{id:x,scenario:I,variant:j,question:N,relevance:S,size:z}=t,c=B[x],P=te[j]?.label||j||I,M={compact:3,normal:4,expanded:6,hero:12},E={compact:3,normal:4,expanded:4,hero:5},H=c?`${c.col_start} / ${c.col_end}`:`span ${M[z]||4}`,D=c?`${c.row_start} / ${c.row_end}`:`span ${E[z]||4}`;return e.jsxs(ae,{sx:{gridColumn:H,gridRow:D},children:[e.jsx(n,{sx:{height:"100%",width:"100%"},children:e.jsx(ne,{scenario:I,variant:j,connectionId:r,showSourceBadge:!0})}),e.jsxs(re,{children:[e.jsx(i,{variant:"caption",sx:{fontWeight:600,flex:1},noWrap:!0,children:N||P}),e.jsx(u,{label:`${Math.round(S*100)}%`,size:"small",color:S>.8?"success":"default",variant:"outlined",sx:{height:18,fontSize:"10px"}})]})]},x)})}),d.length===0&&!m&&e.jsxs(n,{sx:{py:8,textAlign:"center"},children:[e.jsx(i,{variant:"body1",color:"text.secondary",children:"No widgets recommended for this database."}),e.jsx(i,{variant:"caption",color:"text.disabled",children:"Try a different query or check your database connection."})]}),a&&e.jsx(n,{sx:{mt:2,display:"flex",justifyContent:"flex-end"},children:e.jsxs(i,{variant:"caption",color:"text.disabled",children:[a.total_cols,"×",a.total_rows," grid · ",a.utilization_pct,"% utilization"]})})]})}function ve(){return Z(),e.jsx(le,{})}export{ve as default};
