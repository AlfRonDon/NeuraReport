import{r as a,a8 as H,a9 as J,aa as q,j as e,ab as B,ac as G,N as F,g as ce,dg as $e,at as X,ar as oe,as as Se,P as Ce,q as y,o as f,B as $,aZ as Le,a7 as Ne,p as E,K as _,bS as De,A as O,n as Ie,f as Z,aV as xe,bM as he,a2 as me,dh as Fe,bb as We,b3 as _e,v as Ue,a as Be,w as Ve,R as Q,I as K,E as Oe,b0 as He,b2 as be,s as ee,C as ge,a4 as Je,ak as qe,aJ as Ge}from"./index-DeRHNZar.js";import{v as Xe,Z as Ye,u as ve,s as Qe,n as Ke,I as Ze}from"./ZoomableChart-RyAmiUQg.js";import{C as et}from"./CheckCircleOutline-BoLve1SG.js";import{F as tt}from"./InsertDriveFile--FIx5auZ.js";import{I as nt}from"./Insights-mNpDbl8c.js";import{G as fe}from"./Grid-C8zRHJnX.js";import{T as st,a as ae}from"./Tabs-te2tfeGq.js";import{A as ot,a as at,b as rt}from"./AccordionSummary-C2JzanVw.js";import{T as we}from"./TableContainer-BIUEnX5e.js";import{T as ze,a as Ae,b as te,c as W,d as Re}from"./TableRow-8TKLtwpY.js";import{C as lt}from"./CardContent-B7RWOLhy.js";import{S as je}from"./Surface-rMw-iPc-.js";import{C as it}from"./ConnectionSelector-DMISq3nq.js";import{T as ct}from"./TemplateSelector-25CXlVHt.js";import{S as dt}from"./Switch-DE_06Ex2.js";import"./PieChart-CHoWBHnY.js";import"./string-GBVq1Gk0.js";import"./index-Chjiymov.js";import"./band-CquvqAHh.js";import"./init-Dmth1JHB.js";import"./ordinal-DILIJJjt.js";import"./linear-Btwmcagj.js";import"./defaultLocale-DX6XiGOO.js";import"./time-BWVVNhLt.js";import"./KeyboardArrowRight-B-zFI2kH.js";const ne=a.createContext({}),de=a.createContext({});function pt(t){return H("MuiStep",t)}J("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const ut=t=>{const{classes:n,orientation:s,alternativeLabel:l,completed:c}=t;return G({root:["root",s,l&&"alternativeLabel",c&&"completed"]},pt,n)},xt=F("div",{name:"MuiStep",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.root,n[s.orientation],s.alternativeLabel&&n.alternativeLabel,s.completed&&n.completed]}})({variants:[{props:{orientation:"horizontal"},style:{paddingLeft:8,paddingRight:8}},{props:{alternativeLabel:!0},style:{flex:1,position:"relative"}}]}),ht=a.forwardRef(function(n,s){const l=q({props:n,name:"MuiStep"}),{active:c,children:r,className:m,component:u="div",completed:b,disabled:v,expanded:x=!1,index:d,last:h,...j}=l,{activeStep:S,connector:I,alternativeLabel:w,orientation:z,nonLinear:p}=a.useContext(ne);let[o=!1,g=!1,C=!1]=[c,b,v];S===d?o=c!==void 0?c:!0:!p&&S>d?g=b!==void 0?b:!0:!p&&S<d&&(C=v!==void 0?v:!0);const A=a.useMemo(()=>({index:d,last:h,expanded:x,icon:d+1,active:o,completed:g,disabled:C}),[d,h,x,o,g,C]),k={...l,active:o,orientation:z,alternativeLabel:w,completed:g,disabled:C,expanded:x,component:u},T=ut(k),D=e.jsxs(xt,{as:u,className:B(T.root,m),ref:s,ownerState:k,...j,children:[I&&w&&d!==0?I:null,r]});return e.jsx(de.Provider,{value:A,children:I&&!w&&d!==0?e.jsxs(a.Fragment,{children:[I,D]}):D})}),mt=ce(e.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"})),bt=ce(e.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}));function gt(t){return H("MuiStepIcon",t)}const re=J("MuiStepIcon",["root","active","completed","error","text"]);var ye;const vt=t=>{const{classes:n,active:s,completed:l,error:c}=t;return G({root:["root",s&&"active",l&&"completed",c&&"error"],text:["text"]},gt,n)},le=F($e,{name:"MuiStepIcon",slot:"Root"})(X(({theme:t})=>({display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),color:(t.vars||t).palette.text.disabled,[`&.${re.completed}`]:{color:(t.vars||t).palette.primary.main},[`&.${re.active}`]:{color:(t.vars||t).palette.primary.main},[`&.${re.error}`]:{color:(t.vars||t).palette.error.main}}))),ft=F("text",{name:"MuiStepIcon",slot:"Text"})(X(({theme:t})=>({fill:(t.vars||t).palette.primary.contrastText,fontSize:t.typography.caption.fontSize,fontFamily:t.typography.fontFamily}))),jt=a.forwardRef(function(n,s){const l=q({props:n,name:"MuiStepIcon"}),{active:c=!1,className:r,completed:m=!1,error:u=!1,icon:b,...v}=l,x={...l,active:c,completed:m,error:u},d=vt(x);if(typeof b=="number"||typeof b=="string"){const h=B(r,d.root);return u?e.jsx(le,{as:bt,className:h,ref:s,ownerState:x,...v}):m?e.jsx(le,{as:mt,className:h,ref:s,ownerState:x,...v}):e.jsxs(le,{className:h,ref:s,ownerState:x,...v,children:[ye||(ye=e.jsx("circle",{cx:"12",cy:"12",r:"12"})),e.jsx(ft,{className:d.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:x,children:b})]})}return b});function yt(t){return H("MuiStepLabel",t)}const U=J("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),St=t=>{const{classes:n,orientation:s,active:l,completed:c,error:r,disabled:m,alternativeLabel:u}=t;return G({root:["root",s,r&&"error",m&&"disabled",u&&"alternativeLabel"],label:["label",l&&"active",c&&"completed",r&&"error",m&&"disabled",u&&"alternativeLabel"],iconContainer:["iconContainer",l&&"active",c&&"completed",r&&"error",m&&"disabled",u&&"alternativeLabel"],labelContainer:["labelContainer",u&&"alternativeLabel"]},yt,n)},Ct=F("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.root,n[s.orientation]]}})({display:"flex",alignItems:"center",[`&.${U.alternativeLabel}`]:{flexDirection:"column"},[`&.${U.disabled}`]:{cursor:"default"},variants:[{props:{orientation:"vertical"},style:{textAlign:"left",padding:"8px 0"}}]}),Lt=F("span",{name:"MuiStepLabel",slot:"Label"})(X(({theme:t})=>({...t.typography.body2,display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),[`&.${U.active}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${U.completed}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${U.alternativeLabel}`]:{marginTop:16},[`&.${U.error}`]:{color:(t.vars||t).palette.error.main}}))),It=F("span",{name:"MuiStepLabel",slot:"IconContainer"})({flexShrink:0,display:"flex",paddingRight:8,[`&.${U.alternativeLabel}`]:{paddingRight:0}}),wt=F("span",{name:"MuiStepLabel",slot:"LabelContainer"})(X(({theme:t})=>({width:"100%",color:(t.vars||t).palette.text.secondary,[`&.${U.alternativeLabel}`]:{textAlign:"center"}}))),ke=a.forwardRef(function(n,s){const l=q({props:n,name:"MuiStepLabel"}),{children:c,className:r,componentsProps:m={},error:u=!1,icon:b,optional:v,slots:x={},slotProps:d={},StepIconComponent:h,StepIconProps:j,...S}=l,{alternativeLabel:I,orientation:w}=a.useContext(ne),{active:z,disabled:p,completed:o,icon:g}=a.useContext(de),C=b||g;let A=h;C&&!A&&(A=jt);const k={...l,active:z,alternativeLabel:I,completed:o,disabled:p,error:u,orientation:w},T=St(k),D={slots:x,slotProps:{stepIcon:j,...m,...d}},[M,N]=oe("root",{elementType:Ct,externalForwardedProps:{...D,...S},ownerState:k,ref:s,className:B(T.root,r)}),[R,V]=oe("label",{elementType:Lt,externalForwardedProps:D,ownerState:k}),[Y,se]=oe("stepIcon",{elementType:A,externalForwardedProps:D,ownerState:k});return e.jsxs(M,{...N,children:[C||Y?e.jsx(It,{className:T.iconContainer,ownerState:k,children:e.jsx(Y,{completed:o,active:z,error:u,icon:C,...se})}):null,e.jsxs(wt,{className:T.labelContainer,ownerState:k,children:[c?e.jsx(R,{...V,className:B(T.label,V?.className),children:c}):null,v]})]})});ke.muiName="StepLabel";function zt(t){return H("MuiStepConnector",t)}J("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const At=t=>{const{classes:n,orientation:s,alternativeLabel:l,active:c,completed:r,disabled:m}=t,u={root:["root",s,l&&"alternativeLabel",c&&"active",r&&"completed",m&&"disabled"],line:["line",`line${Se(s)}`]};return G(u,zt,n)},Rt=F("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.root,n[s.orientation],s.alternativeLabel&&n.alternativeLabel,s.completed&&n.completed]}})({flex:"1 1 auto",variants:[{props:{orientation:"vertical"},style:{marginLeft:12}},{props:{alternativeLabel:!0},style:{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"}}]}),kt=F("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.line,n[`line${Se(s.orientation)}`]]}})(X(({theme:t})=>{const n=t.palette.mode==="light"?t.palette.grey[400]:t.palette.grey[600];return{display:"block",borderColor:t.vars?t.vars.palette.StepConnector.border:n,variants:[{props:{orientation:"horizontal"},style:{borderTopStyle:"solid",borderTopWidth:1}},{props:{orientation:"vertical"},style:{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24}}]}})),Tt=a.forwardRef(function(n,s){const l=q({props:n,name:"MuiStepConnector"}),{className:c,...r}=l,{alternativeLabel:m,orientation:u="horizontal"}=a.useContext(ne),{active:b,disabled:v,completed:x}=a.useContext(de),d={...l,alternativeLabel:m,orientation:u,active:b,completed:x,disabled:v},h=At(d);return e.jsx(Rt,{className:B(h.root,c),ref:s,ownerState:d,...r,children:e.jsx(kt,{className:h.line,ownerState:d})})});function Et(t){return H("MuiStepper",t)}J("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);const Mt=t=>{const{orientation:n,nonLinear:s,alternativeLabel:l,classes:c}=t;return G({root:["root",n,s&&"nonLinear",l&&"alternativeLabel"]},Et,c)},Pt=F("div",{name:"MuiStepper",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.root,n[s.orientation],s.alternativeLabel&&n.alternativeLabel,s.nonLinear&&n.nonLinear]}})({display:"flex",variants:[{props:{orientation:"horizontal"},style:{flexDirection:"row",alignItems:"center"}},{props:{orientation:"vertical"},style:{flexDirection:"column"}},{props:{alternativeLabel:!0},style:{alignItems:"flex-start"}}]}),$t=e.jsx(Tt,{}),Nt=a.forwardRef(function(n,s){const l=q({props:n,name:"MuiStepper"}),{activeStep:c=0,alternativeLabel:r=!1,children:m,className:u,component:b="div",connector:v=$t,nonLinear:x=!1,orientation:d="horizontal",...h}=l,j={...l,nonLinear:x,alternativeLabel:r,orientation:d,component:b},S=Mt(j),I=a.Children.toArray(m).filter(Boolean),w=I.map((p,o)=>a.cloneElement(p,{index:o,last:o+1===I.length,...p.props})),z=a.useMemo(()=>({activeStep:c,alternativeLabel:r,connector:v,nonLinear:x,orientation:d}),[c,r,v,x,d]);return e.jsx(ne.Provider,{value:z,children:e.jsx(Pt,{as:b,ownerState:j,className:B(S.root,u),ref:s,...h,children:w})})}),Dt=ce(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"})),Ft=".pdf,.xlsx,.xls,.xlsm";function Wt({onFileSelect:t,isUploading:n=!1,progress:s=0,progressStage:l="",error:c=null,disabled:r=!1}){const[m,u]=a.useState(!1),[b,v]=a.useState(null),[x,d]=a.useState(null),h=a.useCallback(p=>{p.preventDefault(),p.stopPropagation(),p.type==="dragenter"||p.type==="dragover"?u(!0):p.type==="dragleave"&&u(!1)},[]),j=a.useCallback(p=>{d(null);const o=Xe(p);if(!o.valid){d(o.error),v(null);return}v(p),t?.(p)},[t]),S=a.useCallback(p=>{if(p.preventDefault(),p.stopPropagation(),u(!1),r||n)return;const o=p.dataTransfer?.files;o&&o.length>0&&j(o[0])},[r,n,j]),I=a.useCallback(p=>{const o=p.target?.files;o&&o.length>0&&j(o[0]),p.target.value=""},[j]),w=a.useCallback(()=>{v(null),d(null),t?.(null)},[t]),z=c||x;return e.jsxs(Ce,{variant:"outlined",onDragEnter:h,onDragLeave:h,onDragOver:h,onDrop:S,sx:{p:4,textAlign:"center",cursor:r||n?"default":"pointer",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)",borderStyle:"dashed",borderWidth:2,borderColor:m||z||b?"text.secondary":"divider",bgcolor:m?"action.hover":z?"error.lighter":b?"success.lighter":"background.paper","&:hover":{borderColor:r||n?void 0:"text.secondary",bgcolor:r||n?void 0:"action.hover"}},children:[e.jsx("input",{type:"file",accept:Ft,onChange:I,disabled:r||n,style:{display:"none"},id:"document-upload-input"}),n?e.jsxs(y,{spacing:2,alignItems:"center",children:[e.jsx(f,{variant:"body1",color:"text.secondary",children:l||"Analyzing document..."}),e.jsx($,{sx:{width:"100%",maxWidth:400},children:e.jsx(Le,{variant:"determinate",value:s})}),e.jsxs(f,{variant:"body2",color:"text.secondary",children:[s,"% complete"]})]}):b?e.jsxs(y,{spacing:2,alignItems:"center",children:[e.jsx(Ne,{sx:{fontSize:48,color:"text.secondary"}}),e.jsxs(y,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(tt,{color:"action"}),e.jsx(f,{variant:"body1",children:b.name}),e.jsx(E,{size:"small",label:`${(b.size/1024/1024).toFixed(2)} MB`,variant:"outlined"})]}),e.jsx(_,{variant:"outlined",size:"small",onClick:w,children:"Choose different file"})]}):e.jsx("label",{htmlFor:"document-upload-input",style:{cursor:r?"default":"pointer"},children:e.jsxs(y,{spacing:2,alignItems:"center",children:[e.jsx(De,{sx:{fontSize:48,color:"text.secondary"}}),e.jsx(f,{variant:"h6",color:"text.primary",children:"Drop a document here or click to browse"}),e.jsx(f,{variant:"body2",color:"text.secondary",children:"Supports PDF and Excel files (max 50MB)"}),e.jsxs(y,{direction:"row",spacing:1,children:[e.jsx(E,{label:"PDF",size:"small",variant:"outlined"}),e.jsx(E,{label:"XLSX",size:"small",variant:"outlined"}),e.jsx(E,{label:"XLS",size:"small",variant:"outlined"})]})]})}),z&&e.jsx(O,{severity:"error",sx:{mt:2,textAlign:"left"},children:z})]})}function ie({children:t,value:n,index:s,...l}){return e.jsx("div",{role:"tabpanel",hidden:n!==s,id:`analysis-tabpanel-${s}`,"aria-labelledby":`analysis-tab-${s}`,...l,children:n===s&&e.jsx($,{sx:{py:2},children:t})})}function _t({metric:t}){const n=(s,l)=>{if(s==null)return"N/A";if(typeof s=="number"){const c=s.toLocaleString(void 0,{maximumFractionDigits:2});return l?`${c} ${l}`:c}return String(s)};return e.jsx(_e,{variant:"outlined",children:e.jsxs(lt,{sx:{py:1.5,"&:last-child":{pb:1.5}},children:[e.jsx(f,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:t.key}),e.jsx(f,{variant:"h6",fontWeight:600,children:n(t.value,t.unit)}),t.context&&e.jsx(f,{variant:"caption",color:"text.secondary",children:t.context})]})})}function Ut({table:t,maxRows:n=50}){const s=t.rows?.slice(0,n)||[],l=(t.rows?.length||0)>n;return e.jsxs(we,{sx:{maxHeight:400},children:[e.jsxs(ze,{size:"small",stickyHeader:!0,children:[e.jsx(Ae,{children:e.jsx(te,{children:t.headers?.map((c,r)=>e.jsx(W,{sx:{fontWeight:600,bgcolor:"background.paper"},children:e.jsxs(y,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx("span",{children:c}),t.data_types?.[r]&&e.jsx(E,{label:t.data_types[r],size:"small",variant:"outlined",sx:{fontSize:"10px",height:18}})]})},r))})}),e.jsx(Re,{children:s.map((c,r)=>e.jsx(te,{hover:!0,children:c.map((m,u)=>e.jsx(W,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis"},children:m||"-"},u))},r))})]}),l&&e.jsxs(f,{variant:"caption",color:"text.secondary",sx:{p:1,display:"block"},children:["Showing ",n," of ",t.rows.length," rows"]})]})}function Bt({result:t}){const[n,s]=a.useState(0),[l,c]=a.useState(0),{document_name:r,document_type:m,processing_time_ms:u,summary:b,tables:v=[],data_points:x=[],chart_suggestions:d=[],raw_data:h=[],field_catalog:j=[],warnings:S=[]}=t||{},I=(o,g)=>{s(g)},w=()=>{if(!h||h.length===0)return;const o=Object.keys(h[0]),C=[o.join(","),...h.map(D=>o.map(M=>{const N=D[M];if(N==null)return"";const R=String(N);return R.includes(",")||R.includes('"')?`"${R.replace(/"/g,'""')}"`:R}).join(","))].join(`
`),A=new Blob([C],{type:"text/csv;charset=utf-8;"}),k=URL.createObjectURL(A),T=document.createElement("a");T.href=k,T.download=`${r||"analysis"}_data.csv`,T.click(),URL.revokeObjectURL(k)},z=()=>{if(!h||h.length===0)return;const o=JSON.stringify(h,null,2),g=new Blob([o],{type:"application/json;charset=utf-8;"}),C=URL.createObjectURL(g),A=document.createElement("a");A.href=C,A.download=`${r||"analysis"}_data.json`,A.click(),URL.revokeObjectURL(C)},p=d[l]||null;return e.jsxs($,{children:[e.jsxs(y,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsxs(y,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(f,{variant:"h6",children:r||"Analysis Results"}),e.jsx(E,{label:m?.toUpperCase(),size:"small",variant:"outlined",sx:{bgcolor:o=>o.palette.mode==="dark"?Z(o.palette.text.primary,.1):Ie[200],color:"text.secondary"}}),u&&e.jsx(E,{label:`${(u/1e3).toFixed(1)}s`,size:"small",variant:"outlined"})]}),e.jsxs(y,{direction:"row",spacing:1,children:[e.jsx(_,{startIcon:e.jsx(xe,{}),size:"small",onClick:w,disabled:!h?.length,children:"Export CSV"}),e.jsx(_,{startIcon:e.jsx(xe,{}),size:"small",onClick:z,disabled:!h?.length,children:"Export JSON"})]})]}),b&&e.jsx(O,{severity:"info",sx:{mb:2},children:b}),S.length>0&&e.jsx(O,{severity:"warning",sx:{mb:2},children:S.join("; ")}),x.length>0&&e.jsxs($,{sx:{mb:3},children:[e.jsx(f,{variant:"subtitle2",sx:{mb:1},children:"Key Metrics"}),e.jsx(fe,{container:!0,spacing:2,children:x.slice(0,8).map((o,g)=>e.jsx(fe,{size:{xs:6,sm:4,md:3},children:e.jsx(_t,{metric:o})},g))})]}),e.jsxs(Ce,{variant:"outlined",sx:{mb:3},children:[e.jsxs(st,{value:n,onChange:I,sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(ae,{icon:e.jsx(he,{}),label:`Charts (${d.length})`,iconPosition:"start"}),e.jsx(ae,{icon:e.jsx(me,{}),label:`Tables (${v.length})`,iconPosition:"start"}),e.jsx(ae,{icon:e.jsx(nt,{}),label:`Fields (${j.length})`,iconPosition:"start"})]}),e.jsx(ie,{value:n,index:0,children:d.length>0?e.jsxs($,{children:[e.jsx(y,{direction:"row",spacing:1,sx:{mb:2,flexWrap:"wrap",gap:1},children:d.map((o,g)=>e.jsx(E,{label:o.title||`Chart ${g+1}`,onClick:()=>c(g),color:l===g?"primary":"default",variant:l===g?"filled":"outlined",icon:o.type==="line"?e.jsx(Fe,{}):e.jsx(he,{})},g))}),p&&e.jsx(Ye,{data:h,spec:p,height:400,showBrush:h.length>15})]}):e.jsx(f,{color:"text.secondary",textAlign:"center",py:4,children:"No chart suggestions available"})}),e.jsx(ie,{value:n,index:1,children:v.length>0?e.jsx(y,{spacing:2,children:v.map((o,g)=>e.jsxs(ot,{defaultExpanded:g===0,children:[e.jsx(at,{expandIcon:e.jsx(We,{}),children:e.jsxs(y,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(me,{fontSize:"small",color:"action"}),e.jsx(f,{fontWeight:500,children:o.title||o.id||`Table ${g+1}`}),e.jsx(E,{label:`${o.rows?.length||0} rows`,size:"small",variant:"outlined"}),e.jsx(E,{label:`${o.headers?.length||0} cols`,size:"small",variant:"outlined"}),o.source_page&&e.jsx(E,{label:`Page ${o.source_page}`,size:"small"}),o.source_sheet&&e.jsx(E,{label:o.source_sheet,size:"small"})]})}),e.jsx(rt,{sx:{p:0},children:e.jsx(Ut,{table:o})})]},g))}):e.jsx(f,{color:"text.secondary",textAlign:"center",py:4,children:"No tables extracted"})}),e.jsx(ie,{value:n,index:2,children:j.length>0?e.jsx(we,{children:e.jsxs(ze,{size:"small",children:[e.jsx(Ae,{children:e.jsxs(te,{children:[e.jsx(W,{sx:{fontWeight:600},children:"Field Name"}),e.jsx(W,{sx:{fontWeight:600},children:"Type"}),e.jsx(W,{sx:{fontWeight:600},children:"Sample Values"})]})}),e.jsx(Re,{children:j.map((o,g)=>e.jsxs(te,{hover:!0,children:[e.jsx(W,{children:o.name}),e.jsx(W,{children:e.jsx(E,{label:o.type,size:"small",color:o.type==="numeric"?"success":o.type==="datetime"?"info":"default",variant:"outlined"})}),e.jsx(W,{children:o.sample_values?.slice(0,3).join(", ")||"-"})]},g))})]})}):e.jsx(f,{color:"text.secondary",textAlign:"center",py:4,children:"No field information available"})})]})]})}const Vt=[{label:"Upload Document",icon:e.jsx(Dt,{fontSize:"small"})},{label:"AI Analysis",icon:e.jsx(ee,{fontSize:"small"})},{label:"View Results",icon:e.jsx(Ze,{fontSize:"small"})}];function gn(){const[t,n]=a.useState(0),[s,l]=a.useState(null),[c,r]=a.useState(!1),[m,u]=a.useState(0),[b,v]=a.useState(""),[x,d]=a.useState(null),[h,j]=a.useState(null),[S,I]=a.useState(""),[w,z]=a.useState(!1),[p,o]=a.useState(!1),[g,C]=a.useState(null),[A,k]=a.useState(""),[T,D]=a.useState(""),M=a.useRef(null);a.useEffect(()=>()=>{M.current&&(M.current.abort(),M.current=null)},[]);const N=Ue(),{execute:R}=Be(),V=Ve(),Y=a.useCallback((i,L,P={})=>V(i,{label:L,intent:{from:"analyze",...P}}),[V]),se=a.useCallback(i=>{l(i),j(null),d(null),C(null),i&&n(0)},[]),Te=a.useCallback(()=>{if(s)return R({type:K.ANALYZE,label:p?"Queue analysis":"Analyze document",reversibility:Q.FULLY_REVERSIBLE,blocksNavigation:!p,suppressSuccessToast:!0,intent:{fileName:s?.name,background:p},action:async()=>{if(M.current=new AbortController,r(!0),u(0),v("Starting analysis..."),j(null),C(null),p){try{const i=await ve({file:s,background:!0,connectionId:A||void 0,templateId:T||void 0}),L=i?.job_id||i?.jobId||null;C(L),d(null),n(0),N.show("Analysis queued in background","success")}catch(i){i.name!=="AbortError"&&j(i.message||"Failed to queue analysis")}finally{r(!1),u(0),v(""),M.current=null}return}n(1);try{const i=await ve({file:s,connectionId:A||void 0,templateId:T||void 0,signal:M.current?.signal,onProgress:L=>{L.event==="stage"&&(u(L.progress||0),v(L.detail||L.stage||"Processing..."))}});i.event==="result"&&(d(i),n(2))}catch(i){i.name==="AbortError"?(N.show("Analysis cancelled","info"),n(0)):(j(i.message||"Analysis failed"),n(0))}finally{r(!1),u(100),M.current=null}}})},[R,s,p,N]),Ee=a.useCallback(()=>R({type:K.UPDATE,label:"Cancel analysis",reversibility:Q.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"analyze"},action:()=>{M.current&&(M.current.abort(),r(!1),n(0),u(0),v(""),N.show("Analysis cancelled","info"))}}),[R,N]),pe=a.useCallback(()=>{if(!(!x?.analysis_id||!S.trim()))return R({type:K.GENERATE,label:"Generate charts",reversibility:Q.FULLY_REVERSIBLE,blocksNavigation:!0,suppressSuccessToast:!0,intent:{analysisId:x.analysis_id},action:async()=>{z(!0);try{const i=await Qe(x.analysis_id,{question:S,includeSampleData:!0});if(i?.charts){const L=i.charts.map((P,Pe)=>Ke(P,Pe)).filter(Boolean);d(P=>({...P,chart_suggestions:[...L,...P.chart_suggestions||[]]}))}}catch(i){j(i.message||"Failed to generate charts")}finally{z(!1),I("")}}})},[x?.analysis_id,S,R]),Me=a.useCallback(()=>R({type:K.UPDATE,label:"Reset analysis",reversibility:Q.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"analyze"},action:()=>{l(null),d(null),j(null),n(0),I(""),C(null)}}),[R]),ue=(()=>{const i=[];if(s&&i.push({label:s.name,color:"primary",variant:"outlined"}),x){const L=x.tables?.length||0,P=x.chart_suggestions?.length||0;L>0&&i.push({label:`${L} table${L!==1?"s":""} found`,color:"success"}),P>0&&i.push({label:`${P} chart${P!==1?"s":""}`,color:"info"})}return i})();return e.jsxs($,{sx:{py:3,px:3},children:[e.jsxs(y,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:3},children:[e.jsxs($,{children:[e.jsx(f,{variant:"h5",fontWeight:600,children:"Analyze Document"}),e.jsx(f,{variant:"body2",color:"text.secondary",children:"Upload PDF or Excel files to extract tables and generate interactive visualizations."})]}),x&&e.jsx(_,{variant:"outlined",size:"small",startIcon:e.jsx(Oe,{}),onClick:Me,sx:{textTransform:"none",fontWeight:600},children:"New Analysis"})]}),e.jsxs(y,{spacing:3,children:[ue.length>0&&e.jsx(y,{direction:"row",spacing:1,flexWrap:"wrap",children:ue.map((i,L)=>e.jsx(E,{label:i.label,size:"small",variant:i.variant||"filled",icon:i.color==="success"?e.jsx(et,{}):void 0,sx:{fontWeight:500,bgcolor:P=>P.palette.mode==="dark"?Z(P.palette.text.primary,.1):Ie[200],color:"text.secondary"}},L))}),g&&e.jsxs(O,{severity:"info",action:e.jsx(_,{size:"small",onClick:()=>Y("/jobs","Open jobs"),sx:{textTransform:"none"},children:"View Jobs"}),sx:{alignItems:"center"},children:["Analysis queued in background. Job ID: ",g]}),e.jsxs(je,{sx:{p:3},children:[e.jsx(Nt,{activeStep:t,sx:{mb:3,"& .MuiStepLabel-label":{fontWeight:500},"& .MuiStepLabel-label.Mui-active":{fontWeight:600,color:"text.secondary"},"& .MuiStepLabel-label.Mui-completed":{fontWeight:600,color:"text.secondary"}},children:Vt.map((i,L)=>e.jsx(ht,{completed:t>L,children:e.jsx(ke,{StepIconProps:{sx:{"&.Mui-completed":{color:"text.secondary"},"&.Mui-active":{color:"text.secondary"}}},children:e.jsxs(y,{direction:"row",alignItems:"center",spacing:.5,children:[i.icon,e.jsx("span",{children:i.label})]})})},i.label))}),t===0&&e.jsxs($,{children:[e.jsxs(y,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},children:[e.jsx(it,{value:A,onChange:k,label:"Analyze from Connection (Optional)",size:"small",showStatus:!0}),e.jsx(ct,{value:T,onChange:D,label:"Report Template (Optional)",size:"small"})]}),e.jsx(Wt,{onFileSelect:se,isUploading:c,progress:m,progressStage:b,error:h,disabled:c}),s&&!c&&e.jsxs(y,{spacing:2,sx:{mt:3},children:[e.jsx(He,{control:e.jsx(dt,{checked:p,onChange:i=>o(i.target.checked)}),label:"Run in background",sx:{alignSelf:"center"}}),e.jsx(y,{direction:"row",justifyContent:"center",children:e.jsx(_,{variant:"contained",size:"large",onClick:Te,startIcon:e.jsx(ee,{}),sx:{px:4,py:1.5,fontWeight:600,fontSize:"1rem",textTransform:"none",borderRadius:1,boxShadow:`0 4px 14px ${Z(be.violet[500],.25)}`,"&:hover":{boxShadow:`0 6px 20px ${Z(be.violet[500],.35)}`}},children:p?"Queue Analysis":"Analyze with AI"})})]})]}),t===1&&e.jsxs($,{sx:{textAlign:"center",py:6},children:[e.jsxs($,{sx:{position:"relative",display:"inline-flex",mb:3},children:[e.jsx(ge,{size:80,thickness:4,variant:m>0?"determinate":"indeterminate",value:m,sx:{color:"text.secondary"}}),e.jsx($,{sx:{position:"absolute",top:0,left:0,bottom:0,right:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(f,{variant:"caption",fontWeight:600,color:"text.secondary",children:[m,"%"]})})]}),e.jsx(f,{variant:"h6",fontWeight:600,gutterBottom:!0,children:b||"Analyzing document..."}),e.jsx(f,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"AI is extracting tables, metrics, and generating chart suggestions"}),e.jsx(Le,{variant:"determinate",value:m,sx:{height:6,borderRadius:1,maxWidth:400,mx:"auto",mb:3,bgcolor:"action.hover","& .MuiLinearProgress-bar":{borderRadius:1}}}),e.jsx(_,{variant:"outlined",color:"inherit",startIcon:e.jsx(Je,{}),onClick:Ee,sx:{textTransform:"none",fontWeight:500},children:"Cancel Analysis"})]}),t===2&&x&&e.jsxs($,{children:[e.jsx(Bt,{result:x}),e.jsx(qe,{sx:{my:3}}),e.jsxs(je,{variant:"outlined",sx:{p:2.5,bgcolor:"action.hover",border:"1px dashed",borderColor:"divider"},children:[e.jsxs(y,{direction:"row",alignItems:"center",spacing:1,sx:{mb:2},children:[e.jsx(ee,{color:"inherit",fontSize:"small",sx:{color:"text.secondary"}}),e.jsx(f,{variant:"subtitle1",fontWeight:600,children:"Ask for more insights"})]}),e.jsxs(y,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(Ge,{fullWidth:!0,placeholder:"e.g., Show me revenue trends over time, Compare categories by month...",value:S,onChange:i=>I(i.target.value),onKeyDown:i=>i.key==="Enter"&&!i.shiftKey&&pe(),disabled:w,size:"small",sx:{"& .MuiOutlinedInput-root":{bgcolor:"background.paper"}}}),e.jsx(_,{variant:"contained",onClick:pe,disabled:!S.trim()||w,startIcon:w?e.jsx(ge,{size:16,color:"inherit"}):e.jsx(ee,{}),sx:{minWidth:160,textTransform:"none",fontWeight:600,whiteSpace:"nowrap"},children:w?"Generating...":"Generate Charts"})]})]})]}),h&&t!==0&&e.jsx(O,{severity:"error",sx:{mt:2},children:h})]}),e.jsxs($,{sx:{textAlign:"center",py:1},children:[e.jsx(f,{variant:"body2",color:"text.secondary",children:"Supported formats: PDF, Excel (XLSX, XLS) â€¢ Max file size: 50MB"}),e.jsx(f,{variant:"caption",color:"text.disabled",children:"AI-powered extraction with zoomable, interactive time series charts"})]})]})]})}export{gn as default};
