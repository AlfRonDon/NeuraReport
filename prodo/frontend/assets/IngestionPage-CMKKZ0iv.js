import{c as re,j as t,a as d,bC as we,e as Ce,d as ve,u as te,r as u,R as h,I as x,B as c,be as S,T as p,k as g,p as m,aJ as Ie,D as ke,t as De,Z as Ae,as as Y,O as Z,ak as We,al as Se,am as Ee,N as V,ao as Te,s as E,P as Ue,aM as v,v as H,o as X,aI as Pe,a1 as Fe,J as y}from"./index-B8Eu23bA.js";import{G as q}from"./Grid-5L9Rvqba.js";import{U as ae}from"./Link-ijq0kuwU.js";import{W as ne}from"./FolderOpen-C6UKmLhO.js";import{E as _e}from"./Email-Dwi3AvV1.js";import{a as Me,C as Re}from"./CardContent-xJVpuEbT.js";import{F as Le}from"./Folder-0HM5LTDq.js";import{S as Ne}from"./Stop-5bZ1q-Dg.js";const se=re(t.jsx("path",{d:"M19 2h-4.18C14.4.84 13.3 0 12 0S9.6.84 9.18 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m7 18H5V4h2v3h10V4h2z"})),oe=re(t.jsx("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"}));async function $e(e,a={}){const r=new FormData;return r.append("file",e),a.autoDetect!==!1&&r.append("auto_detect","true"),a.extractText!==!1&&r.append("extract_text","true"),a.targetFormat&&r.append("target_format",a.targetFormat),(await d.post("/ingestion/upload",r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:a.onProgress})).data}async function Be(e,a={}){const r=new FormData;return e.forEach((n,i)=>{r.append("files",n)}),a.autoDetect!==!1&&r.append("auto_detect","true"),(await d.post("/ingestion/upload/bulk",r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:a.onProgress})).data}async function ze(e,a={}){const r=new FormData;return r.append("file",e),a.flattenFolders&&r.append("flatten_folders","true"),(await d.post("/ingestion/upload/zip",r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:a.onProgress})).data}async function Ge(e,a={}){return(await d.post("/ingestion/url",{url:e,extract_text:a.extractText!==!1,follow_links:a.followLinks||!1,max_depth:a.maxDepth||1})).data}async function Je(e,a,r={}){return(await d.post("/ingestion/structured",{data:e,format:a,schema:r.schema||null,validate:r.validate!==!1})).data}async function Oe(e,a={}){return(await d.post("/ingestion/clip/url",{url:e,include_images:a.includeImages!==!1,clean_content:a.cleanContent!==!1,capture_screenshot:a.captureScreenshot||!1})).data}async function Ye(e,a,r={}){return(await d.post("/ingestion/clip/selection",{content:e,source_url:a,title:r.title||null,tags:r.tags||null})).data}async function Ze(e,a={}){return(await d.post("/ingestion/watchers",{folder_path:e,patterns:a.patterns||["*"],recursive:a.recursive!==!1,auto_import:a.autoImport!==!1,move_after_import:a.moveAfterImport||!1,destination_folder:a.destinationFolder||null})).data}async function Ve(){return(await d.get("/ingestion/watchers")).data}async function He(e){return(await d.post(`/ingestion/watchers/${e}/start`)).data}async function Xe(e){return(await d.post(`/ingestion/watchers/${e}/stop`)).data}async function qe(e){return(await d.delete(`/ingestion/watchers/${e}`)).data}async function Ke(e){return(await d.post(`/ingestion/watchers/${e}/scan`)).data}async function Qe(e,a={}){const r=new FormData;return r.append("file",e),a.language&&r.append("language",a.language),a.model&&r.append("model",a.model),a.timestamps&&r.append("timestamps","true"),(await d.post("/ingestion/transcribe",r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:a.onProgress})).data}async function er(e){return(await d.get(`/ingestion/transcribe/${e}`)).data}async function rr(e){return(await d.post("/ingestion/email/imap/connect",e)).data}async function tr(){return(await d.get("/ingestion/email/imap/accounts")).data}async function ar(e,a={}){return(await d.post(`/ingestion/email/imap/accounts/${e}/sync`,{folder:a.folder||"INBOX",since_date:a.sinceDate||null,limit:a.limit||100})).data}const nr=we((e,a)=>({uploads:[],watchers:[],transcriptionJobs:[],imapAccounts:[],currentUpload:null,uploadProgress:{},loading:!1,uploading:!1,error:null,setLoading:r=>e({loading:r}),setError:r=>e({error:r}),uploadFile:async(r,o={})=>{const n=crypto.randomUUID();e(i=>({uploading:!0,error:null,uploadProgress:{...i.uploadProgress,[n]:0}}));try{const i=await $e(r,{...o,onProgress:b=>{const T=Math.round(b.loaded*100/b.total);e(w=>({uploadProgress:{...w.uploadProgress,[n]:T}}))}});return e(b=>({uploads:[i,...b.uploads],currentUpload:i,uploading:!1})),i}catch(i){return e({error:i.message,uploading:!1}),null}},uploadBulk:async(r,o={})=>{e({uploading:!0,error:null});try{const n=await Be(r,o);return e(i=>({uploads:[...n,...i.uploads],uploading:!1})),n}catch(n){return e({error:n.message,uploading:!1}),[]}},uploadZip:async(r,o={})=>{e({uploading:!0,error:null});try{const n=await ze(r,o);return e(i=>({uploads:[n,...i.uploads],currentUpload:n,uploading:!1})),n}catch(n){return e({error:n.message,uploading:!1}),null}},importFromUrl:async(r,o={})=>{e({loading:!0,error:null});try{const n=await Ge(r,o);return e(i=>({uploads:[n,...i.uploads],currentUpload:n,loading:!1})),n}catch(n){return e({error:n.message,loading:!1}),null}},importStructuredData:async(r,o,n={})=>{e({loading:!0,error:null});try{const i=await Je(r,o,n);return e({loading:!1}),i}catch(i){return e({error:i.message,loading:!1}),null}},clipUrl:async(r,o={})=>{e({loading:!0,error:null});try{const n=await Oe(r,o);return e({loading:!1}),n}catch(n){return e({error:n.message,loading:!1}),null}},clipSelection:async(r,o,n={})=>{e({loading:!0,error:null});try{const i=await Ye(r,o,n);return e({loading:!1}),i}catch(i){return e({error:i.message,loading:!1}),null}},createWatcher:async(r,o={})=>{e({loading:!0,error:null});try{const n=await Ze(r,o);return e(i=>({watchers:[n,...i.watchers],loading:!1})),n}catch(n){return e({error:n.message,loading:!1}),null}},fetchWatchers:async()=>{e({loading:!0,error:null});try{const r=await Ve();return e({watchers:r||[],loading:!1}),r}catch(r){return e({error:r.message,loading:!1}),[]}},startWatcher:async r=>{try{return await He(r),e(o=>({watchers:o.watchers.map(n=>n.id===r?{...n,status:"running"}:n)})),!0}catch(o){return e({error:o.message}),!1}},stopWatcher:async r=>{try{return await Xe(r),e(o=>({watchers:o.watchers.map(n=>n.id===r?{...n,status:"stopped"}:n)})),!0}catch(o){return e({error:o.message}),!1}},deleteWatcher:async r=>{e({loading:!0,error:null});try{return await qe(r),e(o=>({watchers:o.watchers.filter(n=>n.id!==r),loading:!1})),!0}catch(o){return e({error:o.message,loading:!1}),!1}},scanFolder:async r=>{e({loading:!0,error:null});try{const o=await Ke(r);return e({loading:!1}),o}catch(o){return e({error:o.message,loading:!1}),null}},transcribeFile:async(r,o={})=>{e({uploading:!0,error:null});try{const n=await Qe(r,o);return e(i=>({transcriptionJobs:[n,...i.transcriptionJobs],uploading:!1})),n}catch(n){return e({error:n.message,uploading:!1}),null}},getTranscriptionStatus:async r=>{try{const o=await er(r);return e(n=>({transcriptionJobs:n.transcriptionJobs.map(i=>i.id===r?{...i,...o}:i)})),o}catch(o){return e({error:o.message}),null}},connectImapAccount:async r=>{e({loading:!0,error:null});try{const o=await rr(r);return e(n=>({imapAccounts:[o,...n.imapAccounts],loading:!1})),o}catch(o){return e({error:o.message,loading:!1}),null}},fetchImapAccounts:async()=>{e({loading:!0,error:null});try{const r=await tr();return e({imapAccounts:r||[],loading:!1}),r}catch(r){return e({error:r.message,loading:!1}),[]}},syncImapAccount:async(r,o={})=>{e({loading:!0,error:null});try{const n=await ar(r,o);return e({loading:!1}),n}catch(n){return e({error:n.message,loading:!1}),null}},clearUploads:()=>e({uploads:[],currentUpload:null,uploadProgress:{}}),reset:()=>e({currentUpload:null,uploadProgress:{},error:null})})),sr=y(c)(({theme:e})=>({display:"flex",flexDirection:"column",height:"calc(100vh - 64px)",backgroundColor:e.palette.background.default})),or=y(c)(({theme:e})=>({padding:e.spacing(2,3),borderBottom:`1px solid ${m(e.palette.divider,.1)}`,backgroundColor:m(e.palette.background.paper,.8)})),ir=y(c)(({theme:e})=>({flex:1,padding:e.spacing(3),overflow:"auto"})),K=y(v)(({theme:e,isDragging:a})=>({padding:e.spacing(6),border:`2px dashed ${a?e.palette.mode==="dark"?g[1e3]:g[1100]:m(e.palette.divider,.3)}`,backgroundColor:a?e.palette.mode==="dark"?m(e.palette.text.primary,.05):g[200]:"transparent",borderRadius:8,textAlign:"center",cursor:"pointer",transition:"all 0.2s ease","&:hover":{borderColor:e.palette.mode==="dark"?g[1e3]:g[1100],backgroundColor:e.palette.mode==="dark"?m(e.palette.text.primary,.02):g[200]}})),lr=y(Re)(({theme:e,selected:a})=>({cursor:"pointer",transition:"all 0.2s ease",border:a?`2px solid ${e.palette.mode==="dark"?g[1e3]:g[1200]}`:`1px solid ${m(e.palette.divider,.2)}`,"&:hover":{transform:"translateY(-2px)",boxShadow:`0 4px 12px ${m(e.palette.common.black,.1)}`}})),Q=y(v)(({theme:e,status:a})=>({padding:e.spacing(2),marginBottom:e.spacing(1),borderLeft:`4px solid ${a==="completed"?e.palette.mode==="dark"?g[1e3]:g[1100]:a==="error"?e.palette.mode==="dark"?g[1100]:g[1200]:e.palette.mode==="dark"?g[900]:g[1e3]}`})),cr=y(v)(({theme:e,isRunning:a})=>({padding:e.spacing(2),marginBottom:e.spacing(1),border:`1px solid ${a?e.palette.mode==="dark"?g[1e3]:g[1100]:m(e.palette.divider,.2)}`})),ee=y(E)(({theme:e})=>({borderRadius:8,textTransform:"none",fontWeight:500})),dr=[{id:"upload",name:"File Upload",description:"Upload files from your computer",icon:S,color:"primary"},{id:"url",name:"URL Import",description:"Import from a web URL",icon:ae,color:"info"},{id:"clip",name:"Web Clipper",description:"Clip content from web pages",icon:se,color:"secondary"},{id:"watcher",name:"Folder Watcher",description:"Auto-import from folders",icon:ne,color:"warning"},{id:"email",name:"Email Import",description:"Import from email accounts",icon:_e,color:"error"},{id:"transcribe",name:"Transcription",description:"Transcribe audio/video",icon:oe,color:"success"}];function ur(){const e=Ce(),a=ve(),{execute:r}=te(),o=u.useRef(null),{uploads:n,watchers:i,transcriptionJobs:b,imapAccounts:T,uploadProgress:w,loading:U,uploading:pr,error:P,uploadFile:I,uploadBulk:k,uploadZip:F,importFromUrl:_,clipUrl:M,createWatcher:R,fetchWatchers:L,startWatcher:N,stopWatcher:$,deleteWatcher:B,transcribeFile:z,connectImapAccount:gr,fetchImapAccounts:G,syncImapAccount:fr,reset:J}=nr(),[j,ie]=u.useState("upload"),[le,A]=u.useState(!1),[f,W]=u.useState(""),[C,O]=u.useState(""),[ce,D]=u.useState(!1);u.useEffect(()=>(L(),G(),()=>J()),[G,L,J]);const de=u.useCallback(s=>{s.preventDefault(),A(!0)},[]),ue=u.useCallback(s=>{s.preventDefault(),A(!1)},[]),pe=u.useCallback(async s=>{s.preventDefault(),A(!1);const l=Array.from(s.dataTransfer.files);if(l.length!==0)return r({type:x.CREATE,label:`Upload ${l.length} file(s)`,reversibility:h.SYSTEM_MANAGED,blocksNavigation:!0,intent:{source:"ingestion",fileCount:l.length},action:async()=>{l.length===1?await I(l[0]):await k(l),a.show(`${l.length} file(s) uploaded`,"success")}})},[r,a,k,I]),ge=u.useCallback(async s=>{const l=Array.from(s.target.files);if(l.length!==0)return r({type:x.CREATE,label:`Upload ${l.length} file(s)`,reversibility:h.SYSTEM_MANAGED,blocksNavigation:!0,intent:{source:"ingestion",fileCount:l.length},action:async()=>{l.length===1?l[0].name.endsWith(".zip")?await F(l[0]):await I(l[0]):await k(l),a.show(`${l.length} file(s) uploaded`,"success")}})},[r,a,k,I,F]),fe=u.useCallback(async()=>{if(f.trim())return r({type:x.CREATE,label:"Import from URL",reversibility:h.SYSTEM_MANAGED,blocksNavigation:!0,intent:{source:"ingestion",url:f},action:async()=>{await _(f),a.show("URL imported","success"),W("")}})},[r,_,a,f]),me=u.useCallback(async()=>{if(f.trim())return r({type:x.CREATE,label:"Clip web page",reversibility:h.SYSTEM_MANAGED,blocksNavigation:!0,intent:{source:"ingestion",url:f},action:async()=>{await M(f),a.show("Page clipped","success"),W("")}})},[M,r,a,f]),he=u.useCallback(async()=>{if(C.trim())return r({type:x.CREATE,label:"Create folder watcher",reversibility:h.SYSTEM_MANAGED,intent:{source:"ingestion",path:C},action:async()=>{await R(C),a.show("Watcher created","success"),O(""),D(!1)}})},[R,r,a,C]),xe=u.useCallback(async s=>{const l=s.status==="running";return r({type:x.UPDATE,label:l?"Stop watcher":"Start watcher",reversibility:h.FULLY_REVERSIBLE,intent:{source:"ingestion",watcherId:s.id},action:async()=>{l?(await $(s.id),a.show("Watcher stopped","info")):(await N(s.id),a.show("Watcher started","success"))}})},[r,N,$,a]),ye=u.useCallback(async s=>r({type:x.DELETE,label:"Delete watcher",reversibility:h.SYSTEM_MANAGED,intent:{source:"ingestion",watcherId:s},action:async()=>{await B(s),a.show("Watcher deleted","success")}}),[B,r,a]),be=u.useCallback(async s=>{const l=s.target.files?.[0];if(l)return r({type:x.CREATE,label:"Transcribe file",reversibility:h.SYSTEM_MANAGED,blocksNavigation:!0,intent:{source:"ingestion",filename:l.name},action:async()=>{await z(l),a.show("Transcription started","success")}})},[r,a,z]),je=()=>{switch(j){case"upload":return t.jsx(c,{children:t.jsxs(K,{isDragging:le,onDragOver:de,onDragLeave:ue,onDrop:pe,onClick:()=>o.current?.click(),children:[t.jsx("input",{ref:o,type:"file",multiple:!0,hidden:!0,onChange:ge}),t.jsx(S,{sx:{fontSize:48,color:"text.secondary",mb:2}}),t.jsx(p,{variant:"h6",sx:{mb:1},children:"Drag & drop files here"}),t.jsx(p,{variant:"body2",color:"text.secondary",children:"or click to browse (PDF, DOCX, XLSX, TXT, ZIP)"})]})});case"url":case"clip":return t.jsxs(v,{sx:{p:3},children:[t.jsx(p,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:j==="url"?"Import from URL":"Clip Web Page"}),t.jsx(V,{fullWidth:!0,placeholder:"https://example.com/document",value:f,onChange:s=>W(s.target.value),sx:{mb:2}}),t.jsx(ee,{variant:"contained",onClick:j==="url"?fe:me,disabled:!f.trim()||U,startIcon:U?t.jsx(Y,{size:20}):j==="url"?t.jsx(ae,{}):t.jsx(se,{}),children:j==="url"?"Import":"Clip Page"})]});case"watcher":return t.jsxs(c,{children:[t.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[t.jsx(p,{variant:"subtitle1",sx:{fontWeight:600},children:"Folder Watchers"}),t.jsx(ee,{variant:"contained",size:"small",startIcon:t.jsx(ne,{}),onClick:()=>D(!0),children:"Add Watcher"})]}),i.length>0?i.map(s=>t.jsx(cr,{isRunning:s.status==="running",children:t.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[t.jsx(Le,{color:s.status==="running"?"success":"action"}),t.jsxs(c,{children:[t.jsx(p,{variant:"body1",sx:{fontWeight:500},children:s.folder_path}),t.jsx(H,{size:"small",label:s.status,color:s.status==="running"?"success":"default"})]})]}),t.jsxs(c,{children:[t.jsx(X,{onClick:()=>xe(s),children:s.status==="running"?t.jsx(Ne,{}):t.jsx(Pe,{})}),t.jsx(X,{onClick:()=>ye(s.id),children:t.jsx(Fe,{})})]})]})},s.id)):t.jsx(p,{color:"text.secondary",sx:{textAlign:"center",py:4},children:"No folder watchers configured"})]});case"transcribe":return t.jsxs(v,{sx:{p:3},children:[t.jsx(p,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Audio/Video Transcription"}),t.jsxs(K,{onClick:()=>document.getElementById("transcribe-input")?.click(),children:[t.jsx("input",{id:"transcribe-input",type:"file",accept:"audio/*,video/*",hidden:!0,onChange:be}),t.jsx(oe,{sx:{fontSize:48,color:"text.secondary",mb:2}}),t.jsx(p,{variant:"h6",sx:{mb:1},children:"Upload audio or video file"}),t.jsx(p,{variant:"body2",color:"text.secondary",children:"MP3, WAV, MP4, WebM supported"})]}),b.length>0&&t.jsxs(c,{sx:{mt:3},children:[t.jsx(p,{variant:"subtitle2",sx:{mb:1},children:"Transcription Jobs"}),b.map(s=>t.jsxs(Q,{status:s.status,children:[t.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx(p,{variant:"body2",children:s.filename}),t.jsx(H,{size:"small",label:s.status})]}),s.status==="processing"&&t.jsx(Z,{sx:{mt:1}})]},s.id))]})]});default:return null}};return t.jsxs(sr,{children:[t.jsx(or,{children:t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[t.jsx(S,{sx:{color:"text.secondary",fontSize:28}}),t.jsxs(c,{children:[t.jsx(p,{variant:"h6",sx:{fontWeight:600},children:"Document Ingestion"}),t.jsx(p,{variant:"body2",color:"text.secondary",children:"Import documents from various sources"})]})]})}),t.jsxs(ir,{children:[t.jsx(q,{container:!0,spacing:2,sx:{mb:4},children:dr.map(s=>t.jsx(q,{item:!0,xs:6,sm:4,md:2,children:t.jsx(lr,{selected:j===s.id,onClick:()=>ie(s.id),children:t.jsxs(Me,{sx:{textAlign:"center",py:2},children:[t.jsx(c,{sx:{width:48,height:48,borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:e.palette.mode==="dark"?m(e.palette.text.primary,.1):g[300],mx:"auto",mb:1},children:t.jsx(s.icon,{sx:{color:"text.secondary"}})}),t.jsx(p,{variant:"body2",sx:{fontWeight:500},children:s.name})]})})},s.id))}),t.jsx(Ie,{sx:{mb:3}}),je(),n.length>0&&t.jsxs(c,{sx:{mt:4},children:[t.jsx(p,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Recent Uploads"}),n.slice(0,10).map(s=>t.jsxs(Q,{status:s.status||"completed",children:[t.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[t.jsx(ke,{sx:{color:"text.secondary"}}),t.jsxs(c,{sx:{flex:1},children:[t.jsx(p,{variant:"body2",sx:{fontWeight:500},children:s.filename||s.title||"Untitled"}),t.jsxs(p,{variant:"caption",color:"text.secondary",children:[s.file_type?.toUpperCase()," - ",new Date(s.created_at).toLocaleString()]})]}),s.status==="completed"&&t.jsx(De,{sx:{color:"text.secondary"}}),s.status==="error"&&t.jsx(Ae,{sx:{color:"text.secondary"}}),s.status==="processing"&&t.jsx(Y,{size:20})]}),w[s.id]!==void 0&&w[s.id]<100&&t.jsx(Z,{variant:"determinate",value:w[s.id],sx:{mt:1}})]},s.id))]})]}),t.jsxs(We,{open:ce,onClose:()=>D(!1),children:[t.jsx(Se,{children:"Add Folder Watcher"}),t.jsx(Ee,{children:t.jsx(V,{autoFocus:!0,fullWidth:!0,label:"Folder Path",placeholder:"/path/to/folder",value:C,onChange:s=>O(s.target.value),sx:{mt:1}})}),t.jsxs(Te,{children:[t.jsx(E,{onClick:()=>D(!1),children:"Cancel"}),t.jsx(E,{variant:"contained",onClick:he,children:"Create"})]})]}),P&&t.jsx(Ue,{severity:"error",sx:{m:2},children:P})]})}function Ir(){return te(),t.jsx(ur,{})}export{Ir as default};
