import{bC as Be,a as E,e as Pe,d as Ue,u as Re,bD as Ye,f as Ce,r as x,R as z,I as $,j as t,B as H,T as f,S as g,bs as Oe,C as je,n as oe,o as P,a1 as we,v as A,k as m,p as i,ai as Je,aj as Xe,a3 as Ke,w as Ve,as as ke,P as ae,b1 as Ze,aI as et,al as tt,am as nt,ao as rt,s as Y,bE as ot,L as at,J as b,aM as st,an as it,N as lt,ak as ct,K as ie}from"./index-B8Eu23bA.js";import{A as dt}from"./AutoFixHigh-C6xFegD4.js";import{S as ut}from"./Save-CpotRqw9.js";import{C as pt}from"./ContentCopy-CetTCPv3.js";import{L as xt}from"./Lightbulb-CLdW-uXX.js";import{S as mt}from"./Bookmark-BikapQO7.js";import{D as yt}from"./DataTable-_yVGBakl.js";import{C as Ie}from"./ConfirmModal-Bm9QL03g.js";import{g as gt}from"./sqlSafety-CLxawa7_.js";import{A as ft}from"./AiUsageNotice-DRuwRFKl.js";import{D as bt}from"./DisabledTooltip-BX9dkO9B.js";import{S as ht}from"./Switch-CKmzMGzD.js";import"./KeyboardArrowDown-C4qqpONU.js";import"./FilterList-lKi4AKs9.js";import"./Check-BATZaRrq.js";import"./MoreVert-BRjwX6CI.js";import"./TableRow-Gv3OwSlT.js";import"./TableContainer-CxteWhu6.js";import"./KeyboardArrowRight-BOQXGjwe.js";import"./CheckCircleOutline-BKKyaL-x.js";import"./WarningAmber-DtVJgAFk.js";function vt(e,a){let r;try{r=e()}catch{return}return{getItem:c=>{var o;const d=C=>C===null?null:JSON.parse(C,void 0),h=(o=r.getItem(c))!=null?o:null;return h instanceof Promise?h.then(d):d(h)},setItem:(c,o)=>r.setItem(c,JSON.stringify(o,void 0)),removeItem:c=>r.removeItem(c)}}const se=e=>a=>{try{const r=e(a);return r instanceof Promise?r:{then(s){return se(s)(r)},catch(s){return this}}}catch(r){return{then(s){return this},catch(s){return se(s)(r)}}}},St=(e,a)=>(r,s,c)=>{let o={storage:vt(()=>localStorage),partialize:l=>l,version:0,merge:(l,w)=>({...w,...l}),...a},d=!1,h=0;const C=new Set,q=new Set;let S=o.storage;if(!S)return e((...l)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(...l)},s,c);const M=()=>{const l=o.partialize({...s()});return S.setItem(o.name,{state:l,version:o.version})},W=c.setState;c.setState=(l,w)=>(W(l,w),M());const k=e((...l)=>(r(...l),M()),s,c);c.getInitialState=()=>k;let j;const R=()=>{var l,w;if(!S)return;const p=++h;d=!1,C.forEach(y=>{var v;return y((v=s())!=null?v:k)});const I=((w=o.onRehydrateStorage)==null?void 0:w.call(o,(l=s())!=null?l:k))||void 0;return se(S.getItem.bind(S))(o.name).then(y=>{if(y)if(typeof y.version=="number"&&y.version!==o.version){if(o.migrate){const v=o.migrate(y.state,y.version);return v instanceof Promise?v.then(T=>[!0,T]):[!0,v]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,y.state];return[!1,void 0]}).then(y=>{var v;if(p!==h)return;const[T,O]=y;if(j=o.merge(O,(v=s())!=null?v:k),r(j,!0),T)return M()}).then(()=>{p===h&&(I?.(j,void 0),j=s(),d=!0,q.forEach(y=>y(j)))}).catch(y=>{p===h&&I?.(void 0,y)})};return c.persist={setOptions:l=>{o={...o,...l},l.storage&&(S=l.storage)},clearStorage:()=>{S?.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>R(),hasHydrated:()=>d,onHydrate:l=>(C.add(l),()=>{C.delete(l)}),onFinishHydration:l=>(q.add(l),()=>{q.delete(l)})},o.skipHydration||R(),j||k},Ct=St,jt=Be(Ct((e,a)=>({currentQuestion:"",generatedSQL:"",explanation:"",confidence:0,warnings:[],results:null,columns:[],totalCount:null,executionTimeMs:null,includeTotal:!1,isGenerating:!1,isExecuting:!1,error:null,savedQueries:[],queryHistory:[],selectedConnectionId:null,selectedTables:[],setCurrentQuestion:r=>e({currentQuestion:r}),setGeneratedSQL:r=>e({generatedSQL:r}),setSelectedConnection:r=>e({selectedConnectionId:r,selectedTables:[]}),setSelectedTables:r=>e({selectedTables:r}),setGenerationResult:({sql:r,explanation:s,confidence:c,warnings:o,originalQuestion:d})=>e({generatedSQL:r,explanation:s,confidence:c,warnings:o||[],currentQuestion:d,error:null}),setExecutionResult:({columns:r,rows:s,rowCount:c,totalCount:o,executionTimeMs:d,truncated:h})=>e({results:s,columns:r,totalCount:o,executionTimeMs:d,error:null}),setIncludeTotal:r=>e({includeTotal:!!r}),setError:r=>e({error:r,isGenerating:!1,isExecuting:!1}),setIsGenerating:r=>e({isGenerating:r}),setIsExecuting:r=>e({isExecuting:r}),clearResults:()=>e({results:null,columns:[],totalCount:null,executionTimeMs:null}),clearAll:()=>e({currentQuestion:"",generatedSQL:"",explanation:"",confidence:0,warnings:[],results:null,columns:[],totalCount:null,executionTimeMs:null,error:null}),setSavedQueries:r=>e({savedQueries:r}),addSavedQuery:r=>e(s=>({savedQueries:[r,...s.savedQueries]})),removeSavedQuery:r=>e(s=>({savedQueries:s.savedQueries.filter(c=>c.id!==r)})),setQueryHistory:r=>e({queryHistory:r}),addToHistory:r=>e(s=>({queryHistory:[r,...s.queryHistory].slice(0,100)})),loadSavedQuery:r=>e({currentQuestion:r.original_question||"",generatedSQL:r.sql,selectedConnectionId:r.connection_id,explanation:"",confidence:0,warnings:[],results:null,columns:[],error:null})}),{name:"neura-query-store",partialize:e=>({selectedConnectionId:e.selectedConnectionId,queryHistory:e.queryHistory.slice(0,20)}),onRehydrateStorage:()=>e=>{if(e&&e.selectedConnectionId!=null){const a=e.selectedConnectionId;(typeof a!="string"||a.trim()==="")&&(e.selectedConnectionId=null)}}}));async function wt({question:e,connectionId:a,tables:r,context:s}){const{data:c}=await E.post("/nl2sql/generate",{question:e,connection_id:a,tables:r?.length?r:void 0,context:s||void 0});return c}async function kt({sql:e,connectionId:a,limit:r=100,offset:s=0,includeTotal:c=!1}){const{data:o}=await E.post("/nl2sql/execute",{sql:e,connection_id:a,limit:r,offset:s,include_total:c});return o}async function It({name:e,sql:a,connectionId:r,description:s,originalQuestion:c,tags:o}){const{data:d}=await E.post("/nl2sql/save",{name:e,sql:a,connection_id:r,description:s||void 0,original_question:c||void 0,tags:o?.length?o:void 0});return d}async function Qt({connectionId:e,tags:a}={}){const{data:r}=await E.get("/nl2sql/saved",{params:{connection_id:e||void 0,tags:a?.length?a:void 0}});return r}async function Et(e){const{data:a}=await E.delete(`/nl2sql/saved/${encodeURIComponent(e)}`);return a}async function qt({connectionId:e,limit:a=50}={}){const{data:r}=await E.get("/nl2sql/history",{params:{connection_id:e||void 0,limit:a}});return r}async function Rt(e){const{data:a}=await E.delete(`/nl2sql/history/${encodeURIComponent(e)}`);return a}const Te=ie`
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
`;ie`
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.02); }
`;ie`
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
`;const Tt=b(H)(({theme:e})=>({padding:e.spacing(3),maxWidth:1400,margin:"0 auto",width:"100%",minHeight:"100vh",backgroundColor:e.palette.background.default})),Lt=b(g)(({theme:e})=>({marginBottom:e.spacing(3),animation:`${Te} 0.5s ease-out`})),D=b(st)(({theme:e})=>({backgroundColor:i(e.palette.background.paper,.8),backdropFilter:"blur(20px)",border:`1px solid ${i(e.palette.divider,.1)}`,borderRadius:8,padding:e.spacing(2),boxShadow:`0 8px 32px ${i(e.palette.common.black,.08)}`,animation:`${Te} 0.5s ease-out`,marginBottom:e.spacing(2)})),Qe=b(Y)(({theme:e})=>({borderRadius:12,textTransform:"none",fontWeight:500,borderColor:i(e.palette.divider,.2),transition:"all 0.2s ease","&:hover":{borderColor:e.palette.mode==="dark"?m[1e3]:m[1100],backgroundColor:e.palette.mode==="dark"?i(e.palette.text.primary,.08):m[300]}})),Ee=b(Y)(({theme:e})=>({borderRadius:12,textTransform:"none",fontWeight:600,background:e.palette.mode==="dark"?m[1100]:m[1200],color:"#fff",boxShadow:`0 4px 14px ${i(e.palette.common.black,.15)}`,transition:"all 0.2s ease","&:hover":{background:e.palette.mode==="dark"?m[1e3]:m[1100],boxShadow:`0 6px 20px ${i(e.palette.common.black,.2)}`,transform:"translateY(-1px)"},"&:active":{transform:"translateY(0)"},"&:disabled":{background:i(e.palette.text.disabled,.2),color:e.palette.text.disabled,boxShadow:"none"}})),Dt=b(Y)(({theme:e})=>({borderRadius:12,textTransform:"none",fontWeight:600,background:e.palette.mode==="dark"?m[1e3]:m[1100],color:"#fff",boxShadow:`0 4px 14px ${i(e.palette.common.black,.15)}`,transition:"all 0.2s ease","&:hover":{background:e.palette.mode==="dark"?m[900]:m[1e3],boxShadow:`0 6px 20px ${i(e.palette.common.black,.2)}`,transform:"translateY(-1px)"},"&:disabled":{background:i(e.palette.text.disabled,.2),color:e.palette.text.disabled,boxShadow:"none"}})),Ht=b(it)(({theme:e})=>({"& .MuiOutlinedInput-root":{borderRadius:12,backgroundColor:i(e.palette.background.paper,.6),backdropFilter:"blur(8px)",transition:"all 0.2s ease","&:hover":{backgroundColor:i(e.palette.background.paper,.8)},"&.Mui-focused":{backgroundColor:e.palette.background.paper,boxShadow:`0 0 0 3px ${i(e.palette.text.primary,.08)}`}}})),U=b(lt)(({theme:e})=>({"& .MuiOutlinedInput-root":{borderRadius:12,backgroundColor:i(e.palette.background.default,.5),transition:"all 0.2s ease","&:hover":{backgroundColor:i(e.palette.background.default,.7)},"&.Mui-focused":{backgroundColor:i(e.palette.background.default,.9),boxShadow:`0 0 0 3px ${i(e.palette.text.primary,.08)}`}}})),Mt=b(g)(({theme:e})=>({padding:e.spacing(1),borderRadius:10,backgroundColor:e.palette.mode==="dark"?i(e.palette.text.primary,.04):m[200],cursor:"pointer",transition:"all 0.2s ease","&:hover":{backgroundColor:e.palette.mode==="dark"?i(e.palette.text.primary,.08):m[300],transform:"translateX(4px)"}})),Ft=b(g)(({theme:e})=>({padding:e.spacing(1),borderRadius:10,backgroundColor:e.palette.mode==="dark"?i(e.palette.text.primary,.04):m[200],cursor:"pointer",transition:"all 0.2s ease","&:hover":{backgroundColor:e.palette.mode==="dark"?i(e.palette.text.primary,.08):m[300],transform:"translateX(4px)"}})),_t=b(H)(({theme:e})=>({marginTop:e.spacing(2),padding:e.spacing(1.5),backgroundColor:e.palette.mode==="dark"?i(e.palette.text.primary,.05):m[200],borderRadius:12,border:`1px solid ${i(e.palette.divider,.2)}`})),qe=b(A)(({theme:e,confidence:a})=>({height:20,fontSize:"0.7rem",fontWeight:600,backgroundColor:e.palette.mode==="dark"?i(e.palette.text.primary,.1):m[300],color:e.palette.text.secondary,borderRadius:6})),zt=b(ct)(({theme:e})=>({"& .MuiBackdrop-root":{backgroundColor:i(e.palette.common.black,.6),backdropFilter:"blur(8px)"},"& .MuiDialog-paper":{backgroundColor:i(e.palette.background.paper,.95),backdropFilter:"blur(20px)",border:`1px solid ${i(e.palette.divider,.1)}`,borderRadius:8,boxShadow:`0 24px 64px ${i(e.palette.common.black,.25)}`}}));function $t(){const e=Pe(),a=Ue(),{execute:r}=Re(),s=Ye("EXECUTE_WRITE_QUERY"),c=Ce(n=>n.savedConnections),{currentQuestion:o,generatedSQL:d,explanation:h,confidence:C,warnings:q,results:S,columns:M,totalCount:W,executionTimeMs:k,includeTotal:j,isGenerating:R,isExecuting:l,error:w,selectedConnectionId:p,savedQueries:I,queryHistory:y,setCurrentQuestion:v,setGeneratedSQL:T,setSelectedConnection:O,setGenerationResult:le,setExecutionResult:ce,setError:Q,setIsGenerating:J,setIsExecuting:X,clearResults:de,clearAll:At,setSavedQueries:ue,addSavedQuery:pe,removeSavedQuery:xe,setIncludeTotal:Le,setQueryHistory:G,loadSavedQuery:De}=jt(),[He,N]=x.useState(!1),[L,me]=x.useState(""),[K,ye]=x.useState(""),[ge,Me]=x.useState(!1),[fe,Fe]=x.useState(!1),[be,he]=x.useState(null),[V,Z]=x.useState({open:!1,queryId:null,queryName:""}),[B,ee]=x.useState({open:!1,entryId:null,question:""}),te=x.useRef(0),F=gt(d),_e=c.find(n=>n.id===p)?.name||(p?"Selected connection":"No connection selected"),ve="query-builder-connection-label";x.useEffect(()=>{(async()=>{try{const{connections:u}=await ot();Ce.getState().setSavedConnections(u||[])}catch(u){console.error("Failed to fetch connections:",u),a.show("Failed to load connections. Please refresh the page.","error")}})()},[a]),x.useEffect(()=>{if(!p){he(null);return}const n=++te.current;(async()=>{try{const _=await at(p);n===te.current&&he(_)}catch(_){n===te.current&&(console.error("Failed to fetch schema:",_),a.show("Failed to load database schema","warning"))}})()},[p,a]),x.useEffect(()=>{(async()=>{try{const{queries:u}=await Qt();ue(u||[])}catch(u){console.error("Failed to fetch saved queries:",u)}})()},[ue]),x.useEffect(()=>{(async()=>{try{const{history:u}=await qt({limit:50});G(u||[])}catch(u){console.error("Failed to fetch history:",u)}})()},[G]);const Se=x.useCallback(()=>{!o.trim()||!p||r({type:$.GENERATE,label:"Generate SQL query",reversibility:z.SYSTEM_MANAGED,blocksNavigation:!0,action:async()=>{J(!0),Q(null),de();try{const n=await wt({question:o,connectionId:p});le({sql:n.sql,explanation:n.explanation,confidence:n.confidence,warnings:n.warnings,originalQuestion:n.original_question})}catch(n){const u=n.response?.data?.message||n.message||"Failed to generate SQL";throw Q(u),new Error(u)}finally{J(!1)}}})},[o,p,J,Q,de,le,r]),ne=x.useCallback(()=>{r({type:$.EXECUTE,label:"Execute SQL query",reversibility:z.SYSTEM_MANAGED,blocksNavigation:!0,successMessage:"Query executed successfully",action:async()=>{X(!0),Q(null);try{const n=await kt({sql:d,connectionId:p,limit:100,includeTotal:j});ce({columns:n.columns,rows:n.rows,rowCount:n.row_count,totalCount:n.total_count,executionTimeMs:n.execution_time_ms,truncated:n.truncated}),a.show(`Query returned ${n.row_count} rows`,"success")}catch(n){const u=n.response?.data?.detail||n.response?.data?.message||n.message||"Failed to execute query";throw Q(u),new Error(u)}finally{X(!1)}}})},[r,d,j,p,Q,ce,X,a]),ze=x.useCallback(()=>{if(!(!d.trim()||!p)){if(F){const u=c.find(_=>_.id===p)?.name||p||"selected connection";s(u,ne);return}ne()}},[s,c,d,ne,p,F]),$e=x.useCallback(()=>{!L.trim()||!d.trim()||!p||r({type:$.CREATE,label:`Save query "${L}"`,reversibility:z.FULLY_REVERSIBLE,successMessage:"Query saved successfully",errorMessage:"Failed to save query",action:async()=>{const n=await It({name:L,sql:d,connectionId:p,description:K||void 0,originalQuestion:o||void 0});pe(n.query),N(!1),me(""),ye("")}})},[L,K,d,p,o,pe,r]),Ae=x.useCallback(n=>{r({type:$.DELETE,label:"Delete saved query",reversibility:z.IRREVERSIBLE,successMessage:"Query deleted",errorMessage:"Failed to delete query",action:async()=>{await Et(n),xe(n)}})},[xe,r]),We=x.useCallback(n=>{n&&r({type:$.DELETE,label:"Delete history entry",reversibility:z.IRREVERSIBLE,successMessage:"History entry deleted",errorMessage:"Failed to delete history entry",action:async()=>{await Rt(n),G(y.filter(u=>u.id!==n))}})},[y,G,r]),Ge=x.useCallback(async()=>{try{await navigator.clipboard.writeText(d),a.show("SQL copied to clipboard","success")}catch{a.show("Failed to copy to clipboard","error")}},[d,a]),Ne=M.map(n=>({field:n,header:n,sortable:!0})),re=d.trim()?p?null:"Select a connection first":"Generate SQL before executing";return t.jsxs(Tt,{children:[t.jsxs(Lt,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[t.jsxs(H,{children:[t.jsx(f,{variant:"h5",fontWeight:600,sx:{color:e.palette.text.primary},children:"Query Builder"}),t.jsx(f,{variant:"body2",sx:{color:e.palette.text.secondary},children:"Ask questions in natural language and get SQL queries"})]}),t.jsxs(g,{direction:"row",spacing:1,children:[t.jsxs(Qe,{variant:"outlined",size:"small",startIcon:t.jsx(mt,{}),onClick:()=>Fe(!fe),children:["Saved (",I.length,")"]}),t.jsx(Qe,{variant:"outlined",size:"small",startIcon:t.jsx(Oe,{}),onClick:()=>Me(!ge),children:"History"})]})]}),t.jsx(ft,{title:"AI query draft",description:"AI turns questions into SQL using the selected connection's schema. Review the SQL before executing.",chips:[{label:`Source: ${_e}`,variant:"outlined"},{label:"Confidence: Varies per query",variant:"outlined"},{label:"Read-only recommended",variant:"outlined"}],dense:!0,sx:{mb:2}}),t.jsx(je,{in:fe,children:t.jsxs(D,{children:[t.jsx(f,{variant:"subtitle2",sx:{color:e.palette.text.secondary,mb:1},children:"Saved Queries"}),I.length===0?t.jsx(f,{variant:"body2",sx:{color:e.palette.text.disabled},children:"No saved queries yet"}):t.jsx(g,{spacing:1,children:I.slice(0,5).map(n=>t.jsxs(Mt,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[t.jsxs(H,{sx:{flex:1},onClick:()=>De(n),children:[t.jsx(f,{variant:"body2",fontWeight:500,sx:{color:e.palette.text.primary},children:n.name}),n.description&&t.jsx(f,{variant:"caption",sx:{color:e.palette.text.secondary},children:n.description})]}),t.jsx(oe,{title:"Delete saved query",children:t.jsx(P,{size:"small",onClick:()=>Z({open:!0,queryId:n.id,queryName:n.name}),"aria-label":"Delete saved query",children:t.jsx(we,{fontSize:"small",sx:{color:e.palette.text.secondary}})})})]},n.id))})]})}),t.jsx(je,{in:ge,children:t.jsxs(D,{children:[t.jsx(f,{variant:"subtitle2",sx:{color:e.palette.text.secondary,mb:1},children:"Recent Queries"}),y.length===0?t.jsx(f,{variant:"body2",sx:{color:e.palette.text.disabled},children:"No query history yet"}):t.jsx(g,{spacing:1,children:y.slice(0,5).map(n=>t.jsxs(Ft,{direction:"row",alignItems:"center",justifyContent:"space-between",onClick:()=>{v(n.question),T(n.sql)},children:[t.jsxs(H,{sx:{flex:1,minWidth:0},children:[t.jsx(f,{variant:"body2",sx:{color:e.palette.text.primary},noWrap:!0,children:n.question}),t.jsxs(g,{direction:"row",spacing:1,mt:.5,children:[t.jsx(qe,{size:"small",label:`${Math.round(n.confidence*100)}%`,confidence:n.confidence}),n.success?t.jsx(A,{size:"small",label:"Success",sx:{height:20,fontSize:"0.7rem",bgcolor:e.palette.mode==="dark"?i(e.palette.text.primary,.1):m[300],color:e.palette.text.secondary,borderRadius:1.5}}):t.jsx(A,{size:"small",label:"Failed",sx:{height:20,fontSize:"0.7rem",bgcolor:e.palette.mode==="dark"?i(e.palette.text.primary,.1):m[300],color:e.palette.text.secondary,borderRadius:1.5}})]})]}),t.jsx(P,{size:"small",onClick:u=>{u.stopPropagation(),ee({open:!0,entryId:n.id,question:n.question})},children:t.jsx(we,{fontSize:"small",sx:{color:e.palette.text.secondary}})})]},n.id))})]})}),t.jsxs(D,{children:[t.jsxs(Ht,{fullWidth:!0,size:"small",children:[t.jsx(Je,{id:ve,children:"Database Connection"}),t.jsx(Xe,{value:p||"",label:"Database Connection",labelId:ve,id:"query-builder-connection-select",onChange:n=>O(n.target.value),startAdornment:t.jsx(Ve,{sx:{mr:1,color:e.palette.text.secondary}}),children:c.map(n=>t.jsx(Ke,{value:n.id,children:n.name||n.database_path},n.id))})]}),be&&t.jsx(H,{mt:2,children:t.jsxs(f,{variant:"caption",sx:{color:e.palette.text.secondary},children:["Available tables: ",be.tables?.map(n=>n.name).join(", ")]})})]}),t.jsxs(D,{children:[t.jsx(U,{fullWidth:!0,multiline:!0,minRows:2,maxRows:4,placeholder:"Ask a question about your data... (e.g., 'Show me all customers who made purchases last month')",value:o,onChange:n=>v(n.target.value),onKeyDown:n=>{n.key==="Enter"&&n.ctrlKey&&Se()}}),t.jsxs(g,{direction:"row",justifyContent:"space-between",alignItems:"center",mt:2,children:[t.jsx(f,{variant:"caption",sx:{color:e.palette.text.secondary},children:"Press Ctrl+Enter to generate"}),t.jsx(Ee,{startIcon:R?t.jsx(ke,{size:16,color:"inherit"}):t.jsx(dt,{}),onClick:Se,disabled:!o.trim()||!p||R,children:R?"Generating...":"Generate SQL"})]})]}),w&&t.jsx(ae,{severity:"error",sx:{mb:2,borderRadius:1},onClose:()=>Q(null),children:w}),d&&t.jsxs(D,{children:[t.jsxs(g,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:1,children:[t.jsxs(g,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(f,{variant:"subtitle2",sx:{color:e.palette.text.secondary},children:"Generated SQL"}),C>0&&t.jsx(qe,{size:"small",label:`${Math.round(C*100)}% confidence`,confidence:C})]}),t.jsxs(g,{direction:"row",spacing:1,children:[t.jsx(oe,{title:"Copy SQL",children:t.jsx(P,{size:"small",onClick:Ge,"aria-label":"Copy SQL",children:t.jsx(pt,{fontSize:"small",sx:{color:e.palette.text.secondary}})})}),t.jsx(oe,{title:"Save Query",children:t.jsx(P,{size:"small",onClick:()=>N(!0),"aria-label":"Save Query",children:t.jsx(ut,{fontSize:"small",sx:{color:e.palette.text.secondary}})})})]})]}),t.jsx(U,{fullWidth:!0,multiline:!0,minRows:3,maxRows:10,value:d,onChange:n=>T(n.target.value),sx:{"& .MuiOutlinedInput-root":{fontFamily:"monospace",fontSize:"0.875rem"}}}),q.length>0&&t.jsx(g,{spacing:.5,mt:1,children:q.map((n,u)=>t.jsx(ae,{severity:"warning",sx:{py:0,borderRadius:1},children:n},u))}),h&&t.jsx(_t,{children:t.jsxs(g,{direction:"row",alignItems:"flex-start",spacing:1,children:[t.jsx(xt,{sx:{color:e.palette.text.secondary,fontSize:18,mt:.25}}),t.jsx(f,{variant:"body2",sx:{color:e.palette.text.secondary},children:h})]})}),t.jsxs(g,{direction:{xs:"column",sm:"row"},alignItems:{xs:"stretch",sm:"center"},justifyContent:"space-between",mt:2,spacing:1.5,children:[t.jsx(Ze,{control:t.jsx(ht,{size:"small",checked:j,onChange:n=>Le(n.target.checked)}),label:"Include total row count (slower)",sx:{color:e.palette.text.secondary}}),t.jsxs(g,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",children:[t.jsx(A,{size:"small",label:"Read-only recommended",variant:"outlined",sx:{fontSize:"0.7rem"}}),F&&t.jsx(A,{size:"small",label:`${F.toUpperCase()} detected`,sx:{fontSize:"0.7rem",bgcolor:n=>n.palette.mode==="dark"?i(n.palette.text.primary,.1):m[400],color:"text.secondary"}})]}),t.jsx(bt,{disabled:!!re||l,reason:l?"Query is currently running...":re,hint:p?d.trim()?void 0:"Enter a question and click Generate first":"Select a database from the dropdown above",children:t.jsx(Dt,{startIcon:l?t.jsx(ke,{size:16,color:"inherit"}):t.jsx(et,{}),onClick:ze,disabled:!!re||l,children:l?"Executing...":"Execute Query"})})]}),F&&t.jsx(ae,{severity:"warning",sx:{mt:1.5,borderRadius:1},children:"Write queries can modify data and may not be reversible. You will be asked to confirm before execution."})]}),S&&t.jsxs(D,{children:[t.jsxs(g,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:2,children:[t.jsx(f,{variant:"subtitle2",sx:{color:e.palette.text.secondary},children:"Results"}),t.jsxs(g,{direction:"row",spacing:2,children:[W!==null&&t.jsxs(f,{variant:"caption",sx:{color:e.palette.text.secondary},children:[W," total rows"]}),k!==null&&t.jsxs(f,{variant:"caption",sx:{color:e.palette.text.secondary},children:[k,"ms"]})]})]}),t.jsx(yt,{columns:Ne,data:S,pageSize:10,loading:!1})]}),t.jsxs(zt,{open:He,onClose:()=>N(!1),maxWidth:"sm",fullWidth:!0,children:[t.jsx(tt,{sx:{color:e.palette.text.primary},children:"Save Query"}),t.jsx(nt,{children:t.jsxs(g,{spacing:2,mt:1,children:[t.jsx(U,{fullWidth:!0,label:"Name",value:L,onChange:n=>me(n.target.value),placeholder:"e.g., Monthly Sales Report"}),t.jsx(U,{fullWidth:!0,multiline:!0,rows:2,label:"Description (optional)",value:K,onChange:n=>ye(n.target.value),placeholder:"What does this query do?"})]})}),t.jsxs(rt,{sx:{p:2.5},children:[t.jsx(Y,{onClick:()=>N(!1),sx:{borderRadius:1,textTransform:"none"},children:"Cancel"}),t.jsx(Ee,{onClick:$e,disabled:!L.trim(),children:"Save"})]})]}),t.jsx(Ie,{open:V.open,onClose:()=>Z({open:!1,queryId:null,queryName:""}),onConfirm:()=>{Ae(V.queryId),Z({open:!1,queryId:null,queryName:""})},title:"Delete Saved Query",message:`Are you sure you want to delete "${V.queryName}"? This action cannot be undone.`,confirmLabel:"Delete",severity:"error"}),t.jsx(Ie,{open:B.open,onClose:()=>ee({open:!1,entryId:null,question:""}),onConfirm:()=>{We(B.entryId),ee({open:!1,entryId:null,question:""})},title:"Delete History Entry",message:`Are you sure you want to delete this history entry? "${B.question?.substring(0,50)}${B.question?.length>50?"...":""}"`,confirmLabel:"Delete",severity:"warning"})]})}function cn(){return Re(),t.jsx($t,{})}export{cn as default};
