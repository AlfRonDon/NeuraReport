import{r as i,a8 as q,a9 as J,aa as H,j as e,ab as B,ac as Y,N as _,g as pe,dr as Ne,at as G,ar as oe,as as Le,cI as ce,cJ as _e,a$ as de,P as we,q as j,o as v,B as $,aZ as Ie,a7 as De,p as E,K as W,bS as We,A as O,n as ze,f as Z,aV as me,bM as be,a2 as ge,ds as Ue,bb as Be,b3 as Ve,v as Oe,a as qe,w as Je,R as Q,I as K,E as He,b0 as Ye,b2 as fe,s as ee,C as ve,a4 as Ge,ak as Xe,aJ as Qe}from"./index-CS2nn_Zr.js";import{Z as Ke,I as Ze}from"./ZoomableChart-sh3iXrVj.js";import{C as et}from"./CheckCircleOutline-BB2cn-sY.js";import{F as tt}from"./InsertDriveFile-3QoKpQYG.js";import{I as nt}from"./Insights-B-a7QugO.js";import{G as ye}from"./Grid-B_V8L2Yi.js";import{T as st,a as ae}from"./Tabs-LJGpU9Kz.js";import{A as ot,a as at,b as rt}from"./AccordionSummary-Bf62xkde.js";import{T as Ae}from"./TableContainer-BA_ITK0M.js";import{T as Re,a as ke,b as te,c as D,d as Te}from"./TableRow-BDOXK0au.js";import{C as lt}from"./CardContent-D2oMcta9.js";import{S as je}from"./Surface-C1u6pPyH.js";import{C as it}from"./ConnectionSelector-gPkx78kE.js";import{T as ct}from"./TemplateSelector-DosNAo-Z.js";import{S as dt}from"./Switch-kdeVSDF6.js";import"./PieChart-BGgXehmI.js";import"./string-GBVq1Gk0.js";import"./index-Chjiymov.js";import"./band-CquvqAHh.js";import"./init-Dmth1JHB.js";import"./ordinal-DILIJJjt.js";import"./linear-Btwmcagj.js";import"./defaultLocale-DX6XiGOO.js";import"./time-BWVVNhLt.js";import"./KeyboardArrowRight-MNB0l_Vm.js";const ne=i.createContext({}),ue=i.createContext({});function pt(t){return q("MuiStep",t)}J("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const ut=t=>{const{classes:n,orientation:s,alternativeLabel:l,completed:r}=t;return Y({root:["root",s,l&&"alternativeLabel",r&&"completed"]},pt,n)},xt=_("div",{name:"MuiStep",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.root,n[s.orientation],s.alternativeLabel&&n.alternativeLabel,s.completed&&n.completed]}})({variants:[{props:{orientation:"horizontal"},style:{paddingLeft:8,paddingRight:8}},{props:{alternativeLabel:!0},style:{flex:1,position:"relative"}}]}),ht=i.forwardRef(function(n,s){const l=H({props:n,name:"MuiStep"}),{active:r,children:o,className:c,component:p="div",completed:h,disabled:g,expanded:m=!1,index:u,last:b,...y}=l,{activeStep:S,connector:w,alternativeLabel:I,orientation:z,nonLinear:x}=i.useContext(ne);let[a=!1,f=!1,C=!1]=[r,h,g];S===u?a=r!==void 0?r:!0:!x&&S>u?f=h!==void 0?h:!0:!x&&S<u&&(C=g!==void 0?g:!0);const A=i.useMemo(()=>({index:u,last:b,expanded:m,icon:u+1,active:a,completed:f,disabled:C}),[u,b,m,a,f,C]),k={...l,active:a,orientation:z,alternativeLabel:I,completed:f,disabled:C,expanded:m,component:p},T=ut(k),N=e.jsxs(xt,{as:p,className:B(T.root,c),ref:s,ownerState:k,...y,children:[w&&I&&u!==0?w:null,o]});return e.jsx(ue.Provider,{value:A,children:w&&!I&&u!==0?e.jsxs(i.Fragment,{children:[w,N]}):N})}),mt=pe(e.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"})),bt=pe(e.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}));function gt(t){return q("MuiStepIcon",t)}const re=J("MuiStepIcon",["root","active","completed","error","text"]);var Se;const ft=t=>{const{classes:n,active:s,completed:l,error:r}=t;return Y({root:["root",s&&"active",l&&"completed",r&&"error"],text:["text"]},gt,n)},le=_(Ne,{name:"MuiStepIcon",slot:"Root"})(G(({theme:t})=>({display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),color:(t.vars||t).palette.text.disabled,[`&.${re.completed}`]:{color:(t.vars||t).palette.primary.main},[`&.${re.active}`]:{color:(t.vars||t).palette.primary.main},[`&.${re.error}`]:{color:(t.vars||t).palette.error.main}}))),vt=_("text",{name:"MuiStepIcon",slot:"Text"})(G(({theme:t})=>({fill:(t.vars||t).palette.primary.contrastText,fontSize:t.typography.caption.fontSize,fontFamily:t.typography.fontFamily}))),yt=i.forwardRef(function(n,s){const l=H({props:n,name:"MuiStepIcon"}),{active:r=!1,className:o,completed:c=!1,error:p=!1,icon:h,...g}=l,m={...l,active:r,completed:c,error:p},u=ft(m);if(typeof h=="number"||typeof h=="string"){const b=B(o,u.root);return p?e.jsx(le,{as:bt,className:b,ref:s,ownerState:m,...g}):c?e.jsx(le,{as:mt,className:b,ref:s,ownerState:m,...g}):e.jsxs(le,{className:b,ref:s,ownerState:m,...g,children:[Se||(Se=e.jsx("circle",{cx:"12",cy:"12",r:"12"})),e.jsx(vt,{className:u.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:m,children:h})]})}return h});function jt(t){return q("MuiStepLabel",t)}const U=J("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),St=t=>{const{classes:n,orientation:s,active:l,completed:r,error:o,disabled:c,alternativeLabel:p}=t;return Y({root:["root",s,o&&"error",c&&"disabled",p&&"alternativeLabel"],label:["label",l&&"active",r&&"completed",o&&"error",c&&"disabled",p&&"alternativeLabel"],iconContainer:["iconContainer",l&&"active",r&&"completed",o&&"error",c&&"disabled",p&&"alternativeLabel"],labelContainer:["labelContainer",p&&"alternativeLabel"]},jt,n)},Ct=_("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.root,n[s.orientation]]}})({display:"flex",alignItems:"center",[`&.${U.alternativeLabel}`]:{flexDirection:"column"},[`&.${U.disabled}`]:{cursor:"default"},variants:[{props:{orientation:"vertical"},style:{textAlign:"left",padding:"8px 0"}}]}),Lt=_("span",{name:"MuiStepLabel",slot:"Label"})(G(({theme:t})=>({...t.typography.body2,display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),[`&.${U.active}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${U.completed}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${U.alternativeLabel}`]:{marginTop:16},[`&.${U.error}`]:{color:(t.vars||t).palette.error.main}}))),wt=_("span",{name:"MuiStepLabel",slot:"IconContainer"})({flexShrink:0,display:"flex",paddingRight:8,[`&.${U.alternativeLabel}`]:{paddingRight:0}}),It=_("span",{name:"MuiStepLabel",slot:"LabelContainer"})(G(({theme:t})=>({width:"100%",color:(t.vars||t).palette.text.secondary,[`&.${U.alternativeLabel}`]:{textAlign:"center"}}))),Ee=i.forwardRef(function(n,s){const l=H({props:n,name:"MuiStepLabel"}),{children:r,className:o,componentsProps:c={},error:p=!1,icon:h,optional:g,slots:m={},slotProps:u={},StepIconComponent:b,StepIconProps:y,...S}=l,{alternativeLabel:w,orientation:I}=i.useContext(ne),{active:z,disabled:x,completed:a,icon:f}=i.useContext(ue),C=h||f;let A=b;C&&!A&&(A=yt);const k={...l,active:z,alternativeLabel:w,completed:a,disabled:x,error:p,orientation:I},T=St(k),N={slots:m,slotProps:{stepIcon:y,...c,...u}},[M,F]=oe("root",{elementType:Ct,externalForwardedProps:{...N,...S},ownerState:k,ref:s,className:B(T.root,o)}),[R,V]=oe("label",{elementType:Lt,externalForwardedProps:N,ownerState:k}),[X,se]=oe("stepIcon",{elementType:A,externalForwardedProps:N,ownerState:k});return e.jsxs(M,{...F,children:[C||X?e.jsx(wt,{className:T.iconContainer,ownerState:k,children:e.jsx(X,{completed:a,active:z,error:p,icon:C,...se})}):null,e.jsxs(It,{className:T.labelContainer,ownerState:k,children:[r?e.jsx(R,{...V,className:B(T.label,V?.className),children:r}):null,g]})]})});Ee.muiName="StepLabel";function zt(t){return q("MuiStepConnector",t)}J("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const At=t=>{const{classes:n,orientation:s,alternativeLabel:l,active:r,completed:o,disabled:c}=t,p={root:["root",s,l&&"alternativeLabel",r&&"active",o&&"completed",c&&"disabled"],line:["line",`line${Le(s)}`]};return Y(p,zt,n)},Rt=_("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.root,n[s.orientation],s.alternativeLabel&&n.alternativeLabel,s.completed&&n.completed]}})({flex:"1 1 auto",variants:[{props:{orientation:"vertical"},style:{marginLeft:12}},{props:{alternativeLabel:!0},style:{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"}}]}),kt=_("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.line,n[`line${Le(s.orientation)}`]]}})(G(({theme:t})=>{const n=t.palette.mode==="light"?t.palette.grey[400]:t.palette.grey[600];return{display:"block",borderColor:t.vars?t.vars.palette.StepConnector.border:n,variants:[{props:{orientation:"horizontal"},style:{borderTopStyle:"solid",borderTopWidth:1}},{props:{orientation:"vertical"},style:{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24}}]}})),Tt=i.forwardRef(function(n,s){const l=H({props:n,name:"MuiStepConnector"}),{className:r,...o}=l,{alternativeLabel:c,orientation:p="horizontal"}=i.useContext(ne),{active:h,disabled:g,completed:m}=i.useContext(ue),u={...l,alternativeLabel:c,orientation:p,active:h,completed:m,disabled:g},b=At(u);return e.jsx(Rt,{className:B(b.root,r),ref:s,ownerState:u,...o,children:e.jsx(kt,{className:b.line,ownerState:u})})});function Et(t){return q("MuiStepper",t)}J("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);const Mt=t=>{const{orientation:n,nonLinear:s,alternativeLabel:l,classes:r}=t;return Y({root:["root",n,s&&"nonLinear",l&&"alternativeLabel"]},Et,r)},Pt=_("div",{name:"MuiStepper",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.root,n[s.orientation],s.alternativeLabel&&n.alternativeLabel,s.nonLinear&&n.nonLinear]}})({display:"flex",variants:[{props:{orientation:"horizontal"},style:{flexDirection:"row",alignItems:"center"}},{props:{orientation:"vertical"},style:{flexDirection:"column"}},{props:{alternativeLabel:!0},style:{alignItems:"flex-start"}}]}),$t=e.jsx(Tt,{}),Ft=i.forwardRef(function(n,s){const l=H({props:n,name:"MuiStepper"}),{activeStep:r=0,alternativeLabel:o=!1,children:c,className:p,component:h="div",connector:g=$t,nonLinear:m=!1,orientation:u="horizontal",...b}=l,y={...l,nonLinear:m,alternativeLabel:o,orientation:u,component:h},S=Mt(y),w=i.Children.toArray(c).filter(Boolean),I=w.map((x,a)=>i.cloneElement(x,{index:a,last:a+1===w.length,...x.props})),z=i.useMemo(()=>({activeStep:r,alternativeLabel:o,connector:g,nonLinear:m,orientation:u}),[r,o,g,m,u]);return e.jsx(ne.Provider,{value:z,children:e.jsx(Pt,{as:h,ownerState:y,className:B(S.root,p),ref:s,...b,children:I})})}),Nt=pe(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}));async function Ce({file:t,templateId:n,connectionId:s,onProgress:l,background:r=!1,signal:o}){if(!t)throw new Error("No file provided for analysis");const c=new FormData;if(c.append("file",t),n&&c.append("template_id",n),s&&c.append("connection_id",s),r){const h=await ce(`${de}/analyze/upload?background=true`,{method:"POST",body:c});if(!h.ok){const g=await h.text().catch(()=>"");throw new Error(g||`Failed to queue analysis (${h.status})`)}return h.json()}const p=await ce(`${de}/analyze/upload`,{method:"POST",body:c,signal:o});return _e(p,{onEvent:l,errorMessage:"Document analysis failed"})}async function _t(t,{question:n,includeSampleData:s=!0,tableIds:l}={}){if(!t)throw new Error("Analysis ID is required");const r={question:n||"",include_sample_data:s};Array.isArray(l)&&l.length&&(r.table_ids=l);const o=await ce(`${de}/analyze/${encodeURIComponent(t)}/charts/suggest`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!o.ok){const c=await o.text().catch(()=>"");throw new Error(c||`Failed to get chart suggestions (${o.status})`)}return o.json()}function Dt(t,n=0){if(!t||typeof t!="object")return null;const s=typeof t.type=="string"?t.type.toLowerCase().trim():"bar",l=typeof t.xField=="string"?t.xField.trim():"";let r=t.yFields;typeof r=="string"&&(r=[r]),Array.isArray(r)||(r=[]);const o=r.map(c=>typeof c=="string"?c.trim():String(c)).filter(Boolean);return!l||!o.length?null:{id:t.id?String(t.id):`chart_${n+1}`,type:s,xField:l,yFields:o,groupField:t.groupField??null,aggregation:t.aggregation??null,title:t.title??null,description:t.description??null}}function Wt(t){if(!t)return{valid:!1,error:"No file selected"};const n=50;if(t.size>n*1024*1024)return{valid:!1,error:`File too large. Maximum size is ${n}MB.`};const s=t.name.toLowerCase();return[".pdf",".xlsx",".xls",".xlsm"].some(o=>s.endsWith(o))?{valid:!0}:{valid:!1,error:"Only PDF and Excel files are supported."}}const Ut=".pdf,.xlsx,.xls,.xlsm";function Bt({onFileSelect:t,isUploading:n=!1,progress:s=0,progressStage:l="",error:r=null,disabled:o=!1}){const[c,p]=i.useState(!1),[h,g]=i.useState(null),[m,u]=i.useState(null),b=i.useCallback(x=>{x.preventDefault(),x.stopPropagation(),x.type==="dragenter"||x.type==="dragover"?p(!0):x.type==="dragleave"&&p(!1)},[]),y=i.useCallback(x=>{u(null);const a=Wt(x);if(!a.valid){u(a.error),g(null);return}g(x),t?.(x)},[t]),S=i.useCallback(x=>{if(x.preventDefault(),x.stopPropagation(),p(!1),o||n)return;const a=x.dataTransfer?.files;a&&a.length>0&&y(a[0])},[o,n,y]),w=i.useCallback(x=>{const a=x.target?.files;a&&a.length>0&&y(a[0]),x.target.value=""},[y]),I=i.useCallback(()=>{g(null),u(null),t?.(null)},[t]),z=r||m;return e.jsxs(we,{variant:"outlined",onDragEnter:b,onDragLeave:b,onDragOver:b,onDrop:S,sx:{p:4,textAlign:"center",cursor:o||n?"default":"pointer",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)",borderStyle:"dashed",borderWidth:2,borderColor:c||z||h?"text.secondary":"divider",bgcolor:c?"action.hover":z?"error.lighter":h?"success.lighter":"background.paper","&:hover":{borderColor:o||n?void 0:"text.secondary",bgcolor:o||n?void 0:"action.hover"}},children:[e.jsx("input",{type:"file",accept:Ut,onChange:w,disabled:o||n,style:{display:"none"},id:"document-upload-input"}),n?e.jsxs(j,{spacing:2,alignItems:"center",children:[e.jsx(v,{variant:"body1",color:"text.secondary",children:l||"Analyzing document..."}),e.jsx($,{sx:{width:"100%",maxWidth:400},children:e.jsx(Ie,{variant:"determinate",value:s})}),e.jsxs(v,{variant:"body2",color:"text.secondary",children:[s,"% complete"]})]}):h?e.jsxs(j,{spacing:2,alignItems:"center",children:[e.jsx(De,{sx:{fontSize:48,color:"text.secondary"}}),e.jsxs(j,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(tt,{color:"action"}),e.jsx(v,{variant:"body1",children:h.name}),e.jsx(E,{size:"small",label:`${(h.size/1024/1024).toFixed(2)} MB`,variant:"outlined"})]}),e.jsx(W,{variant:"outlined",size:"small",onClick:I,children:"Choose different file"})]}):e.jsx("label",{htmlFor:"document-upload-input",style:{cursor:o?"default":"pointer"},children:e.jsxs(j,{spacing:2,alignItems:"center",children:[e.jsx(We,{sx:{fontSize:48,color:"text.secondary"}}),e.jsx(v,{variant:"h6",color:"text.primary",children:"Drop a document here or click to browse"}),e.jsx(v,{variant:"body2",color:"text.secondary",children:"Supports PDF and Excel files (max 50MB)"}),e.jsxs(j,{direction:"row",spacing:1,children:[e.jsx(E,{label:"PDF",size:"small",variant:"outlined"}),e.jsx(E,{label:"XLSX",size:"small",variant:"outlined"}),e.jsx(E,{label:"XLS",size:"small",variant:"outlined"})]})]})}),z&&e.jsx(O,{severity:"error",sx:{mt:2,textAlign:"left"},children:z})]})}function ie({children:t,value:n,index:s,...l}){return e.jsx("div",{role:"tabpanel",hidden:n!==s,id:`analysis-tabpanel-${s}`,"aria-labelledby":`analysis-tab-${s}`,...l,children:n===s&&e.jsx($,{sx:{py:2},children:t})})}function Vt({metric:t}){const n=(s,l)=>{if(s==null)return"N/A";if(typeof s=="number"){const r=s.toLocaleString(void 0,{maximumFractionDigits:2});return l?`${r} ${l}`:r}return String(s)};return e.jsx(Ve,{variant:"outlined",children:e.jsxs(lt,{sx:{py:1.5,"&:last-child":{pb:1.5}},children:[e.jsx(v,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:t.key}),e.jsx(v,{variant:"h6",fontWeight:600,children:n(t.value,t.unit)}),t.context&&e.jsx(v,{variant:"caption",color:"text.secondary",children:t.context})]})})}function Ot({table:t,maxRows:n=50}){const s=t.rows?.slice(0,n)||[],l=(t.rows?.length||0)>n;return e.jsxs(Ae,{sx:{maxHeight:400},children:[e.jsxs(Re,{size:"small",stickyHeader:!0,children:[e.jsx(ke,{children:e.jsx(te,{children:t.headers?.map((r,o)=>e.jsx(D,{sx:{fontWeight:600,bgcolor:"background.paper"},children:e.jsxs(j,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx("span",{children:r}),t.data_types?.[o]&&e.jsx(E,{label:t.data_types[o],size:"small",variant:"outlined",sx:{fontSize:"10px",height:18}})]})},o))})}),e.jsx(Te,{children:s.map((r,o)=>e.jsx(te,{hover:!0,children:r.map((c,p)=>e.jsx(D,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis"},children:c||"-"},p))},o))})]}),l&&e.jsxs(v,{variant:"caption",color:"text.secondary",sx:{p:1,display:"block"},children:["Showing ",n," of ",t.rows.length," rows"]})]})}function qt({result:t}){const[n,s]=i.useState(0),[l,r]=i.useState(0),{document_name:o,document_type:c,processing_time_ms:p,summary:h,tables:g=[],data_points:m=[],chart_suggestions:u=[],raw_data:b=[],field_catalog:y=[],warnings:S=[]}=t||{},w=(a,f)=>{s(f)},I=()=>{if(!b||b.length===0)return;const a=Object.keys(b[0]),C=[a.join(","),...b.map(N=>a.map(M=>{const F=N[M];if(F==null)return"";const R=String(F);return R.includes(",")||R.includes('"')?`"${R.replace(/"/g,'""')}"`:R}).join(","))].join(`
`),A=new Blob([C],{type:"text/csv;charset=utf-8;"}),k=URL.createObjectURL(A),T=document.createElement("a");T.href=k,T.download=`${o||"analysis"}_data.csv`,T.click(),URL.revokeObjectURL(k)},z=()=>{if(!b||b.length===0)return;const a=JSON.stringify(b,null,2),f=new Blob([a],{type:"application/json;charset=utf-8;"}),C=URL.createObjectURL(f),A=document.createElement("a");A.href=C,A.download=`${o||"analysis"}_data.json`,A.click(),URL.revokeObjectURL(C)},x=u[l]||null;return e.jsxs($,{children:[e.jsxs(j,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsxs(j,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(v,{variant:"h6",children:o||"Analysis Results"}),e.jsx(E,{label:c?.toUpperCase(),size:"small",variant:"outlined",sx:{bgcolor:a=>a.palette.mode==="dark"?Z(a.palette.text.primary,.1):ze[200],color:"text.secondary"}}),p&&e.jsx(E,{label:`${(p/1e3).toFixed(1)}s`,size:"small",variant:"outlined"})]}),e.jsxs(j,{direction:"row",spacing:1,children:[e.jsx(W,{startIcon:e.jsx(me,{}),size:"small",onClick:I,disabled:!b?.length,children:"Export CSV"}),e.jsx(W,{startIcon:e.jsx(me,{}),size:"small",onClick:z,disabled:!b?.length,children:"Export JSON"})]})]}),h&&e.jsx(O,{severity:"info",sx:{mb:2},children:h}),S.length>0&&e.jsx(O,{severity:"warning",sx:{mb:2},children:S.join("; ")}),m.length>0&&e.jsxs($,{sx:{mb:3},children:[e.jsx(v,{variant:"subtitle2",sx:{mb:1},children:"Key Metrics"}),e.jsx(ye,{container:!0,spacing:2,children:m.slice(0,8).map((a,f)=>e.jsx(ye,{size:{xs:6,sm:4,md:3},children:e.jsx(Vt,{metric:a})},f))})]}),e.jsxs(we,{variant:"outlined",sx:{mb:3},children:[e.jsxs(st,{value:n,onChange:w,sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(ae,{icon:e.jsx(be,{}),label:`Charts (${u.length})`,iconPosition:"start"}),e.jsx(ae,{icon:e.jsx(ge,{}),label:`Tables (${g.length})`,iconPosition:"start"}),e.jsx(ae,{icon:e.jsx(nt,{}),label:`Fields (${y.length})`,iconPosition:"start"})]}),e.jsx(ie,{value:n,index:0,children:u.length>0?e.jsxs($,{children:[e.jsx(j,{direction:"row",spacing:1,sx:{mb:2,flexWrap:"wrap",gap:1},children:u.map((a,f)=>e.jsx(E,{label:a.title||`Chart ${f+1}`,onClick:()=>r(f),color:l===f?"primary":"default",variant:l===f?"filled":"outlined",icon:a.type==="line"?e.jsx(Ue,{}):e.jsx(be,{})},f))}),x&&e.jsx(Ke,{data:b,spec:x,height:400,showBrush:b.length>15})]}):e.jsx(v,{color:"text.secondary",textAlign:"center",py:4,children:"No chart suggestions available"})}),e.jsx(ie,{value:n,index:1,children:g.length>0?e.jsx(j,{spacing:2,children:g.map((a,f)=>e.jsxs(ot,{defaultExpanded:f===0,children:[e.jsx(at,{expandIcon:e.jsx(Be,{}),children:e.jsxs(j,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(ge,{fontSize:"small",color:"action"}),e.jsx(v,{fontWeight:500,children:a.title||a.id||`Table ${f+1}`}),e.jsx(E,{label:`${a.rows?.length||0} rows`,size:"small",variant:"outlined"}),e.jsx(E,{label:`${a.headers?.length||0} cols`,size:"small",variant:"outlined"}),a.source_page&&e.jsx(E,{label:`Page ${a.source_page}`,size:"small"}),a.source_sheet&&e.jsx(E,{label:a.source_sheet,size:"small"})]})}),e.jsx(rt,{sx:{p:0},children:e.jsx(Ot,{table:a})})]},f))}):e.jsx(v,{color:"text.secondary",textAlign:"center",py:4,children:"No tables extracted"})}),e.jsx(ie,{value:n,index:2,children:y.length>0?e.jsx(Ae,{children:e.jsxs(Re,{size:"small",children:[e.jsx(ke,{children:e.jsxs(te,{children:[e.jsx(D,{sx:{fontWeight:600},children:"Field Name"}),e.jsx(D,{sx:{fontWeight:600},children:"Type"}),e.jsx(D,{sx:{fontWeight:600},children:"Sample Values"})]})}),e.jsx(Te,{children:y.map((a,f)=>e.jsxs(te,{hover:!0,children:[e.jsx(D,{children:a.name}),e.jsx(D,{children:e.jsx(E,{label:a.type,size:"small",color:a.type==="numeric"?"success":a.type==="datetime"?"info":"default",variant:"outlined"})}),e.jsx(D,{children:a.sample_values?.slice(0,3).join(", ")||"-"})]},f))})]})}):e.jsx(v,{color:"text.secondary",textAlign:"center",py:4,children:"No field information available"})})]})]})}const Jt=[{label:"Upload Document",icon:e.jsx(Nt,{fontSize:"small"})},{label:"AI Analysis",icon:e.jsx(ee,{fontSize:"small"})},{label:"View Results",icon:e.jsx(Ze,{fontSize:"small"})}];function yn(){const[t,n]=i.useState(0),[s,l]=i.useState(null),[r,o]=i.useState(!1),[c,p]=i.useState(0),[h,g]=i.useState(""),[m,u]=i.useState(null),[b,y]=i.useState(null),[S,w]=i.useState(""),[I,z]=i.useState(!1),[x,a]=i.useState(!1),[f,C]=i.useState(null),[A,k]=i.useState(""),[T,N]=i.useState(""),M=i.useRef(null);i.useEffect(()=>()=>{M.current&&(M.current.abort(),M.current=null)},[]);const F=Oe(),{execute:R}=qe(),V=Je(),X=i.useCallback((d,L,P={})=>V(d,{label:L,intent:{from:"analyze",...P}}),[V]),se=i.useCallback(d=>{l(d),y(null),u(null),C(null),d&&n(0)},[]),Me=i.useCallback(()=>{if(s)return R({type:K.ANALYZE,label:x?"Queue analysis":"Analyze document",reversibility:Q.FULLY_REVERSIBLE,blocksNavigation:!x,suppressSuccessToast:!0,intent:{fileName:s?.name,background:x},action:async()=>{if(M.current=new AbortController,o(!0),p(0),g("Starting analysis..."),y(null),C(null),x){try{const d=await Ce({file:s,background:!0,connectionId:A||void 0,templateId:T||void 0}),L=d?.job_id||d?.jobId||null;C(L),u(null),n(0),F.show("Analysis queued in background","success")}catch(d){d.name!=="AbortError"&&y(d.message||"Failed to queue analysis")}finally{o(!1),p(0),g(""),M.current=null}return}n(1);try{const d=await Ce({file:s,connectionId:A||void 0,templateId:T||void 0,signal:M.current?.signal,onProgress:L=>{L.event==="stage"&&(p(L.progress||0),g(L.detail||L.stage||"Processing..."))}});d.event==="result"&&(u(d),n(2))}catch(d){d.name==="AbortError"?(F.show("Analysis cancelled","info"),n(0)):(y(d.message||"Analysis failed"),n(0))}finally{o(!1),p(100),M.current=null}}})},[R,s,x,F]),Pe=i.useCallback(()=>R({type:K.UPDATE,label:"Cancel analysis",reversibility:Q.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"analyze"},action:()=>{M.current&&(M.current.abort(),o(!1),n(0),p(0),g(""),F.show("Analysis cancelled","info"))}}),[R,F]),xe=i.useCallback(()=>{if(!(!m?.analysis_id||!S.trim()))return R({type:K.GENERATE,label:"Generate charts",reversibility:Q.FULLY_REVERSIBLE,blocksNavigation:!0,suppressSuccessToast:!0,intent:{analysisId:m.analysis_id},action:async()=>{z(!0);try{const d=await _t(m.analysis_id,{question:S,includeSampleData:!0});if(d?.charts){const L=d.charts.map((P,Fe)=>Dt(P,Fe)).filter(Boolean);u(P=>({...P,chart_suggestions:[...L,...P.chart_suggestions||[]]}))}}catch(d){y(d.message||"Failed to generate charts")}finally{z(!1),w("")}}})},[m?.analysis_id,S,R]),$e=i.useCallback(()=>R({type:K.UPDATE,label:"Reset analysis",reversibility:Q.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"analyze"},action:()=>{l(null),u(null),y(null),n(0),w(""),C(null)}}),[R]),he=(()=>{const d=[];if(s&&d.push({label:s.name,color:"primary",variant:"outlined"}),m){const L=m.tables?.length||0,P=m.chart_suggestions?.length||0;L>0&&d.push({label:`${L} table${L!==1?"s":""} found`,color:"success"}),P>0&&d.push({label:`${P} chart${P!==1?"s":""}`,color:"info"})}return d})();return e.jsxs($,{sx:{py:3,px:3},children:[e.jsxs(j,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:3},children:[e.jsxs($,{children:[e.jsx(v,{variant:"h5",fontWeight:600,children:"Analyze Document"}),e.jsx(v,{variant:"body2",color:"text.secondary",children:"Upload PDF or Excel files to extract tables and generate interactive visualizations."})]}),m&&e.jsx(W,{variant:"outlined",size:"small",startIcon:e.jsx(He,{}),onClick:$e,sx:{textTransform:"none",fontWeight:600},children:"New Analysis"})]}),e.jsxs(j,{spacing:3,children:[he.length>0&&e.jsx(j,{direction:"row",spacing:1,flexWrap:"wrap",children:he.map((d,L)=>e.jsx(E,{label:d.label,size:"small",variant:d.variant||"filled",icon:d.color==="success"?e.jsx(et,{}):void 0,sx:{fontWeight:500,bgcolor:P=>P.palette.mode==="dark"?Z(P.palette.text.primary,.1):ze[200],color:"text.secondary"}},L))}),f&&e.jsxs(O,{severity:"info",action:e.jsx(W,{size:"small",onClick:()=>X("/jobs","Open jobs"),sx:{textTransform:"none"},children:"View Jobs"}),sx:{alignItems:"center"},children:["Analysis queued in background. Job ID: ",f]}),e.jsxs(je,{sx:{p:3},children:[e.jsx(Ft,{activeStep:t,sx:{mb:3,"& .MuiStepLabel-label":{fontWeight:500},"& .MuiStepLabel-label.Mui-active":{fontWeight:600,color:"text.secondary"},"& .MuiStepLabel-label.Mui-completed":{fontWeight:600,color:"text.secondary"}},children:Jt.map((d,L)=>e.jsx(ht,{completed:t>L,children:e.jsx(Ee,{StepIconProps:{sx:{"&.Mui-completed":{color:"text.secondary"},"&.Mui-active":{color:"text.secondary"}}},children:e.jsxs(j,{direction:"row",alignItems:"center",spacing:.5,children:[d.icon,e.jsx("span",{children:d.label})]})})},d.label))}),t===0&&e.jsxs($,{children:[e.jsxs(j,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},children:[e.jsx(it,{value:A,onChange:k,label:"Analyze from Connection (Optional)",size:"small",showStatus:!0}),e.jsx(ct,{value:T,onChange:N,label:"Report Template (Optional)",size:"small"})]}),e.jsx(Bt,{onFileSelect:se,isUploading:r,progress:c,progressStage:h,error:b,disabled:r}),s&&!r&&e.jsxs(j,{spacing:2,sx:{mt:3},children:[e.jsx(Ye,{control:e.jsx(dt,{checked:x,onChange:d=>a(d.target.checked)}),label:"Run in background",sx:{alignSelf:"center"}}),e.jsx(j,{direction:"row",justifyContent:"center",children:e.jsx(W,{variant:"contained",size:"large",onClick:Me,startIcon:e.jsx(ee,{}),sx:{px:4,py:1.5,fontWeight:600,fontSize:"1rem",textTransform:"none",borderRadius:1,boxShadow:`0 4px 14px ${Z(fe.violet[500],.25)}`,"&:hover":{boxShadow:`0 6px 20px ${Z(fe.violet[500],.35)}`}},children:x?"Queue Analysis":"Analyze with AI"})})]})]}),t===1&&e.jsxs($,{sx:{textAlign:"center",py:6},children:[e.jsxs($,{sx:{position:"relative",display:"inline-flex",mb:3},children:[e.jsx(ve,{size:80,thickness:4,variant:c>0?"determinate":"indeterminate",value:c,sx:{color:"text.secondary"}}),e.jsx($,{sx:{position:"absolute",top:0,left:0,bottom:0,right:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(v,{variant:"caption",fontWeight:600,color:"text.secondary",children:[c,"%"]})})]}),e.jsx(v,{variant:"h6",fontWeight:600,gutterBottom:!0,children:h||"Analyzing document..."}),e.jsx(v,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"AI is extracting tables, metrics, and generating chart suggestions"}),e.jsx(Ie,{variant:"determinate",value:c,sx:{height:6,borderRadius:1,maxWidth:400,mx:"auto",mb:3,bgcolor:"action.hover","& .MuiLinearProgress-bar":{borderRadius:1}}}),e.jsx(W,{variant:"outlined",color:"inherit",startIcon:e.jsx(Ge,{}),onClick:Pe,sx:{textTransform:"none",fontWeight:500},children:"Cancel Analysis"})]}),t===2&&m&&e.jsxs($,{children:[e.jsx(qt,{result:m}),e.jsx(Xe,{sx:{my:3}}),e.jsxs(je,{variant:"outlined",sx:{p:2.5,bgcolor:"action.hover",border:"1px dashed",borderColor:"divider"},children:[e.jsxs(j,{direction:"row",alignItems:"center",spacing:1,sx:{mb:2},children:[e.jsx(ee,{color:"inherit",fontSize:"small",sx:{color:"text.secondary"}}),e.jsx(v,{variant:"subtitle1",fontWeight:600,children:"Ask for more insights"})]}),e.jsxs(j,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(Qe,{fullWidth:!0,placeholder:"e.g., Show me revenue trends over time, Compare categories by month...",value:S,onChange:d=>w(d.target.value),onKeyDown:d=>d.key==="Enter"&&!d.shiftKey&&xe(),disabled:I,size:"small",sx:{"& .MuiOutlinedInput-root":{bgcolor:"background.paper"}}}),e.jsx(W,{variant:"contained",onClick:xe,disabled:!S.trim()||I,startIcon:I?e.jsx(ve,{size:16,color:"inherit"}):e.jsx(ee,{}),sx:{minWidth:160,textTransform:"none",fontWeight:600,whiteSpace:"nowrap"},children:I?"Generating...":"Generate Charts"})]})]})]}),b&&t!==0&&e.jsx(O,{severity:"error",sx:{mt:2},children:b})]}),e.jsxs($,{sx:{textAlign:"center",py:1},children:[e.jsx(v,{variant:"body2",color:"text.secondary",children:"Supported formats: PDF, Excel (XLSX, XLS) â€¢ Max file size: 50MB"}),e.jsx(v,{variant:"caption",color:"text.disabled",children:"AI-powered extraction with zoomable, interactive time series charts"})]})]})]})}export{yn as default};
