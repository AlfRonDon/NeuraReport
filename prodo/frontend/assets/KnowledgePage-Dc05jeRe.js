import{i as c,bN as tt,u as nt,v as rt,a as $e,r as g,R as j,I as b,j as e,B as l,o as i,p as v,bS as O,bT as B,bU as _,aJ as J,b5 as at,b6 as Ae,bP as Z,aT as D,D as st,aU as w,ak as Se,e as ee,a1 as ot,f as m,b3 as Be,P as te,bQ as qe,a_ as lt,M as ne,s as it,G as ct,ah as Te,aj as Ee,al as Ie,am as Fe,K as G,A as _e,C as dt,N as C,n as S}from"./index-DeRHNZar.js";import{u as ut}from"./useSharedData-BAHlW-1G.js";import{u as gt,I as mt}from"./ImportFromMenu-BlfjbaAe.js";import{T as xt,F as ze}from"./useCrossPageActions-BCB3hlt6.js";import{W as Re}from"./FolderOpen-B5o5eiaY.js";import{D as We}from"./Star-C_pOy7CQ.js";import{F as pt}from"./Folder-DlBjtnpR.js";import{G as z}from"./Grid-C8zRHJnX.js";import{C as ht}from"./CardContent-B7RWOLhy.js";import{S as ft}from"./StarBorder-BmHtYBmF.js";import{C as yt}from"./CardActions-BXWuDUf7.js";import{M as jt}from"./MoreVert-BjEJop_-.js";import"./SummarizeRounded-qHrdYjfR.js";function Le(t){if(!t||typeof t!="object")return t;const a={...t};return a.file_type==null&&a.document_type&&(a.file_type=a.document_type),a.collection_ids==null&&Array.isArray(a.collections)&&(a.collection_ids=a.collections),a}function bt(t){switch(String(t||"").toLowerCase().split(".").pop()){case"pdf":return"pdf";case"doc":case"docx":return"docx";case"xls":case"xlsx":return"xlsx";case"ppt":case"pptx":return"pptx";case"txt":return"txt";case"md":case"markdown":return"md";case"htm":case"html":return"html";case"png":case"jpg":case"jpeg":case"gif":case"webp":return"image";default:return"other"}}async function wt(t){return(await c.post("/knowledge/documents",t)).data}async function re(t,a,n=null){const r=new FormData;return r.append("file",t),r.append("title",a||t.name),r.append("document_type",bt(t?.name)),n&&r.append("collection_id",n),(await c.post("/knowledge/documents",r,{headers:{"Content-Type":"multipart/form-data"}})).data}async function Ct(t){return(await c.get(`/knowledge/documents/${t}`)).data}async function kt(t={}){const n=(await c.get("/knowledge/documents",{params:{collection_id:t.collectionId,tags:Array.isArray(t.tags)?t.tags.join(","):t.tags,document_type:t.documentType,limit:t.pageSize||50,offset:t.offset||0}})).data;if(Array.isArray(n)){const r=n.map(Le);return{documents:r,total:r.length}}if(n&&Array.isArray(n.documents)){const r=n.documents.map(Le);return{...n,documents:r,total:n.total??r.length}}return{documents:[],total:0}}async function vt(t,a){return(await c.put(`/knowledge/documents/${t}`,a)).data}async function Dt(t){return(await c.delete(`/knowledge/documents/${t}`)).data}async function At(t){return(await c.post(`/knowledge/documents/${t}/favorite`)).data}async function St(t){return(await c.post("/knowledge/collections",t)).data}async function Tt(t){return(await c.get(`/knowledge/collections/${t}`)).data}async function Et(){const a=(await c.get("/knowledge/collections")).data;return Array.isArray(a)?a:a&&typeof a=="object"?Array.isArray(a.collections)?a.collections:[]:[]}async function It(t,a){return(await c.put(`/knowledge/collections/${t}`,a)).data}async function Ft(t){return(await c.delete(`/knowledge/collections/${t}`)).data}async function _t(t,a){return(await c.post(`/knowledge/collections/${t}/documents`,{document_id:a})).data}async function zt(t,a){return(await c.delete(`/knowledge/collections/${t}/documents/${a}`)).data}async function Rt(t,a=null){return(await c.post("/knowledge/tags",{name:t,color:a})).data}async function Wt(){const a=(await c.get("/knowledge/tags")).data;return Array.isArray(a)?a:a&&typeof a=="object"?Array.isArray(a.tags)?a.tags:[]:[]}async function Lt(t){return(await c.delete(`/knowledge/tags/${t}`)).data}async function Ut(t,a){return(await c.post(`/knowledge/documents/${t}/tags`,{tag_id:a})).data}async function $t(t,a){return(await c.delete(`/knowledge/documents/${t}/tags/${a}`)).data}async function Bt(t,a={}){return(await c.post("/knowledge/search",{query:t,collections:a.collectionId?[a.collectionId]:[],tags:a.tags||[],date_from:a.dateFrom,date_to:a.dateTo,limit:a.pageSize||50,offset:a.offset||0})).data}async function qt(t,a={}){return(await c.post("/knowledge/search/semantic",{query:t,top_k:a.limit||10,threshold:a.minSimilarity||.5})).data}async function Gt(t,a=5){return(await c.post("/knowledge/auto-tag",{document_id:t,max_tags:a})).data}async function Nt(t,a={}){return(await c.post("/knowledge/related",{document_id:t,limit:a.limit||10})).data}async function Mt(t={}){return(await c.post("/knowledge/knowledge-graph",{document_ids:t.documentIds||[],depth:t.depth||2,include_entities:t.includeEntities!==!1})).data}async function Kt(t={}){const a=Array.isArray(t.documentIds)?t.documentIds.filter(Boolean):[];return(await c.post("/knowledge/faq",{document_ids:a,max_questions:t.maxQuestions||10},{params:{background:t.background??!1}})).data}async function Ot(){return(await c.get("/knowledge/stats")).data}async function Pt(t,a={}){return(await c.get(`/knowledge/documents/${t}/activity`,{params:{days:a.days||30}})).data}const Ue=t=>(Array.isArray(t?.results)?t.results:[]).map(n=>{const r=n?.document&&typeof n.document=="object"?n.document:n;return!r||typeof r!="object"?null:{...r,_score:n?.score,_highlights:Array.isArray(n?.highlights)?n.highlights:[]}}).filter(Boolean),Qt=t=>(Array.isArray(t?.related)?t.related:[]).map(n=>n?.document).filter(n=>n&&typeof n=="object"),Yt=t=>Array.isArray(t?.faq?.items)?t.faq.items:Array.isArray(t?.items)?t.items:Array.isArray(t?.faq)?t.faq:[],Vt=tt((t,a)=>({documents:[],collections:[],tags:[],currentDocument:null,currentCollection:null,searchResults:[],relatedDocuments:[],knowledgeGraph:null,faq:[],stats:null,totalDocuments:0,loading:!1,searching:!1,error:null,setLoading:n=>t({loading:n}),setError:n=>t({error:n}),addDocument:async n=>{t({loading:!0,error:null});try{const r=await wt(n);return t(o=>({documents:[r,...o.documents].slice(0,500),currentDocument:r,loading:!1})),r}catch(r){return t({error:r.message,loading:!1}),null}},fetchDocuments:async(n={})=>{t({loading:!0,error:null});try{const r=await kt(n);return t({documents:r.documents||[],totalDocuments:r.total||0,loading:!1}),r}catch(r){return t({error:r.message,loading:!1}),null}},getDocument:async n=>{t({loading:!0,error:null});try{const r=await Ct(n);return t({currentDocument:r,loading:!1}),r}catch(r){return t({error:r.message,loading:!1}),null}},updateDocument:async(n,r)=>{t({loading:!0,error:null});try{const o=await vt(n,r);return t(u=>({documents:u.documents.map(T=>T.id===n?o:T),currentDocument:u.currentDocument?.id===n?o:u.currentDocument,loading:!1})),o}catch(o){return t({error:o.message,loading:!1}),null}},deleteDocument:async n=>{t({loading:!0,error:null});try{return await Dt(n),t(r=>({documents:r.documents.filter(o=>o.id!==n),currentDocument:r.currentDocument?.id===n?null:r.currentDocument,loading:!1})),!0}catch(r){return t({error:r.message,loading:!1}),!1}},toggleFavorite:async n=>{try{const r=await At(n);return t(o=>({documents:o.documents.map(u=>u.id===n?{...u,is_favorite:r.is_favorite}:u),currentDocument:o.currentDocument?.id===n?{...o.currentDocument,is_favorite:r.is_favorite}:o.currentDocument})),r}catch(r){return t({error:r.message}),null}},createCollection:async n=>{t({loading:!0,error:null});try{const r=await St(n);return t(o=>({collections:[r,...o.collections].slice(0,200),currentCollection:r,loading:!1})),r}catch(r){return t({error:r.message,loading:!1}),null}},fetchCollections:async()=>{t({loading:!0,error:null});try{const n=await Et();return t({collections:n||[],loading:!1}),n}catch(n){return t({error:n.message,loading:!1}),[]}},getCollection:async n=>{t({loading:!0,error:null});try{const r=await Tt(n);return t({currentCollection:r,loading:!1}),r}catch(r){return t({error:r.message,loading:!1}),null}},updateCollection:async(n,r)=>{t({loading:!0,error:null});try{const o=await It(n,r);return t(u=>({collections:u.collections.map(T=>T.id===n?o:T),currentCollection:u.currentCollection?.id===n?o:u.currentCollection,loading:!1})),o}catch(o){return t({error:o.message,loading:!1}),null}},deleteCollection:async n=>{t({loading:!0,error:null});try{return await Ft(n),t(r=>({collections:r.collections.filter(o=>o.id!==n),currentCollection:r.currentCollection?.id===n?null:r.currentCollection,loading:!1})),!0}catch(r){return t({error:r.message,loading:!1}),!1}},addDocumentToCollection:async(n,r)=>{try{return await _t(n,r),await a().getCollection(n),!0}catch(o){return t({error:o.message}),!1}},removeDocumentFromCollection:async(n,r)=>{try{return await zt(n,r),await a().getCollection(n),!0}catch(o){return t({error:o.message}),!1}},createTag:async(n,r=null)=>{t({loading:!0,error:null});try{const o=await Rt(n,r);return t(u=>({tags:[o,...u.tags].slice(0,500),loading:!1})),o}catch(o){return t({error:o.message,loading:!1}),null}},fetchTags:async()=>{try{const n=await Wt();return t({tags:n||[]}),n}catch(n){return t({error:n.message}),[]}},deleteTag:async n=>{try{return await Lt(n),t(r=>({tags:r.tags.filter(o=>o.id!==n)})),!0}catch(r){return t({error:r.message}),!1}},addTagToDocument:async(n,r)=>{try{return await Ut(n,r),await a().getDocument(n),!0}catch(o){return t({error:o.message}),!1}},removeTagFromDocument:async(n,r)=>{try{return await $t(n,r),await a().getDocument(n),!0}catch(o){return t({error:o.message}),!1}},getDocumentActivity:async n=>{try{return await Pt(n)}catch(r){return t({error:r.message}),null}},searchDocuments:async(n,r={})=>{t({searching:!0,error:null});try{const o=await Bt(n,r);return t({searchResults:Ue(o),searching:!1}),o}catch(o){return t({error:o.message,searching:!1}),null}},semanticSearch:async(n,r={})=>{t({searching:!0,error:null});try{const o=await qt(n,r);return t({searchResults:Ue(o),searching:!1}),o}catch(o){return t({error:o.message,searching:!1}),null}},autoTag:async n=>{t({loading:!0,error:null});try{const r=await Gt(n);return await a().getDocument(n),t({loading:!1}),r}catch(r){return t({error:r.message,loading:!1}),null}},findRelated:async(n,r={})=>{t({loading:!0,error:null});try{const o=await Nt(n,r);return t({relatedDocuments:Qt(o),loading:!1}),o}catch(o){return t({error:o.message,loading:!1}),[]}},buildKnowledgeGraph:async(n={})=>{t({loading:!0,error:null});try{const r=await Mt(n);return t({knowledgeGraph:r,loading:!1}),r}catch(r){return t({error:r.message,loading:!1}),null}},generateFaq:async(n={})=>{t({loading:!0,error:null});try{const r=await Kt(n);return t({faq:Yt(r),loading:!1}),r}catch(r){return t({error:r.message,loading:!1}),[]}},fetchStats:async()=>{try{const n=await Ot();return t({stats:n}),n}catch(n){return t({error:n.message}),null}},clearSearchResults:()=>t({searchResults:[]}),reset:()=>t({currentDocument:null,currentCollection:null,searchResults:[],relatedDocuments:[],error:null})})),Xt=C(l)(({theme:t})=>({display:"flex",flexDirection:"column",height:"calc(100vh - 64px)",backgroundColor:t.palette.background.default})),Ht=C(l)(({theme:t})=>({padding:t.spacing(2,3),borderBottom:`1px solid ${m(t.palette.divider,.1)}`,backgroundColor:m(t.palette.background.paper,.8)})),Jt=C(l)(({theme:t})=>({flex:1,display:"flex",overflow:"hidden"})),Zt=C(l)(({theme:t})=>({width:260,borderRight:`1px solid ${m(t.palette.divider,.1)}`,backgroundColor:m(t.palette.background.paper,.6),display:"flex",flexDirection:"column"})),en=C(l)(({theme:t})=>({flex:1,padding:t.spacing(3),overflow:"auto"})),tn=C(Be)(({theme:t})=>({cursor:"pointer",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{transform:"translateY(-2px)",boxShadow:`0 8px 24px ${m(t.palette.text.primary,.05)}`}})),q=C(qe)(({theme:t,selected:a})=>({borderRadius:8,marginBottom:4,backgroundColor:a?t.palette.mode==="dark"?m(t.palette.text.primary,.1):S[100]:"transparent","&:hover":{backgroundColor:t.palette.mode==="dark"?m(t.palette.text.primary,.05):S[50]}})),A=C(G)(({theme:t})=>({borderRadius:8,textTransform:"none",fontWeight:500})),nn=C(l)(({theme:t,isDragActive:a})=>({border:`2px dashed ${a?t.palette.mode==="dark"?S[500]:S[700]:m(t.palette.divider,.3)}`,borderRadius:8,padding:t.spacing(6),textAlign:"center",backgroundColor:a?t.palette.mode==="dark"?m(t.palette.text.primary,.05):S[50]:m(t.palette.background.paper,.5),cursor:"pointer",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{borderColor:t.palette.mode==="dark"?S[500]:S[700],backgroundColor:t.palette.mode==="dark"?m(t.palette.text.primary,.02):S[50]}}));function rn(){const t=nt(),a=rt(),{execute:n}=$e(),{connections:r,templates:o}=ut();gt(ze.KNOWLEDGE,{[xt.SAVE_TO]:async s=>{const d=typeof s.content=="string"?s.content:JSON.stringify(s.content),U=new Blob([d],{type:"text/plain"}),$=new File([U],`${s.title||"Imported"}.txt`,{type:"text/plain"});await re($,s.title||"Imported Document",p?.id),x()}});const{documents:u,collections:T,tags:Ge,currentDocument:an,currentCollection:sn,searchResults:ae,relatedDocuments:on,knowledgeGraph:h,faq:E,stats:se,totalDocuments:ln,loading:k,searching:cn,error:oe,fetchDocuments:x,fetchCollections:le,fetchTags:ie,createCollection:ce,deleteDocument:de,toggleFavorite:ue,searchDocuments:ge,autoTag:me,findRelated:xe,buildKnowledgeGraph:pe,generateFaq:he,fetchStats:fe,reset:ye}=Vt(),[I,Ne]=g.useState(""),[p,P]=g.useState(null),[f,F]=g.useState("all"),[Me,N]=g.useState(!1),[R,je]=g.useState(""),[be,we]=g.useState(null),[Q,Ce]=g.useState(null),[Ke,W]=g.useState(!1),[y,ke]=g.useState(null),[M,Y]=g.useState(""),[L,ve]=g.useState(!1);g.useEffect(()=>(x(),le(),ie(),fe(),()=>ye()),[le,x,fe,ie,ye]);const Oe=g.useCallback(async()=>{if(!I.trim()){x();return}return n({type:b.EXECUTE,label:"Search library",reversibility:j.FULLY_REVERSIBLE,suppressSuccessToast:!0,intent:{source:"knowledge",query:I},action:()=>ge(I)})},[n,x,ge,I]),Pe=g.useCallback(s=>{P(s),s?x({collectionId:s.id}):x()},[x]),Qe=g.useCallback(async s=>n({type:b.UPDATE,label:"Toggle favorite",reversibility:j.FULLY_REVERSIBLE,intent:{source:"knowledge",documentId:s},action:()=>ue(s)}),[n,ue]),Ye=g.useCallback(async s=>n({type:b.DELETE,label:"Delete document",reversibility:j.SYSTEM_MANAGED,intent:{source:"knowledge",documentId:s},action:async()=>{await de(s),a.show("Document deleted","success")}}),[de,n,a]),Ve=g.useCallback(async s=>n({type:b.UPDATE,label:"Auto-tag document",reversibility:j.SYSTEM_MANAGED,blocksNavigation:!0,intent:{source:"knowledge",documentId:s},action:async()=>{await me(s),a.show("Tags generated","success")}}),[me,n,a]),Xe=g.useCallback(async s=>n({type:b.EXECUTE,label:"Find related documents",reversibility:j.FULLY_REVERSIBLE,intent:{source:"knowledge",documentId:s},action:()=>xe(s)}),[n,xe]),V=g.useCallback(async()=>{const s=u.map(d=>d?.id).filter(Boolean);return n({type:b.EXECUTE,label:"Build knowledge graph",reversibility:j.FULLY_REVERSIBLE,blocksNavigation:!0,intent:{source:"knowledge"},action:async()=>{await pe({collectionId:p?.id,documentIds:s}),F("graph"),a.show("Knowledge graph built","success")}})},[pe,u,n,p?.id,a]),X=g.useCallback(async()=>{const s=u.map(d=>d?.id).filter(Boolean);return s.length?n({type:b.EXECUTE,label:"Generate FAQ",reversibility:j.FULLY_REVERSIBLE,blocksNavigation:!0,intent:{source:"knowledge"},action:async()=>{(await he({collectionId:p?.id,documentIds:s,background:!1}))?.status==="queued"?a.show("FAQ generation queued","info"):(F("faq"),a.show("FAQ generated","success"))}}):(a.show("Upload at least one document before generating FAQ","warning"),null)},[u,n,he,p?.id,a]),He=g.useCallback(async()=>{if(R.trim())return n({type:b.CREATE,label:"Create collection",reversibility:j.SYSTEM_MANAGED,intent:{source:"knowledge",name:R},action:async()=>{await ce({name:R}),a.show("Collection created","success"),je(""),N(!1)}})},[ce,n,R,a]),Je=(s,d)=>{we(s.currentTarget),Ce(d)},K=()=>{we(null),Ce(null)},Ze=g.useCallback(async()=>{if(!y){a.show("Please select a file to upload","warning");return}return n({type:b.CREATE,label:"Upload document",reversibility:j.SYSTEM_MANAGED,blocksNavigation:!0,intent:{source:"knowledge",fileName:y.name},action:async()=>{ve(!0);try{await re(y,M||y.name,p?.id),a.show("Document uploaded successfully!","success"),W(!1),ke(null),Y(""),x()}catch(s){a.show(s.userMessage||s.message||"Failed to upload document","error")}finally{ve(!1)}}})},[n,x,p,a,y,M]),et=s=>{const d=s.target.files?.[0];d&&(ke(d),M||Y(d.name.replace(/\.[^/.]+$/,"")))},De=f==="favorites"?u.filter(s=>s.is_favorite):I&&ae.length>0?ae:u;return e.jsxs(Xt,{children:[e.jsx(Ht,{children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Re,{sx:{color:"text.secondary",fontSize:28}}),e.jsxs(l,{children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:"Knowledge Library"}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsxs(i,{variant:"body2",color:"text.secondary",children:[se?.total_documents||0," documents in ",se?.total_collections||0," collections"]}),r.length>0&&e.jsx(v,{label:`${r.length} connections`,size:"small",variant:"outlined"}),o.length>0&&e.jsx(v,{label:`${o.length} templates`,size:"small",variant:"outlined"})]})]})]}),e.jsxs(l,{sx:{display:"flex",gap:1},children:[e.jsx(mt,{currentFeature:ze.KNOWLEDGE,onImport:async s=>{const d=typeof s.data=="string"?s.data:JSON.stringify(s.data),U=new Blob([d],{type:"text/plain"}),$=new File([U],`${s.title||"Imported"}.txt`,{type:"text/plain"});await re($,s.title||"Imported",p?.id),x(),a.show(`"${s.title}" saved to library`,"success")}}),e.jsx(A,{variant:"contained",startIcon:e.jsx(O,{}),onClick:()=>W(!0),children:"Upload Document"}),e.jsx(A,{startIcon:e.jsx(B,{}),onClick:V,disabled:k,children:"Knowledge Graph"}),e.jsx(A,{startIcon:e.jsx(_,{}),onClick:X,disabled:k,children:"Generate FAQ"})]})]})}),e.jsxs(Jt,{children:[e.jsxs(Zt,{children:[e.jsx(l,{sx:{p:2},children:e.jsx(J,{fullWidth:!0,size:"small",placeholder:"Search...",value:I,onChange:s=>Ne(s.target.value),onKeyDown:s=>s.key==="Enter"&&Oe(),InputProps:{startAdornment:e.jsx(at,{position:"start",children:e.jsx(Ae,{fontSize:"small"})})}})}),e.jsxs(Z,{dense:!0,sx:{px:1},children:[e.jsxs(q,{button:!0,selected:f==="all"&&!p,onClick:()=>{F("all"),P(null),x()},children:[e.jsx(D,{sx:{minWidth:36},children:e.jsx(st,{fontSize:"small"})}),e.jsx(w,{primary:"All Documents"})]}),e.jsxs(q,{button:!0,selected:f==="favorites",onClick:()=>{F("favorites"),P(null),x({favoritesOnly:!0})},children:[e.jsx(D,{sx:{minWidth:36},children:e.jsx(We,{fontSize:"small",sx:{color:"text.secondary"}})}),e.jsx(w,{primary:"Favorites"})]}),e.jsxs(q,{button:!0,selected:f==="graph",onClick:()=>F("graph"),children:[e.jsx(D,{sx:{minWidth:36},children:e.jsx(B,{fontSize:"small",sx:{color:"text.secondary"}})}),e.jsx(w,{primary:"Knowledge Graph",secondary:h?`${h.nodes?.length||0} nodes`:null})]}),e.jsxs(q,{button:!0,selected:f==="faq",onClick:()=>F("faq"),children:[e.jsx(D,{sx:{minWidth:36},children:e.jsx(_,{fontSize:"small",sx:{color:"text.secondary"}})}),e.jsx(w,{primary:"FAQ",secondary:E.length?`${E.length} items`:null})]})]}),e.jsx(Se,{sx:{my:1}}),e.jsxs(l,{sx:{px:2,py:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:600},children:"COLLECTIONS"}),e.jsx(ee,{size:"small",onClick:()=>N(!0),children:e.jsx(ot,{fontSize:"small"})})]}),e.jsx(Z,{dense:!0,sx:{px:1,flex:1,overflow:"auto"},children:T.map(s=>e.jsxs(q,{button:!0,selected:p?.id===s.id,onClick:()=>Pe(s),children:[e.jsx(D,{sx:{minWidth:36},children:e.jsx(pt,{fontSize:"small",sx:{color:"text.secondary"}})}),e.jsx(w,{primary:s.name,secondary:`${s.document_count||0} docs`})]},s.id))}),e.jsxs(l,{sx:{p:2,borderTop:`1px solid ${m(t.palette.divider,.1)}`},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:600,display:"block",mb:1},children:"TAGS"}),e.jsx(l,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:Ge.slice(0,10).map(s=>e.jsx(v,{size:"small",label:s.name,variant:"filled",onClick:()=>x({tags:[s.name]})},s.id))})]})]}),e.jsx(en,{children:k&&!u.length&&f!=="graph"&&f!=="faq"?e.jsx(z,{container:!0,spacing:2,children:Array.from({length:6}).map((s,d)=>e.jsx(z,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(Be,{variant:"outlined",sx:{p:2},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",mb:1.5},children:[e.jsx(l,{sx:{width:"70%",height:20,bgcolor:m(t.palette.text.primary,.08),borderRadius:1}}),e.jsx(l,{sx:{width:24,height:24,bgcolor:m(t.palette.text.primary,.05),borderRadius:"50%"}})]}),e.jsx(l,{sx:{width:"50%",height:14,bgcolor:m(t.palette.text.primary,.05),borderRadius:1,mb:1.5}}),e.jsxs(l,{sx:{display:"flex",gap:.5},children:[e.jsx(l,{sx:{width:48,height:20,bgcolor:m(t.palette.text.primary,.05),borderRadius:1}}),e.jsx(l,{sx:{width:56,height:20,bgcolor:m(t.palette.text.primary,.05),borderRadius:1}})]})]})},d))}):f==="graph"?h?e.jsxs(l,{children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(l,{children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:"Knowledge Graph"}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[h.nodes?.length||0," nodes, ",h.edges?.length||0," relationships"]})]}),e.jsx(A,{startIcon:e.jsx(B,{}),onClick:V,disabled:k,children:"Rebuild"})]}),e.jsx(i,{variant:"overline",sx:{fontWeight:600,display:"block",mb:1},children:"Entities"}),e.jsx(z,{container:!0,spacing:1.5,sx:{mb:3},children:h.nodes?.map(s=>e.jsx(z,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(te,{variant:"outlined",sx:{p:2,borderRadius:1,transition:"all 0.15s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{borderColor:"text.secondary",transform:"translateY(-1px)"}},children:[e.jsx(l,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:e.jsx(v,{size:"small",label:s.type,color:s.type==="document"?"primary":s.type==="entity"?"secondary":"default",variant:"outlined"})}),e.jsx(i,{variant:"body2",sx:{fontWeight:600},children:s.label}),s.properties?.description&&e.jsx(i,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:s.properties.description})]})},s.id))}),h.edges?.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"overline",sx:{fontWeight:600,display:"block",mb:1},children:"Relationships"}),e.jsx(te,{variant:"outlined",sx:{borderRadius:1},children:e.jsx(Z,{dense:!0,children:h.edges.map((s,d)=>{const U=h.nodes?.find(H=>H.id===s.source),$=h.nodes?.find(H=>H.id===s.target);return e.jsx(qe,{divider:d<h.edges.length-1,children:e.jsx(w,{primary:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(i,{variant:"body2",sx:{fontWeight:600},children:U?.label||s.source}),e.jsx(v,{size:"small",label:s.type,variant:"outlined"}),e.jsx(i,{variant:"body2",sx:{fontWeight:600},children:$?.label||s.target})]})})},d)})})})]})]}):e.jsxs(l,{sx:{height:"50vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(B,{sx:{fontSize:64,color:"text.disabled",mb:2}}),e.jsx(i,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No knowledge graph yet"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:3,textAlign:"center",maxWidth:400},children:"Build a knowledge graph to visualize relationships between your documents, entities, and concepts."}),e.jsx(A,{variant:"contained",size:"large",startIcon:e.jsx(B,{}),onClick:V,disabled:k||!u.length,children:"Build Knowledge Graph"})]}):f==="faq"?E.length>0?e.jsxs(l,{children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(l,{children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:"Frequently Asked Questions"}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[E.length," question",E.length!==1?"s":""," generated from your documents"]})]}),e.jsx(A,{startIcon:e.jsx(_,{}),onClick:X,disabled:k,children:"Regenerate"})]}),e.jsx(l,{sx:{display:"flex",flexDirection:"column",gap:2},children:E.map((s,d)=>e.jsx(te,{variant:"outlined",sx:{p:2.5,borderRadius:1},children:e.jsxs(l,{sx:{display:"flex",alignItems:"flex-start",gap:1.5},children:[e.jsx(_,{sx:{color:"text.secondary",fontSize:20,mt:.25,flexShrink:0}}),e.jsxs(l,{sx:{flex:1},children:[e.jsx(i,{variant:"body1",sx:{fontWeight:600,mb:1},children:s.question}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{lineHeight:1.7},children:s.answer}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,mt:1.5},children:[s.category&&e.jsx(v,{size:"small",label:s.category,variant:"outlined"}),s.confidence!=null&&e.jsx(v,{size:"small",label:`${Math.round(s.confidence*100)}% confidence`,variant:"outlined",color:s.confidence>=.8?"success":s.confidence>=.5?"warning":"default"})]})]})]})},d))})]}):e.jsxs(l,{sx:{height:"50vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(_,{sx:{fontSize:64,color:"text.disabled",mb:2}}),e.jsx(i,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No FAQ generated yet"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:3,textAlign:"center",maxWidth:400},children:"Generate FAQ from your documents to surface the most important questions and answers."}),e.jsx(A,{variant:"contained",size:"large",startIcon:e.jsx(_,{}),onClick:X,disabled:k||!u.length,children:"Generate FAQ"})]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{container:!0,spacing:2,children:De.map(s=>e.jsx(z,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(tn,{children:[e.jsxs(ht,{children:[e.jsxs(l,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[e.jsxs(l,{sx:{flex:1},children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600},noWrap:!0,children:s.title}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:[s.file_type?.toUpperCase()," - ",new Date(s.updated_at).toLocaleDateString()]})]}),e.jsx(ee,{size:"small",onClick:()=>Qe(s.id),children:s.is_favorite?e.jsx(We,{sx:{color:"text.secondary"}}):e.jsx(ft,{})})]}),s.tags?.length>0&&e.jsx(l,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:s.tags.slice(0,3).map(d=>e.jsx(v,{size:"small",label:d,variant:"outlined"},d))})]}),e.jsx(yt,{sx:{justifyContent:"flex-end",pt:0},children:e.jsx(ee,{size:"small",onClick:d=>Je(d,s),children:e.jsx(jt,{fontSize:"small"})})})]})},s.id))}),De.length===0&&!k&&e.jsxs(l,{sx:{height:"50vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(Re,{sx:{fontSize:64,color:"text.disabled",mb:2}}),e.jsx(i,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No documents found"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:3,textAlign:"center",maxWidth:400},children:"Upload your first document to start building your knowledge base. We support PDF, Word, Text, and Markdown files."}),e.jsx(A,{variant:"contained",size:"large",startIcon:e.jsx(O,{}),onClick:()=>W(!0),children:"Upload Your First Document"})]})]})})]}),e.jsxs(lt,{anchorEl:be,open:!!be,onClose:K,children:[e.jsxs(ne,{onClick:()=>{Ve(Q?.id),K()},children:[e.jsx(D,{children:e.jsx(it,{fontSize:"small"})}),e.jsx(w,{children:"Auto-tag"})]}),e.jsxs(ne,{onClick:()=>{Xe(Q?.id),K()},children:[e.jsx(D,{children:e.jsx(Ae,{fontSize:"small"})}),e.jsx(w,{children:"Find Related"})]}),e.jsx(Se,{}),e.jsxs(ne,{onClick:()=>{Ye(Q?.id),K()},children:[e.jsx(D,{children:e.jsx(ct,{fontSize:"small",sx:{color:"text.secondary"}})}),e.jsx(w,{children:"Delete"})]})]}),e.jsxs(Te,{open:Me,onClose:()=>N(!1),children:[e.jsx(Ee,{children:"Create Collection"}),e.jsx(Ie,{children:e.jsx(J,{autoFocus:!0,fullWidth:!0,label:"Collection Name",value:R,onChange:s=>je(s.target.value),sx:{mt:1}})}),e.jsxs(Fe,{children:[e.jsx(G,{onClick:()=>N(!1),children:"Cancel"}),e.jsx(G,{variant:"contained",onClick:He,children:"Create"})]})]}),e.jsxs(Te,{open:Ke,onClose:()=>!L&&W(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ee,{children:"Upload Document"}),e.jsxs(Ie,{children:[e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Upload a document to add it to your knowledge library. Supported formats: PDF, DOCX, TXT, MD, HTML"}),e.jsxs(nn,{onClick:()=>document.getElementById("document-upload-input")?.click(),sx:{mb:3},children:[e.jsx("input",{id:"document-upload-input",type:"file",accept:".pdf,.docx,.doc,.txt,.md,.html",onChange:et,style:{display:"none"}}),e.jsx(O,{sx:{fontSize:48,color:"text.disabled",mb:2}}),y?e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600},children:y.name}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[(y.size/1024/1024).toFixed(2)," MB - Click to change"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600},children:"Click to select a file"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:"or drag and drop here"})]})]}),e.jsx(J,{fullWidth:!0,label:"Document Title",value:M,onChange:s=>Y(s.target.value),placeholder:"Enter a title for this document",sx:{mb:2}}),p&&e.jsxs(_e,{severity:"info",children:['This document will be added to the "',p.name,'" collection.']})]}),e.jsxs(Fe,{children:[e.jsx(G,{onClick:()=>W(!1),disabled:L,children:"Cancel"}),e.jsx(G,{variant:"contained",onClick:Ze,disabled:!y||L,startIcon:L?e.jsx(dt,{size:16}):e.jsx(O,{}),children:L?"Uploading...":"Upload"})]})]}),oe&&e.jsx(_e,{severity:"error",sx:{m:2},children:oe})]})}function kn(){return $e(),e.jsx(rn,{})}export{kn as default};
