import{e as ee,j as e,cr as te,B as j,T as Y,o as J,k as $,aG as re,p as u,S as p,s as g,as as K,K as ae,r as c,u as se,R as ne,I as oe,Y as le,P as U,N as I,an as ie,ai as ce,aj as de,a3 as ue,cs as pe,aN as he,Q as be,C as xe,b1 as me,aJ as fe,t as ye,Z as ge,n as je,ct as ve}from"./index-B8Eu23bA.js";import{S as Ce}from"./Switch-CKmzMGzD.js";const Te=ae`
  from {
    opacity: 0;
    transform: translateX(20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
`;function qe({open:t,onClose:n,title:i,subtitle:x,children:T,anchor:r="right",width:A=480,actions:D,loading:q=!1,confirmLabel:E="Save",cancelLabel:m="Cancel",onConfirm:d,onCancel:_,confirmDisabled:h=!1}){const s=ee(),v=()=>{_?.(),n()};return e.jsx(te,{anchor:r,open:t,onClose:n,PaperProps:{sx:{width:{xs:"100%",sm:A},maxWidth:"100%",bgcolor:u(s.palette.background.paper,.98),backdropFilter:"blur(20px)",borderLeft:`1px solid ${u(s.palette.divider,.08)}`,boxShadow:`0 0 64px ${u(s.palette.common.black,.25)}`}},slotProps:{backdrop:{sx:{bgcolor:u(s.palette.common.black,.5),backdropFilter:"blur(4px)"}}},children:e.jsxs(j,{sx:{display:"flex",flexDirection:"column",height:"100%",animation:`${Te} 0.3s ease-out`},children:[e.jsxs(j,{sx:{px:3,py:2.5,display:"flex",alignItems:"flex-start",justifyContent:"space-between",borderBottom:`1px solid ${u(s.palette.divider,.08)}`},children:[e.jsxs(j,{children:[e.jsx(Y,{sx:{fontSize:"1.125rem",fontWeight:600,color:s.palette.text.primary,letterSpacing:"-0.01em"},children:i}),x&&e.jsx(Y,{sx:{fontSize:"0.8125rem",color:s.palette.text.secondary,mt:.5},children:x})]}),e.jsx(J,{onClick:n,size:"small",sx:{color:s.palette.text.secondary,borderRadius:1,transition:"all 0.2s ease","&:hover":{bgcolor:s.palette.mode==="dark"?u(s.palette.text.primary,.08):$[300],color:s.palette.text.primary,transform:"rotate(90deg)"}},children:e.jsx(re,{sx:{fontSize:18}})})]}),e.jsx(j,{sx:{flex:1,overflow:"auto",p:3,bgcolor:u(s.palette.background.default,.5)},children:T}),(D||d)&&e.jsx(j,{sx:{px:3,py:2.5,borderTop:`1px solid ${u(s.palette.divider,.08)}`,bgcolor:s.palette.background.paper},children:D||e.jsxs(p,{direction:"row",spacing:1.5,justifyContent:"flex-end",children:[e.jsx(g,{variant:"outlined",onClick:v,disabled:q,sx:{borderRadius:1,textTransform:"none",fontWeight:500,color:s.palette.text.secondary,borderColor:u(s.palette.divider,.2),transition:"all 0.2s ease","&:hover":{borderColor:u(s.palette.text.primary,.3),bgcolor:u(s.palette.text.primary,.05)}},children:m}),e.jsx(g,{variant:"contained",onClick:d,disabled:h||q,startIcon:q?e.jsx(K,{size:16,color:"inherit"}):null,sx:{borderRadius:1,textTransform:"none",fontWeight:600,bgcolor:s.palette.mode==="dark"?$[1100]:$[1200],boxShadow:`0 4px 14px ${u(s.palette.common.black,.15)}`,transition:"all 0.2s ease","&:hover":{bgcolor:s.palette.mode==="dark"?$[1e3]:$[1100],boxShadow:`0 6px 20px ${u(s.palette.common.black,.2)}`,transform:"translateY(-1px)"},"&:active":{transform:"translateY(0)"}},children:E})]})})]})})}function Se(t){return t==null?!0:typeof t=="string"?t.trim().length===0:Array.isArray(t)?t.length===0:!1}function W(t,n="This field"){return Se(t)?{valid:!1,error:`${n} is required`}:{valid:!0,error:null}}function we(t,n,i="This field"){return typeof t!="string"?{valid:!1,error:`${i} must be a string`}:t.trim().length<n?{valid:!1,error:`${i} must be at least ${n} characters`}:{valid:!0,error:null}}function M(t,n,i="This field"){return typeof t!="string"?{valid:!0,error:null}:t.length>n?{valid:!1,error:`${i} must be at most ${n} characters`}:{valid:!0,error:null}}function H(...t){return(n,i)=>{for(const x of t){const T=x(n,i);if(!T.valid)return T}return{valid:!0,error:null}}}const ke={name:'A friendly name to identify this connection. Example: "Production Database" or "Local Dev".',db_type:"The type of database you're connecting to. Contact your database administrator if you're unsure.",host:'The server address where your database is hosted. This could be a domain name (db.example.com) or an IP address (192.168.1.1). Use "localhost" for local databases.',port:"The port number your database listens on. Default ports: PostgreSQL (5432), MySQL (3306), SQL Server (1433). Usually you don't need to change this.",database:"The name of the specific database you want to connect to on the server. Ask your database administrator if you're not sure.",database_sqlite:"The file path to your SQLite database file. Example: /home/user/data/myapp.db",username:"Your database username. This is the account that will be used to run queries.",password:"Your database password. This will be stored securely and encrypted.",ssl:"Enable SSL/TLS encryption for secure connections. Recommended for production databases, especially over the internet."};function y({field:t}){const n=ke[t];return n?e.jsx(je,{title:n,arrow:!0,placement:"top",children:e.jsx(J,{size:"small",sx:{p:.5},"aria-label":n,children:e.jsx(ve,{sx:{fontSize:16,color:"text.secondary"}})})}):null}const N=[{value:"sqlite",label:"SQLite",port:null,requiresAuth:!1},{value:"postgresql",label:"PostgreSQL",port:5432,requiresAuth:!0},{value:"mysql",label:"MySQL",port:3306,requiresAuth:!0},{value:"mssql",label:"SQL Server",port:1433,requiresAuth:!0},{value:"mariadb",label:"MariaDB",port:3306,requiresAuth:!0}],L={name:H(t=>W(t,"Connection name"),t=>we(t,2,"Connection name"),t=>M(t,100,"Connection name")),host:(t,n)=>n.db_type==="sqlite"?{valid:!0,error:null}:H(i=>W(i,"Host"),i=>M(i,255,"Host"))(t),database:H(t=>W(t,"Database name"),t=>M(t,255,"Database name")),port:t=>{const n=parseInt(t,10);return isNaN(n)||n<1||n>65535?{valid:!1,error:"Port must be between 1 and 65535"}:{valid:!0,error:null}}};function Ee({connection:t,onSave:n,onCancel:i,loading:x}){const T=N.some(a=>a.value===t?.db_type)?t?.db_type:"sqlite",[r,A]=c.useState({name:t?.name||"",db_type:T,host:t?.host||"localhost",port:t?.port||5432,database:t?.database||"",username:t?.username||"",password:"",ssl:t?.ssl??!0}),[D,q]=c.useState(!1),[E,m]=c.useState(null),[d,_]=c.useState({}),[h,s]=c.useState({}),[v,O]=c.useState(!1),[S,w]=c.useState(null),F=c.useRef(!1),{execute:G}=se(),C=c.useCallback(a=>o=>{const l=o.target.type==="checkbox"?o.target.checked:o.target.value;A(b=>{const R={...b,[a]:l};if(d[a]&&L[a]){const k=L[a](l,R);s(Q=>({...Q,[a]:k.error}))}return R}),m(null)},[d]),P=c.useCallback(a=>()=>{if(_(o=>({...o,[a]:!0})),L[a]){const o=L[a](r[a],r);s(l=>({...l,[a]:o.error}))}},[r]),V=c.useCallback(a=>{const o=a.target.value,l=N.find(b=>b.value===o);A(b=>({...b,db_type:o,port:l?.port||b.port})),w(null)},[]),B=c.useCallback(()=>{if(r.db_type==="sqlite")return null;const a=r.username?`${r.username}${r.password?`:${r.password}`:""}@`:"";return`${r.db_type}://${a}${r.host}:${r.port}/${r.database}`},[r]),z=c.useCallback(async()=>{const a={};if(r.database.trim()||(a.database="Database is required to test"),r.db_type!=="sqlite"&&!r.host.trim()&&(a.host="Host is required to test"),Object.keys(a).length>0){s(o=>({...o,...a})),_(o=>({...o,database:!0,host:!0}));return}await G({type:oe.EXECUTE,label:"Test connection",reversibility:ne.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{dbType:r.db_type,action:"test_connection"},action:async()=>{O(!0),w(null),m(null);try{const o=B(),l=await le({db_url:o,db_type:r.db_type,database:r.database});return l?.status==="healthy"||l?.healthy||l?.status==="ok"||l?.ok?w("success"):(w("error"),m(l?.message||l?.error||"Connection test failed")),l}catch(o){throw w("error"),m(o.message||"Connection test failed"),o}finally{O(!1)}}})},[B,G,r]),Z=c.useCallback(a=>{if(a.preventDefault(),F.current)return;F.current=!0,setTimeout(()=>{F.current=!1},1e3),_({name:!0,host:!0,database:!0,port:!0});const l={};let b=!1;for(const[k,Q]of Object.entries(L)){const X=Q(r[k],r);X.valid||(l[k]=X.error,b=!0)}if(s(l),b){const k=Object.values(l).find(Boolean);m(k||"Please fix the errors above");return}const R=B();n({...r,db_url:R})},[r,n,B]),f=r.db_type==="sqlite";return e.jsx(j,{component:"form",onSubmit:Z,children:e.jsxs(p,{spacing:3,children:[E&&e.jsx(U,{severity:"error",onClose:()=>m(null),action:S==="error"&&e.jsx(g,{color:"inherit",size:"small",onClick:z,disabled:v,children:"Try Again"}),children:E}),e.jsx(U,{severity:"info",children:"Use a read-only account when possible. Testing only checks connectivity. Saved credentials are encrypted for reuse. Deleting a connection never deletes data from your database."}),e.jsx(I,{label:e.jsxs(p,{direction:"row",alignItems:"center",spacing:.5,component:"span",children:[e.jsx("span",{children:"Connection Name"}),e.jsx(y,{field:"name"})]}),value:r.name,onChange:C("name"),onBlur:P("name"),placeholder:"e.g., Production Database",required:!0,fullWidth:!0,error:d.name&&!!h.name,helperText:d.name&&h.name}),e.jsxs(ie,{fullWidth:!0,children:[e.jsx(ce,{children:e.jsxs(p,{direction:"row",alignItems:"center",spacing:.5,component:"span",children:[e.jsx("span",{children:"Database Type"}),e.jsx(y,{field:"db_type"})]})}),e.jsx(de,{value:r.db_type,onChange:V,label:"Database Type      ",children:N.map(a=>e.jsx(ue,{value:a.value,children:a.label},a.value))}),e.jsx(pe,{children:"Not sure? Ask your database administrator"})]}),!f&&e.jsxs(p,{direction:"row",spacing:2,children:[e.jsx(I,{label:e.jsxs(p,{direction:"row",alignItems:"center",spacing:.5,component:"span",children:[e.jsx("span",{children:"Server Address"}),e.jsx(y,{field:"host"})]}),value:r.host,onChange:C("host"),onBlur:P("host"),placeholder:"e.g., db.example.com",required:!0,sx:{flex:2},error:d.host&&!!h.host,helperText:d.host?h.host:"The URL or IP address of your database server"}),e.jsx(I,{label:e.jsxs(p,{direction:"row",alignItems:"center",spacing:.5,component:"span",children:[e.jsx("span",{children:"Port"}),e.jsx(y,{field:"port"})]}),type:"number",value:r.port,onChange:C("port"),onBlur:P("port"),sx:{flex:1},error:d.port&&!!h.port,helperText:d.port?h.port:"Usually automatic"})]}),e.jsx(I,{label:e.jsxs(p,{direction:"row",alignItems:"center",spacing:.5,component:"span",children:[e.jsx("span",{children:f?"Database Path":"Database Name"}),e.jsx(y,{field:f?"database_sqlite":"database"})]}),value:r.database,onChange:C("database"),onBlur:P("database"),placeholder:f?"/path/to/database.db":"e.g., my_database",required:!0,fullWidth:!0,error:d.database&&!!h.database,helperText:d.database?h.database:f?"Full path to your SQLite file":"The name of the database on the server"}),!f&&e.jsxs(e.Fragment,{children:[e.jsx(I,{label:e.jsxs(p,{direction:"row",alignItems:"center",spacing:.5,component:"span",children:[e.jsx("span",{children:"Username"}),e.jsx(y,{field:"username"})]}),value:r.username,onChange:C("username"),placeholder:"e.g., postgres",fullWidth:!0,helperText:"The database account to use"}),e.jsx(I,{label:e.jsxs(p,{direction:"row",alignItems:"center",spacing:.5,component:"span",children:[e.jsx("span",{children:"Password"}),e.jsx(y,{field:"password"})]}),type:"password",value:r.password,onChange:C("password"),placeholder:"Enter password",fullWidth:!0,helperText:"Stored securely and encrypted"})]}),e.jsxs(j,{children:[e.jsx(g,{variant:"text",size:"small",onClick:()=>q(a=>!a),endIcon:D?e.jsx(he,{}):e.jsx(be,{}),sx:{textTransform:"none",fontWeight:500},children:"Advanced Settings"}),e.jsx(xe,{in:D,children:e.jsx(j,{sx:{mt:2,p:2,bgcolor:"action.hover",borderRadius:1},children:e.jsxs(p,{spacing:2,children:[!f&&e.jsx(me,{control:e.jsx(Ce,{checked:r.ssl,onChange:C("ssl")}),label:e.jsxs(p,{direction:"row",alignItems:"center",spacing:.5,children:[e.jsx("span",{children:"Use Secure Connection (SSL)"}),e.jsx(y,{field:"ssl"})]})}),f&&e.jsx(Y,{variant:"caption",color:"text.secondary",children:"SQLite databases use file-based storage and do not require additional configuration."})]})})})]}),e.jsx(fe,{}),S&&e.jsx(U,{severity:S==="success"?"success":"error",icon:S==="success"?e.jsx(ye,{}):e.jsx(ge,{}),onClose:()=>w(null),action:S==="error"&&e.jsx(g,{color:"inherit",size:"small",onClick:z,disabled:v,children:"Retry"}),children:S==="success"?"Connection successful! Database is reachable.":E||"Connection failed. Check your settings and try again."}),e.jsxs(p,{direction:"row",spacing:2,justifyContent:"flex-end",children:[e.jsx(g,{variant:"text",onClick:z,disabled:x||v,startIcon:v?e.jsx(K,{size:16}):null,children:v?"Testing...":"Test Connection"}),e.jsx(g,{variant:"outlined",onClick:i,disabled:x,children:"Cancel"}),e.jsx(g,{type:"submit",variant:"contained",disabled:x,children:t?"Update Connection":"Add Connection"})]})]})})}export{Ee as C,qe as D};
