import{c as Ne,j as e,a as g,bC as _e,u as ue,a4 as Pe,r as d,B as o,T as c,as as P,s as f,A as ze,P as z,aM as w,N as R,v as H,k as se,p as re,o as ae,a1 as te,aI as Re,n as ke,q as Me,O as Oe,aJ as Be,ak as Le,al as Ge,am as We,an as Fe,ai as He,aj as Ye,a3 as $e,ao as Je,R as E,I as T}from"./index-B8Eu23bA.js";import{C as ne}from"./ConfirmModal-Bm9QL03g.js";import{A as Ue}from"./AiUsageNotice-DRuwRFKl.js";import{A as ie}from"./AutoFixHigh-C6xFegD4.js";import{T as qe,a as ce}from"./Tabs-D_BhmpzR.js";import{G as y}from"./Grid-5L9Rvqba.js";import{C as Ke,a as Ve}from"./CardContent-xJVpuEbT.js";import{P as Ze}from"./Preview-iX_0Zgyl.js";import{T as Qe}from"./TableContainer-CxteWhu6.js";import{T as Xe,a as es,b as oe,c as le,d as ss}from"./TableRow-Gv3OwSlT.js";import"./CheckCircleOutline-BKKyaL-x.js";import"./WarningAmber-DtVJgAFk.js";import"./KeyboardArrowRight-BOQXGjwe.js";const rs=Ne(e.jsx("path",{d:"m19 8-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4z"}));async function as(){return(await g.get("/enrichment/sources")).data}async function ts({data:a,sources:h,sampleSize:r=5}){return(await g.post("/enrichment/preview",{data:a,sources:h,sample_size:r})).data}async function ns({data:a,sources:h,options:r={}}){return(await g.post("/enrichment/enrich",{data:a,sources:h,options:r})).data}async function is({name:a,type:h,description:r,config:t={},cacheTtlHours:l=24}){return(await g.post("/enrichment/sources/create",{name:a,type:h,description:r,config:t,cache_ttl_hours:l})).data}async function cs(a){return(await g.delete(`/enrichment/sources/${a}`)).data}async function os(){return(await g.get("/enrichment/cache/stats")).data}async function ls(a=null){const h=a?`?source_id=${a}`:"";return(await g.delete(`/enrichment/cache${h}`)).data}const us=_e((a,h)=>({sources:[],customSources:[],cacheStats:null,previewResult:null,enrichmentResult:null,loading:!1,error:null,setLoading:r=>a({loading:r}),setError:r=>a({error:r}),fetchSources:async()=>{a({loading:!0,error:null});try{const r=await as(),t=Array.isArray(r.sources)?r.sources:[],l=[],n=[];t.forEach(m=>{!!(m?.created_at||m?.updated_at||m?.cache_ttl_hours!==void 0||m?.config)?n.push(m):l.push(m)}),a({sources:l,customSources:n,loading:!1})}catch(r){a({error:r.message,loading:!1})}},createSource:async({name:r,type:t,description:l,config:n,cacheTtlHours:m})=>{a({loading:!0,error:null});try{const C=(await is({name:r,type:t,description:l,config:n,cacheTtlHours:m})).source;return a(k=>({customSources:[...k.customSources.filter(b=>b.id!==C.id),C].slice(0,200),loading:!1})),C}catch(j){return a({error:j.message,loading:!1}),null}},deleteSource:async r=>{a({loading:!0,error:null});try{return await cs(r),a(t=>({customSources:t.customSources.filter(l=>l.id!==r),sources:t.sources.filter(l=>l.id!==r),loading:!1})),!0}catch(t){return a({error:t.message,loading:!1}),!1}},fetchCacheStats:async()=>{try{const r=await os();return a({cacheStats:r.stats}),r.stats}catch(r){return a({error:r.message}),null}},clearCache:async(r=null)=>{a({loading:!0,error:null});try{const t=await ls(r);return await h().fetchCacheStats(),a({loading:!1}),t.cleared_entries}catch(t){return a({error:t.message,loading:!1}),null}},previewEnrichment:async(r,t,l=5)=>{a({loading:!0,error:null,previewResult:null});try{const n=await ts({data:r,sources:t,sampleSize:l});return a({previewResult:n,loading:!1}),n}catch(n){return a({error:n.message,loading:!1}),null}},enrichData:async(r,t,l={})=>{a({loading:!0,error:null,enrichmentResult:null});try{const n=await ns({data:r,sources:t,options:l});return a({enrichmentResult:n,loading:!1}),n}catch(n){return a({error:n.message,loading:!1}),null}},reset:()=>a({previewResult:null,enrichmentResult:null,error:null})})),ds=[{id:"company",name:"Company Information",description:"Enrich with company details (industry, size, revenue)"},{id:"address",name:"Address Standardization",description:"Standardize and validate addresses"},{id:"exchange",name:"Currency Exchange",description:"Convert currencies to target currency"}],hs=[{value:"company_info",label:"Company Information"},{value:"address",label:"Address Standardization"},{value:"exchange_rate",label:"Currency Exchange"}];function ms(){const{sources:a,customSources:h,cacheStats:r,previewResult:t,enrichmentResult:l,loading:n,error:m,fetchSources:j,createSource:C,deleteSource:k,fetchCacheStats:b,clearCache:de,previewEnrichment:he,enrichData:me,reset:M}=us(),{execute:S}=ue(),[xe,Y]=Pe(),O=xe.get("tab")==="cache"?1:0,[$,J]=d.useState(!0),pe=d.useCallback((s,u)=>{Y(u===1?{tab:"cache"}:{},{replace:!0})},[Y]),[v,fe]=d.useState(""),[x,ye]=d.useState([]),[p,B]=d.useState(null),[ge,I]=d.useState(!1),[A,U]=d.useState(""),[L,q]=d.useState("company_info"),[K,V]=d.useState(""),[Z,Q]=d.useState(24),[D,G]=d.useState({open:!1,sourceId:null,sourceName:""}),[N,_]=d.useState({open:!1,sourceId:null,sourceName:""});d.useEffect(()=>((async()=>(J(!0),await Promise.all([j(),b()]),J(!1)))(),()=>M()),[j,b,M]);const je=d.useCallback(()=>{try{const s=JSON.parse(v);Array.isArray(s)?B(s):B([s])}catch{const u=v.trim().split(`
`);if(u.length>1){const i=u[0].split(",").map(F=>F.trim()),W=u.slice(1).map(F=>{const Ie=F.split(","),ee={};return i.forEach((Ae,De)=>{ee[Ae]=Ie[De]?.trim()||""}),ee});B(W)}}},[v]),Ce=async()=>{!p||x.length===0||await S({type:T.ANALYZE,label:"Preview enrichment",reversibility:E.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{sourceIds:x,action:"preview_enrichment"},action:async()=>{const s=await he(p,x,3);if(!s)throw new Error("Preview enrichment failed");return s}})},be=async()=>{!p||x.length===0||await S({type:T.GENERATE,label:"Enrich data",reversibility:E.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{sourceIds:x,action:"enrich_data"},action:async()=>{const s=await me(p,x);if(!s)throw new Error("Enrichment failed");return s}})},Se=s=>{ye(u=>u.includes(s)?u.filter(i=>i!==s):[...u,s])},ve=async()=>{A.trim()&&await S({type:T.CREATE,label:"Create enrichment source",reversibility:E.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{sourceType:L,action:"create_enrichment_source"},action:async()=>{const s=await C({name:A,type:L,description:K,config:{},cacheTtlHours:Z});if(s&&(I(!1),U(""),q("company_info"),V(""),Q(24)),!s)throw new Error("Create source failed");return s}})},we=async()=>{const s=D.sourceId,u=D.sourceName;G({open:!1,sourceId:null,sourceName:""}),s&&await S({type:T.DELETE,label:"Delete enrichment source",reversibility:E.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{sourceId:s,sourceName:u,action:"delete_enrichment_source"},action:async()=>{const i=await k(s);if(!i)throw new Error("Delete source failed");return i}})},Ee=async()=>{const s=N.sourceId||null,u=N.sourceName;_({open:!1,sourceId:null,sourceName:""}),await S({type:T.DELETE,label:"Clear enrichment cache",reversibility:E.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{sourceId:s,sourceName:u,action:"clear_enrichment_cache"},action:async()=>{const i=await de(s);if(i==null)throw new Error("Clear cache failed");return i}})},Te=a.length===0&&!$,X=[...a.length>0?a:ds,...h];return $?e.jsxs(o,{sx:{p:3,maxWidth:1400,mx:"auto"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(ie,{}),e.jsx(c,{variant:"h4",children:"Data Enrichment"})]}),e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:300},children:e.jsx(P,{})})]}):e.jsxs(o,{sx:{p:3,maxWidth:1400,mx:"auto"},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(o,{children:[e.jsxs(c,{variant:"h4",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{})," Data Enrichment"]}),e.jsx(c,{variant:"body1",color:"text.secondary",children:"Enrich your data with external information sources using AI"})]}),e.jsx(f,{variant:"outlined",startIcon:e.jsx(ze,{}),onClick:()=>I(!0),children:"Add Custom Source"})]}),m&&e.jsx(z,{severity:"error",sx:{mb:2},onClose:()=>M(),children:m}),e.jsx(Ue,{title:"AI enrichment",description:"Enrichment adds fields to a new output based on the sources you select. Preview before running.",chips:[{label:"Source: Input data",color:"info",variant:"outlined"},{label:"Confidence: Review results",color:"warning",variant:"outlined"},{label:"Original data unchanged",color:"success",variant:"outlined"}],dense:!0,sx:{mb:2}}),Te&&e.jsx(z,{severity:"info",sx:{mb:2},children:"Using default enrichment sources. Create custom sources below to configure specific enrichment behavior."}),e.jsxs(qe,{value:O,onChange:pe,sx:{mb:3},children:[e.jsx(ce,{label:"Enrich Data"}),e.jsx(ce,{label:"Cache Admin",icon:e.jsx(rs,{}),iconPosition:"start"})]}),O===0&&e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{size:{xs:12,md:6},children:e.jsxs(w,{sx:{p:3,height:"100%"},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Input Data"}),e.jsx(R,{fullWidth:!0,multiline:!0,rows:10,placeholder:`Paste JSON array or CSV data:

[
  {"name": "Acme Corp", "address": "123 Main St"},
  {"name": "Tech Inc", "address": "456 Oak Ave"}
]

Or CSV:
name,address
Acme Corp,123 Main St
Tech Inc,456 Oak Ave`,value:v,onChange:s=>fe(s.target.value),sx:{mb:2,fontFamily:"monospace"}}),e.jsx(f,{variant:"outlined",onClick:je,disabled:!v.trim(),children:"Parse Data"}),p&&e.jsxs(z,{severity:"success",sx:{mt:2},children:["Parsed ",p.length," records with columns: ",Object.keys(p[0]||{}).join(", ")]})]})}),e.jsx(y,{size:{xs:12,md:6},children:e.jsxs(w,{sx:{p:3,height:"100%"},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Enrichment Sources"}),e.jsx(o,{sx:{display:"flex",flexDirection:"column",gap:2},children:X.map(s=>{const u=h.some(i=>i.id===s.id);return e.jsx(Ke,{variant:"outlined",sx:{cursor:"pointer",borderColor:x.includes(s.id)?"text.secondary":"divider",bgcolor:x.includes(s.id)?"action.selected":"background.paper"},onClick:()=>Se(s.id),children:e.jsx(Ve,{sx:{py:1.5,"&:last-child":{pb:1.5}},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{children:[e.jsx(c,{variant:"subtitle1",children:s.name}),e.jsx(c,{variant:"body2",color:"text.secondary",children:s.description})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[u?e.jsx(H,{label:"Custom",size:"small",sx:{bgcolor:i=>i.palette.mode==="dark"?re(i.palette.text.primary,.1):se[400],color:"text.secondary"}}):e.jsx(H,{label:"Built-in",size:"small",variant:"outlined"}),x.includes(s.id)&&e.jsx(H,{label:"Selected",size:"small",sx:{bgcolor:i=>i.palette.mode==="dark"?re(i.palette.text.primary,.1):se[400],color:"text.secondary"}}),u&&e.jsx(ae,{size:"small",onClick:i=>{i.stopPropagation(),G({open:!0,sourceId:s.id,sourceName:s.name})},children:e.jsx(te,{fontSize:"small"})})]})]})})},s.id)})}),e.jsxs(o,{sx:{mt:3,display:"flex",gap:2},children:[e.jsx(f,{variant:"outlined",startIcon:n?e.jsx(P,{size:20}):e.jsx(Ze,{}),onClick:Ce,disabled:!p||x.length===0||n,children:"Preview"}),e.jsx(f,{variant:"contained",startIcon:n?e.jsx(P,{size:20}):e.jsx(Re,{}),onClick:be,disabled:!p||x.length===0||n,children:"Enrich All"})]})]})}),(t||l)&&e.jsx(y,{size:12,children:e.jsxs(w,{sx:{p:3},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:l?"Enrichment Results":"Preview Results"}),e.jsx(Qe,{sx:{maxHeight:400},children:e.jsxs(Xe,{stickyHeader:!0,size:"small",children:[e.jsx(es,{children:e.jsx(oe,{children:Object.keys((l?.enriched_data||t?.preview)?.[0]||{}).map(s=>e.jsx(le,{children:s},s))})}),e.jsx(ss,{children:(l?.enriched_data||t?.preview||[]).map((s,u)=>e.jsx(oe,{children:Object.values(s).map((i,W)=>e.jsx(le,{children:typeof i=="object"?JSON.stringify(i):String(i)},W))},u))})]})})]})})]}),O===1&&e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{size:{xs:12,md:6},children:e.jsxs(w,{sx:{p:3},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(c,{variant:"h6",children:"Cache Statistics"}),e.jsx(ke,{title:"Refresh cache stats",children:e.jsx(ae,{onClick:b,size:"small","aria-label":"Refresh cache stats",children:e.jsx(Me,{})})})]}),r?e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(o,{children:[e.jsx(c,{variant:"body2",color:"text.secondary",children:"Total Entries"}),e.jsx(c,{variant:"h4",children:r.total_entries||0})]}),e.jsxs(o,{children:[e.jsx(c,{variant:"body2",color:"text.secondary",children:"Hit Rate"}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Oe,{variant:"determinate",value:(r.hit_rate||0)*100,sx:{flex:1,height:10,borderRadius:1}}),e.jsxs(c,{variant:"body1",children:[((r.hit_rate||0)*100).toFixed(1),"%"]})]})]}),e.jsxs(o,{children:[e.jsx(c,{variant:"body2",color:"text.secondary",children:"Cache Hits / Misses"}),e.jsxs(c,{variant:"body1",children:[r.hits||0," hits / ",r.misses||0," misses"]})]}),r.size_bytes&&e.jsxs(o,{children:[e.jsx(c,{variant:"body2",color:"text.secondary",children:"Cache Size"}),e.jsxs(c,{variant:"body1",children:[(r.size_bytes/1024).toFixed(2)," KB"]})]})]}):e.jsx(c,{color:"text.secondary",children:"No cache stats available"})]})}),e.jsx(y,{size:{xs:12,md:6},children:e.jsxs(w,{sx:{p:3},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Cache Management"}),e.jsx(z,{severity:"info",sx:{mb:3},children:"Clearing the cache will remove all cached enrichment results. New enrichment requests will fetch fresh data from sources."}),e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(f,{variant:"outlined",startIcon:n?e.jsx(P,{size:20}):e.jsx(te,{}),onClick:()=>_({open:!0,sourceId:null,sourceName:"all sources"}),disabled:n,sx:{color:"text.secondary",borderColor:"divider"},children:"Clear All Cache"}),e.jsx(Be,{sx:{my:1}}),e.jsx(c,{variant:"subtitle2",color:"text.secondary",children:"Clear cache for specific source:"}),X.map(s=>e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(c,{variant:"body2",children:s.name}),e.jsx(f,{size:"small",onClick:()=>_({open:!0,sourceId:s.id,sourceName:s.name}),disabled:n,children:"Clear"})]},s.id))]})]})})]}),e.jsxs(Le,{open:ge,onClose:()=>I(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ge,{children:"Create Custom Enrichment Source"}),e.jsxs(We,{children:[e.jsx(R,{fullWidth:!0,label:"Source Name",value:A,onChange:s=>U(s.target.value),sx:{mt:2,mb:2}}),e.jsxs(Fe,{fullWidth:!0,sx:{mb:2},children:[e.jsx(He,{children:"Source Type"}),e.jsx(Ye,{value:L,label:"Source Type",onChange:s=>q(s.target.value),children:hs.map(s=>e.jsx($e,{value:s.value,children:s.label},s.value))})]}),e.jsx(R,{fullWidth:!0,label:"Description",value:K,onChange:s=>V(s.target.value),multiline:!0,rows:2,sx:{mb:2}}),e.jsx(R,{fullWidth:!0,label:"Cache TTL (hours)",type:"number",value:Z,onChange:s=>Q(parseInt(s.target.value)||24),inputProps:{min:1,max:720}})]}),e.jsxs(Je,{children:[e.jsx(f,{onClick:()=>I(!1),children:"Cancel"}),e.jsx(f,{variant:"contained",onClick:ve,disabled:!A.trim()||n,children:"Create"})]})]}),e.jsx(ne,{open:D.open,onClose:()=>G({open:!1,sourceId:null,sourceName:""}),onConfirm:we,title:"Delete Source",message:`Are you sure you want to delete "${D.sourceName}"? This will remove the source configuration and all associated cache data.`,confirmLabel:"Delete",severity:"error"}),e.jsx(ne,{open:N.open,onClose:()=>_({open:!1,sourceId:null,sourceName:""}),onConfirm:Ee,title:"Clear Cache",message:`Are you sure you want to clear cache for ${N.sourceName}? New enrichment requests will fetch fresh data from the source.`,confirmLabel:"Clear Cache",severity:"warning"})]})}function Ds(){return ue(),e.jsx(ms,{})}export{Ds as default};
