import{c as ne,j as s,a as k,bC as Xe,K as j,e as Ke,r as h,d as Je,u as De,bD as Ze,B as n,T as p,k as i,A as ee,N as W,p as a,bM as es,bN as ss,H as ts,o as F,a1 as os,n as T,D as as,aG as ns,s as R,F as se,be as xe,q as rs,P as is,bh as ls,al as ge,am as me,ao as fe,aJ as cs,R as S,I,J as d,v as Re,z as ds,ak as ps}from"./index-B8Eu23bA.js";import{C as te}from"./ConfirmModal-Bm9QL03g.js";import{D as us}from"./DisabledTooltip-BX9dkO9B.js";import{A as xs}from"./AiUsageNotice-DRuwRFKl.js";import{F as oe}from"./QuestionAnswer-n3mCgub-.js";import{F as gs}from"./Folder-0HM5LTDq.js";import{F as he}from"./InsertDriveFile-CpjWG4CB.js";import{C as ms}from"./Clear-BuyldfmA.js";import{P as fs}from"./Person-DzBPKkcS.js";import{F as hs}from"./FormatQuote-B77-u4aK.js";import{C as bs}from"./ContentCopy-CetTCPv3.js";import{S as ys}from"./Psychology-BoNYy9kx.js";import"./CheckCircleOutline-BKKyaL-x.js";import"./WarningAmber-DtVJgAFk.js";const ks=ne(s.jsx("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"})),js=ne(s.jsx("path",{d:"M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2m4 0v12h4V3z"})),Cs=ne(s.jsx("path",{d:"M1 21h4V9H1zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73z"}));async function vs(e){return(await k.post("/docqa/sessions",{name:e})).data}async function ws({limit:e,offset:l}={}){const o={};return e!=null&&(o.limit=e),l!=null&&(o.offset=l),(await k.get("/docqa/sessions",{params:o})).data}async function Ss(e){return(await k.get(`/docqa/sessions/${e}`)).data}async function Is(e){return(await k.delete(`/docqa/sessions/${e}`)).data}async function Ds(e,{name:l,content:o,pageCount:r}){return(await k.post(`/docqa/sessions/${e}/documents`,{name:l,content:o,page_count:r})).data}async function Rs(e,l){return(await k.delete(`/docqa/sessions/${e}/documents/${l}`)).data}async function As(e,{question:l,includeCitations:o=!0,maxResponseLength:r=2e3}){return(await k.post(`/docqa/sessions/${e}/ask`,{question:l,include_citations:o,max_response_length:r})).data}async function $s(e,l=50){return(await k.get(`/docqa/sessions/${e}/history`,{params:{limit:l}})).data}async function Es(e){return(await k.delete(`/docqa/sessions/${e}/history`)).data}async function Ns(e,l,{feedbackType:o,comment:r}){return(await k.post(`/docqa/sessions/${e}/messages/${l}/feedback`,{feedback_type:o,comment:r})).data}async function Ts(e,l,{includeCitations:o=!0,maxResponseLength:r=2e3}={}){return(await k.post(`/docqa/sessions/${e}/messages/${l}/regenerate`,{include_citations:o,max_response_length:r})).data}const zs=Xe((e,l)=>({sessions:[],currentSession:null,messages:[],loading:!1,asking:!1,error:null,setLoading:o=>e({loading:o}),setError:o=>e({error:o}),fetchSessions:async()=>{e({loading:!0,error:null});try{const o=await ws();e({sessions:o.sessions||[],loading:!1})}catch(o){e({error:o.message,loading:!1})}},createSession:async o=>{e({loading:!0,error:null});try{const u=(await vs(o)).session;return e(x=>({sessions:[...x.sessions,u].slice(0,100),currentSession:u,messages:[],loading:!1})),u}catch(r){return e({error:r.message,loading:!1}),null}},getSession:async o=>{e({loading:!0,error:null});try{const r=await Ss(o);let u=r.session?.messages||[];try{const x=await $s(o,0);Array.isArray(x?.messages)&&(u=x.messages)}catch{}return e({currentSession:r.session,messages:u,loading:!1}),r.session}catch(r){return e({error:r.message,loading:!1}),null}},deleteSession:async o=>{e({loading:!0,error:null});try{return await Is(o),e(r=>({sessions:r.sessions.filter(u=>u.id!==o),currentSession:r.currentSession?.id===o?null:r.currentSession,messages:r.currentSession?.id===o?[]:r.messages,loading:!1})),!0}catch(r){return e({error:r.message,loading:!1}),!1}},addDocument:async(o,r)=>{e({loading:!0,error:null});try{const u=await Ds(o,r);return await l().getSession(o),e({loading:!1}),u.document}catch(u){return e({error:u.message,loading:!1}),null}},removeDocument:async(o,r)=>{e({loading:!0,error:null});try{return await Rs(o,r),await l().getSession(o),e({loading:!1}),!0}catch(u){return e({error:u.message,loading:!1}),!1}},askQuestion:async(o,r,u={})=>{const x={id:`temp-${Date.now()}`,role:"user",content:r,timestamp:new Date().toISOString(),citations:[]};e(g=>({messages:[...g.messages,x].slice(-500),asking:!0,error:null}));try{const g=await As(o,{question:r,...u});return e(y=>({messages:[...y.messages.filter(C=>C.id!==x.id),{...x,id:g.response?.message?.id||x.id},g.response?.message].filter(Boolean),asking:!1})),g.response}catch(g){return e(y=>({messages:y.messages.filter(C=>C.id!==x.id),error:g.message,asking:!1})),null}},clearHistory:async o=>{e({loading:!0,error:null});try{return await Es(o),e({messages:[],loading:!1}),!0}catch(r){return e({error:r.message,loading:!1}),!1}},submitFeedback:async(o,r,u,x=null)=>{try{const g=await Ns(o,r,{feedbackType:u,comment:x});return e(y=>({messages:y.messages.map(C=>C.id===r?{...C,feedback:g.message?.feedback}:C)})),g.message}catch(g){return e({error:g.message}),null}},regenerateResponse:async(o,r,u={})=>{e({asking:!0,error:null});try{const x=await Ts(o,r,u);return e(g=>({messages:g.messages.map(y=>y.id===r?x.response?.message:y),asking:!1})),x.response}catch(x){return e({error:x.message,asking:!1}),null}},reset:()=>e({currentSession:null,messages:[],error:null})}));j`
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
`;j`
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
`;j`
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
`;const Fs=j`
  from { opacity: 0; transform: translateX(-20px); }
  to { opacity: 1; transform: translateX(0); }
`,Ls=j`
  from { opacity: 0; transform: translateX(20px); }
  to { opacity: 1; transform: translateX(0); }
`,_s=j`
  0%, 100% { transform: scale(1); opacity: 0.8; }
  50% { transform: scale(1.05); opacity: 1; }
`;j`
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
`;const Ms=j`
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-4px); }
`;j`
  0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
  50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.5); }
`;const Ws=j`
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
`,be=d(n)(({theme:e})=>({display:"flex",height:"calc(100vh - 64px)",backgroundColor:"transparent",position:"relative",overflow:"hidden"})),Ps=d(n)(({theme:e})=>({width:320,flexShrink:0,display:"flex",flexDirection:"column",background:a(e.palette.background.paper,.6),backdropFilter:"blur(20px)",borderRight:`1px solid ${a(e.palette.divider,.1)}`,position:"relative","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,height:200,background:`linear-gradient(180deg, ${a(e.palette.text.primary,.03)} 0%, transparent 100%)`,pointerEvents:"none"}})),qs=d(n)(({theme:e})=>({padding:e.spacing(3),position:"relative",zIndex:1})),Bs=d(n)(({theme:e})=>({flex:1,overflow:"auto",padding:e.spacing(0,2,2),"&::-webkit-scrollbar":{width:6},"&::-webkit-scrollbar-track":{backgroundColor:"transparent"},"&::-webkit-scrollbar-thumb":{backgroundColor:a(e.palette.text.primary,.1),borderRadius:1,"&:hover":{backgroundColor:a(e.palette.text.primary,.2)}}})),Qs=d(n,{shouldForwardProp:e=>e!=="selected"})(({theme:e,selected:l})=>({padding:e.spacing(1.5),borderRadius:8,cursor:"pointer",marginBottom:e.spacing(1),backgroundColor:l?e.palette.mode==="dark"?a(e.palette.text.primary,.1):i[300]:a(e.palette.background.paper,.4),border:`1px solid ${l?a(e.palette.divider,.3):"transparent"}`,transition:"all 0.2s ease",position:"relative",overflow:"hidden","&:hover":{backgroundColor:l?e.palette.mode==="dark"?a(e.palette.text.primary,.12):i[400]:e.palette.mode==="dark"?a(e.palette.text.primary,.05):i[200],transform:"translateX(4px)"},"&::before":l?{content:'""',position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",width:3,height:"60%",background:e.palette.mode==="dark"?i[1e3]:i[1200],borderRadius:"0 4px 4px 0"}:{}})),Hs=d(Re)(({theme:e})=>({height:24,fontSize:11,backgroundColor:e.palette.mode==="dark"?a(e.palette.text.primary,.08):i[300],color:e.palette.text.secondary,border:`1px solid ${a(e.palette.divider,.2)}`,"& .MuiChip-icon":{fontSize:14}})),Ys=d(n)(({theme:e})=>({flex:1,display:"flex",flexDirection:"column",backgroundColor:"transparent",position:"relative"})),Os=d(n)(({theme:e})=>({padding:e.spacing(2,3),display:"flex",alignItems:"center",justifyContent:"space-between",background:a(e.palette.background.paper,.4),backdropFilter:"blur(10px)",borderBottom:`1px solid ${a(e.palette.divider,.1)}`})),Vs=d(n)(({theme:e})=>({flex:1,overflow:"auto",padding:e.spacing(3),display:"flex",flexDirection:"column",gap:e.spacing(2),"&::-webkit-scrollbar":{width:8},"&::-webkit-scrollbar-track":{backgroundColor:"transparent"},"&::-webkit-scrollbar-thumb":{backgroundColor:a(e.palette.text.primary,.1),borderRadius:4,"&:hover":{backgroundColor:a(e.palette.text.primary,.2)}}})),ye=d(n,{shouldForwardProp:e=>!["isUser","index"].includes(e)})(({theme:e,isUser:l,index:o})=>({maxWidth:"75%",alignSelf:l?"flex-end":"flex-start",animation:`${l?Ls:Fs} 0.4s ease-out`,animationDelay:`${o*.05}s`,animationFillMode:"both"})),ke=d(n,{shouldForwardProp:e=>e!=="isUser"})(({theme:e,isUser:l})=>({padding:e.spacing(2,2.5),borderRadius:l?"20px 20px 4px 20px":"20px 20px 20px 4px",backgroundColor:l?e.palette.mode==="dark"?i[1100]:i[1200]:a(e.palette.background.paper,.8),color:l?"#fff":e.palette.text.primary,backdropFilter:l?"none":"blur(10px)",border:l?"none":`1px solid ${a(e.palette.divider,.1)}`,position:"relative",boxShadow:l?`0 4px 20px ${a(e.palette.common.black,.2)}`:`0 4px 20px ${a(e.palette.common.black,.05)}`})),je=d(ds,{shouldForwardProp:e=>e!=="isUser"})(({theme:e,isUser:l})=>({width:36,height:36,background:l?e.palette.mode==="dark"?i[1100]:i[1200]:e.palette.mode==="dark"?a(e.palette.text.primary,.1):i[300],border:`2px solid ${a(e.palette.background.paper,.8)}`,boxShadow:`0 2px 10px ${a(e.palette.common.black,.1)}`,"& svg":{fontSize:18,color:l?"#fff":e.palette.text.secondary}})),Us=d(n)(({theme:e})=>({marginTop:e.spacing(2),padding:e.spacing(1.5),backgroundColor:e.palette.mode==="dark"?a(e.palette.text.primary,.04):i[200],borderRadius:8,border:`1px solid ${a(e.palette.divider,.1)}`})),Gs=d(n)(({theme:e})=>({display:"flex",alignItems:"flex-start",gap:e.spacing(1),padding:e.spacing(1),borderRadius:8,backgroundColor:a(e.palette.background.paper,.5),marginTop:e.spacing(1),cursor:"pointer",transition:"all 0.2s ease","&:hover":{backgroundColor:e.palette.mode==="dark"?a(e.palette.text.primary,.05):i[200]}})),Xs=d(Re)(({theme:e})=>({borderRadius:20,backgroundColor:e.palette.mode==="dark"?a(e.palette.text.primary,.08):i[300],border:`1px solid ${a(e.palette.divider,.2)}`,color:e.palette.text.primary,transition:"all 0.2s ease","&:hover":{backgroundColor:e.palette.mode==="dark"?a(e.palette.text.primary,.12):i[400],transform:"translateY(-2px)",boxShadow:`0 4px 12px ${a(e.palette.common.black,.1)}`}})),Ks=d(n)(({theme:e})=>({padding:e.spacing(2,3,3),background:`linear-gradient(180deg, transparent 0%, ${a(e.palette.background.paper,.6)} 30%)`,backdropFilter:"blur(10px)"})),Js=d(n)(({theme:e})=>({display:"flex",alignItems:"flex-end",gap:e.spacing(1.5),padding:e.spacing(1.5),backgroundColor:a(e.palette.background.paper,.8),borderRadius:24,border:`1px solid ${a(e.palette.divider,.15)}`,boxShadow:`0 4px 20px ${a(e.palette.common.black,.05)}`,transition:"all 0.2s ease","&:focus-within":{borderColor:a(e.palette.divider,.4),boxShadow:`0 4px 30px ${a(e.palette.common.black,.08)}`}})),Zs=d(W)(({theme:e})=>({"& .MuiOutlinedInput-root":{backgroundColor:"transparent",fontSize:15,"& fieldset":{border:"none"}},"& .MuiInputBase-input":{padding:e.spacing(1,0),"&::placeholder":{color:a(e.palette.text.secondary,.6)}}})),et=d(F)(({theme:e})=>({width:44,height:44,background:e.palette.mode==="dark"?i[1100]:i[1200],color:"#fff",transition:"all 0.2s ease","&:hover":{transform:"scale(1.05)",background:e.palette.mode==="dark"?i[1e3]:i[1100],boxShadow:`0 4px 20px ${a(e.palette.common.black,.2)}`},"&:disabled":{background:a(e.palette.text.primary,.1),color:a(e.palette.text.primary,.3)}})),st=d(n)(({theme:e})=>({display:"flex",alignItems:"center",gap:6,padding:e.spacing(2),"& span":{width:8,height:8,borderRadius:"50%",backgroundColor:e.palette.text.secondary,animation:`${Ms} 1.4s infinite ease-in-out`,"&:nth-of-type(1)":{animationDelay:"0s"},"&:nth-of-type(2)":{animationDelay:"0.2s"},"&:nth-of-type(3)":{animationDelay:"0.4s"}}})),tt=d(n)(({theme:e})=>({display:"flex",alignItems:"center",gap:e.spacing(1.5),padding:e.spacing(1.5,2),backgroundColor:e.palette.mode==="dark"?a(e.palette.text.primary,.08):i[300],borderRadius:8,marginBottom:e.spacing(1),animation:`${_s} 2s infinite ease-in-out`})),Ce=d(n)(({theme:e})=>({flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:e.spacing(4),textAlign:"center"})),ve=d(n)(({theme:e})=>({width:120,height:120,borderRadius:"50%",background:e.palette.mode==="dark"?a(e.palette.text.primary,.08):i[300],display:"flex",alignItems:"center",justifyContent:"center",marginBottom:e.spacing(3),animation:`${Ws} 3s infinite ease-in-out`,"& svg":{fontSize:56,color:e.palette.text.secondary}})),ot=d(n)(({theme:e})=>({padding:e.spacing(2),borderRadius:8,backgroundColor:a(e.palette.background.paper,.6),border:`1px solid ${a(e.palette.divider,.1)}`,cursor:"pointer",transition:"all 0.2s ease","&:hover":{backgroundColor:e.palette.mode==="dark"?a(e.palette.text.primary,.05):i[200],borderColor:a(e.palette.divider,.2),transform:"translateY(-2px)"}})),Q=d(F)(({theme:e})=>({width:28,height:28,color:a(e.palette.text.secondary,.6),"&:hover":{color:e.palette.text.primary,backgroundColor:e.palette.mode==="dark"?a(e.palette.text.primary,.08):i[300]}})),we=d(R)(({theme:e})=>({borderRadius:8,padding:e.spacing(1.5,2),background:e.palette.mode==="dark"?i[1100]:i[1200],color:"#fff",fontWeight:600,textTransform:"none",boxShadow:`0 4px 20px ${a(e.palette.common.black,.15)}`,transition:"all 0.2s ease","&:hover":{transform:"translateY(-2px)",background:e.palette.mode==="dark"?i[1e3]:i[1100],boxShadow:`0 6px 28px ${a(e.palette.common.black,.2)}`}})),at=d(n)(({theme:e})=>({padding:e.spacing(2),borderTop:`1px solid ${a(e.palette.divider,.1)}`,backgroundColor:a(e.palette.background.paper,.3)})),nt=d(n)(({theme:e})=>({position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:a(e.palette.background.default,.8),backdropFilter:"blur(8px)",zIndex:10})),rt=d(n)(({theme:e})=>({width:48,height:48,borderRadius:"50%",background:`conic-gradient(from 0deg, transparent, ${e.palette.text.secondary})`,animation:"spin 1s linear infinite","@keyframes spin":{to:{transform:"rotate(360deg)"}},"&::before":{content:'""',position:"absolute",inset:4,borderRadius:"50%",backgroundColor:e.palette.background.paper}})),Se=d(ps)(({theme:e})=>({"& .MuiDialog-paper":{backgroundColor:a(e.palette.background.paper,.9),backdropFilter:"blur(20px)",borderRadius:8,border:`1px solid ${a(e.palette.divider,.1)}`}})),ae=5*1024*1024,Ie=10,v=200,z=3,D=2e3;function it(){const e=Ke(),{sessions:l,currentSession:o,messages:r,loading:u,asking:x,error:g,fetchSessions:y,createSession:C,getSession:Ae,deleteSession:$e,addDocument:Ee,removeDocument:Ne,askQuestion:Te,clearHistory:ze,submitFeedback:Fe,regenerateResponse:Le,reset:H}=zs(),[_e,L]=h.useState(!1),[Me,A]=h.useState(!1),[$,re]=h.useState(""),[E,Y]=h.useState(""),[N,O]=h.useState(""),[b,P]=h.useState(""),ie=h.useRef(null),[q,V]=h.useState({open:!1,sessionId:null,sessionName:""}),[B,U]=h.useState({open:!1,docId:null,docName:""}),[_,G]=h.useState({open:!1,sessionId:null,sessionName:"",messageCount:0}),[X,We]=h.useState(""),m=Je(),[Pe,le]=h.useState(!0),qe=h.useRef(null),ce=o?.documents?.length||0,{execute:w}=De();Ze("DELETE_SESSION"),h.useEffect(()=>((async()=>(le(!0),await y(),le(!1)))(),()=>H()),[y,H]),h.useEffect(()=>{ie.current?.scrollIntoView({behavior:"smooth"})},[r]);const Be=()=>{if($){if($.length>v){m.show(`Session name must be ${v} characters or less`,"error");return}w({type:I.CREATE,label:`Create session "${$}"`,reversibility:S.FULLY_REVERSIBLE,successMessage:"Session created successfully",action:async()=>{await C($),L(!1),re("")}})}},Qe=()=>{if(!(!o||!E||!N)){if(E.length>v){m.show(`Document name must be ${v} characters or less`,"error");return}if(N.trim().length<Ie){m.show(`Document content must be at least ${Ie} characters`,"error");return}if(N.length>ae){m.show("Document content exceeds 5MB limit","error");return}w({type:I.UPLOAD,label:`Add document "${E}"`,reversibility:S.FULLY_REVERSIBLE,successMessage:"Document added successfully",action:async()=>{await Ee(o.id,{name:E,content:N}),A(!1),Y(""),O("")}})}},He=t=>{const c=t.target.files[0];if(!c)return;if(c.name.length>v){m.show(`File name must be ${v} characters or less`,"error"),t.target.value="";return}const f=[".txt",".md",".json",".csv"],M=c.name.toLowerCase();if(!f.some(Z=>M.endsWith(Z))){m.show(`Invalid file type. Supported formats: ${f.join(", ")}`,"error"),t.target.value="";return}if(c.size>ae){m.show("File size exceeds 5MB limit","error"),t.target.value="";return}const J=new FileReader;J.onload=Z=>{const ue=Z.target.result;if(ue.includes("\0")){m.show("File appears to be binary. Please upload a text file.","error"),t.target.value="";return}Y(c.name),O(ue)},J.onerror=()=>{m.show("Failed to read file","error"),t.target.value=""},J.readAsText(c)},de=()=>{if(!o||!b.trim())return;const t=b.trim();if(t.length<z){m.show(`Question must be at least ${z} characters`,"error");return}if(t.length>D){m.show(`Question must be ${D} characters or less`,"error");return}const c=t;w({type:I.ANALYZE,label:"Analyzing documents...",reversibility:S.SYSTEM_MANAGED,blocksNavigation:!0,action:async()=>{P(""),await Te(o.id,c)}})},Ye=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),de())},Oe=t=>{navigator.clipboard.writeText(t),m.show("Copied to clipboard","success")},Ve=h.useCallback(async t=>{const c=t?.quote||t?.document_name;if(c){if(!navigator?.clipboard?.writeText){m.show("Clipboard not available","warning");return}try{await navigator.clipboard.writeText(c),m.show("Citation copied","success")}catch(f){m.show(f.message||"Failed to copy citation","error")}}},[m]),pe=async(t,c)=>{if(!o)return;await Fe(o.id,t,c)&&m.show(c==="helpful"?"Thanks for the feedback!":"Thanks for letting us know","success")},Ue=t=>{o&&w({type:I.GENERATE,label:"Regenerating response...",reversibility:S.SYSTEM_MANAGED,successMessage:"Response regenerated",errorMessage:"Failed to regenerate response",blocksNavigation:!0,action:async()=>{if(!await Le(o.id,t))throw new Error("Regenerate failed")}})},K=l.filter(t=>t.name.toLowerCase().includes(X.toLowerCase())),Ge=["What are the main topics covered in these documents?","Can you summarize the key findings?","What are the most important insights?","Are there any conflicting information?"];return Pe?s.jsx(be,{children:s.jsx(nt,{children:s.jsxs(n,{sx:{textAlign:"center"},children:[s.jsx(n,{sx:{position:"relative",width:48,height:48,mx:"auto",mb:2},children:s.jsx(rt,{})}),s.jsx(p,{variant:"body2",color:"text.secondary",children:"Loading your sessions..."})]})})}):s.jsxs(be,{children:[s.jsxs(Ps,{children:[s.jsxs(qs,{children:[s.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:2},children:[s.jsx(n,{sx:{width:40,height:40,borderRadius:1,background:e.palette.mode==="dark"?i[1100]:i[1200],display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(oe,{sx:{color:"#fff",fontSize:22}})}),s.jsxs(n,{children:[s.jsx(p,{variant:"h6",sx:{fontWeight:700,lineHeight:1.2},children:"Document Q&A"}),s.jsx(p,{variant:"caption",color:"text.secondary",children:"AI-powered analysis"})]})]}),s.jsx(we,{fullWidth:!0,startIcon:s.jsx(ee,{}),onClick:()=>L(!0),children:"New Session"}),s.jsx(W,{fullWidth:!0,size:"small",placeholder:"Search sessions...",value:X,onChange:t=>We(t.target.value),sx:{mt:2},InputProps:{startAdornment:s.jsx(es,{position:"start",children:s.jsx(ss,{sx:{fontSize:18,color:"text.secondary"}})}),sx:{borderRadius:1,backgroundColor:a(e.palette.background.paper,.5),"& fieldset":{borderColor:a(e.palette.divider,.1)}}}})]}),s.jsxs(Bs,{children:[s.jsxs(p,{variant:"overline",sx:{color:"text.secondary",px:1,display:"block",mb:1},children:["Sessions (",K.length,")"]}),K.length===0?s.jsxs(n,{sx:{textAlign:"center",py:4},children:[s.jsx(gs,{sx:{fontSize:40,color:"text.disabled",mb:1}}),s.jsx(p,{variant:"body2",color:"text.secondary",children:X?"No matching sessions":"No sessions yet"})]}):K.map((t,c)=>s.jsx(ts,{in:!0,style:{transitionDelay:`${c*50}ms`},children:s.jsx(Qs,{selected:o?.id===t.id,onClick:()=>Ae(t.id),children:s.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[s.jsxs(n,{sx:{flex:1,minWidth:0,pl:1},children:[s.jsx(p,{variant:"subtitle2",sx:{fontWeight:o?.id===t.id?600:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),s.jsx(n,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:s.jsx(Hs,{size:"small",icon:s.jsx(he,{}),label:`${t.documents?.length||0} docs`})})]}),s.jsx(F,{size:"small",onClick:f=>{f.stopPropagation(),V({open:!0,sessionId:t.id,sessionName:t.name})},sx:{opacity:.5,"&:hover":{opacity:1,color:"text.primary"}},children:s.jsx(os,{fontSize:"small"})})]})})},t.id))]}),o&&s.jsxs(at,{children:[s.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[s.jsx(p,{variant:"overline",sx:{color:"text.secondary"},children:"Documents"}),s.jsx(T,{title:"Add document",children:s.jsx(F,{size:"small",onClick:()=>A(!0),"aria-label":"Add document",sx:{bgcolor:e.palette.mode==="dark"?a(e.palette.text.primary,.08):i[300],"&:hover":{bgcolor:e.palette.mode==="dark"?a(e.palette.text.primary,.12):i[400]}},children:s.jsx(ee,{fontSize:"small"})})})]}),s.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[o.documents?.map(t=>s.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,p:1,borderRadius:1.5,bgcolor:a(e.palette.background.paper,.5),"&:hover":{bgcolor:e.palette.mode==="dark"?a(e.palette.text.primary,.05):i[200]}},children:[s.jsx(as,{sx:{fontSize:18,color:"text.secondary"}}),s.jsx(p,{variant:"caption",sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),s.jsx(F,{size:"small",onClick:()=>U({open:!0,docId:t.id,docName:t.name}),sx:{opacity:.5,"&:hover":{opacity:1,color:"text.primary"}},children:s.jsx(ns,{sx:{fontSize:14}})})]},t.id)),(!o.documents||o.documents.length===0)&&s.jsx(p,{variant:"caption",color:"text.secondary",sx:{textAlign:"center",py:2},children:"No documents added yet"})]})]})]}),s.jsx(Ys,{children:o?s.jsxs(s.Fragment,{children:[s.jsxs(Os,{children:[s.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[s.jsx(n,{sx:{width:36,height:36,borderRadius:1,bgcolor:e.palette.mode==="dark"?a(e.palette.text.primary,.08):i[300],display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(oe,{sx:{color:"text.secondary",fontSize:20}})}),s.jsxs(n,{children:[s.jsx(p,{variant:"subtitle1",sx:{fontWeight:600},children:o.name}),s.jsxs(p,{variant:"caption",color:"text.secondary",children:[o.documents?.length||0," documents â€¢"," ",r.length," messages"]})]})]}),r.length>0&&s.jsx(R,{size:"small",startIcon:s.jsx(ms,{}),onClick:()=>G({open:!0,sessionId:o.id,sessionName:o.name,messageCount:r.length}),sx:{borderRadius:1,textTransform:"none",color:"text.secondary"},children:"Clear Chat"})]}),s.jsx(n,{sx:{px:3,pt:2},children:s.jsx(xs,{title:"AI answers",description:"Responses are generated from documents in this session. Review citations before sharing.",chips:[{label:`Source: ${ce} document${ce===1?"":"s"}`,color:"info",variant:"outlined"},{label:"Confidence: Verify citations",color:"warning",variant:"outlined"},{label:"Reversible: No source changes",color:"success",variant:"outlined"}],dense:!0})}),s.jsxs(Vs,{children:[r.length===0?s.jsxs(Ce,{children:[s.jsx(ve,{children:s.jsx(se,{})}),s.jsx(p,{variant:"h5",sx:{fontWeight:600,mb:1},children:o.documents?.length>0?"Ready to answer your questions":"Add documents to get started"}),s.jsx(p,{color:"text.secondary",sx:{mb:4,maxWidth:400},children:o.documents?.length>0?"Ask anything about your documents. I'll analyze them and provide accurate answers with citations.":"Upload documents to this session, then ask questions about their content."}),o.documents?.length>0&&s.jsx(n,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,maxWidth:600},children:Ge.map((t,c)=>s.jsx(ot,{onClick:()=>P(t),children:s.jsx(p,{variant:"body2",sx:{fontWeight:500},children:t})},c))}),!o.documents?.length&&s.jsx(R,{variant:"outlined",startIcon:s.jsx(xe,{}),onClick:()=>A(!0),sx:{borderRadius:1,textTransform:"none",px:4,py:1.5},children:"Add Your First Document"})]}):s.jsxs(s.Fragment,{children:[r.map((t,c)=>s.jsx(ye,{isUser:t.role==="user",index:c,children:s.jsxs(n,{sx:{display:"flex",gap:1.5,flexDirection:t.role==="user"?"row-reverse":"row",alignItems:"flex-start"},children:[s.jsx(je,{isUser:t.role==="user",children:t.role==="user"?s.jsx(fs,{}):s.jsx(se,{})}),s.jsxs(n,{sx:{flex:1},children:[s.jsx(ke,{isUser:t.role==="user",children:s.jsx(p,{variant:"body2",sx:{whiteSpace:"pre-wrap",lineHeight:1.6},children:t.content})}),t.citations?.length>0&&s.jsxs(Us,{children:[s.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[s.jsx(hs,{sx:{fontSize:16,color:"text.secondary"}}),s.jsxs(p,{variant:"caption",sx:{fontWeight:600,color:"text.secondary"},children:["Sources (",t.citations.length,")"]})]}),t.citations.map((f,M)=>s.jsxs(Gs,{onClick:()=>Ve(f),children:[s.jsx(he,{sx:{fontSize:16,color:"text.secondary",mt:.25}}),s.jsxs(n,{children:[s.jsx(p,{variant:"caption",sx:{fontWeight:600,display:"block"},children:f.document_name}),s.jsxs(p,{variant:"caption",color:"text.secondary",sx:{fontStyle:"italic"},children:['"',f.quote?.substring(0,120),'..."']})]})]},M))]}),t.metadata?.follow_up_questions?.length>0&&s.jsxs(n,{sx:{mt:2},children:[s.jsx(p,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"Related questions"}),s.jsx(n,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:t.metadata.follow_up_questions.map((f,M)=>s.jsx(Xs,{label:f,size:"small",clickable:!0,onClick:()=>P(f)},M))})]}),t.role==="assistant"&&s.jsxs(n,{sx:{display:"flex",gap:.5,mt:1.5},children:[s.jsx(T,{title:"Copy",children:s.jsx(Q,{size:"small",onClick:()=>Oe(t.content),children:s.jsx(bs,{sx:{fontSize:16}})})}),s.jsx(T,{title:t.feedback?.feedback_type==="helpful"?"Marked as helpful":"Helpful",children:s.jsx(Q,{size:"small",onClick:()=>pe(t.id,"helpful"),sx:{color:t.feedback?.feedback_type==="helpful"?"text.primary":void 0,bgcolor:t.feedback?.feedback_type==="helpful"?e.palette.mode==="dark"?a(e.palette.text.primary,.1):i[300]:void 0},children:s.jsx(Cs,{sx:{fontSize:16}})})}),s.jsx(T,{title:t.feedback?.feedback_type==="not_helpful"?"Marked as not helpful":"Not helpful",children:s.jsx(Q,{size:"small",onClick:()=>pe(t.id,"not_helpful"),sx:{color:t.feedback?.feedback_type==="not_helpful"?"text.primary":void 0,bgcolor:t.feedback?.feedback_type==="not_helpful"?e.palette.mode==="dark"?a(e.palette.text.primary,.1):i[300]:void 0},children:s.jsx(js,{sx:{fontSize:16}})})}),s.jsx(T,{title:"Regenerate response",children:s.jsx(Q,{size:"small",onClick:()=>Ue(t.id),disabled:x,children:s.jsx(rs,{sx:{fontSize:16}})})})]})]})]})},c)),x&&s.jsx(ye,{isUser:!1,index:r.length,children:s.jsxs(n,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[s.jsx(je,{isUser:!1,children:s.jsx(se,{})}),s.jsxs(n,{children:[s.jsxs(tt,{children:[s.jsx(ys,{sx:{fontSize:18,color:"text.secondary"}}),s.jsx(p,{variant:"caption",sx:{fontWeight:500},children:"Analyzing documents..."})]}),s.jsx(ke,{isUser:!1,children:s.jsxs(st,{children:[s.jsx("span",{}),s.jsx("span",{}),s.jsx("span",{})]})})]})]})})]}),s.jsx("div",{ref:ie})]}),s.jsxs(Ks,{children:[g&&s.jsx(is,{severity:"error",onClose:()=>H(),sx:{mb:2,borderRadius:1},children:g}),s.jsxs(Js,{children:[s.jsx(T,{title:"Attach file",children:s.jsx(F,{size:"small",onClick:()=>A(!0),sx:{color:"text.secondary"},children:s.jsx(ks,{})})}),s.jsx(Zs,{ref:qe,fullWidth:!0,placeholder:o.documents?.length?"Ask a question about your documents...":"Add documents to start asking questions...",value:b,onChange:t=>P(t.target.value),onKeyPress:Ye,disabled:x||!o.documents?.length,multiline:!0,maxRows:4,inputProps:{maxLength:D}}),s.jsx(us,{disabled:!b.trim()||b.trim().length<z||b.trim().length>D||x||!o.documents?.length,reason:x?"Please wait for the current question to complete":o.documents?.length?b.trim()?b.trim().length<z?`Question must be at least ${z} characters`:b.trim().length>D?`Question exceeds ${D} character limit`:void 0:"Enter a question to ask":"Add at least one document first",hint:o.documents?.length?b.trim()?void 0:"Type your question in the field above":"Click the attach button or drag a file",children:s.jsx(et,{onClick:de,disabled:!b.trim()||b.trim().length<z||b.trim().length>D||x||!o.documents?.length,children:x?s.jsx(n,{sx:{width:20,height:20,border:"2px solid",borderColor:"rgba(255,255,255,0.3)",borderTopColor:"#fff",borderRadius:"50%",animation:"spin 0.8s linear infinite"}}):s.jsx(ls,{})})})]})]})]}):s.jsxs(Ce,{children:[s.jsx(ve,{children:s.jsx(oe,{})}),s.jsx(p,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Document Intelligence"}),s.jsx(p,{color:"text.secondary",sx:{mb:4,maxWidth:450},children:"Create a session, upload your documents, and start asking questions. Our AI will analyze and provide accurate answers with citations."}),s.jsx(we,{startIcon:s.jsx(ee,{}),onClick:()=>L(!0),sx:{px:4,py:1.5},children:"Create Your First Session"})]})}),s.jsxs(Se,{open:_e,onClose:()=>L(!1),maxWidth:"xs",fullWidth:!0,children:[s.jsxs(ge,{sx:{pb:1},children:[s.jsx(p,{variant:"h6",sx:{fontWeight:600},children:"Create Q&A Session"}),s.jsx(p,{variant:"body2",color:"text.secondary",children:"Start a new document analysis workspace"})]}),s.jsx(me,{children:s.jsx(W,{fullWidth:!0,label:"Session Name",placeholder:"e.g., Research Papers Analysis",value:$,onChange:t=>re(t.target.value),sx:{mt:2},inputProps:{maxLength:v},InputProps:{sx:{borderRadius:1}}})}),s.jsxs(fe,{sx:{px:3,pb:3},children:[s.jsx(R,{onClick:()=>L(!1),sx:{borderRadius:1,textTransform:"none"},children:"Cancel"}),s.jsx(R,{variant:"contained",onClick:Be,disabled:!$,sx:{borderRadius:1,textTransform:"none",px:3,background:e.palette.mode==="dark"?i[1100]:i[1200]},children:"Create Session"})]})]}),s.jsxs(Se,{open:Me,onClose:()=>A(!1),maxWidth:"md",fullWidth:!0,children:[s.jsxs(ge,{sx:{pb:1},children:[s.jsx(p,{variant:"h6",sx:{fontWeight:600},children:"Add Document"}),s.jsx(p,{variant:"body2",color:"text.secondary",children:"Upload or paste document content for analysis"})]}),s.jsxs(me,{children:[s.jsxs(n,{sx:{mt:2,p:4,border:`2px dashed ${a(e.palette.divider,.4)}`,borderRadius:1,textAlign:"center",cursor:"pointer",transition:"all 0.2s ease",bgcolor:e.palette.mode==="dark"?a(e.palette.text.primary,.02):i[200],"&:hover":{borderColor:e.palette.mode==="dark"?i[1e3]:i[1100],bgcolor:e.palette.mode==="dark"?a(e.palette.text.primary,.05):i[300]}},component:"label",children:[s.jsx(xe,{sx:{fontSize:40,color:"text.secondary",mb:1}}),s.jsx(p,{variant:"body1",sx:{fontWeight:500,mb:.5},children:"Drop your file here or click to browse"}),s.jsx(p,{variant:"caption",color:"text.secondary",children:"Supports TXT, MD, JSON, CSV (max 5MB)"}),s.jsx("input",{type:"file",hidden:!0,onChange:He,accept:".txt,.md,.json,.csv"})]}),s.jsx(cs,{sx:{my:3},children:s.jsx(p,{variant:"caption",color:"text.secondary",children:"OR"})}),s.jsx(W,{fullWidth:!0,label:"Document Name",value:E,onChange:t=>Y(t.target.value),sx:{mb:2},inputProps:{maxLength:v},InputProps:{sx:{borderRadius:1}}}),s.jsx(W,{fullWidth:!0,multiline:!0,rows:10,label:"Document Content",value:N,onChange:t=>O(t.target.value),placeholder:"Paste your document content here...",inputProps:{maxLength:ae},InputProps:{sx:{borderRadius:1}}})]}),s.jsxs(fe,{sx:{px:3,pb:3},children:[s.jsx(R,{onClick:()=>A(!1),sx:{borderRadius:1,textTransform:"none"},children:"Cancel"}),s.jsx(R,{variant:"contained",onClick:Qe,disabled:!E||!N,sx:{borderRadius:1,textTransform:"none",px:3,background:e.palette.mode==="dark"?i[1100]:i[1200]},children:"Add Document"})]})]}),s.jsx(te,{open:q.open,onClose:()=>V({open:!1,sessionId:null,sessionName:""}),onConfirm:()=>{const t=q.sessionId,c=q.sessionName;V({open:!1,sessionId:null,sessionName:""}),w({type:I.DELETE,label:`Delete session "${c}"`,reversibility:S.IRREVERSIBLE,successMessage:`Session "${c}" deleted`,errorMessage:"Failed to delete session",action:async()=>{if(!await $e(t))throw new Error("Delete failed")}})},title:"Delete Session",message:`Are you sure you want to delete "${q.sessionName}"? All documents and chat history will be permanently removed.`,confirmLabel:"Delete",severity:"error"}),s.jsx(te,{open:B.open,onClose:()=>U({open:!1,docId:null,docName:""}),onConfirm:()=>{const t=B.docId,c=B.docName;U({open:!1,docId:null,docName:""}),w({type:I.DELETE,label:`Remove document "${c}"`,reversibility:S.PARTIALLY_REVERSIBLE,successMessage:`Document "${c}" removed`,errorMessage:"Failed to remove document",action:async()=>{if(!await Ne(o?.id,t))throw new Error("Remove failed")}})},title:"Remove Document",message:`Are you sure you want to remove "${B.docName}" from this session?`,confirmLabel:"Remove",severity:"warning"}),s.jsx(te,{open:_.open,onClose:()=>G({open:!1,sessionId:null,sessionName:"",messageCount:0}),onConfirm:()=>{const t=_.sessionId,c=_.sessionName;G({open:!1,sessionId:null,sessionName:"",messageCount:0}),w({type:I.DELETE,label:`Clear chat history for "${c}"`,reversibility:S.PARTIALLY_REVERSIBLE,successMessage:"Chat history cleared",errorMessage:"Failed to clear chat history",action:async()=>{await ze(t)}})},title:"Clear Chat History",message:`Are you sure you want to clear all ${_.messageCount} messages from "${_.sessionName}"? This action cannot be undone.`,confirmLabel:"Clear History",severity:"warning"})]})}function vt(){return De(),s.jsx(it,{})}export{vt as default};
