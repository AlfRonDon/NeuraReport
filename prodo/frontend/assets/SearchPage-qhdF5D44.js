import{c as ce,j as r,a as x,bC as ie,e as ue,d as de,u as Z,r as p,R as U,I as G,B as o,T as c,bN as z,bM as V,o as Y,as as he,C as pe,aM as ee,an as xe,ai as ye,aj as ge,a3 as S,N as D,D as fe,v as A,s as re,aR as K,aV as J,$ as Q,bs as me,b1 as be,aS as Se,P as je,J as f,k as m,p as g}from"./index-B8Eu23bA.js";import{T as ve,a as Ce}from"./Tabs-D_BhmpzR.js";import{S as we}from"./Psychology-BoNYy9kx.js";import{C as ke}from"./Code-C_kZAZjt.js";import{B as Te}from"./DataObject-CqeGq04Y.js";import{C as Ie}from"./Clear-BuyldfmA.js";import{F as Re}from"./FilterList-lKi4AKs9.js";import{G as w}from"./Grid-5L9Rvqba.js";import{S as Ae}from"./Bookmark-BikapQO7.js";import"./KeyboardArrowRight-BOQXGjwe.js";const _e=ce(r.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2m0 15-5-2.18L7 18V5h10z"}));async function ze(e,l={}){return(await x.post("/search/search",{query:e,search_type:l.searchType||"fulltext",filters:l.filters||null,sort_by:l.sortBy||"relevance",page:l.page||1,page_size:l.pageSize||20,highlight:l.highlight!==!1,facets:l.facets||null})).data}async function De(e,l={}){return(await x.post("/search/semantic",{query:e,search_type:"semantic",filters:l.filters||[],page:l.page||1,page_size:l.limit||20})).data}async function Ee(e,l={}){return(await x.post("/search/regex",{query:e,search_type:"regex",filters:l.filters||[]})).data}async function Fe(e,l={}){return(await x.post("/search/boolean",{query:e,search_type:"boolean",filters:l.filters||[]})).data}async function We(e,l,s={}){return(await x.post("/search/replace",{search_query:e,replace_with:l,document_ids:s.documentIds||null,dry_run:s.previewOnly!==!1})).data}async function Pe(e,l={}){return(await x.get(`/search/documents/${e}/similar`,{params:{limit:l.limit||10,min_similarity:l.minSimilarity||.5}})).data}async function Le(e,l,s={}){return(await x.post("/search/saved-searches",{name:e,query:l,search_type:s.searchType||"fulltext",filters:s.filters||null,is_alert:s.isAlert||!1,alert_frequency:s.alertFrequency||null})).data}async function qe(){return(await x.get("/search/saved-searches")).data}async function Be(e){return(await x.delete(`/search/saved-searches/${e}`)).data}async function He(e){return(await x.post(`/search/saved-searches/${e}/run`)).data}async function Me(e={}){return(await x.get("/search/analytics",{params:{days:e.days||30}})).data}const Oe=ie((e,l)=>({results:[],totalResults:0,facets:{},savedSearches:[],currentSearch:null,searchHistory:[],analytics:null,loading:!1,searching:!1,error:null,setLoading:s=>e({loading:s}),setError:s=>e({error:s}),search:async(s,n={})=>{e({searching:!0,error:null});try{const t=await ze(s,n);return e(i=>({results:t.results||[],totalResults:t.total||0,facets:t.facets||{},searchHistory:[{query:s,timestamp:new Date().toISOString(),resultCount:t.total},...i.searchHistory.slice(0,49)],searching:!1})),t}catch(t){return e({error:t.message,searching:!1}),null}},semanticSearch:async(s,n={})=>{e({searching:!0,error:null});try{const t=await De(s,n);return e({results:t.results||[],totalResults:t.results?.length||0,searching:!1}),t}catch(t){return e({error:t.message,searching:!1}),null}},regexSearch:async(s,n={})=>{e({searching:!0,error:null});try{const t=await Ee(s,n);return e({results:t.results||[],totalResults:t.results?.length||0,searching:!1}),t}catch(t){return e({error:t.message,searching:!1}),null}},booleanSearch:async(s,n={})=>{e({searching:!0,error:null});try{const t=await Fe(s,n);return e({results:t.results||[],totalResults:t.results?.length||0,searching:!1}),t}catch(t){return e({error:t.message,searching:!1}),null}},searchAndReplace:async(s,n,t={})=>{e({loading:!0,error:null});try{const i=await We(s,n,t);return e({loading:!1}),i}catch(i){return e({error:i.message,loading:!1}),null}},findSimilar:async(s,n={})=>{e({loading:!0,error:null});try{const t=await Pe(s,n);return e({loading:!1}),t}catch(t){return e({error:t.message,loading:!1}),null}},saveSearch:async(s,n,t={})=>{e({loading:!0,error:null});try{const i=await Le(s,n,t);return e(j=>({savedSearches:[i,...j.savedSearches],loading:!1})),i}catch(i){return e({error:i.message,loading:!1}),null}},fetchSavedSearches:async()=>{e({loading:!0,error:null});try{const s=await qe();return e({savedSearches:s||[],loading:!1}),s}catch(s){return e({error:s.message,loading:!1}),[]}},deleteSavedSearch:async s=>{e({loading:!0,error:null});try{return await Be(s),e(n=>({savedSearches:n.savedSearches.filter(t=>t.id!==s),loading:!1})),!0}catch(n){return e({error:n.message,loading:!1}),!1}},runSavedSearch:async s=>{e({searching:!0,error:null});try{const n=await He(s);return e({results:n.results||[],totalResults:n.total||0,searching:!1}),n}catch(n){return e({error:n.message,searching:!1}),null}},fetchAnalytics:async(s={})=>{e({loading:!0,error:null});try{const n=await Me(s);return e({analytics:n,loading:!1}),n}catch(n){return e({error:n.message,loading:!1}),null}},clearResults:()=>e({results:[],totalResults:0,facets:{},error:null}),clearHistory:()=>e({searchHistory:[]}),reset:()=>e({results:[],totalResults:0,facets:{},currentSearch:null,error:null})})),$e=f(o)(({theme:e})=>({display:"flex",flexDirection:"column",height:"calc(100vh - 64px)",backgroundColor:e.palette.background.default})),Ne=f(o)(({theme:e})=>({padding:e.spacing(3),backgroundColor:e.palette.mode==="dark"?g(e.palette.text.primary,.05):m[200],borderBottom:`1px solid ${g(e.palette.divider,.1)}`})),Ue=f(o)(({theme:e})=>({flex:1,display:"flex",overflow:"hidden"})),Ge=f(o)(({theme:e})=>({flex:1,padding:e.spacing(3),overflow:"auto"})),Ve=f(o)(({theme:e})=>({width:280,borderLeft:`1px solid ${g(e.palette.divider,.1)}`,backgroundColor:g(e.palette.background.paper,.6),display:"flex",flexDirection:"column"})),Ye=f(D)(({theme:e})=>({"& .MuiOutlinedInput-root":{backgroundColor:e.palette.mode==="dark"?g(e.palette.background.paper,.6):m[300],borderRadius:8,"& fieldset":{borderColor:e.palette.mode==="dark"?g(e.palette.text.primary,.12):m[500]},"&:hover":{"& fieldset":{borderColor:e.palette.mode==="dark"?g(e.palette.text.primary,.2):m[600]}},"&.Mui-focused":{"& fieldset":{borderColor:e.palette.mode==="dark"?e.palette.text.secondary:m[900],borderWidth:1}}}})),Ke=f(ee)(({theme:e})=>({padding:e.spacing(2),marginBottom:e.spacing(2),cursor:"pointer",transition:"all 0.2s ease","&:hover":{backgroundColor:e.palette.mode==="dark"?g(e.palette.text.primary,.05):m[200],borderColor:e.palette.mode==="dark"?m[1e3]:m[1100]}})),_=f(o)(({theme:e})=>({padding:e.spacing(2),borderBottom:`1px solid ${g(e.palette.divider,.1)}`})),X=f(re)(({theme:e})=>({borderRadius:8,textTransform:"none",fontWeight:500})),Je=[{type:"fulltext",label:"Full Text",icon:z},{type:"semantic",label:"Semantic",icon:we},{type:"regex",label:"Regex",icon:ke},{type:"boolean",label:"Boolean",icon:Te}];function Qe(){ue();const e=de(),{execute:l}=Z(),{results:s,totalResults:n,facets:t,savedSearches:i,searchHistory:j,loading:Xe,searching:k,error:E,search:F,semanticSearch:W,regexSearch:P,booleanSearch:L,saveSearch:q,fetchSavedSearches:B,deleteSavedSearch:Ze,runSavedSearch:H,clearResults:M,reset:O}=Oe(),[u,b]=p.useState(""),[y,T]=p.useState("fulltext"),[I,ae]=p.useState(!1),[d,R]=p.useState({}),[er,rr]=p.useState(!1),[ar,$]=p.useState(!1),[v,se]=p.useState("");p.useEffect(()=>(B(),()=>O()),[B,O]);const C=p.useCallback(async()=>{if(!u.trim())return;const a=async()=>{let h=null;switch(y){case"semantic":h=await W(u,{filters:d});break;case"regex":h=await P(u,{filters:d});break;case"boolean":h=await L(u,{filters:d});break;default:h=await F(u,{searchType:"fulltext",filters:d})}return h};return l({type:G.EXECUTE,label:"Search documents",reversibility:U.FULLY_REVERSIBLE,suppressSuccessToast:!0,intent:{source:"search",query:u,searchType:y},action:a})},[L,l,d,u,P,F,y,W]),te=p.useCallback(a=>{a.key==="Enter"&&C()},[C]);p.useCallback(async()=>{if(!(!v.trim()||!u.trim()))return l({type:G.CREATE,label:"Save search",reversibility:U.SYSTEM_MANAGED,intent:{source:"search",name:v},action:async()=>{await q(v,u,{searchType:y,filters:d}),e.show("Search saved","success"),se(""),$(!1)}})},[l,d,u,q,v,y,e]);const ne=p.useCallback(async a=>{b(a.query),T(a.search_type||"fulltext"),await H(a.id)},[H]),le=p.useCallback(()=>{b(""),M()},[M]);return r.jsxs($e,{children:[r.jsx(Ne,{children:r.jsxs(o,{sx:{maxWidth:800,mx:"auto"},children:[r.jsx(c,{variant:"h5",sx:{fontWeight:600,mb:3,textAlign:"center"},children:"Search & Discovery"}),r.jsx(ve,{value:y,onChange:(a,h)=>T(h),centered:!0,sx:{mb:2},children:Je.map(a=>r.jsx(Ce,{value:a.type,label:a.label,icon:r.jsx(a.icon,{fontSize:"small"}),iconPosition:"start"},a.type))}),r.jsx(Ye,{fullWidth:!0,placeholder:y==="regex"?"Enter regex pattern...":y==="boolean"?"e.g., (revenue AND growth) OR profit":y==="semantic"?"Describe what you're looking for...":"Search documents...",value:u,onChange:a=>b(a.target.value),onKeyPress:te,InputProps:{startAdornment:r.jsx(V,{position:"start",children:r.jsx(z,{color:"action"})}),endAdornment:r.jsxs(V,{position:"end",children:[u&&r.jsx(Y,{size:"small",onClick:le,children:r.jsx(Ie,{fontSize:"small"})}),r.jsx(Y,{onClick:()=>ae(!I),color:I?"primary":"default",children:r.jsx(Re,{})}),r.jsx(X,{variant:"contained",onClick:C,disabled:!u.trim()||k,sx:{ml:1},children:k?r.jsx(he,{size:20}):"Search"})]})}}),r.jsx(pe,{in:I,children:r.jsx(ee,{sx:{mt:2,p:2},children:r.jsxs(w,{container:!0,spacing:2,children:[r.jsx(w,{item:!0,xs:12,sm:4,children:r.jsxs(xe,{fullWidth:!0,size:"small",children:[r.jsx(ye,{children:"Document Type"}),r.jsxs(ge,{value:d.documentType||"",label:"Document Type",onChange:a=>R({...d,documentType:a.target.value}),children:[r.jsx(S,{value:"",children:"All"}),r.jsx(S,{value:"pdf",children:"PDF"}),r.jsx(S,{value:"docx",children:"Word"}),r.jsx(S,{value:"xlsx",children:"Excel"}),r.jsx(S,{value:"txt",children:"Text"})]})]})}),r.jsx(w,{item:!0,xs:12,sm:4,children:r.jsx(D,{fullWidth:!0,size:"small",label:"Date From",type:"date",InputLabelProps:{shrink:!0},value:d.dateFrom||"",onChange:a=>R({...d,dateFrom:a.target.value})})}),r.jsx(w,{item:!0,xs:12,sm:4,children:r.jsx(D,{fullWidth:!0,size:"small",label:"Date To",type:"date",InputLabelProps:{shrink:!0},value:d.dateTo||"",onChange:a=>R({...d,dateTo:a.target.value})})})]})})})]})}),r.jsxs(Ue,{children:[r.jsx(Ge,{children:s.length>0?r.jsxs(r.Fragment,{children:[r.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[r.jsxs(c,{variant:"subtitle1",children:[n," results found"]}),r.jsx(X,{size:"small",startIcon:r.jsx(_e,{}),onClick:()=>$(!0),children:"Save Search"})]}),s.map((a,h)=>r.jsx(Ke,{variant:"outlined",children:r.jsxs(o,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[r.jsx(fe,{color:"inherit"}),r.jsxs(o,{sx:{flex:1},children:[r.jsx(c,{variant:"subtitle1",sx:{fontWeight:600},children:a.title||a.filename||"Untitled"}),a.highlight&&r.jsx(c,{variant:"body2",color:"text.secondary",sx:{mt:.5},dangerouslySetInnerHTML:{__html:a.highlight}}),r.jsxs(o,{sx:{display:"flex",gap:1,mt:1},children:[a.score&&r.jsx(A,{size:"small",label:`Score: ${(a.score*100).toFixed(0)}%`}),a.type&&r.jsx(A,{size:"small",label:a.type.toUpperCase(),variant:"outlined"})]})]})]})},a.id||h))]}):k?null:r.jsxs(o,{sx:{height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",maxWidth:500,mx:"auto"},children:[r.jsx(z,{sx:{fontSize:64,color:"text.secondary",opacity:.3,mb:2}}),r.jsx(c,{variant:"h6",sx:{fontWeight:600,mb:1},children:"Search Your Documents"}),r.jsx(c,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Find what you need across all your documents using different search modes."}),r.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:1,width:"100%",maxWidth:300},children:[r.jsx(c,{variant:"caption",color:"text.secondary",sx:{textAlign:"left",mb:.5},children:"Try these example searches:"}),[{query:"quarterly revenue",type:"fulltext",label:"Full Text"},{query:"documents about marketing strategy",type:"semantic",label:"Semantic"},{query:"(budget AND 2024) OR forecast",type:"boolean",label:"Boolean"}].map(a=>r.jsxs(re,{variant:"outlined",size:"small",onClick:()=>{b(a.query),T(a.type)},sx:{justifyContent:"flex-start",textTransform:"none",textAlign:"left"},children:[r.jsx(A,{size:"small",label:a.label,sx:{mr:1,pointerEvents:"none"}}),r.jsx(c,{variant:"body2",noWrap:!0,children:a.query})]},a.query))]})]})}),r.jsxs(Ve,{children:[r.jsxs(_,{children:[r.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[r.jsx(c,{variant:"subtitle2",sx:{fontWeight:600},children:"Saved Searches"}),r.jsx(Ae,{fontSize:"small",color:"action"})]}),r.jsxs(K,{dense:!0,children:[i.slice(0,5).map(a=>r.jsx(J,{button:!0,onClick:()=>ne(a),sx:{borderRadius:1},children:r.jsx(Q,{primary:a.name,secondary:a.query,primaryTypographyProps:{variant:"body2"},secondaryTypographyProps:{noWrap:!0}})},a.id)),i.length===0&&r.jsx(c,{variant:"body2",color:"text.secondary",sx:{py:1},children:"No saved searches"})]})]}),r.jsxs(_,{children:[r.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[r.jsx(c,{variant:"subtitle2",sx:{fontWeight:600},children:"Recent Searches"}),r.jsx(me,{fontSize:"small",color:"action"})]}),r.jsxs(K,{dense:!0,children:[j.slice(0,5).map((a,h)=>r.jsx(J,{button:!0,onClick:()=>{b(a.query),C()},sx:{borderRadius:1},children:r.jsx(Q,{primary:a.query,secondary:`${a.resultCount} results`,primaryTypographyProps:{variant:"body2",noWrap:!0}})},h)),j.length===0&&r.jsx(c,{variant:"body2",color:"text.secondary",sx:{py:1},children:"No recent searches"})]})]}),Object.keys(t).length>0&&r.jsxs(_,{children:[r.jsx(c,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:"Refine Results"}),Object.entries(t).map(([a,h])=>r.jsxs(o,{sx:{mb:2},children:[r.jsx(c,{variant:"caption",color:"text.secondary",children:a.replace(/_/g," ").toUpperCase()}),Object.entries(h).slice(0,5).map(([N,oe])=>r.jsx(be,{control:r.jsx(Se,{size:"small"}),label:r.jsxs(c,{variant:"body2",children:[N," (",oe,")"]})},N))]},a))]})]})]}),E&&r.jsx(je,{severity:"error",sx:{m:2},children:E})]})}function pr(){return Z(),r.jsx(Qe,{})}export{pr as default};
