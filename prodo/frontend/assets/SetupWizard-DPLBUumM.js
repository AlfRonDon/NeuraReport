import{a8 as Re,a9 as Pe,r as a,aa as Ee,ar as ue,ab as me,j as e,ac as Fe,N as q,cG as Ve,at as le,g as De,d2 as _e,d3 as Ye,d4 as Je,as as re,au as qe,av as ye,B as w,o as p,aZ as fe,n as i,q as W,P as Y,K as z,v as ce,a as de,l as O,b8 as Qe,bf as Ze,R as X,I as ee,b3 as oe,p as $,f as L,ak as xe,A as J,t as Xe,a7 as ie,a1 as et,bW as tt,w as Ne,d5 as st,d6 as ot,b_ as at,a2 as he,d7 as nt,D as rt,s as ve,bS as je,d8 as it,aF as lt,aJ as ct,ba as dt,bb as pt,bc as ut,ci as mt,aE as xt,Z as ht}from"./index-CS2nn_Zr.js";import{A as ft}from"./ArrowBack-Pz5aUg6X.js";import{A as gt}from"./ArrowForward-DSlf8ErD.js";import{C as Ce}from"./Check-qKgRAIhX.js";import{C as se}from"./Container-DN76a9U0.js";import{S as bt}from"./Science-DSVMyZUu.js";import{C as yt}from"./Cloud-CnmUcx6t.js";import{D as vt,C as jt}from"./ConnectionForm-DaYky-BB.js";import{C as ae}from"./CardContent-D2oMcta9.js";import{P as Ct}from"./PictureAsPdf-DqRICvGz.js";import{R as kt}from"./ReceiptLong-B-h52U3k.js";import{T as It,a as ke}from"./ToggleButtonGroup-il_rsV-0.js";import{G as Ie}from"./Grid-B_V8L2Yi.js";import{T as St,a as wt,b as Se,c as V,d as Tt}from"./TableRow-BDOXK0au.js";import{R as At}from"./ReportGlossaryNotice-BhAfs_HN.js";import"./Switch-kdeVSDF6.js";import"./Article-hUc3iiWJ.js";function Rt(t){return Re("MuiCardActionArea",t)}const pe=Pe("MuiCardActionArea",["root","focusVisible","focusHighlight"]),Pt=t=>{const{classes:n}=t;return Fe({root:["root"],focusHighlight:["focusHighlight"]},Rt,n)},Et=q(Ve,{name:"MuiCardActionArea",slot:"Root"})(le(({theme:t})=>({display:"block",textAlign:"inherit",borderRadius:"inherit",width:"100%",[`&:hover .${pe.focusHighlight}`]:{opacity:(t.vars||t).palette.action.hoverOpacity,"@media (hover: none)":{opacity:0}},[`&.${pe.focusVisible} .${pe.focusHighlight}`]:{opacity:(t.vars||t).palette.action.focusOpacity}}))),Ft=q("span",{name:"MuiCardActionArea",slot:"FocusHighlight"})(le(({theme:t})=>({overflow:"hidden",pointerEvents:"none",position:"absolute",top:0,right:0,bottom:0,left:0,borderRadius:"inherit",opacity:0,backgroundColor:"currentcolor",transition:t.transitions.create("opacity",{duration:t.transitions.duration.short})}))),ne=a.forwardRef(function(n,f){const c=Ee({props:n,name:"MuiCardActionArea"}),{children:r,className:P,focusVisibleClassName:I,slots:F={},slotProps:j={},..._}=c,g=c,C=Pt(g),E={slots:F,slotProps:j},[u,R]=ue("root",{elementType:Et,externalForwardedProps:{...E,..._},shouldForwardComponentProp:!0,ownerState:g,ref:f,className:me(C.root,P),additionalProps:{focusVisibleClassName:me(I,C.focusVisible)}}),[M,N]=ue("focusHighlight",{elementType:Ft,externalForwardedProps:E,ownerState:g,className:C.focusHighlight});return e.jsxs(u,{...R,children:[r,e.jsx(M,{...N})]})}),Dt=De(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),_t=De(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"})),Nt=q("span",{name:"MuiRadioButtonIcon",shouldForwardProp:_e})({position:"relative",display:"flex"}),Mt=q(Dt,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),Ut=q(_t,{name:"MuiRadioButtonIcon"})(le(({theme:t})=>({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}}]})));function Me(t){const{checked:n=!1,classes:f={},fontSize:c}=t,r={...t,checked:n};return e.jsxs(Nt,{className:f.root,ownerState:r,children:[e.jsx(Mt,{fontSize:c,className:f.background,ownerState:r}),e.jsx(Ut,{fontSize:c,className:f.dot,ownerState:r})]})}const Bt=a.createContext(void 0);function zt(){return a.useContext(Bt)}function Lt(t){return Re("MuiRadio",t)}const we=Pe("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),Ot=t=>{const{classes:n,color:f,size:c}=t,r={root:["root",`color${re(f)}`,c!=="medium"&&`size${re(c)}`]};return{...n,...Fe(r,Lt,n)}},Wt=q(qe,{shouldForwardProp:t=>_e(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:f}=t;return[n.root,f.size!=="medium"&&n[`size${re(f.size)}`],n[`color${re(f.color)}`]]}})(le(({theme:t})=>({color:(t.vars||t).palette.text.secondary,[`&.${we.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.alpha((t.vars||t).palette.action.active,(t.vars||t).palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(ye()).map(([n])=>({props:{color:n,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.alpha((t.vars||t).palette[n].main,(t.vars||t).palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(ye()).map(([n])=>({props:{color:n,disabled:!1},style:{[`&.${we.checked}`]:{color:(t.vars||t).palette[n].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function Gt(t,n){return typeof n=="object"&&n!==null?t===n:String(t)===String(n)}const $t=e.jsx(Me,{checked:!0}),Kt=e.jsx(Me,{}),Ue=a.forwardRef(function(n,f){const c=Ee({props:n,name:"MuiRadio"}),{checked:r,checkedIcon:P=$t,color:I="primary",icon:F=Kt,name:j,onChange:_,size:g="medium",className:C,disabled:E,disableRipple:u=!1,slots:R={},slotProps:M={},inputProps:N,...D}=c,k=Ye();let y=E;k&&typeof y>"u"&&(y=k.disabled),y??=!1;const U={...c,disabled:y,disableRipple:u,color:I,size:g},m=Ot(U),T=zt();let s=r;const b=Je(_,T&&T.onChange);let B=j;T&&(typeof s>"u"&&(s=Gt(T.value,c.value)),typeof B>"u"&&(B=T.name));const l=M.input??N,[x,A]=ue("root",{ref:f,elementType:Wt,className:me(m.root,C),shouldForwardComponentProp:!0,externalForwardedProps:{slots:R,slotProps:M,...D},getSlotProps:d=>({...d,onChange:(Q,...H)=>{d.onChange?.(Q,...H),b(Q,...H)}}),ownerState:U,additionalProps:{type:"radio",icon:a.cloneElement(F,{fontSize:F.props.fontSize??g}),checkedIcon:a.cloneElement(P,{fontSize:P.props.fontSize??g}),disabled:y,name:B,checked:s,slots:R,slotProps:{input:typeof l=="function"?l(U):l}}});return e.jsx(x,{...A,classes:m})});function Ht({title:t,subtitle:n,steps:f,currentStep:c,onNext:r,onPrev:P,onComplete:I,onCancel:F,nextLabel:j="Next",prevLabel:_="Back",completeLabel:g="Complete",cancelLabel:C="Exit",nextDisabled:E=!1,loading:u=!1,children:R}){const M=(c+1)/f.length*100,N=c===f.length-1,D=c===0;return e.jsxs(w,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",bgcolor:"background.default"},children:[e.jsx(w,{sx:{borderBottom:1,borderColor:"divider",bgcolor:"background.paper",py:2},children:e.jsxs(se,{maxWidth:"md",children:[e.jsx(p,{variant:"h5",fontWeight:600,children:t}),n&&e.jsx(p,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:n})]})}),e.jsx(fe,{variant:"determinate",value:M,sx:{height:4,bgcolor:"action.hover","& .MuiLinearProgress-bar":{bgcolor:k=>k.palette.mode==="dark"?i[500]:i[900]}}}),e.jsx(w,{sx:{borderBottom:1,borderColor:"divider",bgcolor:"background.paper"},children:e.jsx(se,{maxWidth:"md",children:e.jsx(W,{direction:"row",spacing:0,sx:{py:2},children:f.map((k,y)=>e.jsxs(w,{sx:{flex:1,display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(w,{sx:{width:28,height:28,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:U=>y<c?U.palette.mode==="dark"?i[700]:i[900]:y===c?U.palette.mode==="dark"?i[500]:i[700]:"action.disabledBackground",color:y<=c?"white":"text.disabled",fontSize:"0.75rem",fontWeight:600},children:y<c?e.jsx(Ce,{sx:{fontSize:16}}):y+1}),e.jsxs(w,{sx:{flex:1},children:[e.jsx(p,{variant:"body2",fontWeight:y===c?600:400,color:y===c?"text.primary":"text.secondary",children:k.label}),k.description&&e.jsx(p,{variant:"caption",color:"text.disabled",children:k.description})]}),y<f.length-1&&e.jsx(w,{sx:{width:40,height:2,bgcolor:U=>y<c?U.palette.mode==="dark"?i[700]:i[900]:U.palette.divider,mx:1}})]},k.key))})})}),e.jsx(w,{sx:{flex:1,py:4},children:e.jsx(se,{maxWidth:"md",children:e.jsx(Y,{elevation:0,sx:{p:4,border:1,borderColor:"divider",borderRadius:1},children:R})})}),e.jsx(w,{sx:{borderTop:1,borderColor:"divider",bgcolor:"background.paper",py:2},children:e.jsx(se,{maxWidth:"md",children:e.jsxs(W,{direction:"row",justifyContent:"space-between",children:[e.jsxs(W,{direction:"row",spacing:1,children:[F&&e.jsx(z,{variant:"text",onClick:F,disabled:u,sx:{color:"text.secondary"},children:C}),e.jsx(z,{variant:"outlined",startIcon:e.jsx(ft,{}),onClick:P,disabled:D||u,children:_})]}),e.jsx(z,{variant:"contained",endIcon:N?e.jsx(Ce,{}):e.jsx(gt,{}),onClick:N?I:r,disabled:E||u,children:N?g:j})]})})})]})}const K={id:"demo-connection",name:"Sample Database (Demo)",db_type:"demo",database:"sample_data",status:"connected",summary:"Pre-loaded sample data for testing",isDemo:!0};function Vt({wizardState:t,updateWizardState:n,onComplete:f,setLoading:c}){const r=ce(),{execute:P}=de(),I=O(s=>s.savedConnections),F=O(s=>s.setSavedConnections),j=O(s=>s.addSavedConnection),_=O(s=>s.setActiveConnectionId),g=O(s=>s.activeConnection),[C,E]=a.useState(t.connectionId||g?.id||null),[u,R]=a.useState(!1),[M,N]=a.useState(!1),D=Array.isArray(I)?I.filter(s=>s&&typeof s=="object"&&s.id):[];a.useEffect(()=>{const s=async()=>{try{const b=await tt();b?.connections&&F(b.connections)}catch(b){console.error("Failed to fetch connections:",b),r.show("Failed to load saved connections","warning")}};D.length===0&&s()},[D.length,F,r]);const k=a.useCallback(s=>{E(s),n({connectionId:s}),_(s)},[n,_]),y=a.useCallback(()=>{R(!0)},[]),U=a.useCallback(async s=>{N(!0);try{await P({type:ee.CREATE,label:`Add connection "${s?.name||s?.db_url||"connection"}"`,reversibility:X.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,blocksNavigation:!1,intent:{connectionName:s?.name,dbType:s?.db_type},action:async()=>{try{const b=await Qe(s);if(!b.ok)throw new Error(b.detail||"Connection test failed");const B=await Ze({id:b.connection_id,name:s.name,dbType:s.db_type,dbUrl:s.db_url,database:s.database,status:"connected",latencyMs:b.latency_ms});return j(B),k(B.id),r.show("Connection added","success"),R(!1),B}catch(b){throw r.show(b.message||"Failed to save connection","error"),b}}})}finally{N(!1)}},[j,k,r,P]);a.useCallback(()=>{C&&f()},[C,f]);const m=a.useCallback(()=>{E(K.id),n({connectionId:K.id,isDemo:!0}),D.find(s=>s.id===K.id)||j(K),_(K.id),r.show("Demo mode activated! Using sample data.","success")},[n,D,j,_,r]),T=a.useCallback(()=>{n({connectionId:null,skippedConnection:!0}),f()},[n,f]);return e.jsxs(w,{children:[e.jsx(p,{variant:"h6",fontWeight:600,sx:{mb:1},children:"Connect Your Data"}),e.jsx(p,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Choose where your report data comes from. You can always change this later."}),e.jsxs(w,{sx:{mb:4},children:[e.jsx(p,{variant:"subtitle2",fontWeight:600,color:"text.secondary",sx:{mb:2,textTransform:"uppercase",fontSize:"0.75rem",letterSpacing:"0.05em"},children:"Quick Start"}),e.jsxs(W,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(oe,{variant:"outlined",sx:{flex:1,border:2,borderColor:C===K.id?s=>s.palette.mode==="dark"?i[500]:i[700]:"divider",bgcolor:C===K.id?s=>s.palette.mode==="dark"?L(s.palette.text.primary,.04):i[50]:"transparent",transition:"all 0.2s","&:hover":{borderColor:s=>s.palette.mode==="dark"?i[500]:i[700],bgcolor:s=>s.palette.mode==="dark"?L(s.palette.text.primary,.04):i[50]}},children:e.jsx(ne,{onClick:m,sx:{height:"100%"},children:e.jsxs(ae,{sx:{textAlign:"center",py:3},children:[e.jsx(bt,{sx:{fontSize:40,color:"text.secondary",mb:1}}),e.jsx(p,{variant:"subtitle1",fontWeight:600,children:"Try Demo Mode"}),e.jsx(p,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Explore with sample data — no setup needed"}),e.jsx($,{label:"Recommended for first-time users",size:"small",variant:"outlined",sx:{bgcolor:s=>s.palette.mode==="dark"?L(s.palette.text.primary,.1):i[200],color:"text.secondary"}})]})})}),e.jsx(oe,{variant:"outlined",sx:{flex:1,border:2,borderColor:"divider",transition:"all 0.2s","&:hover":{borderColor:"secondary.main"}},children:e.jsx(ne,{onClick:T,sx:{height:"100%"},children:e.jsxs(ae,{sx:{textAlign:"center",py:3},children:[e.jsx(yt,{sx:{fontSize:40,color:"text.secondary",mb:1}}),e.jsx(p,{variant:"subtitle1",fontWeight:600,children:"Skip for Now"}),e.jsx(p,{variant:"body2",color:"text.secondary",children:"Set up data source later and explore templates first"})]})})})]})]}),e.jsx(xe,{sx:{my:3},children:e.jsx($,{label:"Or connect your own data",size:"small"})}),D.length===0||D.every(s=>s.isDemo)?e.jsx(J,{severity:"info",sx:{mb:3},children:"No database connections yet. Add one below or try demo mode above."}):e.jsx(W,{spacing:2,sx:{mb:3},children:D.map(s=>e.jsx(oe,{variant:"outlined",sx:{border:2,borderColor:C===s.id?b=>b.palette.mode==="dark"?i[500]:i[700]:"divider",transition:"border-color 0.2s"},children:e.jsx(ne,{onClick:()=>k(s.id),children:e.jsxs(ae,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ue,{checked:C===s.id,sx:{p:0}}),e.jsx(Xe,{sx:{color:"text.secondary"}}),e.jsxs(w,{sx:{flex:1},children:[e.jsx(p,{variant:"subtitle1",fontWeight:500,children:s.name}),e.jsxs(p,{variant:"body2",color:"text.secondary",children:[s.db_type," • ",s.summary||s.database]})]}),e.jsxs(W,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx($,{size:"small",label:s.status==="connected"?"Connected":"Disconnected",variant:"outlined",sx:{bgcolor:b=>b.palette.mode==="dark"?L(b.palette.text.primary,.1):i[200],color:"text.secondary"}}),C===s.id&&e.jsx(ie,{sx:{color:"text.secondary"}})]})]})})},s.id))}),e.jsx(xe,{sx:{my:3}}),e.jsx(z,{variant:"outlined",startIcon:e.jsx(et,{}),onClick:y,fullWidth:!0,sx:{py:1.5,borderStyle:"dashed"},children:"Add New Connection"}),e.jsx(vt,{open:u,onClose:()=>R(!1),title:"New Connection",subtitle:"Configure your database connection",width:520,children:e.jsx(jt,{onSave:U,onCancel:()=>R(!1),loading:M})})]})}const Yt=[{id:"gallery-invoice",name:"Invoice Report",description:"Professional invoice template with line items, totals, and company branding",kind:"pdf",icon:kt,popular:!0},{id:"gallery-sales",name:"Sales Summary",description:"Weekly/monthly sales report with charts, metrics, and trends",kind:"excel",icon:at,popular:!0},{id:"gallery-inventory",name:"Inventory Report",description:"Stock levels, reorder points, and inventory movement tracking",kind:"excel",icon:he,popular:!1},{id:"gallery-executive",name:"Executive Summary",description:"High-level business metrics and KPIs for leadership review",kind:"pdf",icon:nt,popular:!1},{id:"gallery-blank-pdf",name:"Blank PDF Template",description:"Start from scratch with a customizable PDF layout",kind:"pdf",icon:rt,popular:!1},{id:"gallery-blank-excel",name:"Blank Excel Template",description:"Start from scratch with a customizable spreadsheet",kind:"excel",icon:he,popular:!1}];function Jt({wizardState:t,updateWizardState:n,onComplete:f,setLoading:c}){const r=ce(),{execute:P}=de(),I=Ne(),F=a.useCallback((o,v,S={})=>I(o,{label:v,intent:{from:"setup-step-template",...S}}),[I]),j=a.useRef(null),_=O(o=>o.activeConnection),g=O(o=>o.setTemplateId),C=O(o=>o.setVerifyArtifacts),E=O(o=>o.addTemplate),[u,R]=a.useState(t.templateKind||"pdf"),[M,N]=a.useState(!1),[D,k]=a.useState(0),[y,U]=a.useState(null),[m,T]=a.useState(null),[s,b]=a.useState(null),[B,l]=a.useState(!1),[x,A]=a.useState(null),[d,Q]=a.useState(null),[H,be]=a.useState(!1);a.useEffect(()=>{if(!x)return;let o=!1;const v=async()=>{try{const h=await it(x);if(o||!h)return;if(typeof h.progress=="number"&&k(Math.round(h.progress)),h.status==="completed"){const G=h.result||{},Z=G.template_id||G.templateId;if(!Z){b("Template verification completed but no template ID was returned."),r.show("Template verification completed without a template ID.","error"),A(null);return}T(G),g(Z),C(G.artifacts),n({templateId:Z}),E({id:Z,name:y?.name||`Template ${Z}`,kind:u,status:"pending",created_at:new Date().toISOString()}),r.show("Template verified successfully","success"),A(null)}else if(h.status==="failed"||h.status==="cancelled"){const G=h.error||"Template verification failed";b(G),r.show(G,"error"),A(null)}}catch(h){if(o)return;const G=h.message||"Failed to load queued job status";b(G),r.show(G,"error"),A(null)}};v();const S=setInterval(v,3e3);return()=>{o=!0,clearInterval(S)}},[x,u,y,g,C,n,E,r]);const Be=a.useCallback((o,v)=>{v&&(R(v),n({templateKind:v}))},[n]),te=a.useCallback(async o=>{b(null),U(o),N(!0),k(0),A(null);try{const v=t.connectionId||_?.id;if(!v){const S="Please connect to a database before verifying templates.";b(S),r.show(S,"warning"),N(!1),k(0);return}await P({type:ee.UPLOAD,label:`Verify ${u.toUpperCase()} template`,reversibility:X.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,blocksNavigation:!0,intent:{connectionId:v,templateKind:u,fileName:o?.name,action:"verify_template"},action:async()=>{try{const S=await st({file:o,connectionId:v,kind:u,background:B,onProgress:h=>{if(h.event==="stage"){const G=h.progress||0;k(G)}},onUploadProgress:h=>{k(h)}});if(B){const h=S?.job_id||S?.jobId||null;return A(h),r.show("Template verification queued. Track progress in Jobs.","success"),S}return T(S),g(S.template_id),C(S.artifacts),n({templateId:S.template_id}),E({id:S.template_id,name:o.name,kind:u,status:"pending",created_at:new Date().toISOString()}),r.show("Template verified successfully","success"),S}catch(S){throw b(S.message||"Failed to verify template"),r.show(S.message||"Failed to verify template","error"),S}}})}finally{N(!1),k(100)}},[t.connectionId,_?.id,u,B,g,C,n,E,r,P]),ze=a.useCallback(o=>{o.preventDefault();const v=o.dataTransfer?.files;v?.length>0&&te(v[0])},[te]),Le=a.useCallback(o=>{o.preventDefault()},[]),Oe=a.useCallback(o=>{const v=o.target.files;v?.length>0&&te(v[0])},[te]),We=a.useCallback(()=>{j.current?.click()},[]),Ge=u==="pdf"?".pdf":".xlsx,.xls",$e=a.useCallback(o=>{Q(o),R(o.kind),n({templateKind:o.kind,galleryTemplate:o})},[n]),Ke=a.useCallback(async()=>{d&&await P({type:ee.CREATE,label:`Use "${d.name}" template`,reversibility:X.FULLY_REVERSIBLE,suppressSuccessToast:!0,intent:{galleryId:d.id,kind:d.kind,action:"use_gallery_template"},action:async()=>{c(!0);try{const o=await ot?.({galleryId:d.id,kind:d.kind,connectionId:t.connectionId}).catch(()=>({template_id:`template-${d.id}-${Date.now()}`,name:d.name})),v=o.template_id||o.templateId||`gallery-${d.id}`;return g(v),n({templateId:v,galleryTemplate:d}),E({id:v,name:d.name,kind:d.kind,status:"approved",created_at:new Date().toISOString(),isGalleryTemplate:!0}),r.show(`"${d.name}" template ready!`,"success"),T({template_id:v}),o}finally{c(!1)}}})},[d,t.connectionId,g,n,E,r,c,P]),He=Yt.filter(o=>u==="all"||o.kind===u);return e.jsxs(w,{children:[e.jsx(p,{variant:"h6",fontWeight:600,sx:{mb:1},children:"Choose a Report Template"}),e.jsx(p,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Create with AI, pick from our gallery, or upload your own design."}),e.jsx(w,{sx:{mb:3},children:e.jsxs(It,{value:u,exclusive:!0,onChange:Be,size:"small",children:[e.jsxs(ke,{value:"pdf",sx:{px:3},children:[e.jsx(Ct,{sx:{mr:1,fontSize:18}}),"PDF Reports"]}),e.jsxs(ke,{value:"excel",sx:{px:3},children:[e.jsx(he,{sx:{mr:1,fontSize:18}}),"Excel Reports"]})]})}),!H&&!m&&e.jsxs(w,{sx:{mb:3},children:[e.jsxs(p,{variant:"subtitle2",fontWeight:600,color:"text.secondary",sx:{mb:2,textTransform:"uppercase",fontSize:"0.75rem",letterSpacing:"0.05em"},children:[e.jsx(ve,{sx:{fontSize:14,mr:.5,verticalAlign:"middle"}}),"Template Gallery"]}),e.jsx(Ie,{container:!0,spacing:2,children:He.map(o=>{const v=o.icon,S=d?.id===o.id;return e.jsx(Ie,{item:!0,xs:12,sm:6,md:4,children:e.jsx(oe,{variant:"outlined",sx:{height:"100%",border:2,borderColor:S?h=>h.palette.mode==="dark"?i[500]:i[700]:"divider",bgcolor:S?h=>h.palette.mode==="dark"?L(h.palette.text.primary,.04):i[50]:"transparent",transition:"all 0.2s","&:hover":{borderColor:h=>h.palette.mode==="dark"?i[500]:i[700],transform:"translateY(-2px)",boxShadow:2}},children:e.jsx(ne,{onClick:()=>$e(o),sx:{height:"100%",display:"flex",flexDirection:"column",alignItems:"stretch"},children:e.jsxs(ae,{sx:{flex:1},children:[e.jsxs(W,{direction:"row",alignItems:"flex-start",spacing:1,sx:{mb:1},children:[e.jsx(Ue,{checked:S,size:"small",sx:{p:0,mr:.5}}),e.jsx(v,{sx:{fontSize:24,color:"text.secondary"}}),e.jsxs(w,{sx:{flex:1},children:[e.jsxs(W,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(p,{variant:"subtitle2",fontWeight:600,children:o.name}),o.popular&&e.jsx($,{label:"Popular",size:"small",sx:{height:18,fontSize:"10px",bgcolor:h=>h.palette.mode==="dark"?L(h.palette.text.primary,.1):i[200],color:"text.secondary"}})]}),e.jsx($,{label:o.kind.toUpperCase(),size:"small",variant:"outlined",sx:{height:18,fontSize:"10px",mt:.5,bgcolor:h=>h.palette.mode==="dark"?L(h.palette.text.primary,.1):i[200],color:"text.secondary"}})]})]}),e.jsx(p,{variant:"caption",color:"text.secondary",children:o.description})]})})})},o.id)})}),d&&e.jsxs(w,{sx:{mt:2},children:[e.jsxs(z,{variant:"contained",onClick:Ke,startIcon:e.jsx(ie,{}),sx:{mr:2},children:['Use "',d.name,'"']}),e.jsx(z,{variant:"text",onClick:()=>Q(null),children:"Clear Selection"})]}),e.jsx(xe,{sx:{my:3},children:e.jsx($,{label:"Or start your own",size:"small"})}),e.jsxs(W,{direction:"row",spacing:2,children:[e.jsx(z,{variant:"contained",startIcon:e.jsx(ve,{}),onClick:()=>F(`/templates/new/chat?from=wizard&connectionId=${encodeURIComponent(t.connectionId||"")}`,"Create template with AI"),sx:{bgcolor:i[900],"&:hover":{bgcolor:i[700]}},children:"Create with AI"}),e.jsx(z,{variant:"outlined",startIcon:e.jsx(je,{}),onClick:()=>be(!0),sx:{borderStyle:"dashed"},children:"Upload Custom Template"})]})]}),(H||m)&&e.jsxs(e.Fragment,{children:[H&&!m&&e.jsx(z,{variant:"text",onClick:()=>be(!1),sx:{mb:2},children:"← Back to Gallery"}),s&&e.jsx(J,{severity:"error",sx:{mb:3},onClose:()=>b(null),children:s}),x&&e.jsxs(J,{severity:"info",sx:{mb:3},action:e.jsx(z,{size:"small",onClick:()=>F("/jobs","Open jobs"),sx:{textTransform:"none"},children:"View Jobs"}),children:["Template verification queued. Job ID: ",x]}),m?e.jsx(Y,{sx:{p:3,border:2,borderColor:o=>L(o.palette.divider,.3),bgcolor:o=>o.palette.mode==="dark"?L(o.palette.text.primary,.04):i[50]},children:e.jsxs(W,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(ie,{sx:{fontSize:48,color:"text.secondary"}}),e.jsxs(w,{children:[e.jsx(p,{variant:"subtitle1",fontWeight:600,children:"Template Verified"}),e.jsx(p,{variant:"body2",color:"text.secondary",children:y?.name}),e.jsxs(p,{variant:"caption",color:"text.secondary",children:["ID: ",m.template_id]})]})]})}):e.jsxs(Y,{onDrop:ze,onDragOver:Le,sx:{p:4,border:2,borderStyle:"dashed",borderColor:"divider",bgcolor:"action.hover",textAlign:"center",cursor:"pointer",transition:"border-color 0.2s, background-color 0.2s","&:hover":{borderColor:o=>o.palette.mode==="dark"?i[500]:i[700],bgcolor:o=>o.palette.mode==="dark"?L(o.palette.text.primary,.04):i[50]}},onClick:We,children:[e.jsx(W,{direction:"row",justifyContent:"center",sx:{mb:2},children:e.jsx(z,{variant:B?"contained":"outlined",size:"small",onClick:o=>{o.stopPropagation(),l(v=>!v)},sx:{textTransform:"none"},children:B?"Queue in background: On":"Queue in background: Off"})}),e.jsx("input",{ref:j,type:"file",accept:Ge,onChange:Oe,hidden:!0}),M?e.jsxs(w,{children:[e.jsx(p,{variant:"body1",sx:{mb:2},children:"Uploading and verifying..."}),e.jsx(fe,{variant:"determinate",value:D,sx:{maxWidth:300,mx:"auto",bgcolor:o=>o.palette.mode==="dark"?L(o.palette.text.primary,.1):i[100],"& .MuiLinearProgress-bar":{bgcolor:o=>o.palette.mode==="dark"?i[500]:i[700]}}}),e.jsxs(p,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:[D,"%"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{sx:{fontSize:48,color:"text.disabled",mb:2}}),e.jsxs(p,{variant:"body1",sx:{mb:1},children:["Drag and drop your ",u.toUpperCase()," file here"]}),e.jsx(p,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"or click to browse"}),e.jsx(z,{variant:"outlined",size:"small",children:"Browse Files"})]})]}),m?.artifacts?.png_url&&e.jsxs(w,{sx:{mt:3},children:[e.jsx(p,{variant:"subtitle2",fontWeight:600,sx:{mb:1},children:"Preview"}),e.jsx(Y,{sx:{p:2,bgcolor:"background.default"},children:e.jsx("img",{src:m.artifacts.png_url,alt:"Template preview",style:{maxWidth:"100%",height:"auto",borderRadius:4}})})]})]})]})}function qt({wizardState:t,updateWizardState:n,onComplete:f,setLoading:c}){const r=ce(),{execute:P}=de(),I=O(l=>l.templateId)||t.templateId,F=O(l=>l.activeConnection),j=O(l=>l.setLastApprovedTemplate),[_,g]=a.useState(!1),[C,E]=a.useState(t.mapping||{}),[u,R]=a.useState(t.keys||[]),[M,N]=a.useState(!1),[D,k]=a.useState(!1),[y,U]=a.useState(!1),[m,T]=a.useState(null);a.useEffect(()=>{let l=!1;const x=async()=>{if(I){g(!0);try{const A=t.connectionId||F?.id;await P({type:ee.ANALYZE,label:"Load mapping preview",reversibility:X.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,blocksNavigation:!1,intent:{connectionId:A,templateId:I,templateKind:t.templateKind||"pdf",action:"mapping_preview"},action:async()=>{try{const d=await xt(I,A,{kind:t.templateKind||"pdf"});return l||(d.mapping&&(E(d.mapping),n({mapping:d.mapping})),d.keys&&(R(d.keys),n({keys:d.keys}))),d}catch(d){throw l||T(d.message||"Failed to load mapping"),d}}})}finally{l||g(!1)}}};return t.mapping||x(),()=>{l=!0}},[I,t.connectionId,t.templateKind,t.mapping,F?.id,n,P]);const s=a.useCallback((l,x,A)=>{E(d=>({...d,[l]:{...d[l],[x]:A}}))},[]),b=a.useCallback(async()=>{k(!0),T(null);try{const l=t.connectionId||F?.id;await P({type:ee.UPDATE,label:"Approve template mapping",reversibility:X.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,blocksNavigation:!0,intent:{connectionId:l,templateId:I,templateKind:t.templateKind||"pdf",action:"mapping_approve"},action:async()=>{try{const x=await lt(I,C,{connectionId:l,keys:u,kind:t.templateKind||"pdf",onProgress:()=>{}});return x.ok&&(U(!0),j({id:I,name:t.templateName,kind:t.templateKind}),r.show("Template approved and ready to use!","success")),x}catch(x){throw T(x.message||"Failed to approve mapping"),r.show(x.message||"Failed to approve mapping","error"),x}}})}finally{k(!1)}},[I,C,u,t,F?.id,j,r,P]),B=Object.entries(C);return e.jsxs(w,{children:[e.jsx(p,{variant:"h6",fontWeight:600,sx:{mb:1},children:"Configure Field Mapping"}),e.jsx(p,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Map template placeholders to your database columns for automatic data insertion."}),m&&e.jsx(J,{severity:"error",sx:{mb:3},onClose:()=>T(null),children:m}),y&&e.jsx(J,{severity:"success",icon:e.jsx(ie,{}),sx:{mb:3},children:"Template mapping approved! You can now generate reports."}),_?e.jsxs(w,{sx:{py:4},children:[e.jsx(p,{variant:"body2",color:"text.secondary",sx:{mb:2,textAlign:"center"},children:"Loading mapping configuration..."}),e.jsx(fe,{})]}):B.length===0?e.jsx(J,{severity:"info",children:"No mappings found. The template may not have any placeholder tokens."}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{variant:"outlined",sx:{overflow:"hidden"},children:e.jsxs(St,{size:"small",children:[e.jsx(wt,{children:e.jsxs(Se,{sx:{bgcolor:"action.hover"},children:[e.jsx(V,{sx:{fontWeight:600},children:"Template Field"}),e.jsx(V,{sx:{fontWeight:600},children:"Database Column"}),e.jsx(V,{sx:{fontWeight:600},children:"Status"})]})}),e.jsx(Tt,{children:B.map(([l,x])=>e.jsxs(Se,{children:[e.jsx(V,{children:e.jsx($,{label:l,size:"small",variant:"outlined",sx:{fontFamily:"monospace"}})}),e.jsx(V,{children:e.jsx(ct,{size:"small",value:x?.column||x?.expression||"",onChange:A=>s(l,"column",A.target.value),placeholder:"Enter column name",fullWidth:!0,disabled:y})}),e.jsx(V,{children:x?.column||x?.expression?e.jsx($,{label:"Mapped",size:"small",variant:"outlined",sx:{bgcolor:A=>A.palette.mode==="dark"?L(A.palette.text.primary,.1):i[200],color:"text.secondary"}}):e.jsx($,{label:"Unmapped",size:"small",variant:"outlined",sx:{bgcolor:A=>A.palette.mode==="dark"?L(A.palette.text.primary,.1):i[200],color:"text.secondary"}})})]},l))})]})}),e.jsxs(w,{sx:{mt:3},children:[e.jsx(z,{variant:"text",size:"small",onClick:()=>N(l=>!l),endIcon:M?e.jsx(dt,{}):e.jsx(pt,{}),sx:{textTransform:"none",fontWeight:500},children:"Advanced Settings"}),e.jsx(ut,{in:M,children:e.jsxs(Y,{sx:{mt:2,p:2,bgcolor:"action.hover"},children:[e.jsx(p,{variant:"subtitle2",fontWeight:600,sx:{mb:2},children:"Key Fields"}),e.jsx(p,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Select fields that will be used as filter keys when generating reports."}),e.jsx(W,{direction:"row",spacing:1,flexWrap:"wrap",gap:1,children:B.map(([l])=>e.jsx($,{label:l,size:"small",variant:u.includes(l)?"filled":"outlined",sx:u.includes(l)?{bgcolor:x=>x.palette.mode==="dark"?L(x.palette.text.primary,.1):i[200],color:"text.secondary"}:{},onClick:()=>{u.includes(l)?R(x=>x.filter(A=>A!==l)):R(x=>[...x,l])},disabled:y},l))})]})})]}),!y&&e.jsx(w,{sx:{mt:4,textAlign:"center"},children:e.jsx(z,{variant:"contained",size:"large",onClick:b,disabled:D,startIcon:e.jsx(mt,{}),children:D?"Approving...":"Approve Mapping"})})]})]})}const ge="neurareport_wizard_state",Qt=t=>{try{sessionStorage.setItem(ge,JSON.stringify(t))}catch{}},Zt=()=>{try{const t=sessionStorage.getItem(ge);return t?JSON.parse(t):null}catch{return null}},Te=()=>{try{sessionStorage.removeItem(ge)}catch{}},Ae=[{key:"connection",label:"Connect Data Source",description:"Select or create a data source for reports"},{key:"template",label:"Upload Report Design",description:"Upload a PDF or Excel design"},{key:"mapping",label:"Map Fields",description:"Match design fields to data columns (no SQL required)"}],Xt={connection:0,template:1,mapping:2},es=["connection","template","mapping"];function ts(){const t=Ne(),[n,f]=ht(),c=a.useCallback((m,T,s={})=>t(m,{label:T,intent:{from:"setup-wizard",...s}}),[t]),r=ce(),[P,I]=a.useState(!1),F=n.get("step")||"connection",[j,_]=a.useState(()=>Xt[F]??0),[g,C]=a.useState(()=>Zt()||{connectionId:null,templateId:null,templateKind:"pdf",mapping:null,keys:[]}),E=O(m=>m.activeConnection),u=O(m=>m.templateId);a.useEffect(()=>{Qt(g)},[g]),a.useEffect(()=>{f(m=>{const T=new URLSearchParams(m);return T.set("step",es[j]),T},{replace:!0})},[j,f]);const R=a.useCallback(m=>{C(T=>({...T,...m}))},[]),M=a.useCallback(()=>{j<Ae.length-1&&_(m=>m+1)},[j]),N=a.useCallback(()=>{j>0&&_(m=>m-1)},[j]),D=a.useCallback(()=>{Te(),r.show("Report design ready. You can run it from Reports.","success"),c("/reports","Open reports")},[c,r]),k=a.useCallback(()=>{Te(),c("/","Exit wizard")},[c]),y=()=>{switch(j){case 0:return e.jsx(Vt,{wizardState:g,updateWizardState:R,onComplete:M,setLoading:I});case 1:return e.jsx(Jt,{wizardState:g,updateWizardState:R,onComplete:M,setLoading:I});case 2:return e.jsx(qt,{wizardState:g,updateWizardState:R,onComplete:D,setLoading:I});default:return null}},U=()=>{switch(j){case 0:return!g.connectionId&&!E?.id;case 1:return!g.templateId&&!u;case 2:return!1;default:return!1}};return e.jsx(Ht,{title:"Set Up Report Design",subtitle:"Connect your data source and prepare a report design for runs",steps:Ae,currentStep:j,onNext:M,onPrev:N,onComplete:D,onCancel:k,nextDisabled:U(),loading:P,children:e.jsxs(W,{spacing:2,children:[e.jsx(At,{dense:!0,showChips:!1}),y()]})})}function ys(){return de(),e.jsx(ts,{})}export{ys as default};
