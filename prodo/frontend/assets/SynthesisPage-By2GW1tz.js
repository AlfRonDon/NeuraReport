import{c as $e,j as e,a as y,bC as Pe,r as d,d as ke,u as ge,B as c,T as l,as as O,s as h,A as re,P as oe,aM as f,aR as Be,aV as Oe,_ as We,$ as Ue,bS as Ge,o as W,a1 as ie,D as Ye,v as ae,n as Ve,an as le,ai as ce,aj as de,a3 as m,N as R,b0 as ue,F as He,k as Xe,p as Ze,Q as qe,ak as U,al as G,am as Y,ao as V,R as C,I}from"./index-B8Eu23bA.js";import{C as he}from"./ConfirmModal-Bm9QL03g.js";import{A as Je}from"./AiUsageNotice-DRuwRFKl.js";import{D as xe}from"./DisabledTooltip-BX9dkO9B.js";import{G as p}from"./Grid-5L9Rvqba.js";import{C as Ke,a as Qe}from"./CardContent-xJVpuEbT.js";import{C as es}from"./CardActions-CJzuqktr.js";import{P as ss}from"./Preview-iX_0Zgyl.js";import{A as ns,a as ts,b as rs}from"./AccordionSummary-CvHbDzcW.js";import{U as os}from"./Upload-BxhlLt54.js";import"./CheckCircleOutline-BKKyaL-x.js";import"./WarningAmber-DtVJgAFk.js";const T=$e(e.jsx("path",{d:"M6.41 21 5 19.59l4.83-4.83c.75-.75 1.17-1.77 1.17-2.83v-5.1L9.41 8.41 8 7l4-4 4 4-1.41 1.41L13 6.83v5.1c0 1.06.42 2.08 1.17 2.83L19 19.59 17.59 21 12 15.41z"}));async function is(n){return(await y.post("/synthesis/sessions",{name:n})).data}async function as(){return(await y.get("/synthesis/sessions")).data}async function ls(n){return(await y.get(`/synthesis/sessions/${n}`)).data}async function cs(n){return(await y.delete(`/synthesis/sessions/${n}`)).data}async function ds(n,{name:r,content:o,docType:t="text",metadata:i}){return(await y.post(`/synthesis/sessions/${n}/documents`,{name:r,content:o,doc_type:t,metadata:i})).data}async function us(n,r){return(await y.delete(`/synthesis/sessions/${n}/documents/${r}`)).data}async function hs(n){return(await y.get(`/synthesis/sessions/${n}/inconsistencies`)).data}async function xs(n,{focusTopics:r,outputFormat:o="structured",includeSources:t=!0,maxLength:i=5e3}){return(await y.post(`/synthesis/sessions/${n}/synthesize`,{focus_topics:r,output_format:o,include_sources:t,max_length:i})).data}const ms=Pe((n,r)=>({sessions:[],currentSession:null,inconsistencies:[],synthesisResult:null,loading:!1,error:null,setLoading:o=>n({loading:o}),setError:o=>n({error:o}),fetchSessions:async()=>{n({loading:!0,error:null});try{const o=await as();n({sessions:o.sessions||[],loading:!1})}catch(o){n({error:o.message,loading:!1})}},createSession:async o=>{n({loading:!0,error:null});try{const i=(await is(o)).session;return n(j=>({sessions:[...j.sessions,i].slice(0,100),currentSession:i,loading:!1})),i}catch(t){return n({error:t.message,loading:!1}),null}},getSession:async o=>{n({loading:!0,error:null});try{const t=await ls(o);return n({currentSession:t.session,loading:!1}),t.session}catch(t){return n({error:t.message,loading:!1}),null}},deleteSession:async o=>{n({loading:!0,error:null});try{return await cs(o),n(t=>({sessions:t.sessions.filter(i=>i.id!==o),currentSession:t.currentSession?.id===o?null:t.currentSession,loading:!1})),!0}catch(t){return n({error:t.message,loading:!1}),!1}},addDocument:async(o,t)=>{n({loading:!0,error:null});try{const i=await ds(o,t);return await r().getSession(o),n({loading:!1}),i.document}catch(i){return n({error:i.message,loading:!1}),null}},removeDocument:async(o,t)=>{n({loading:!0,error:null});try{return await us(o,t),await r().getSession(o),n({loading:!1}),!0}catch(i){return n({error:i.message,loading:!1}),!1}},findInconsistencies:async o=>{n({loading:!0,error:null});try{const t=await hs(o);return n({inconsistencies:t.inconsistencies||[],loading:!1}),t.inconsistencies}catch(t){return n({error:t.message,loading:!1}),[]}},synthesize:async(o,t={})=>{n({loading:!0,error:null,synthesisResult:null});try{const i=await xs(o,t);return n({synthesisResult:i.result,loading:!1}),i.result}catch(i){return n({error:i.message,loading:!1}),null}},reset:()=>n({currentSession:null,inconsistencies:[],synthesisResult:null,error:null})})),H=5*1024*1024,me=10,g=200,pe=10;function ps(){const{sessions:n,currentSession:r,inconsistencies:o,synthesisResult:t,loading:i,error:j,fetchSessions:X,createSession:ye,getSession:fe,deleteSession:je,addDocument:ve,removeDocument:be,findInconsistencies:Se,synthesize:we,reset:z}=ms(),[Ce,D]=d.useState(!1),[Ie,A]=d.useState(!1),[v,Z]=d.useState(""),[b,F]=d.useState(""),[S,_]=d.useState(""),[q,M]=d.useState("text"),[J,De]=d.useState("structured"),[$,Ae]=d.useState(""),[E,K]=d.useState(null),[Ee,Q]=d.useState(!1),[N,P]=d.useState({open:!1,sessionId:null,sessionName:""}),[L,k]=d.useState({open:!1,docId:null,docName:""}),u=ke(),ee=r?.documents?.length||0,{execute:w}=ge(),[Ne,se]=d.useState(!0);d.useEffect(()=>((async()=>(se(!0),await X(),se(!1)))(),()=>z()),[X,z]);const Le=()=>{if(v){if(v.length>g){u.show(`Session name must be ${g} characters or less`,"error");return}w({type:I.CREATE,label:`Create session "${v}"`,reversibility:C.FULLY_REVERSIBLE,successMessage:"Session created successfully",action:async()=>{await ye(v),D(!1),Z("")}})}},Re=()=>{if(!(!r||!b||!S)){if(b.length>g){u.show(`Document name must be ${g} characters or less`,"error");return}if(S.trim().length<me){u.show(`Document content must be at least ${me} characters`,"error");return}if(S.length>H){u.show("Document content exceeds 5MB limit","error");return}w({type:I.UPLOAD,label:`Add document "${b}"`,reversibility:C.FULLY_REVERSIBLE,successMessage:"Document added successfully",action:async()=>{await ve(r.id,{name:b,content:S,docType:q}),A(!1),F(""),_("")}})}},Te=s=>{const a=s.target.files[0];if(!a)return;if(a.name.length>g){u.show(`File name must be ${g} characters or less`,"error"),s.target.value="";return}const x=a.name.split(".").pop().toLowerCase();if(["pdf","xlsx","xls","doc","docx"].includes(x)){u.show(`${x.toUpperCase()} files must be converted to text format first. Please paste the content directly.`,"warning"),s.target.value="";return}if(a.size>H){u.show("File size exceeds 5MB limit","error"),s.target.value="";return}const B=new FileReader;B.onload=Me=>{const te=Me.target.result;if(te.includes("\0")){u.show("File appears to be binary. Please upload a text file or paste content directly.","error"),s.target.value="";return}F(a.name),_(te),["json"].includes(x)?M("json"):M("text")},B.onerror=()=>{u.show("Failed to read file","error"),s.target.value=""},B.readAsText(a)},ze=()=>{if(!r)return;const s=$?$.split(",").map(a=>a.trim()).filter(Boolean):void 0;if(s&&s.length>pe){u.show(`Focus topics must be ${pe} items or less`,"error");return}w({type:I.GENERATE,label:"Synthesize documents",reversibility:C.SYSTEM_MANAGED,blocksNavigation:!0,successMessage:"Synthesis complete",errorMessage:"Synthesis failed",action:async()=>{if(!await we(r.id,{focusTopics:s,outputFormat:J}))throw new Error("Synthesis failed")}})},Fe=()=>{r&&w({type:I.ANALYZE,label:"Find inconsistencies",reversibility:C.SYSTEM_MANAGED,blocksNavigation:!0,action:async()=>{const s=await Se(r.id);if(s===null)throw new Error("Analysis failed");s.length>0?u.show(`Found ${s.length} inconsistencies`,"warning"):u.show("No inconsistencies found","success")}})},_e=s=>{K(s),Q(!0)},ne=()=>{Q(!1),K(null)};return Ne?e.jsxs(c,{sx:{p:3,maxWidth:1400,mx:"auto"},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(T,{}),e.jsx(l,{variant:"h4",children:"Multi-Document Synthesis"})]}),e.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:300},children:e.jsx(O,{})})]}):e.jsxs(c,{sx:{p:3,maxWidth:1400,mx:"auto"},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(c,{children:[e.jsxs(l,{variant:"h4",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(T,{})," Multi-Document Synthesis"]}),e.jsx(l,{variant:"body1",color:"text.secondary",children:"Combine information from multiple documents with AI-powered analysis"})]}),e.jsx(h,{variant:"contained",startIcon:e.jsx(re,{}),onClick:()=>D(!0),children:"New Session"})]}),j&&e.jsx(oe,{severity:"error",sx:{mb:2},onClose:()=>z(),children:j}),r&&e.jsx(Je,{title:"AI synthesis",description:"Outputs are generated from the documents in this session. Review before sharing.",chips:[{label:`Source: ${ee} document${ee===1?"":"s"}`,color:"info",variant:"outlined"},{label:"Confidence: Review required",color:"warning",variant:"outlined"},{label:"Reversible: No source changes",color:"success",variant:"outlined"}],dense:!0,sx:{mb:2}}),e.jsxs(p,{container:!0,spacing:3,children:[e.jsx(p,{size:{xs:12,md:3},children:e.jsxs(f,{sx:{p:2},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Sessions"}),n.length===0?e.jsx(l,{color:"text.secondary",sx:{py:2,textAlign:"center"},children:"No sessions yet"}):e.jsx(Be,{dense:!0,children:n.map(s=>e.jsxs(Oe,{button:!0,selected:r?.id===s.id,onClick:()=>fe(s.id),children:[e.jsx(We,{children:e.jsx(T,{})}),e.jsx(Ue,{primary:s.name,secondary:`${s.documents?.length||0} docs`}),e.jsx(Ge,{children:e.jsx(W,{size:"small",onClick:a=>{a.stopPropagation(),P({open:!0,sessionId:s.id,sessionName:s.name})},children:e.jsx(ie,{fontSize:"small"})})})]},s.id))})]})}),e.jsx(p,{size:{xs:12,md:9},children:r?e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(f,{sx:{p:3},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(l,{variant:"h6",children:["Documents (",r.documents?.length||0,")"]}),e.jsx(h,{variant:"outlined",startIcon:e.jsx(re,{}),onClick:()=>A(!0),children:"Add Document"})]}),r.documents?.length===0?e.jsx(l,{color:"text.secondary",sx:{textAlign:"center",py:3},children:"Add documents to begin synthesis"}):e.jsx(p,{container:!0,spacing:2,children:r.documents?.map(s=>e.jsx(p,{size:{xs:12,sm:6,md:4},children:e.jsxs(Ke,{variant:"outlined",children:[e.jsxs(Qe,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(Ye,{sx:{color:"text.secondary"}}),e.jsx(l,{variant:"subtitle2",noWrap:!0,children:s.name})]}),e.jsx(ae,{size:"small",label:s.doc_type})]}),e.jsxs(es,{children:[e.jsx(Ve,{title:"Preview",children:e.jsx(W,{size:"small",onClick:()=>_e(s),children:e.jsx(ss,{fontSize:"small"})})}),e.jsx(W,{size:"small",onClick:()=>k({open:!0,docId:s.id,docName:s.name}),children:e.jsx(ie,{fontSize:"small"})})]})]})},s.id))})]}),r.documents?.length>=2&&e.jsxs(f,{sx:{p:3},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Analysis"}),e.jsxs(p,{container:!0,spacing:2,sx:{mb:2},children:[e.jsx(p,{size:{xs:12,sm:6},children:e.jsxs(le,{fullWidth:!0,size:"small",children:[e.jsx(ce,{children:"Output Format"}),e.jsxs(de,{value:J,label:"Output Format",onChange:s=>De(s.target.value),children:[e.jsx(m,{value:"structured",children:"Structured"}),e.jsx(m,{value:"narrative",children:"Narrative"}),e.jsx(m,{value:"comparison",children:"Comparison"})]})]})}),e.jsx(p,{size:{xs:12,sm:6},children:e.jsx(R,{fullWidth:!0,size:"small",label:"Focus Topics (comma-separated)",value:$,onChange:s=>Ae(s.target.value),placeholder:"revenue, growth, risks"})})]}),e.jsxs(c,{sx:{display:"flex",gap:2},children:[e.jsx(xe,{disabled:i||!r?.documents?.length,reason:i?"Please wait for the current operation to complete":r?.documents?.length?void 0:"Add at least one document first",children:e.jsx(h,{variant:"outlined",startIcon:i?e.jsx(O,{size:20}):e.jsx(ue,{}),onClick:Fe,disabled:i||!r?.documents?.length,children:"Find Inconsistencies"})}),e.jsx(xe,{disabled:i||!r?.documents?.length,reason:i?"Please wait for the current operation to complete":r?.documents?.length?void 0:"Add at least two documents to synthesize",children:e.jsx(h,{variant:"contained",startIcon:i?e.jsx(O,{size:20}):e.jsx(He,{}),onClick:ze,disabled:i||!r?.documents?.length,children:"Synthesize"})})]})]}),o.length>0&&e.jsxs(f,{sx:{p:3},children:[e.jsxs(l,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ue,{sx:{color:"text.secondary"}})," Inconsistencies Found (",o.length,")"]}),o.map((s,a)=>e.jsxs(ns,{variant:"outlined",children:[e.jsx(ts,{expandIcon:e.jsx(qe,{}),children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ae,{size:"small",label:s.severity,sx:{bgcolor:x=>x.palette.mode==="dark"?Ze(x.palette.text.primary,.1):Xe[400],color:"text.secondary"}}),e.jsx(l,{children:s.field_or_topic})]})}),e.jsxs(rs,{children:[e.jsx(l,{variant:"body2",sx:{mb:1},children:s.description}),s.suggested_resolution&&e.jsxs(oe,{severity:"info",sx:{mt:1},children:[e.jsx("strong",{children:"Suggestion:"})," ",s.suggested_resolution]})]})]},a))]}),t&&e.jsxs(f,{sx:{p:3},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Synthesis Result"}),e.jsxs(c,{sx:{bgcolor:"grey.50",p:2,borderRadius:1},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:t.synthesis?.title}),e.jsx(l,{variant:"body1",sx:{mb:2},children:t.synthesis?.executive_summary}),t.synthesis?.key_insights&&e.jsxs(c,{sx:{mb:2},children:[e.jsx(l,{variant:"subtitle2",gutterBottom:!0,children:"Key Insights"}),e.jsx("ul",{style:{margin:0,paddingLeft:20},children:t.synthesis.key_insights.map((s,a)=>e.jsx("li",{children:e.jsx(l,{variant:"body2",children:s})},a))})]}),t.synthesis?.sections&&e.jsx(c,{children:t.synthesis.sections.map((s,a)=>e.jsxs(c,{sx:{mb:2},children:[e.jsx(l,{variant:"subtitle1",children:s.heading}),e.jsx(l,{variant:"body2",children:s.content})]},a))})]})]})]}):e.jsxs(f,{sx:{p:4,textAlign:"center"},children:[e.jsx(T,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(l,{color:"text.secondary",children:"Select a session or create a new one to begin"})]})})]}),e.jsxs(U,{open:Ce,onClose:()=>D(!1),children:[e.jsx(G,{children:"Create Synthesis Session"}),e.jsx(Y,{children:e.jsx(R,{fullWidth:!0,label:"Session Name",value:v,onChange:s=>Z(s.target.value),sx:{mt:2},inputProps:{maxLength:g}})}),e.jsxs(V,{children:[e.jsx(h,{onClick:()=>D(!1),children:"Cancel"}),e.jsx(h,{variant:"contained",onClick:Le,disabled:!v,children:"Create"})]})]}),e.jsxs(U,{open:Ie,onClose:()=>A(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(G,{children:"Add Document"}),e.jsxs(Y,{children:[e.jsxs(c,{sx:{display:"flex",gap:2,mb:2,mt:2},children:[e.jsx(R,{fullWidth:!0,label:"Document Name",value:b,onChange:s=>F(s.target.value),inputProps:{maxLength:g}}),e.jsxs(le,{sx:{minWidth:150},children:[e.jsx(ce,{children:"Type"}),e.jsxs(de,{value:q,label:"Type",onChange:s=>M(s.target.value),children:[e.jsx(m,{value:"text",children:"Text"}),e.jsx(m,{value:"pdf",children:"PDF"}),e.jsx(m,{value:"excel",children:"Excel"}),e.jsx(m,{value:"word",children:"Word"}),e.jsx(m,{value:"json",children:"JSON"})]})]})]}),e.jsxs(h,{variant:"outlined",component:"label",startIcon:e.jsx(os,{}),sx:{mb:2},children:["Upload File",e.jsx("input",{type:"file",hidden:!0,onChange:Te})]}),e.jsx(R,{fullWidth:!0,multiline:!0,rows:10,label:"Document Content",value:S,onChange:s=>_(s.target.value),placeholder:"Paste document content or upload a file...",inputProps:{maxLength:H}})]}),e.jsxs(V,{children:[e.jsx(h,{onClick:()=>A(!1),children:"Cancel"}),e.jsx(h,{variant:"contained",onClick:Re,disabled:!b||!S,children:"Add"})]})]}),e.jsxs(U,{open:Ee,onClose:ne,maxWidth:"md",fullWidth:!0,children:[e.jsx(G,{children:"Document Preview"}),e.jsxs(Y,{dividers:!0,children:[e.jsx(l,{variant:"subtitle2",sx:{mb:1},children:E?.name||"Document"}),e.jsx(l,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:2},children:E?.doc_type||E?.docType||"text"}),e.jsx(f,{sx:{p:2,bgcolor:"grey.50",maxHeight:420,overflow:"auto"},children:e.jsx(l,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:E?.content||"No content available."})})]}),e.jsx(V,{children:e.jsx(h,{onClick:ne,children:"Close"})})]}),e.jsx(he,{open:N.open,onClose:()=>P({open:!1,sessionId:null,sessionName:""}),onConfirm:()=>{const s=N.sessionId,a=N.sessionName;P({open:!1,sessionId:null,sessionName:""}),w({type:I.DELETE,label:`Delete session "${a}"`,reversibility:C.IRREVERSIBLE,successMessage:`Session "${a}" deleted`,errorMessage:"Failed to delete session",action:async()=>{if(!await je(s))throw new Error("Delete failed")}})},title:"Delete Session",message:`Are you sure you want to delete "${N.sessionName}"? All documents and analysis data will be permanently removed.`,confirmLabel:"Delete",severity:"error"}),e.jsx(he,{open:L.open,onClose:()=>k({open:!1,docId:null,docName:""}),onConfirm:()=>{const s=L.docId,a=L.docName;k({open:!1,docId:null,docName:""}),w({type:I.DELETE,label:`Remove document "${a}"`,reversibility:C.PARTIALLY_REVERSIBLE,successMessage:`Document "${a}" removed`,errorMessage:"Failed to remove document",action:async()=>{if(!await be(r?.id,s))throw new Error("Remove failed")}})},title:"Remove Document",message:`Are you sure you want to remove "${L.docName}" from this session?`,confirmLabel:"Remove",severity:"warning"})]})}function Ns(){return ge(),e.jsx(ps,{})}export{Ns as default};
