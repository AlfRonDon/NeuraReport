{"version":3,"file":"AgentsPage-Dq4qJnNy.js","sources":["../../node_modules/@mui/icons-material/esm/Analytics.js","../../node_modules/@mui/icons-material/esm/Transform.js","../../src/api/agents.js","../../src/api/agentsV2.js","../../src/stores/agentStore.js","../../src/features/agents/containers/AgentsPageContainer.jsx","../../src/pages/agents/AgentsPage.jsx"],"sourcesContent":["\"use client\";\n\nimport createSvgIcon from \"./utils/createSvgIcon.js\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon(/*#__PURE__*/_jsx(\"path\", {\n  d: \"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2M9 17H7v-5h2zm4 0h-2v-3h2zm0-5h-2v-2h2zm4 5h-2V7h2z\"\n}), 'Analytics');","\"use client\";\n\nimport createSvgIcon from \"./utils/createSvgIcon.js\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon(/*#__PURE__*/_jsx(\"path\", {\n  d: \"M22 18v-2H8V4h2L7 1 4 4h2v2H2v2h4v8c0 1.1.9 2 2 2h8v2h-2l3 3 3-3h-2v-2zM10 8h6v6h2V8c0-1.1-.9-2-2-2h-6z\"\n}), 'Transform');","/**\n * Agents API Client\n * Handles AI agent operations (research, data analysis, email drafts, content, proofreading).\n */\nimport { api } from './client';\n\nfunction asArray(payload, keys = []) {\n  if (Array.isArray(payload)) return payload;\n  if (!payload || typeof payload !== 'object') return [];\n  for (const key of keys) {\n    if (Array.isArray(payload[key])) return payload[key];\n  }\n  return [];\n}\n\n// ============================================\n// Research Agent\n// ============================================\n\nexport async function runResearchAgent(topic, options = {}) {\n  const response = await api.post('/agents/research', {\n    topic,\n    depth: options.depth || 'comprehensive',\n    focus_areas: options.focusAreas || null,\n    max_sections: options.maxSections || 5,\n  });\n  return response.data;\n}\n\n// ============================================\n// Data Analyst Agent\n// ============================================\n\nexport async function runDataAnalystAgent(question, data, options = {}) {\n  const response = await api.post('/agents/data-analysis', {\n    question,\n    data,\n    data_description: options.dataDescription || null,\n    generate_charts: options.generateCharts !== false,\n  });\n  return response.data;\n}\n\n// ============================================\n// Email Draft Agent\n// ============================================\n\nexport async function runEmailDraftAgent(context, purpose, options = {}) {\n  const response = await api.post('/agents/email-draft', {\n    context,\n    purpose,\n    tone: options.tone || 'professional',\n    recipient_info: options.recipientInfo || null,\n    previous_emails: options.previousEmails || null,\n  });\n  return response.data;\n}\n\n// ============================================\n// Content Repurposing Agent\n// ============================================\n\nexport async function runContentRepurposeAgent(content, sourceFormat, targetFormats, options = {}) {\n  const response = await api.post('/agents/content-repurpose', {\n    content,\n    source_format: sourceFormat,\n    target_formats: targetFormats,\n    preserve_key_points: options.preserveKeyPoints !== false,\n    adapt_length: options.adaptLength !== false,\n  });\n  return response.data;\n}\n\n// ============================================\n// Proofreading Agent\n// ============================================\n\nexport async function runProofreadingAgent(text, options = {}) {\n  const response = await api.post('/agents/proofread', {\n    text,\n    style_guide: options.styleGuide || null,\n    focus_areas: options.focusAreas || null,\n    preserve_voice: options.preserveVoice !== false,\n  });\n  return response.data;\n}\n\n// ============================================\n// Task Management\n// ============================================\n\nexport async function getTask(taskId) {\n  const response = await api.get(`/agents/tasks/${taskId}`);\n  const payload = response.data;\n  if (payload && typeof payload === 'object' && payload.task) {\n    return payload.task;\n  }\n  return payload;\n}\n\nexport async function listTasks(agentType = null) {\n  const params = agentType ? { agent_type: agentType } : {};\n  const response = await api.get('/agents/tasks', { params });\n  return asArray(response.data, ['tasks', 'items', 'results']);\n}\n\n// ============================================\n// Utility\n// ============================================\n\nexport async function listAgentTypes() {\n  const response = await api.get('/agents/types');\n  const payload = response.data;\n  if (Array.isArray(payload)) {\n    return { types: payload };\n  }\n  if (payload && typeof payload === 'object') {\n    return { ...payload, types: asArray(payload, ['types', 'items', 'results']) };\n  }\n  return { types: [] };\n}\n\nexport async function listRepurposeFormats() {\n  const response = await api.get('/agents/formats/repurpose');\n  const payload = response.data;\n  if (Array.isArray(payload)) {\n    return { formats: payload };\n  }\n  if (payload && typeof payload === 'object') {\n    return { ...payload, formats: asArray(payload, ['formats', 'items', 'results']) };\n  }\n  return { formats: [] };\n}\n","/**\n * Agents API Client v2\n * Production-grade client for AI agent operations with:\n * - Persistent task storage\n * - Idempotency support\n * - Progress tracking\n * - Task management (cancel, retry)\n *\n * Usage:\n *   import { runResearchAgent, pollTaskUntilComplete, cancelTask } from './agentsV2';\n *\n *   // Async execution with polling\n *   const task = await runResearchAgent('AI trends', { sync: false });\n *   const result = await pollTaskUntilComplete(task.task_id, {\n *     onProgress: (task) => console.log(`${task.progress.percent}%`)\n *   });\n *\n *   // Sync execution (waits for completion)\n *   const result = await runResearchAgent('AI trends', { sync: true });\n */\nimport { api, toApiUrl } from './client';\n\nconst BASE_PATH = '/agents/v2';\n\nconst asArray = (payload, keys = []) => {\n  if (Array.isArray(payload)) return payload;\n  if (!payload || typeof payload !== 'object') return [];\n  for (const key of keys) {\n    if (Array.isArray(payload[key])) return payload[key];\n  }\n  return [];\n};\n\n// ============================================\n// Error Types\n// ============================================\n\nexport class AgentError extends Error {\n  constructor(code, message, retryable = false, details = {}) {\n    super(message);\n    this.name = 'AgentError';\n    this.code = code;\n    this.retryable = retryable;\n    this.details = details;\n  }\n}\n\nexport class ValidationError extends AgentError {\n  constructor(message, field = null) {\n    super('VALIDATION_ERROR', message, false, { field });\n    this.name = 'ValidationError';\n  }\n}\n\nexport class TaskNotFoundError extends AgentError {\n  constructor(taskId) {\n    super('TASK_NOT_FOUND', `Task ${taskId} not found`, false, { taskId });\n    this.name = 'TaskNotFoundError';\n  }\n}\n\nexport class TaskConflictError extends AgentError {\n  constructor(message) {\n    super('TASK_CONFLICT', message, false);\n    this.name = 'TaskConflictError';\n  }\n}\n\n// ============================================\n// Response Helpers\n// ============================================\n\nfunction handleApiError(error) {\n  if (error.response) {\n    const { status, data } = error.response;\n    const detail = data?.detail || {};\n\n    if (status === 400) {\n      throw new ValidationError(detail.message || 'Invalid request', detail.field);\n    }\n    if (status === 404) {\n      throw new TaskNotFoundError(detail.taskId || 'unknown');\n    }\n    if (status === 409) {\n      throw new TaskConflictError(detail.message || 'Task conflict');\n    }\n    if (status === 429) {\n      throw new AgentError(\n        'RATE_LIMITED',\n        detail.message || 'Rate limit exceeded',\n        true,\n        { retryAfter: detail.retry_after || 60 }\n      );\n    }\n\n    throw new AgentError(\n      detail.code || 'API_ERROR',\n      detail.message || error.message,\n      detail.retryable ?? true\n    );\n  }\n\n  throw new AgentError('NETWORK_ERROR', error.message, true);\n}\n\n// ============================================\n// Research Agent\n// ============================================\n\n/**\n * Run the research agent to compile a comprehensive report on a topic.\n *\n * @param {string} topic - Topic to research (at least 2 words)\n * @param {Object} options - Configuration options\n * @param {string} options.depth - Research depth: 'quick', 'moderate', 'comprehensive' (default)\n * @param {string[]} options.focusAreas - Specific areas to focus on (max 10)\n * @param {number} options.maxSections - Maximum sections in report (1-20, default 5)\n * @param {string} options.idempotencyKey - Unique key for deduplication\n * @param {number} options.priority - Task priority (0-10, default 0)\n * @param {string} options.webhookUrl - URL to notify on completion\n * @param {boolean} options.sync - Wait for completion (default true)\n * @returns {Promise<Object>} Task response with status, progress, and result\n */\nexport async function runResearchAgent(topic, options = {}) {\n  try {\n    const response = await api.post(`${BASE_PATH}/research`, {\n      topic,\n      depth: options.depth || 'comprehensive',\n      focus_areas: options.focusAreas || null,\n      max_sections: options.maxSections || 5,\n      idempotency_key: options.idempotencyKey || null,\n      priority: options.priority || 0,\n      webhook_url: options.webhookUrl || null,\n      sync: options.sync !== false, // Default to true\n    });\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n  }\n}\n\n// ============================================\n// Data Analyst Agent\n// ============================================\n\n/**\n * Run the data analyst agent to analyse tabular data.\n *\n * @param {string} question - Question to answer about the data\n * @param {Object[]} data - Tabular data as array of objects\n * @param {Object} options - Configuration options\n * @param {string} options.dataDescription - Optional description of the dataset\n * @param {boolean} options.generateCharts - Whether to suggest charts (default true)\n * @param {string} options.idempotencyKey - Unique key for deduplication\n * @param {number} options.priority - Task priority (0-10)\n * @param {string} options.webhookUrl - Webhook URL for completion\n * @param {boolean} options.sync - Wait for completion (default true)\n * @returns {Promise<Object>} Task response\n */\nexport async function runDataAnalystAgent(question, data, options = {}) {\n  try {\n    const response = await api.post(`${BASE_PATH}/data-analyst`, {\n      question,\n      data,\n      data_description: options.dataDescription || null,\n      generate_charts: options.generateCharts !== false,\n      idempotency_key: options.idempotencyKey || null,\n      priority: options.priority || 0,\n      webhook_url: options.webhookUrl || null,\n      sync: options.sync !== false,\n    });\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n  }\n}\n\n// ============================================\n// Email Draft Agent\n// ============================================\n\n/**\n * Run the email draft agent to compose an email.\n *\n * @param {string} context - Background context for the email\n * @param {string} purpose - Purpose of the email\n * @param {Object} options - Configuration options\n * @param {string} options.tone - Tone: professional, friendly, formal, casual, empathetic, assertive\n * @param {string} options.recipientInfo - Information about the recipient\n * @param {string[]} options.previousEmails - Previous emails in thread\n * @param {boolean} options.includeSubject - Include subject line (default true)\n * @param {string} options.idempotencyKey - Unique key for deduplication\n * @param {number} options.priority - Task priority (0-10)\n * @param {string} options.webhookUrl - Webhook URL for completion\n * @param {boolean} options.sync - Wait for completion (default true)\n * @returns {Promise<Object>} Task response\n */\nexport async function runEmailDraftAgent(context, purpose, options = {}) {\n  try {\n    const response = await api.post(`${BASE_PATH}/email-draft`, {\n      context,\n      purpose,\n      tone: options.tone || 'professional',\n      recipient_info: options.recipientInfo || null,\n      previous_emails: options.previousEmails || null,\n      include_subject: options.includeSubject !== false,\n      idempotency_key: options.idempotencyKey || null,\n      priority: options.priority || 0,\n      webhook_url: options.webhookUrl || null,\n      sync: options.sync !== false,\n    });\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n  }\n}\n\n// ============================================\n// Content Repurposing Agent\n// ============================================\n\n/**\n * Run the content repurposing agent to transform content into multiple formats.\n *\n * @param {string} content - Source content to repurpose\n * @param {string} sourceFormat - Format of the source (article, report, etc.)\n * @param {string[]} targetFormats - Target formats (tweet_thread, linkedin_post, etc.)\n * @param {Object} options - Configuration options\n * @param {boolean} options.preserveKeyPoints - Preserve key points (default true)\n * @param {boolean} options.adaptLength - Adapt length for format (default true)\n * @param {string} options.idempotencyKey - Unique key for deduplication\n * @param {number} options.priority - Task priority (0-10)\n * @param {string} options.webhookUrl - Webhook URL for completion\n * @param {boolean} options.sync - Wait for completion (default true)\n * @returns {Promise<Object>} Task response\n */\nexport async function runContentRepurposeAgent(content, sourceFormat, targetFormats, options = {}) {\n  try {\n    const response = await api.post(`${BASE_PATH}/content-repurpose`, {\n      content,\n      source_format: sourceFormat,\n      target_formats: targetFormats,\n      preserve_key_points: options.preserveKeyPoints !== false,\n      adapt_length: options.adaptLength !== false,\n      idempotency_key: options.idempotencyKey || null,\n      priority: options.priority || 0,\n      webhook_url: options.webhookUrl || null,\n      sync: options.sync !== false,\n    });\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n  }\n}\n\n// ============================================\n// Proofreading Agent\n// ============================================\n\n/**\n * Run the proofreading agent for grammar, style, and clarity checking.\n *\n * @param {string} text - Text to proofread\n * @param {Object} options - Configuration options\n * @param {string} options.styleGuide - Style guide: ap, chicago, apa, mla\n * @param {string[]} options.focusAreas - Focus areas (grammar, spelling, clarity, etc.)\n * @param {boolean} options.preserveVoice - Preserve author's voice (default true)\n * @param {string} options.idempotencyKey - Unique key for deduplication\n * @param {number} options.priority - Task priority (0-10)\n * @param {string} options.webhookUrl - Webhook URL for completion\n * @param {boolean} options.sync - Wait for completion (default true)\n * @returns {Promise<Object>} Task response\n */\nexport async function runProofreadingAgent(text, options = {}) {\n  try {\n    const response = await api.post(`${BASE_PATH}/proofreading`, {\n      text,\n      style_guide: options.styleGuide || null,\n      focus_areas: options.focusAreas || null,\n      preserve_voice: options.preserveVoice !== false,\n      idempotency_key: options.idempotencyKey || null,\n      priority: options.priority || 0,\n      webhook_url: options.webhookUrl || null,\n      sync: options.sync !== false,\n    });\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n  }\n}\n\n// ============================================\n// Report Analyst Agent\n// ============================================\n\n/**\n * Run the report analyst agent to analyze, summarize, compare, or ask questions about reports.\n *\n * @param {string} runId - Report run ID to analyze\n * @param {Object} options - Configuration options\n * @param {string} options.analysisType - Analysis type: 'summarize', 'insights', 'compare', 'qa'\n * @param {string} options.question - Question text (required for 'qa' type)\n * @param {string} options.compareRunId - Second run ID (required for 'compare' type)\n * @param {string[]} options.focusAreas - Optional areas to focus on\n * @param {string} options.idempotencyKey - Unique key for deduplication\n * @param {number} options.priority - Task priority (0-10)\n * @param {string} options.webhookUrl - Webhook URL for completion\n * @param {boolean} options.sync - Wait for completion (default true)\n * @returns {Promise<Object>} Task response\n */\nexport async function runReportAnalystAgent(runId, options = {}) {\n  try {\n    const response = await api.post(`${BASE_PATH}/report-analyst`, {\n      run_id: runId,\n      analysis_type: options.analysisType || 'summarize',\n      question: options.question || null,\n      compare_run_id: options.compareRunId || null,\n      focus_areas: options.focusAreas || null,\n      idempotency_key: options.idempotencyKey || null,\n      priority: options.priority || 0,\n      webhook_url: options.webhookUrl || null,\n      sync: options.sync !== false,\n    });\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n  }\n}\n\n/**\n * Generate a report from an agent task result.\n *\n * @param {string} taskId - Agent task ID whose result provides context\n * @param {Object} config - Report generation config\n * @param {string} config.templateId - Template to use\n * @param {string} config.connectionId - Database connection to use\n * @param {string} config.startDate - Report start date (YYYY-MM-DD)\n * @param {string} config.endDate - Report end date (YYYY-MM-DD)\n * @param {Object} config.keyValues - Additional key-value parameters\n * @param {boolean} config.docx - Generate DOCX\n * @param {boolean} config.xlsx - Generate XLSX\n * @returns {Promise<Object>} Job info with job_id\n */\nexport async function generateReportFromTask(taskId, config = {}) {\n  try {\n    const response = await api.post(`${BASE_PATH}/tasks/${taskId}/generate-report`, {\n      template_id: config.templateId,\n      connection_id: config.connectionId,\n      start_date: config.startDate,\n      end_date: config.endDate,\n      key_values: config.keyValues || null,\n      docx: config.docx || false,\n      xlsx: config.xlsx || false,\n    });\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n  }\n}\n\n// ============================================\n// Task Management\n// ============================================\n\n/**\n * Get a task by ID.\n *\n * @param {string} taskId - Task identifier\n * @returns {Promise<Object>} Task details including status, progress, and result\n */\nexport async function getTask(taskId) {\n  try {\n    const response = await api.get(`${BASE_PATH}/tasks/${taskId}`);\n    const payload = response.data;\n    if (payload && typeof payload === 'object' && payload.task) {\n      return payload.task;\n    }\n    return payload;\n  } catch (error) {\n    handleApiError(error);\n  }\n}\n\n/**\n * List tasks with optional filtering.\n *\n * @param {Object} options - Filter options\n * @param {string} options.agentType - Filter by agent type\n * @param {string} options.status - Filter by status\n * @param {string} options.userId - Filter by user ID\n * @param {number} options.limit - Maximum results (default 50, max 100)\n * @param {number} options.offset - Number to skip (default 0)\n * @returns {Promise<Object>} List of tasks with pagination info\n */\nexport async function listTasks(options = {}) {\n  try {\n    const params = {};\n    if (options.agentType) params.agent_type = options.agentType;\n    if (options.status) params.status = options.status;\n    if (options.userId) params.user_id = options.userId;\n    if (options.limit) params.limit = options.limit;\n    if (options.offset) params.offset = options.offset;\n\n    const response = await api.get(`${BASE_PATH}/tasks`, { params });\n    const payload = response.data;\n    if (Array.isArray(payload)) {\n      return { tasks: payload, total: payload.length };\n    }\n    if (payload && typeof payload === 'object') {\n      const tasks = asArray(payload, ['tasks', 'items', 'results']);\n      return { ...payload, tasks, total: payload.total ?? payload.count ?? tasks.length };\n    }\n    return { tasks: [], total: 0 };\n  } catch (error) {\n    handleApiError(error);\n  }\n}\n\n/**\n * Cancel a pending or running task.\n *\n * @param {string} taskId - Task identifier\n * @param {string} reason - Optional cancellation reason\n * @returns {Promise<Object>} Updated task with cancelled status\n */\nexport async function cancelTask(taskId, reason = null) {\n  try {\n    const response = await api.post(`${BASE_PATH}/tasks/${taskId}/cancel`, {\n      reason,\n    });\n    const payload = response.data;\n    if (payload && typeof payload === 'object' && payload.task) {\n      return payload.task;\n    }\n    return payload;\n  } catch (error) {\n    handleApiError(error);\n  }\n}\n\n/**\n * Retry a failed task.\n *\n * @param {string} taskId - Task identifier\n * @returns {Promise<Object>} Updated task after retry\n */\nexport async function retryTask(taskId) {\n  try {\n    const response = await api.post(`${BASE_PATH}/tasks/${taskId}/retry`);\n    const payload = response.data;\n    if (payload && typeof payload === 'object' && payload.task) {\n      return payload.task;\n    }\n    return payload;\n  } catch (error) {\n    handleApiError(error);\n  }\n}\n\n/**\n * Get audit events for a task.\n *\n * @param {string} taskId - Task identifier\n * @param {number} limit - Maximum events (default 100, max 500)\n * @returns {Promise<Object[]>} List of task events\n */\nexport async function getTaskEvents(taskId, limit = 100) {\n  try {\n    const response = await api.get(`${BASE_PATH}/tasks/${taskId}/events`, {\n      params: { limit },\n    });\n    return asArray(response.data, ['events', 'items', 'results']);\n  } catch (error) {\n    handleApiError(error);\n  }\n}\n\n// ============================================\n// Polling Helper\n// ============================================\n\n/**\n * Poll a task until it reaches a terminal state.\n *\n * @param {string} taskId - Task identifier\n * @param {Object} options - Polling options\n * @param {number} options.intervalMs - Polling interval in ms (default 1000)\n * @param {number} options.timeoutMs - Maximum wait time in ms (default 300000 = 5 min)\n * @param {Function} options.onProgress - Callback for progress updates (receives task)\n * @param {AbortSignal} options.signal - AbortSignal for cancellation\n * @returns {Promise<Object>} Final task state\n */\nexport async function pollTaskUntilComplete(taskId, options = {}) {\n  const {\n    intervalMs = 1000,\n    timeoutMs = 300000,\n    onProgress = null,\n    signal = null,\n  } = options;\n\n  const startTime = Date.now();\n  const terminalStatuses = ['completed', 'failed', 'cancelled'];\n\n  while (true) {\n    // Check for abort\n    if (signal?.aborted) {\n      throw new AgentError('POLLING_ABORTED', 'Polling was aborted', false);\n    }\n\n    // Check for timeout\n    if (Date.now() - startTime > timeoutMs) {\n      throw new AgentError('POLLING_TIMEOUT', `Task did not complete within ${timeoutMs}ms`, true);\n    }\n\n    // Fetch task status\n    const task = await getTask(taskId);\n\n    // Report progress\n    if (onProgress) {\n      try {\n        onProgress(task);\n      } catch (e) {\n        console.warn('Progress callback error:', e);\n      }\n    }\n\n    // Check if terminal\n    if (terminalStatuses.includes(task.status)) {\n      return task;\n    }\n\n    // Wait before next poll\n    await new Promise((resolve) => setTimeout(resolve, intervalMs));\n  }\n}\n\n/**\n * Run research agent and poll until complete (convenience method).\n *\n * @param {string} topic - Topic to research\n * @param {Object} options - Same as runResearchAgent + polling options\n * @returns {Promise<Object>} Final task state with result\n */\nexport async function runResearchAndWait(topic, options = {}) {\n  // Always run async for polling\n  const task = await runResearchAgent(topic, { ...options, sync: false });\n\n  return pollTaskUntilComplete(task.task_id, {\n    intervalMs: options.pollIntervalMs,\n    timeoutMs: options.pollTimeoutMs,\n    onProgress: options.onProgress,\n    signal: options.signal,\n  });\n}\n\n// ============================================\n// Utility\n// ============================================\n\n/**\n * List available agent types.\n *\n * @returns {Promise<Object>} List of agent types with descriptions\n */\nexport async function listAgentTypes() {\n  try {\n    const response = await api.get(`${BASE_PATH}/types`);\n    const payload = response.data;\n    if (Array.isArray(payload)) {\n      return { types: payload };\n    }\n    if (payload && typeof payload === 'object') {\n      return { ...payload, types: asArray(payload, ['types', 'items', 'results']) };\n    }\n    return { types: [] };\n  } catch (error) {\n    handleApiError(error);\n  }\n}\n\n/**\n * Get service statistics.\n *\n * @returns {Promise<Object>} Task counts by status\n */\nexport async function getStats() {\n  try {\n    const response = await api.get(`${BASE_PATH}/stats`);\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n  }\n}\n\n/**\n * Health check for agents service.\n *\n * @returns {Promise<Object>} Health status\n */\nexport async function healthCheck() {\n  try {\n    const response = await api.get(`${BASE_PATH}/health`);\n    return response.data;\n  } catch (error) {\n    handleApiError(error);\n  }\n}\n\n// ============================================\n// SSE Progress Streaming (Trade-off 2)\n// ============================================\n\n/**\n * Stream real-time progress updates for a task via Server-Sent Events.\n *\n * Returns an EventSource-like controller with cleanup. Prefer this over\n * polling when you need instant progress feedback in the UI.\n *\n * @param {string} taskId - Task identifier\n * @param {Object} options - Streaming options\n * @param {Function} options.onProgress - Called on progress updates (receives {event, data})\n * @param {Function} options.onComplete - Called when task reaches terminal state\n * @param {Function} options.onError - Called on stream errors\n * @param {number} options.pollInterval - Poll interval in seconds (default 0.5)\n * @param {number} options.timeout - Stream timeout in seconds (default 300)\n * @returns {Object} Controller with { close() } method\n */\nexport function streamTaskProgress(taskId, options = {}) {\n  const {\n    onProgress = null,\n    onComplete = null,\n    onError = null,\n    pollInterval = 0.5,\n    timeout = 300,\n  } = options;\n\n  const params = new URLSearchParams({\n    poll_interval: String(pollInterval),\n    timeout: String(timeout),\n  });\n\n  const url = toApiUrl(`${BASE_PATH}/tasks/${taskId}/stream?${params}`);\n\n  // Use EventSource for native SSE support\n  const eventSource = new EventSource(url);\n  let closed = false;\n\n  eventSource.onmessage = (event) => {\n    if (closed) return;\n\n    try {\n      const payload = JSON.parse(event.data);\n\n      if (payload.event === 'progress' && onProgress) {\n        onProgress(payload.data);\n      } else if (payload.event === 'complete') {\n        if (onComplete) onComplete(payload.data);\n        eventSource.close();\n        closed = true;\n      } else if (payload.event === 'heartbeat') {\n        // Connection keep-alive — no action needed\n      } else if (payload.event === 'error') {\n        // DB_ERROR is transient — server will retry automatically\n        if (payload.data.code === 'DB_ERROR') return;\n        if (onError) {\n          onError(new AgentError(\n            payload.data.code || 'STREAM_ERROR',\n            payload.data.message || 'Stream error',\n            false,\n          ));\n        }\n        eventSource.close();\n        closed = true;\n      }\n    } catch (e) {\n      console.warn('Failed to parse SSE event:', e);\n    }\n  };\n\n  eventSource.onerror = (event) => {\n    if (closed) return;\n\n    // EventSource auto-reconnects on transient errors.\n    // Only propagate if the connection is truly dead.\n    if (eventSource.readyState === EventSource.CLOSED) {\n      if (onError) {\n        onError(new AgentError('SSE_CONNECTION_CLOSED', 'SSE connection closed', true));\n      }\n      closed = true;\n    }\n  };\n\n  return {\n    close() {\n      if (!closed) {\n        closed = true;\n        eventSource.close();\n      }\n    },\n  };\n}\n\n/**\n * Run research agent with SSE progress streaming (convenience method).\n *\n * Creates the task asynchronously and immediately starts streaming progress.\n * Returns a promise that resolves with the final task state.\n *\n * @param {string} topic - Topic to research\n * @param {Object} options - Same as runResearchAgent + streaming options\n * @param {Function} options.onProgress - Progress callback\n * @returns {Promise<Object>} Final task state with result\n */\nexport async function runResearchWithStreaming(topic, options = {}) {\n  // Create the task asynchronously first\n  const task = await runResearchAgent(topic, { ...options, sync: false });\n\n  // Then wrap only the SSE streaming in a promise\n  return new Promise((resolve, reject) => {\n    streamTaskProgress(task.task_id, {\n      onProgress: options.onProgress,\n      onComplete: (data) => resolve(data),\n      onError: (err) => reject(err),\n      pollInterval: options.pollInterval,\n      timeout: options.timeout,\n    });\n  });\n}\n\n// ============================================\n// Generate Idempotency Key Helper\n// ============================================\n\n/**\n * Generate a unique idempotency key for a research request.\n * Use this to ensure duplicate requests return the same task.\n *\n * @param {string} userId - User identifier\n * @param {string} topic - Research topic\n * @param {Object} options - Request options (depth, focusAreas, etc.)\n * @returns {string} Idempotency key\n */\nexport function generateIdempotencyKey(userId, topic, options = {}) {\n  const parts = [\n    userId,\n    topic.toLowerCase().trim(),\n    options.depth || 'comprehensive',\n    (options.focusAreas || []).sort().join(','),\n    options.maxSections || 5,\n  ];\n  return btoa(parts.join('|')).replace(/[^a-zA-Z0-9]/g, '').slice(0, 64);\n}\n\nexport default {\n  // Research\n  runResearchAgent,\n  runResearchAndWait,\n  runResearchWithStreaming,\n\n  // Data Analyst\n  runDataAnalystAgent,\n\n  // Email Draft\n  runEmailDraftAgent,\n\n  // Content Repurpose\n  runContentRepurposeAgent,\n\n  // Proofreading\n  runProofreadingAgent,\n\n  // Report Analyst\n  runReportAnalystAgent,\n  generateReportFromTask,\n\n  // Task Management\n  getTask,\n  listTasks,\n  cancelTask,\n  retryTask,\n  getTaskEvents,\n\n  // Polling\n  pollTaskUntilComplete,\n\n  // SSE Streaming\n  streamTaskProgress,\n\n  // Utility\n  listAgentTypes,\n  getStats,\n  healthCheck,\n  generateIdempotencyKey,\n\n  // Error Types\n  AgentError,\n  ValidationError,\n  TaskNotFoundError,\n  TaskConflictError,\n};\n","/**\n * Agent Store - Zustand store for AI agents.\n */\nimport { create } from 'zustand';\nimport * as agentsApi from '../api/agents';\nimport * as agentsV2Api from '../api/agentsV2';\n\nconst taskIdentifier = (task) => task?.id || task?.task_id || null;\n\nconst useAgentStore = create((set, get) => ({\n  // State\n  tasks: [],\n  currentTask: null,\n  agentTypes: [],\n  repurposeFormats: [],\n  loading: false,\n  executing: false,\n  error: null,\n\n  // Actions\n  setLoading: (loading) => set({ loading }),\n  setError: (error) => set({ error }),\n\n  // Research Agent\n  runResearch: async (topic, options = {}) => {\n    set({ executing: true, error: null });\n    try {\n      const task = await agentsApi.runResearchAgent(topic, options);\n      set((state) => ({\n        tasks: [task, ...state.tasks].slice(0, 200),\n        currentTask: task,\n        executing: false,\n      }));\n      return task;\n    } catch (err) {\n      set({ error: err.message, executing: false });\n      return null;\n    }\n  },\n\n  // Data Analyst Agent\n  runDataAnalysis: async (question, data, options = {}) => {\n    set({ executing: true, error: null });\n    try {\n      const task = await agentsApi.runDataAnalystAgent(question, data, options);\n      set((state) => ({\n        tasks: [task, ...state.tasks].slice(0, 200),\n        currentTask: task,\n        executing: false,\n      }));\n      return task;\n    } catch (err) {\n      set({ error: err.message, executing: false });\n      return null;\n    }\n  },\n\n  // Email Draft Agent\n  runEmailDraft: async (context, purpose, options = {}) => {\n    set({ executing: true, error: null });\n    try {\n      const task = await agentsApi.runEmailDraftAgent(context, purpose, options);\n      set((state) => ({\n        tasks: [task, ...state.tasks].slice(0, 200),\n        currentTask: task,\n        executing: false,\n      }));\n      return task;\n    } catch (err) {\n      set({ error: err.message, executing: false });\n      return null;\n    }\n  },\n\n  // Content Repurpose Agent\n  runContentRepurpose: async (content, sourceFormat, targetFormats, options = {}) => {\n    set({ executing: true, error: null });\n    try {\n      const task = await agentsApi.runContentRepurposeAgent(content, sourceFormat, targetFormats, options);\n      set((state) => ({\n        tasks: [task, ...state.tasks].slice(0, 200),\n        currentTask: task,\n        executing: false,\n      }));\n      return task;\n    } catch (err) {\n      set({ error: err.message, executing: false });\n      return null;\n    }\n  },\n\n  // Proofreading Agent\n  runProofreading: async (text, options = {}) => {\n    set({ executing: true, error: null });\n    try {\n      const task = await agentsApi.runProofreadingAgent(text, options);\n      set((state) => ({\n        tasks: [task, ...state.tasks].slice(0, 200),\n        currentTask: task,\n        executing: false,\n      }));\n      return task;\n    } catch (err) {\n      set({ error: err.message, executing: false });\n      return null;\n    }\n  },\n\n  // Report Analyst Agent\n  runReportAnalyst: async (runId, options = {}) => {\n    set({ executing: true, error: null });\n    try {\n      const task = await agentsV2Api.runReportAnalystAgent(runId, options);\n      set((state) => ({\n        tasks: [task, ...state.tasks].slice(0, 200),\n        currentTask: task,\n        executing: false,\n      }));\n      return task;\n    } catch (err) {\n      set({ error: err.message, executing: false });\n      return null;\n    }\n  },\n\n  // Generate Report from Agent Task\n  generateReportFromTask: async (taskId, config = {}) => {\n    set({ executing: true, error: null });\n    try {\n      const result = await agentsV2Api.generateReportFromTask(taskId, config);\n      set({ executing: false });\n      return result;\n    } catch (err) {\n      set({ error: err.message, executing: false });\n      return null;\n    }\n  },\n\n  // Task Management\n  fetchTasks: async (agentType = null) => {\n    set({ loading: true, error: null });\n    try {\n      const tasks = await agentsApi.listTasks(agentType);\n      set({ tasks, loading: false });\n      return tasks;\n    } catch (err) {\n      set({ error: err.message, loading: false });\n      return [];\n    }\n  },\n\n  getTask: async (taskId) => {\n    set({ loading: true, error: null });\n    try {\n      const task = await agentsApi.getTask(taskId);\n      set({ currentTask: task, loading: false });\n      return task;\n    } catch (err) {\n      set({ error: err.message, loading: false });\n      return null;\n    }\n  },\n\n  // Utility\n  fetchAgentTypes: async () => {\n    try {\n      const response = await agentsApi.listAgentTypes();\n      set({ agentTypes: response.types || [] });\n      return response.types;\n    } catch (err) {\n      set({ error: err.message });\n      return [];\n    }\n  },\n\n  fetchRepurposeFormats: async () => {\n    try {\n      const response = await agentsApi.listRepurposeFormats();\n      set({ repurposeFormats: response.formats || [] });\n      return response.formats;\n    } catch (err) {\n      set({ error: err.message });\n      return [];\n    }\n  },\n\n  // V2 Task Management\n  cancelTask: async (taskId) => {\n    try {\n      await agentsV2Api.cancelTask(taskId);\n      set((state) => ({\n        tasks: state.tasks.map((t) =>\n          taskIdentifier(t) === taskId ? { ...t, status: 'cancelled' } : t\n        ),\n        currentTask: taskIdentifier(state.currentTask) === taskId\n          ? { ...state.currentTask, status: 'cancelled' }\n          : state.currentTask,\n      }));\n      return true;\n    } catch (err) {\n      set({ error: err.message });\n      return false;\n    }\n  },\n\n  retryTask: async (taskId) => {\n    set({ executing: true, error: null });\n    try {\n      const task = await agentsV2Api.retryTask(taskId);\n      set((state) => ({\n        tasks: state.tasks.map((t) => (taskIdentifier(t) === taskId ? task : t)),\n        currentTask: taskIdentifier(state.currentTask) === taskId ? task : state.currentTask,\n        executing: false,\n      }));\n      return task;\n    } catch (err) {\n      set({ error: err.message, executing: false });\n      return null;\n    }\n  },\n\n  getTaskEvents: async (taskId) => {\n    try {\n      const events = await agentsV2Api.getTaskEvents(taskId);\n      return events;\n    } catch (err) {\n      set({ error: err.message });\n      return [];\n    }\n  },\n\n  getAgentStats: async () => {\n    try {\n      const stats = await agentsV2Api.getStats();\n      return stats;\n    } catch (err) {\n      set({ error: err.message });\n      return null;\n    }\n  },\n\n  streamTaskProgress: async (taskId, onEvent) => {\n    try {\n      return await agentsV2Api.streamTaskProgress(taskId, onEvent);\n    } catch (err) {\n      set({ error: err.message });\n      return null;\n    }\n  },\n\n  // Reset\n  reset: () => set({\n    currentTask: null,\n    error: null,\n  }),\n\n  clearTasks: () => set({\n    tasks: [],\n    currentTask: null,\n  }),\n}));\n\nexport default useAgentStore;\n","/**\n * AI Agents Page Container\n * Interface for running AI agents (research, data analysis, email, content, proofreading, report analyst).\n */\nimport React, { useState, useEffect, useCallback, useRef } from 'react'\nimport {\n  Box,\n  Typography,\n  Button,\n  TextField,\n  Paper,\n  Grid,\n  Card,\n  CardContent,\n  CardActions,\n  Chip,\n  Alert,\n  CircularProgress,\n  Tabs,\n  Tab,\n  Divider,\n  List,\n  ListItem,\n  ListItemText,\n  IconButton,\n  Select,\n  MenuItem,\n  FormControl,\n  InputLabel,\n  useTheme,\n  alpha,\n  styled,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Stack,\n  LinearProgress,\n  Autocomplete,\n  Tooltip,\n} from '@mui/material'\nimport {\n  Science as ResearchIcon,\n  Analytics as DataIcon,\n  Email as EmailIcon,\n  Transform as ContentIcon,\n  Spellcheck as ProofreadIcon,\n  PlayArrow as RunIcon,\n  History as HistoryIcon,\n  ContentCopy as CopyIcon,\n  Download as DownloadIcon,\n  SmartToy as AgentIcon,\n  Assessment as ReportAnalystIcon,\n  Description as ReportIcon,\n  TrendingUp as TrendUpIcon,\n  TrendingDown as TrendDownIcon,\n  TrendingFlat as TrendFlatIcon,\n  Lightbulb as InsightIcon,\n  CheckCircle as CheckIcon,\n  QuestionAnswer as QAIcon,\n  CompareArrows as CompareIcon,\n} from '@mui/icons-material'\nimport * as clientApi from '@/api/client'\nimport { useSearchParams } from 'react-router-dom'\nimport { neutral, palette } from '@/app/theme'\nimport useAgentStore from '@/stores/agentStore'\nimport useSharedData from '@/hooks/useSharedData'\nimport useCrossPageActions from '@/hooks/useCrossPageActions'\nimport ConnectionSelector from '@/components/common/ConnectionSelector'\nimport SendToMenu from '@/components/common/SendToMenu'\nimport { useToast } from '@/components/ToastProvider'\nimport { useInteraction, InteractionType, Reversibility } from '@/components/ux/governance'\nimport { OutputType, FeatureKey } from '@/utils/crossPageTypes'\n\n// =============================================================================\n// STYLED COMPONENTS\n// =============================================================================\n\nconst PageContainer = styled(Box)(({ theme }) => ({\n  display: 'flex',\n  flexDirection: 'column',\n  height: 'calc(100vh - 64px)',\n  backgroundColor: theme.palette.background.default,\n}))\n\nconst Header = styled(Box)(({ theme }) => ({\n  padding: theme.spacing(2, 3),\n  borderBottom: `1px solid ${alpha(theme.palette.divider, 0.1)}`,\n  backgroundColor: alpha(theme.palette.background.paper, 0.8),\n}))\n\nconst ContentArea = styled(Box)(({ theme }) => ({\n  flex: 1,\n  display: 'flex',\n  overflow: 'hidden',\n}))\n\nconst MainPanel = styled(Box)(({ theme }) => ({\n  flex: 1,\n  padding: theme.spacing(3),\n  overflow: 'auto',\n}))\n\nconst Sidebar = styled(Box)(({ theme }) => ({\n  width: 350,\n  borderLeft: `1px solid ${alpha(theme.palette.divider, 0.1)}`,\n  backgroundColor: alpha(theme.palette.background.paper, 0.6),\n  display: 'flex',\n  flexDirection: 'column',\n}))\n\nconst AgentCard = styled(Card)(({ theme, selected }) => ({\n  cursor: 'pointer',\n  transition: 'all 0.2s cubic-bezier(0.22, 1, 0.36, 1)',\n  border: selected ? `2px solid ${theme.palette.mode === 'dark' ? neutral[500] : neutral[700]}` : `1px solid ${alpha(theme.palette.divider, 0.2)}`,\n  '&:hover': {\n    transform: 'translateY(-2px)',\n    boxShadow: `0 8px 24px ${alpha(theme.palette.text.primary, 0.15)}`,\n  },\n}))\n\nconst ResultCard = styled(Paper)(({ theme }) => ({\n  padding: theme.spacing(2),\n  marginTop: theme.spacing(2),\n  backgroundColor: theme.palette.mode === 'dark' ? alpha(theme.palette.text.primary, 0.05) : neutral[50],\n  border: `1px solid ${alpha(theme.palette.divider, 0.2)}`,\n}))\n\nconst ActionButton = styled(Button)(({ theme }) => ({\n  borderRadius: 8,\n  textTransform: 'none',\n  fontWeight: 500,\n}))\n\n// =============================================================================\n// TREND ICON HELPER\n// =============================================================================\n\nconst TrendIcon = ({ trend }) => {\n  if (trend === 'up') return <TrendUpIcon fontSize=\"small\" color=\"success\" />\n  if (trend === 'down') return <TrendDownIcon fontSize=\"small\" color=\"error\" />\n  if (trend === 'stable') return <TrendFlatIcon fontSize=\"small\" color=\"action\" />\n  return null\n}\n\n// =============================================================================\n// REPORT ANALYST STRUCTURED RESULT\n// =============================================================================\n\nconst AnalysisSectionTitle = styled(Typography)(({ theme }) => ({\n  fontWeight: 600,\n  fontSize: '0.875rem',\n  display: 'flex',\n  alignItems: 'center',\n  gap: theme.spacing(1),\n  marginBottom: theme.spacing(1),\n}))\n\nconst FindingCard = styled(Paper)(({ theme }) => ({\n  padding: theme.spacing(1.5),\n  backgroundColor: theme.palette.mode === 'dark' ? alpha(theme.palette.text.primary, 0.04) : neutral[50],\n  border: `1px solid ${alpha(theme.palette.divider, 0.15)}`,\n  borderRadius: 8,\n}))\n\nconst HighlightRow = styled(Box)(({ theme }) => ({\n  display: 'flex',\n  alignItems: 'center',\n  justifyContent: 'space-between',\n  padding: theme.spacing(1, 1.5),\n  borderBottom: `1px solid ${alpha(theme.palette.divider, 0.1)}`,\n  '&:last-child': { borderBottom: 'none' },\n}))\n\nfunction ReportAnalystResult({ output }) {\n  if (!output || typeof output !== 'object') return null\n\n  const { summary, answer, key_findings, data_highlights, recommendations, comparison, analysis_type } = output\n\n  return (\n    <Stack spacing={2.5}>\n      {/* Answer (QA mode) */}\n      {answer && (\n        <Box>\n          <AnalysisSectionTitle>\n            <QAIcon fontSize=\"small\" color=\"primary\" />\n            Answer\n          </AnalysisSectionTitle>\n          <Paper sx={{ p: 2, bgcolor: (t) => alpha(t.palette.primary.main, 0.06), borderRadius: 2, border: '1px solid', borderColor: (t) => alpha(t.palette.primary.main, 0.15) }}>\n            <Typography variant=\"body2\" sx={{ whiteSpace: 'pre-wrap' }}>{answer}</Typography>\n          </Paper>\n        </Box>\n      )}\n\n      {/* Summary */}\n      {summary && (\n        <Box>\n          <AnalysisSectionTitle>\n            <ReportIcon fontSize=\"small\" color=\"action\" />\n            Summary\n          </AnalysisSectionTitle>\n          <Typography variant=\"body2\" sx={{ whiteSpace: 'pre-wrap', lineHeight: 1.7 }}>{summary}</Typography>\n        </Box>\n      )}\n\n      {/* Key Findings */}\n      {key_findings?.length > 0 && (\n        <Box>\n          <AnalysisSectionTitle>\n            <InsightIcon fontSize=\"small\" sx={{ color: 'warning.main' }} />\n            Key Findings ({key_findings.length})\n          </AnalysisSectionTitle>\n          <Stack spacing={1}>\n            {key_findings.map((f, i) => (\n              <FindingCard key={i} elevation={0}>\n                <Box sx={{ display: 'flex', alignItems: 'flex-start', justifyContent: 'space-between', gap: 1 }}>\n                  <Typography variant=\"body2\">{f.finding || f}</Typography>\n                  {f.confidence != null && (\n                    <Chip\n                      label={`${Math.round(f.confidence * 100)}%`}\n                      size=\"small\"\n                      color={f.confidence >= 0.8 ? 'success' : f.confidence >= 0.6 ? 'warning' : 'default'}\n                      variant=\"outlined\"\n                      sx={{ flexShrink: 0, fontSize: '12px', height: 22 }}\n                    />\n                  )}\n                </Box>\n                {f.source_section && (\n                  <Typography variant=\"caption\" color=\"text.secondary\" sx={{ mt: 0.5, display: 'block' }}>\n                    Source: {f.source_section}\n                  </Typography>\n                )}\n              </FindingCard>\n            ))}\n          </Stack>\n        </Box>\n      )}\n\n      {/* Data Highlights */}\n      {data_highlights?.length > 0 && (\n        <Box>\n          <AnalysisSectionTitle>\n            <DataIcon fontSize=\"small\" color=\"info\" />\n            Data Highlights ({data_highlights.length})\n          </AnalysisSectionTitle>\n          <Paper variant=\"outlined\" sx={{ borderRadius: 2, overflow: 'hidden' }}>\n            {data_highlights.map((d, i) => (\n              <HighlightRow key={i}>\n                <Box sx={{ flex: 1, minWidth: 0 }}>\n                  <Typography variant=\"body2\" fontWeight={600} noWrap>{d.metric}</Typography>\n                  {d.context && <Typography variant=\"caption\" color=\"text.secondary\">{d.context}</Typography>}\n                </Box>\n                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, flexShrink: 0 }}>\n                  <Typography variant=\"body2\" fontWeight={500}>{d.value}</Typography>\n                  <TrendIcon trend={d.trend} />\n                </Box>\n              </HighlightRow>\n            ))}\n          </Paper>\n        </Box>\n      )}\n\n      {/* Comparison (Compare mode) */}\n      {comparison && (\n        <Box>\n          <AnalysisSectionTitle>\n            <CompareIcon fontSize=\"small\" color=\"secondary\" />\n            Comparison\n          </AnalysisSectionTitle>\n          <Stack spacing={1}>\n            {comparison.report_a_period && comparison.report_b_period && (\n              <Typography variant=\"caption\" color=\"text.secondary\">\n                Comparing: {comparison.report_a_period} vs {comparison.report_b_period}\n              </Typography>\n            )}\n            {comparison.improvements?.length > 0 && (\n              <Box>\n                <Typography variant=\"caption\" fontWeight={600} color=\"success.main\">Improvements:</Typography>\n                <ul style={{ margin: '4px 0', paddingLeft: 20 }}>\n                  {comparison.improvements.map((item, i) => (\n                    <li key={i}><Typography variant=\"caption\">{item}</Typography></li>\n                  ))}\n                </ul>\n              </Box>\n            )}\n            {comparison.regressions?.length > 0 && (\n              <Box>\n                <Typography variant=\"caption\" fontWeight={600} color=\"error.main\">Regressions:</Typography>\n                <ul style={{ margin: '4px 0', paddingLeft: 20 }}>\n                  {comparison.regressions.map((item, i) => (\n                    <li key={i}><Typography variant=\"caption\">{item}</Typography></li>\n                  ))}\n                </ul>\n              </Box>\n            )}\n          </Stack>\n        </Box>\n      )}\n\n      {/* Recommendations */}\n      {recommendations?.length > 0 && (\n        <Box>\n          <AnalysisSectionTitle>\n            <CheckIcon fontSize=\"small\" color=\"success\" />\n            Recommendations ({recommendations.length})\n          </AnalysisSectionTitle>\n          <Stack spacing={0.5}>\n            {recommendations.map((rec, i) => (\n              <Box key={i} sx={{ display: 'flex', alignItems: 'flex-start', gap: 1, pl: 0.5 }}>\n                <Typography variant=\"body2\" color=\"text.secondary\" sx={{ minWidth: 20, fontWeight: 600 }}>{i + 1}.</Typography>\n                <Typography variant=\"body2\">{rec}</Typography>\n              </Box>\n            ))}\n          </Stack>\n        </Box>\n      )}\n    </Stack>\n  )\n}\n\n// =============================================================================\n// GENERATE REPORT FROM AGENT DIALOG\n// =============================================================================\n\nfunction GenerateReportDialog({ open, onClose, taskId, templates, connections, onGenerate }) {\n  const [templateId, setTemplateId] = useState('')\n  const [connectionId, setConnectionId] = useState('')\n  const [startDate, setStartDate] = useState('')\n  const [endDate, setEndDate] = useState('')\n  const [submitting, setSubmitting] = useState(false)\n\n  useEffect(() => {\n    if (open) {\n      setTemplateId(templates?.[0]?.id || '')\n      setConnectionId(connections?.[0]?.id || '')\n      const today = new Date().toISOString().split('T')[0]\n      const monthAgo = new Date(Date.now() - 30 * 86400000).toISOString().split('T')[0]\n      setStartDate(monthAgo)\n      setEndDate(today)\n    }\n  }, [open, templates, connections])\n\n  const handleSubmit = async () => {\n    setSubmitting(true)\n    try {\n      await onGenerate(taskId, {\n        templateId,\n        connectionId,\n        startDate,\n        endDate,\n      })\n      onClose()\n    } catch (err) {\n      // Error handled in parent\n    } finally {\n      setSubmitting(false)\n    }\n  }\n\n  return (\n    <Dialog open={open} onClose={onClose} maxWidth=\"sm\" fullWidth>\n      <DialogTitle sx={{ fontWeight: 600 }}>Generate Report from Agent Result</DialogTitle>\n      <DialogContent>\n        <Stack spacing={2.5} sx={{ mt: 1 }}>\n          <FormControl fullWidth size=\"small\">\n            <InputLabel>Template</InputLabel>\n            <Select value={templateId} onChange={(e) => setTemplateId(e.target.value)} label=\"Template\">\n              {(templates || []).map((t) => (\n                <MenuItem key={t.id} value={t.id}>{t.name || t.id}</MenuItem>\n              ))}\n            </Select>\n          </FormControl>\n          <FormControl fullWidth size=\"small\">\n            <InputLabel>Connection</InputLabel>\n            <Select value={connectionId} onChange={(e) => setConnectionId(e.target.value)} label=\"Connection\">\n              {(connections || []).map((c) => (\n                <MenuItem key={c.id} value={c.id}>{c.name || c.id}</MenuItem>\n              ))}\n            </Select>\n          </FormControl>\n          <Stack direction=\"row\" spacing={2}>\n            <TextField\n              label=\"Start Date\"\n              type=\"date\"\n              value={startDate}\n              onChange={(e) => setStartDate(e.target.value)}\n              InputLabelProps={{ shrink: true }}\n              fullWidth\n              size=\"small\"\n            />\n            <TextField\n              label=\"End Date\"\n              type=\"date\"\n              value={endDate}\n              onChange={(e) => setEndDate(e.target.value)}\n              InputLabelProps={{ shrink: true }}\n              fullWidth\n              size=\"small\"\n            />\n          </Stack>\n        </Stack>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={onClose}>Cancel</Button>\n        <Button\n          variant=\"contained\"\n          onClick={handleSubmit}\n          disabled={!templateId || !connectionId || submitting}\n          startIcon={submitting ? <CircularProgress size={16} /> : <ReportIcon />}\n        >\n          {submitting ? 'Generating...' : 'Generate Report'}\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\n// =============================================================================\n// AGENT CONFIGS\n// =============================================================================\n\nconst AGENTS = [\n  {\n    type: 'research',\n    name: 'Research Agent',\n    description: 'Deep-dive research and report compilation on any topic',\n    icon: ResearchIcon,\n    color: 'primary',\n    fields: [\n      { name: 'topic', label: 'Research Topic', type: 'text', required: true, multiline: true },\n      { name: 'depth', label: 'Depth', type: 'select', options: ['quick', 'standard', 'comprehensive', 'exhaustive'], default: 'comprehensive' },\n      { name: 'maxSections', label: 'Sections', type: 'number', default: 5, min: 1, max: 10 },\n    ],\n  },\n  {\n    type: 'data_analyst',\n    name: 'Data Analyst',\n    description: 'Analyze data and answer questions with insights',\n    icon: DataIcon,\n    color: 'info',\n    fields: [\n      { name: 'question', label: 'What do you want to know?', type: 'text', required: true, multiline: true, placeholder: 'e.g., What are the top 5 products by revenue? Which month had the highest sales?' },\n      { name: 'dataSource', label: 'Data Source', type: 'select', options: ['paste_spreadsheet', 'database_connection', 'sample_sales', 'sample_inventory', 'custom_json'], default: 'paste_spreadsheet' },\n      { name: 'data', label: 'Paste your data here (from Excel or Google Sheets)', type: 'spreadsheet', required: true, multiline: true, rows: 8, placeholder: 'Tip: Copy cells from Excel or Google Sheets and paste here. We\\'ll convert it automatically!' },\n    ],\n  },\n  {\n    type: 'email_draft',\n    name: 'Email Draft',\n    description: 'Compose professional emails based on context',\n    icon: EmailIcon,\n    color: 'warning',\n    fields: [\n      { name: 'context', label: 'Context', type: 'text', required: true, multiline: true },\n      { name: 'purpose', label: 'Purpose', type: 'text', required: true },\n      { name: 'tone', label: 'Tone', type: 'select', options: ['professional', 'friendly', 'formal', 'casual'], default: 'professional' },\n      { name: 'recipientInfo', label: 'Recipient Info', type: 'text' },\n    ],\n  },\n  {\n    type: 'content_repurpose',\n    name: 'Content Repurpose',\n    description: 'Transform content into multiple formats',\n    icon: ContentIcon,\n    color: 'secondary',\n    fields: [\n      { name: 'content', label: 'Original Content', type: 'text', required: true, multiline: true, rows: 6 },\n      { name: 'sourceFormat', label: 'Source Format', type: 'select', options: ['blog', 'article', 'report', 'notes', 'transcript'], default: 'blog' },\n      { name: 'targetFormats', label: 'Target Formats', type: 'multiselect', options: ['tweet_thread', 'linkedin_post', 'blog_summary', 'slides', 'email_newsletter', 'video_script'] },\n    ],\n  },\n  {\n    type: 'proofreading',\n    name: 'Proofreading',\n    description: 'Grammar, style, and clarity improvements',\n    icon: ProofreadIcon,\n    color: 'success',\n    fields: [\n      { name: 'text', label: 'Text to Proofread', type: 'text', required: true, multiline: true, rows: 8 },\n      { name: 'styleGuide', label: 'Style Guide', type: 'select', options: ['AP', 'Chicago', 'MLA', 'APA', 'None'], default: 'None' },\n    ],\n  },\n  {\n    type: 'report_analyst',\n    name: 'Report Analyst',\n    description: 'Analyze, summarize, compare, or ask questions about generated reports',\n    icon: ReportAnalystIcon,\n    color: 'error',\n    fields: [\n      { name: 'runId', label: 'Report Run', type: 'reportRunPicker', required: true, placeholder: 'Select or enter a report run ID' },\n      { name: 'analysisType', label: 'Analysis Type', type: 'select', options: ['summarize', 'insights', 'compare', 'qa'], default: 'summarize' },\n      { name: 'question', label: 'Question (for Q&A mode)', type: 'text', multiline: true, placeholder: 'What would you like to know about this report?' },\n      { name: 'compareRunId', label: 'Comparison Run ID (for compare mode)', type: 'reportRunPicker', placeholder: 'Select second report to compare against' },\n    ],\n  },\n]\n\n// =============================================================================\n// MAIN COMPONENT\n// =============================================================================\n\nexport default function AgentsPageContainer() {\n  const theme = useTheme()\n  const toast = useToast()\n  const [searchParams, setSearchParams] = useSearchParams()\n  const { execute } = useInteraction()\n  const {\n    tasks,\n    currentTask,\n    agentTypes,\n    repurposeFormats,\n    loading,\n    executing,\n    error,\n    runResearch,\n    runDataAnalysis,\n    runEmailDraft,\n    runContentRepurpose,\n    runProofreading,\n    runReportAnalyst,\n    generateReportFromTask,\n    fetchTasks,\n    fetchAgentTypes,\n    fetchRepurposeFormats,\n    reset,\n  } = useAgentStore()\n\n  const { connections, templates, activeConnectionId } = useSharedData()\n  const { registerOutput } = useCrossPageActions(FeatureKey.AGENTS)\n  const [selectedConnectionId, setSelectedConnectionId] = useState(activeConnectionId)\n\n  const [selectedAgent, setSelectedAgent] = useState(AGENTS[0])\n  const [formData, setFormData] = useState({})\n  const [showHistory, setShowHistory] = useState(false)\n  const [result, setResult] = useState(null)\n  const [recentRuns, setRecentRuns] = useState([])\n  const [runsLoading, setRunsLoading] = useState(false)\n  const [generateDialogOpen, setGenerateDialogOpen] = useState(false)\n  const resultRef = useRef(null)\n\n  useEffect(() => {\n    fetchAgentTypes()\n    fetchRepurposeFormats()\n    fetchTasks()\n    return () => reset()\n  }, [fetchAgentTypes, fetchRepurposeFormats, fetchTasks, reset])\n\n  // Handle deep-link from Reports page: ?analyzeRunId=<run_id>\n  useEffect(() => {\n    const analyzeRunId = searchParams.get('analyzeRunId')\n    if (analyzeRunId) {\n      const reportAnalystAgent = AGENTS.find((a) => a.type === 'report_analyst')\n      if (reportAnalystAgent) {\n        setSelectedAgent(reportAnalystAgent)\n        setFormData({ runId: analyzeRunId, analysisType: 'summarize' })\n        // Clear the query param so it doesn't persist\n        const nextParams = new URLSearchParams(searchParams)\n        nextParams.delete('analyzeRunId')\n        setSearchParams(nextParams, { replace: true })\n      }\n    }\n  }, []) // eslint-disable-line react-hooks/exhaustive-deps\n\n  // Fetch recent report runs when Report Analyst is selected\n  useEffect(() => {\n    if (selectedAgent?.type === 'report_analyst') {\n      setRunsLoading(true)\n      clientApi.listReportRuns({ limit: 20 })\n        .then((runs) => setRecentRuns(Array.isArray(runs) ? runs : []))\n        .catch(() => setRecentRuns([]))\n        .finally(() => setRunsLoading(false))\n    }\n  }, [selectedAgent?.type])\n\n  const handleSelectAgent = useCallback((agent) => {\n    setSelectedAgent(agent)\n    setFormData({})\n    setResult(null)\n  }, [])\n\n  const handleFieldChange = useCallback((fieldName, value) => {\n    setFormData((prev) => ({ ...prev, [fieldName]: value }))\n  }, [])\n\n  const handleRun = useCallback(async () => {\n    if (!selectedAgent) return\n\n    const runAction = async () => {\n      let taskResult = null\n\n      switch (selectedAgent.type) {\n        case 'research':\n          taskResult = await runResearch(formData.topic, {\n            depth: formData.depth || 'comprehensive',\n            maxSections: formData.maxSections || 5,\n          })\n          break\n        case 'data_analyst':\n          try {\n            let data\n            const dataSource = formData.dataSource || 'paste_spreadsheet'\n\n            // Handle different data sources\n            if (dataSource === 'sample_sales') {\n              data = [\n                { product: 'Widget A', revenue: 15000, units: 300, month: 'January' },\n                { product: 'Widget B', revenue: 22000, units: 440, month: 'January' },\n                { product: 'Widget A', revenue: 18000, units: 360, month: 'February' },\n                { product: 'Widget B', revenue: 25000, units: 500, month: 'February' },\n                { product: 'Widget C', revenue: 12000, units: 200, month: 'February' },\n              ]\n            } else if (dataSource === 'sample_inventory') {\n              data = [\n                { item: 'SKU-001', stock: 150, reorder_point: 50, supplier: 'Acme Corp' },\n                { item: 'SKU-002', stock: 25, reorder_point: 30, supplier: 'Beta Inc' },\n                { item: 'SKU-003', stock: 200, reorder_point: 75, supplier: 'Acme Corp' },\n                { item: 'SKU-004', stock: 10, reorder_point: 20, supplier: 'Gamma Ltd' },\n              ]\n            } else if (dataSource === 'database_connection') {\n              if (!selectedConnectionId) {\n                toast.show('Please select a database connection', 'warning')\n                return null\n              }\n              taskResult = await runDataAnalysis(formData.question, [], { connectionId: selectedConnectionId })\n            } else if (dataSource === 'custom_json') {\n              // User provided raw JSON\n              data = JSON.parse(formData.data)\n            } else {\n              // paste_spreadsheet - parse tab/comma separated values\n              const rawData = formData.data || ''\n              const lines = rawData.trim().split('\\n')\n              if (lines.length < 2) {\n                toast.show('Please paste data with at least a header row and one data row', 'warning')\n                return null\n              }\n              // Detect delimiter (tab or comma)\n              const delimiter = lines[0].includes('\\t') ? '\\t' : ','\n              const headers = lines[0].split(delimiter).map(h => h.trim().replace(/^[\"']|[\"']$/g, ''))\n              data = lines.slice(1).map(line => {\n                const values = line.split(delimiter).map(v => {\n                  const trimmed = v.trim().replace(/^[\"']|[\"']$/g, '')\n                  // Try to parse as number\n                  const num = parseFloat(trimmed)\n                  return isNaN(num) ? trimmed : num\n                })\n                const row = {}\n                headers.forEach((header, i) => {\n                  row[header] = values[i] ?? ''\n                })\n                return row\n              }).filter(row => Object.values(row).some(v => v !== ''))\n            }\n\n            if (dataSource !== 'database_connection') {\n              if (!data || !data.length) {\n                toast.show('No valid data found. Please check your input.', 'warning')\n                return null\n              }\n\n              taskResult = await runDataAnalysis(formData.question, data)\n            }\n          } catch (parseError) {\n            toast.show('Could not parse data. For custom JSON, ensure it\\'s valid JSON format.', 'error')\n            return null\n          }\n          break\n        case 'email_draft':\n          taskResult = await runEmailDraft(formData.context, formData.purpose, {\n            tone: formData.tone || 'professional',\n            recipientInfo: formData.recipientInfo,\n          })\n          break\n        case 'content_repurpose':\n          taskResult = await runContentRepurpose(\n            formData.content,\n            formData.sourceFormat || 'blog',\n            formData.targetFormats || ['blog_summary'],\n          )\n          break\n        case 'proofreading':\n          taskResult = await runProofreading(formData.text, {\n            styleGuide: formData.styleGuide !== 'None' ? formData.styleGuide : null,\n          })\n          break\n        case 'report_analyst':\n          taskResult = await runReportAnalyst(formData.runId, {\n            analysisType: formData.analysisType || 'summarize',\n            question: formData.question || null,\n            compareRunId: formData.compareRunId || null,\n          })\n          break\n        default:\n          break\n      }\n\n      if (taskResult) {\n        setResult(taskResult)\n        if (taskResult.status === 'failed' || taskResult.status === 'error') {\n          const errMsg = (typeof taskResult.error === 'object' ? taskResult.error?.message : taskResult.error) || taskResult.message || 'Agent task failed'\n          toast.show(errMsg, 'error')\n        } else {\n          const taskOutput = taskResult.result || taskResult.output\n          const outputText = (typeof taskOutput === 'string'\n            ? taskOutput\n            : JSON.stringify(taskOutput, null, 2)) || ''\n          registerOutput({\n            type: OutputType.TEXT,\n            title: `${selectedAgent.name}: ${formData.topic || formData.question || formData.purpose || 'Result'}`,\n            summary: outputText.substring(0, 200),\n            data: outputText,\n            format: 'text',\n          })\n          toast.show('Agent completed successfully', 'success')\n        }\n      }\n      return taskResult\n    }\n\n    return execute({\n      type: InteractionType.EXECUTE,\n      label: `Run ${selectedAgent.name}`,\n      reversibility: Reversibility.FULLY_REVERSIBLE,\n      blocksNavigation: true,\n      intent: { source: 'agents', agentType: selectedAgent.type },\n      action: runAction,\n    })\n  }, [execute, formData, runContentRepurpose, runDataAnalysis, runEmailDraft, runProofreading, runReportAnalyst, runResearch, selectedAgent, selectedConnectionId, toast])\n\n  const handleCopyResult = useCallback(() => {\n    const outputData = result?.result || result?.output\n    if (outputData) {\n      navigator.clipboard.writeText(typeof outputData === 'string' ? outputData : JSON.stringify(outputData, null, 2))\n      toast.show('Copied to clipboard', 'success')\n    }\n  }, [result, toast])\n\n  const handleToggleHistory = useCallback(() => {\n    setShowHistory((prev) => !prev)\n  }, [])\n\n  const isFormValid = () => {\n    if (!selectedAgent) return false\n    return selectedAgent.fields\n      .filter((f) => f.required)\n      .every((f) => formData[f.name]?.toString().trim())\n  }\n\n  return (\n    <PageContainer>\n      <Header>\n        <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\n          <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\n            <AgentIcon sx={{ color: 'text.secondary', fontSize: 28 }} />\n            <Box>\n              <Typography variant=\"h6\" sx={{ fontWeight: 600 }}>\n                AI Agents\n              </Typography>\n              <Typography variant=\"body2\" color=\"text.secondary\">\n                Specialized AI agents for research, analysis, writing, and more\n              </Typography>\n            </Box>\n          </Box>\n          <ActionButton\n            startIcon={<HistoryIcon />}\n            onClick={handleToggleHistory}\n            variant={showHistory ? 'contained' : 'outlined'}\n          >\n            History ({tasks.length})\n          </ActionButton>\n        </Box>\n      </Header>\n\n      <ContentArea>\n        <MainPanel>\n          {/* Agent Selection */}\n          <Typography variant=\"subtitle1\" sx={{ fontWeight: 600, mb: 2 }}>\n            Select Agent\n          </Typography>\n          <Grid container spacing={2} sx={{ mb: 4 }}>\n            {AGENTS.map((agent) => (\n              <Grid item xs={12} sm={6} md={4} key={agent.type}>\n                <AgentCard\n                  selected={selectedAgent?.type === agent.type}\n                  onClick={() => handleSelectAgent(agent)}\n                >\n                  <CardContent>\n                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5, mb: 1 }}>\n                      <Box\n                        sx={{\n                          width: 40,\n                          height: 40,\n                          borderRadius: 1,  // Figma spec: 8px\n                          display: 'flex',\n                          alignItems: 'center',\n                          justifyContent: 'center',\n                          bgcolor: theme.palette.mode === 'dark' ? alpha(theme.palette.text.primary, 0.05) : neutral[50],\n                        }}\n                      >\n                        <agent.icon color=\"inherit\" sx={{ color: 'text.secondary' }} />\n                      </Box>\n                      <Typography variant=\"subtitle1\" sx={{ fontWeight: 600 }}>\n                        {agent.name}\n                      </Typography>\n                    </Box>\n                    <Typography variant=\"body2\" color=\"text.secondary\">\n                      {agent.description}\n                    </Typography>\n                  </CardContent>\n                </AgentCard>\n              </Grid>\n            ))}\n          </Grid>\n\n          {/* Agent Form */}\n          {selectedAgent && (\n            <>\n              <Divider sx={{ mb: 3 }} />\n              <Typography variant=\"subtitle1\" sx={{ fontWeight: 600, mb: 2 }}>\n                {selectedAgent.name} Configuration\n              </Typography>\n              <Paper sx={{ p: 3 }}>\n                <Grid container spacing={2}>\n                  {selectedAgent.fields.map((field) => {\n                    // For data_analyst, hide data field if using sample data or database connection\n                    if (selectedAgent.type === 'data_analyst' && field.name === 'data') {\n                      const dataSource = formData.dataSource || 'paste_spreadsheet'\n                      if (dataSource === 'sample_sales' || dataSource === 'sample_inventory') {\n                        return (\n                          <Grid item xs={12} key={field.name}>\n                            <Alert severity=\"info\" sx={{ mt: 1 }}>\n                              Using sample {dataSource === 'sample_sales' ? 'sales' : 'inventory'} data. Just enter your question above!\n                            </Alert>\n                          </Grid>\n                        )\n                      }\n                      if (dataSource === 'database_connection') {\n                        return (\n                          <Grid item xs={12} key={field.name}>\n                            <ConnectionSelector\n                              value={selectedConnectionId}\n                              onChange={setSelectedConnectionId}\n                              label=\"Select Database\"\n                              showStatus\n                            />\n                          </Grid>\n                        )\n                      }\n                    }\n\n                    // Conditionally hide question/compareRunId fields based on analysisType\n                    if (selectedAgent.type === 'report_analyst') {\n                      const analysisType = formData.analysisType || 'summarize'\n                      if (field.name === 'question' && analysisType !== 'qa') return null\n                      if (field.name === 'compareRunId' && analysisType !== 'compare') return null\n                    }\n\n                    return (\n                      <Grid item xs={12} md={field.multiline ? 12 : 6} key={field.name}>\n                        {field.type === 'reportRunPicker' ? (\n                          <Autocomplete\n                            freeSolo\n                            options={recentRuns}\n                            loading={runsLoading}\n                            getOptionLabel={(option) => {\n                              if (typeof option === 'string') return option\n                              const name = option.templateName || option.template_name || option.templateId || option.template_id || ''\n                              const date = option.createdAt || option.created_at || ''\n                              const dateStr = date ? new Date(date).toLocaleDateString() : ''\n                              return `${name} — ${dateStr} (${option.id?.slice(0, 8)}...)`\n                            }}\n                            value={formData[field.name] || null}\n                            onChange={(_, value) => {\n                              const runId = typeof value === 'string' ? value : value?.id || ''\n                              handleFieldChange(field.name, runId)\n                            }}\n                            onInputChange={(_, value, reason) => {\n                              if (reason === 'input') handleFieldChange(field.name, value)\n                            }}\n                            renderOption={(props, option) => {\n                              const { key, ...rest } = props\n                              const name = option.templateName || option.template_name || option.templateId || option.template_id || ''\n                              const date = option.createdAt || option.created_at || ''\n                              const dateStr = date ? new Date(date).toLocaleString() : ''\n                              const period = [option.startDate || option.start_date, option.endDate || option.end_date].filter(Boolean).join(' – ')\n                              return (\n                                <li key={key} {...rest}>\n                                  <Box sx={{ display: 'flex', flexDirection: 'column' }}>\n                                    <Typography variant=\"body2\" fontWeight={500}>{name}</Typography>\n                                    <Typography variant=\"caption\" color=\"text.secondary\">\n                                      {dateStr}{period ? ` | ${period}` : ''} | {option.id?.slice(0, 12)}...\n                                    </Typography>\n                                  </Box>\n                                </li>\n                              )\n                            }}\n                            renderInput={(params) => (\n                              <TextField\n                                {...params}\n                                label={field.label}\n                                placeholder={field.placeholder}\n                                required={field.required}\n                                InputProps={{\n                                  ...params.InputProps,\n                                  endAdornment: (\n                                    <>\n                                      {runsLoading ? <CircularProgress size={18} /> : null}\n                                      {params.InputProps.endAdornment}\n                                    </>\n                                  ),\n                                }}\n                              />\n                            )}\n                          />\n                        ) : field.type === 'select' ? (\n                          <FormControl fullWidth>\n                            <InputLabel>{field.label}</InputLabel>\n                            <Select\n                              value={formData[field.name] || field.default || ''}\n                              label={field.label}\n                              onChange={(e) => handleFieldChange(field.name, e.target.value)}\n                            >\n                              {field.options.map((opt) => {\n                                // More user-friendly labels for data source options\n                                let label = opt.replace(/_/g, ' ').replace(/\\b\\w/g, (l) => l.toUpperCase())\n                                if (opt === 'paste_spreadsheet') label = 'Paste from Spreadsheet (Recommended)'\n                                if (opt === 'database_connection') label = 'Query Database Connection'\n                                if (opt === 'sample_sales') label = 'Use Sample Sales Data'\n                                if (opt === 'sample_inventory') label = 'Use Sample Inventory Data'\n                                if (opt === 'custom_json') label = 'Enter Raw JSON (Advanced)'\n                                return (\n                                  <MenuItem key={opt} value={opt}>\n                                    {label}\n                                  </MenuItem>\n                                )\n                              })}\n                            </Select>\n                          </FormControl>\n                        ) : field.type === 'multiselect' ? (\n                          <FormControl fullWidth>\n                            <InputLabel>{field.label}</InputLabel>\n                            <Select\n                              multiple\n                              value={formData[field.name] || []}\n                              label={field.label}\n                              onChange={(e) => handleFieldChange(field.name, e.target.value)}\n                              renderValue={(selected) => (\n                                <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 0.5 }}>\n                                  {selected.map((value) => (\n                                    <Chip key={value} label={value.replace(/_/g, ' ')} size=\"small\" />\n                                  ))}\n                                </Box>\n                              )}\n                            >\n                              {field.options.map((opt) => (\n                                <MenuItem key={opt} value={opt}>\n                                  {opt.replace(/_/g, ' ').replace(/\\b\\w/g, (l) => l.toUpperCase())}\n                                </MenuItem>\n                              ))}\n                            </Select>\n                          </FormControl>\n                        ) : field.type === 'number' ? (\n                          <TextField\n                            fullWidth\n                            type=\"number\"\n                            label={field.label}\n                            value={formData[field.name] ?? field.default ?? ''}\n                            onChange={(e) => handleFieldChange(field.name, parseInt(e.target.value))}\n                            inputProps={{ min: field.min, max: field.max }}\n                            required={field.required}\n                          />\n                        ) : field.type === 'spreadsheet' ? (\n                          <TextField\n                            fullWidth\n                            label={formData.dataSource === 'custom_json' ? 'JSON Data' : field.label}\n                            value={formData[field.name] || ''}\n                            onChange={(e) => handleFieldChange(field.name, e.target.value)}\n                            multiline\n                            rows={field.rows || 4}\n                            required={field.required}\n                            placeholder={formData.dataSource === 'custom_json'\n                              ? '[{\"name\": \"John\", \"value\": 100}, {\"name\": \"Jane\", \"value\": 200}]'\n                              : field.placeholder || 'Copy from Excel/Sheets and paste here...'}\n                            helperText={formData.dataSource === 'custom_json'\n                              ? 'Enter valid JSON array of objects'\n                              : 'Supports tab-separated (Excel) or comma-separated (CSV) data'}\n                          />\n                        ) : (\n                          <TextField\n                            fullWidth\n                            label={field.label}\n                            value={formData[field.name] || ''}\n                            onChange={(e) => handleFieldChange(field.name, e.target.value)}\n                            multiline={field.multiline}\n                            rows={field.rows || 4}\n                            required={field.required}\n                            placeholder={field.placeholder}\n                          />\n                        )}\n                      </Grid>\n                    )\n                  })}\n                </Grid>\n\n                <Box sx={{ mt: 3, display: 'flex', justifyContent: 'flex-end' }}>\n                  <ActionButton\n                    variant=\"contained\"\n                    size=\"large\"\n                    startIcon={executing ? <CircularProgress size={20} color=\"inherit\" /> : <RunIcon />}\n                    onClick={handleRun}\n                    disabled={!isFormValid() || executing}\n                  >\n                    {executing ? 'Running...' : `Run ${selectedAgent.name}`}\n                  </ActionButton>\n                </Box>\n              </Paper>\n\n              {/* Result */}\n              {result && (\n                <ResultCard ref={resultRef}>\n                  <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', mb: 2 }}>\n                    <Typography variant=\"subtitle1\" sx={{ fontWeight: 600 }}>\n                      Result\n                      {result.status && (\n                        <Chip\n                          label={result.status}\n                          size=\"small\"\n                          color={result.status === 'completed' ? 'success' : result.status === 'failed' ? 'error' : 'default'}\n                          sx={{ ml: 1, fontSize: '12px', height: 22 }}\n                        />\n                      )}\n                    </Typography>\n                    <Box sx={{ display: 'flex', gap: 1, alignItems: 'center' }}>\n                      {/* Generate Report button for completed agent tasks */}\n                      {result.status === 'completed' && result.task_id && (\n                        <Tooltip title=\"Generate a report using this agent's output\" arrow>\n                          <Button\n                            size=\"small\"\n                            variant=\"outlined\"\n                            startIcon={<ReportIcon fontSize=\"small\" />}\n                            onClick={() => setGenerateDialogOpen(true)}\n                            sx={{ textTransform: 'none', mr: 0.5 }}\n                            data-testid=\"agent-generate-report-button\"\n                          >\n                            Generate Report\n                          </Button>\n                        </Tooltip>\n                      )}\n                      <SendToMenu\n                        outputType={OutputType.TEXT}\n                        payload={{\n                          title: `${selectedAgent.name} Result`,\n                          content: (() => { const o = result.result || result.output; return typeof o === 'string' ? o : JSON.stringify(o, null, 2) })(),\n                        }}\n                        sourceFeature={FeatureKey.AGENTS}\n                      />\n                      <IconButton size=\"small\" onClick={handleCopyResult} aria-label=\"Copy result\" data-testid=\"agent-copy-result-button\">\n                        <CopyIcon fontSize=\"small\" />\n                      </IconButton>\n                    </Box>\n                  </Box>\n\n                  {/* Structured result for Report Analyst (V2 uses result.result, V1 uses result.output) */}\n                  {(() => {\n                    const agentOutput = result.result || result.output\n                    if (selectedAgent.type === 'report_analyst' && agentOutput && typeof agentOutput === 'object') {\n                      return <ReportAnalystResult output={agentOutput} />\n                    }\n                    const displayContent = typeof agentOutput === 'string' ? agentOutput : JSON.stringify(agentOutput, null, 2)\n                    return (\n                      <Typography\n                        variant=\"body2\"\n                        component=\"pre\"\n                        sx={{\n                          whiteSpace: 'pre-wrap',\n                          fontFamily: 'monospace',\n                          bgcolor: alpha(theme.palette.background.default, 0.5),\n                          p: 2,\n                          borderRadius: 1,\n                          maxHeight: 400,\n                          overflow: 'auto',\n                        }}\n                      >\n                        {displayContent}\n                      </Typography>\n                    )\n                  })()}\n                </ResultCard>\n              )}\n            </>\n          )}\n        </MainPanel>\n\n        {/* History Sidebar */}\n        {showHistory && (\n          <Sidebar>\n            <Box sx={{ p: 2, borderBottom: `1px solid ${alpha(theme.palette.divider, 0.1)}` }}>\n              <Typography variant=\"subtitle1\" sx={{ fontWeight: 600 }}>\n                Task History\n              </Typography>\n            </Box>\n            <Box sx={{ flex: 1, overflow: 'auto' }}>\n              {tasks.length > 0 ? (\n                <List>\n                  {tasks.map((task) => {\n                    const taskId = task.id || task.task_id\n                    const isSelected = (result?.id || result?.task_id) === taskId\n                    return (\n                      <ListItem\n                        key={taskId}\n                        divider\n                        onClick={() => {\n                          const agentDef = AGENTS.find((a) => a.type === task.agent_type)\n                          if (agentDef) setSelectedAgent(agentDef)\n                          setResult(task)\n                          setTimeout(() => resultRef.current?.scrollIntoView({ behavior: 'smooth', block: 'start' }), 100)\n                        }}\n                        sx={{\n                          cursor: 'pointer',\n                          bgcolor: isSelected ? alpha(theme.palette.primary.main, 0.08) : 'transparent',\n                          borderLeft: isSelected ? `3px solid ${theme.palette.primary.main}` : '3px solid transparent',\n                          '&:hover': {\n                            bgcolor: alpha(theme.palette.primary.main, 0.04),\n                          },\n                          transition: 'all 0.15s cubic-bezier(0.22, 1, 0.36, 1)',\n                        }}\n                      >\n                        <ListItemText\n                          primary={task.agent_type?.replace(/_/g, ' ').replace(/\\b\\w/g, (l) => l.toUpperCase())}\n                          secondary={\n                            <>\n                              <Chip\n                                size=\"small\"\n                                label={task.status}\n                                color={task.status === 'completed' ? 'success' : task.status === 'failed' ? 'error' : 'default'}\n                                sx={{ mr: 1 }}\n                              />\n                              {new Date(task.created_at).toLocaleString()}\n                            </>\n                          }\n                        />\n                      </ListItem>\n                    )\n                  })}\n                </List>\n              ) : (\n                <Box sx={{ p: 3, textAlign: 'center' }}>\n                  <Typography color=\"text.secondary\">No tasks yet</Typography>\n                </Box>\n              )}\n            </Box>\n          </Sidebar>\n        )}\n      </ContentArea>\n\n      {error && (\n        <Alert severity=\"error\" sx={{ m: 2 }}>\n          {error}\n        </Alert>\n      )}\n\n      {/* Generate Report from Agent Dialog */}\n      <GenerateReportDialog\n        open={generateDialogOpen}\n        onClose={() => setGenerateDialogOpen(false)}\n        taskId={result?.task_id}\n        templates={templates}\n        connections={connections}\n        onGenerate={async (taskId, config) => {\n          const res = await generateReportFromTask(taskId, config)\n          if (res) {\n            toast.show(`Report generation started! Job ID: ${res.job_id || 'queued'}`, 'success')\n          }\n        }}\n      />\n    </PageContainer>\n  )\n}\n","import { useInteraction } from '@/components/ux/governance'\nimport AgentsPageContainer from '@/features/agents/containers/AgentsPageContainer'\n\nexport default function AgentsPage() {\n  useInteraction()\n  return <AgentsPageContainer />\n}\n"],"names":["DataIcon","createSvgIcon","_jsx","ContentIcon","asArray","payload","keys","key","runResearchAgent","topic","options","api","runDataAnalystAgent","question","data","runEmailDraftAgent","context","purpose","runContentRepurposeAgent","content","sourceFormat","targetFormats","runProofreadingAgent","text","getTask","taskId","listTasks","agentType","params","response","listAgentTypes","listRepurposeFormats","BASE_PATH","AgentError","code","message","retryable","details","ValidationError","field","TaskNotFoundError","TaskConflictError","handleApiError","error","status","detail","runReportAnalystAgent","runId","generateReportFromTask","config","cancelTask","reason","retryTask","getTaskEvents","limit","getStats","streamTaskProgress","onProgress","onComplete","onError","pollInterval","timeout","url","toApiUrl","eventSource","closed","event","e","taskIdentifier","task","useAgentStore","create","set","get","loading","agentsApi.runResearchAgent","state","err","agentsApi.runDataAnalystAgent","agentsApi.runEmailDraftAgent","agentsApi.runContentRepurposeAgent","agentsApi.runProofreadingAgent","agentsV2Api.runReportAnalystAgent","result","agentsV2Api.generateReportFromTask","tasks","agentsApi.listTasks","agentsApi.getTask","agentsApi.listAgentTypes","agentsApi.listRepurposeFormats","agentsV2Api.cancelTask","t","agentsV2Api.retryTask","agentsV2Api.getTaskEvents","agentsV2Api.getStats","onEvent","agentsV2Api.streamTaskProgress","PageContainer","styled","Box","theme","Header","alpha","ContentArea","MainPanel","Sidebar","AgentCard","Card","selected","neutral","ResultCard","Paper","ActionButton","Button","TrendIcon","trend","jsx","TrendUpIcon","TrendDownIcon","TrendFlatIcon","AnalysisSectionTitle","Typography","FindingCard","HighlightRow","ReportAnalystResult","output","summary","answer","key_findings","data_highlights","recommendations","comparison","analysis_type","jsxs","Stack","QAIcon","ReportIcon","InsightIcon","f","i","Chip","CompareIcon","item","CheckIcon","rec","GenerateReportDialog","open","onClose","templates","connections","onGenerate","templateId","setTemplateId","useState","connectionId","setConnectionId","startDate","setStartDate","endDate","setEndDate","submitting","setSubmitting","useEffect","today","monthAgo","handleSubmit","Dialog","DialogTitle","DialogContent","FormControl","InputLabel","Select","MenuItem","c","TextField","DialogActions","CircularProgress","AGENTS","ResearchIcon","EmailIcon","ProofreadIcon","ReportAnalystIcon","AgentsPageContainer","useTheme","toast","useToast","searchParams","setSearchParams","useSearchParams","execute","useInteraction","currentTask","agentTypes","repurposeFormats","executing","runResearch","runDataAnalysis","runEmailDraft","runContentRepurpose","runProofreading","runReportAnalyst","fetchTasks","fetchAgentTypes","fetchRepurposeFormats","reset","activeConnectionId","useSharedData","registerOutput","useCrossPageActions","FeatureKey","selectedConnectionId","setSelectedConnectionId","selectedAgent","setSelectedAgent","formData","setFormData","showHistory","setShowHistory","setResult","recentRuns","setRecentRuns","runsLoading","setRunsLoading","generateDialogOpen","setGenerateDialogOpen","resultRef","useRef","analyzeRunId","reportAnalystAgent","a","nextParams","clientApi.listReportRuns","runs","handleSelectAgent","useCallback","agent","handleFieldChange","fieldName","value","prev","handleRun","runAction","taskResult","dataSource","lines","delimiter","headers","h","line","values","v","trimmed","num","row","header","errMsg","taskOutput","outputText","OutputType","InteractionType","Reversibility","handleCopyResult","outputData","handleToggleHistory","isFormValid","AgentIcon","HistoryIcon","Grid","CardContent","Fragment","Divider","Alert","ConnectionSelector","analysisType","Autocomplete","option","name","date","dateStr","_","props","rest","period","opt","label","l","RunIcon","Tooltip","SendToMenu","o","IconButton","CopyIcon","agentOutput","displayContent","List","isSelected","ListItem","agentDef","ListItemText","res","AgentsPage"],"mappings":"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","x_google_ignoreList":[0,1]}