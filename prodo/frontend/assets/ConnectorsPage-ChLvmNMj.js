import{c as Re,j as e,e as _e,d as Ae,u as me,ce as Oe,r as t,R as j,I as g,B as r,T as i,v as I,k as D,w as L,p as y,t as ze,Z as Be,n as S,o as w,q as Le,a1 as Qe,ak as A,al as O,am as z,N as x,ao as B,s as h,as as re,aI as ae,aM as le,P as qe,J as m}from"./index-B8Eu23bA.js";import{T as Ne,a as ce}from"./Tabs-D_BhmpzR.js";import{C as Ce}from"./Cloud-BjXKCnvy.js";import{G as T}from"./Grid-5L9Rvqba.js";import{a as ie,C as He}from"./CardContent-xJVpuEbT.js";import{C as de}from"./CardActions-CJzuqktr.js";import{C as Me}from"./Code-C_kZAZjt.js";import"./KeyboardArrowRight-BOQXGjwe.js";const Fe=Re(e.jsx("path",{d:"M14 9v2h-3V9H8.5V7H11V1H4v6h2.5v2H4v6h2.5v2H4v6h7v-6H8.5v-2H11v-2h3v2h7V9z"})),$e=m(r)(({theme:n})=>({display:"flex",flexDirection:"column",height:"calc(100vh - 64px)",backgroundColor:n.palette.background.default})),Ve=m(r)(({theme:n})=>({padding:n.spacing(3),borderBottom:`1px solid ${y(n.palette.divider,.1)}`,backgroundColor:y(n.palette.background.paper,.8)})),Pe=m(r)(({theme:n})=>({flex:1,overflow:"auto",padding:n.spacing(3)})),ue=m(He)(({theme:n})=>({height:"100%",display:"flex",flexDirection:"column",transition:"all 0.2s ease","&:hover":{transform:"translateY(-4px)",boxShadow:`0 8px 30px ${y(n.palette.text.primary,.15)}`}})),Ue=m(r)(({theme:n})=>({width:48,height:48,borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:n.spacing(2)})),Ge=m(I)(({theme:n,status:a})=>({borderRadius:6,fontWeight:500,...a==="connected"&&{backgroundColor:n.palette.mode==="dark"?y(n.palette.text.primary,.1):D[400],color:n.palette.text.secondary},...a==="error"&&{backgroundColor:n.palette.mode==="dark"?y(n.palette.text.primary,.08):D[300],color:n.palette.text.secondary}})),xe=m(h)(({theme:n})=>({borderRadius:8,textTransform:"none",fontWeight:500})),he={database:{label:"Databases",icon:L,connectors:[{id:"postgresql",name:"PostgreSQL",color:"#336791"},{id:"mysql",name:"MySQL",color:"#4479A1"},{id:"mongodb",name:"MongoDB",color:"#47A248"},{id:"sqlserver",name:"SQL Server",color:"#CC2927"},{id:"bigquery",name:"BigQuery",color:"#4285F4"},{id:"snowflake",name:"Snowflake",color:"#29B5E8"}]},cloud_storage:{label:"Cloud Storage",icon:Ce,connectors:[{id:"google_drive",name:"Google Drive",color:"#4285F4"},{id:"dropbox",name:"Dropbox",color:"#0061FF"},{id:"s3",name:"Amazon S3",color:"#FF9900"},{id:"azure_blob",name:"Azure Blob",color:"#0089D6"},{id:"onedrive",name:"OneDrive",color:"#0078D4"}]}};function Ye(){const n=_e(),a=Ae(),{execute:u}=me(),{connectorTypes:Xe,connections:k,currentConnection:Je,schema:Q,queryResult:f,loading:pe,testing:q,querying:N,error:H,fetchConnectorTypes:M,fetchConnections:F,testConnection:$,createConnection:V,deleteConnection:P,checkHealth:U,fetchSchema:G,executeQuery:Y,reset:E}=Oe(),[X,be]=t.useState(0),[je,W]=t.useState(!1),[d,R]=t.useState(null),[C,J]=t.useState(""),[c,p]=t.useState({}),[ge,Z]=t.useState(!1),[v,K]=t.useState(""),[ye,ee]=t.useState(!1);t.useEffect(()=>(M(),F(),()=>E()),[M,F,E]);const l=t.useCallback((s,o,_={})=>u({type:g.EXECUTE,label:s,reversibility:j.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"connectors",..._},action:o}),[u]),fe=t.useCallback(s=>l("Open connector setup",()=>{R(s),J(""),p({}),W(!0)},{connectorId:s?.id}),[l]),se=t.useCallback(()=>l("Close connector setup",()=>W(!1)),[l]),ve=t.useCallback(()=>{if(d)return u({type:g.EXECUTE,label:"Test connection",reversibility:j.SYSTEM_MANAGED,intent:{source:"connectors",connectorId:d.id},action:async()=>{const s=await $(d.id,c);return s?.success?a.show("Connection successful!","success"):a.show(`Connection failed: ${s?.error||"Unknown error"}`,"error"),s}})},[c,u,d,$,a]),ke=t.useCallback(()=>{if(!(!d||!C))return u({type:g.CREATE,label:"Create connection",reversibility:j.SYSTEM_MANAGED,intent:{source:"connectors",connectorId:d.id,name:C},action:async()=>{const s=await V(d.id,C,c);return s&&(W(!1),R(null),a.show("Connection created successfully","success")),s}})},[c,C,V,u,d,a]),Ee=t.useCallback(s=>u({type:g.DELETE,label:"Delete connection",reversibility:j.SYSTEM_MANAGED,intent:{source:"connectors",connectionId:s},action:async()=>{const o=await P(s);return o&&a.show("Connection deleted","success"),o}}),[P,u,a]),Se=t.useCallback(s=>u({type:g.EXECUTE,label:"Check connection health",reversibility:j.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"connectors",connectionId:s},action:async()=>{const o=await U(s);return o?.success?a.show("Connection is healthy","success"):a.show(`Health check failed: ${o?.error}`,"error"),o}}),[U,u,a]),we=t.useCallback(s=>l("View schema",async()=>{await G(s),ee(!0)},{connectionId:s}),[l,G]),te=t.useCallback(()=>l("Close schema",()=>ee(!1)),[l]),Te=t.useCallback(s=>l("Open query runner",()=>{R(s),K(""),Z(!0)},{connectionId:s?.id}),[l]),ne=t.useCallback(()=>l("Close query runner",()=>Z(!1)),[l]),Ie=t.useCallback(()=>{if(!(!d||!v))return u({type:g.EXECUTE,label:"Execute query",reversibility:j.IRREVERSIBLE,requiresConfirmation:!1,blocksNavigation:!0,intent:{source:"connectors",connectionId:d.id},action:async()=>{const s=await Y(d.id,v);return s?.error?a.show(`Query error: ${s.error}`,"error"):a.show(`Query executed: ${s?.row_count||0} rows`,"success"),s}})},[u,Y,v,d,a]),oe=t.useCallback(s=>l("Switch connector tab",()=>be(s),{tab:s}),[l]),De=t.useCallback(()=>l("Dismiss connector error",()=>E()),[l,E]),We=Object.keys(he);return e.jsxs($e,{children:[e.jsxs(Ve,{children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(r,{children:[e.jsx(i,{variant:"h5",sx:{fontWeight:700},children:"Data Connectors"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:"Connect to databases and cloud storage services"})]}),e.jsx(I,{label:`${k.length} connections`,variant:"outlined",sx:{borderColor:n.palette.mode==="dark"?D[1e3]:D[1100],color:"text.secondary"}})]}),e.jsxs(Ne,{value:X,onChange:(s,o)=>oe(o),sx:{mt:2},children:[e.jsx(ce,{label:"Available Connectors"}),e.jsx(ce,{label:`My Connections (${k.length})`})]})]}),e.jsx(Pe,{children:X===0?e.jsx(r,{children:We.map(s=>{const o=he[s],_=o.icon;return e.jsxs(r,{sx:{mb:4},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(_,{color:"inherit",sx:{color:"text.secondary"}}),e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:o.label})]}),e.jsx(T,{container:!0,spacing:2,children:o.connectors.map(b=>e.jsx(T,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(ue,{variant:"outlined",children:[e.jsxs(ie,{children:[e.jsx(Ue,{sx:{bgcolor:y(b.color,.1)},children:s==="database"?e.jsx(L,{sx:{color:b.color}}):e.jsx(Ce,{sx:{color:b.color}})}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600},children:b.name}),e.jsx(i,{variant:"caption",color:"text.secondary",children:s==="database"?"Database":"Cloud Storage"})]}),e.jsx(de,{sx:{mt:"auto",p:2,pt:0},children:e.jsx(xe,{fullWidth:!0,variant:"outlined",size:"small",onClick:()=>fe(b),children:"Connect"})})]})},b.id))})]},s)})}):e.jsx(r,{children:k.length>0?e.jsx(T,{container:!0,spacing:2,children:k.map(s=>e.jsx(T,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(ue,{children:[e.jsxs(ie,{children:[e.jsxs(r,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[e.jsxs(r,{children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600},children:s.name}),e.jsx(i,{variant:"caption",color:"text.secondary",children:s.connector_type})]}),e.jsx(Ge,{size:"small",status:s.status,label:s.status,icon:s.status==="connected"?e.jsx(ze,{}):e.jsx(Be,{})})]}),s.latency_ms&&e.jsxs(i,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["Latency: ",s.latency_ms.toFixed(0),"ms"]})]}),e.jsxs(de,{sx:{p:2,pt:0,gap:1},children:[e.jsx(S,{title:"Test connection",children:e.jsx(w,{size:"small",onClick:()=>Se(s.id),children:e.jsx(Le,{})})}),e.jsx(S,{title:"View schema",children:e.jsx(w,{size:"small",onClick:()=>we(s.id),children:e.jsx(Fe,{})})}),e.jsx(S,{title:"Run query",children:e.jsx(w,{size:"small",onClick:()=>Te(s),children:e.jsx(Me,{})})}),e.jsx(r,{sx:{flex:1}}),e.jsx(S,{title:"Delete",children:e.jsx(w,{size:"small",sx:{color:"text.secondary"},onClick:()=>Ee(s.id),children:e.jsx(Qe,{})})})]})]})},s.id))}):e.jsxs(r,{sx:{textAlign:"center",py:8},children:[e.jsx(L,{sx:{fontSize:80,color:"text.disabled",mb:2}}),e.jsx(i,{variant:"h6",sx:{mb:1},children:"No connections yet"}),e.jsx(i,{color:"text.secondary",sx:{mb:3},children:"Connect to a database or cloud storage to get started."}),e.jsx(xe,{variant:"contained",onClick:()=>oe(0),children:"Browse Connectors"})]})})}),e.jsxs(A,{open:je,onClose:se,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(O,{children:["Connect to ",d?.name]}),e.jsxs(z,{children:[e.jsx(x,{fullWidth:!0,label:"Connection Name",value:C,onChange:s=>J(s.target.value),sx:{mt:2,mb:2}}),e.jsx(x,{fullWidth:!0,label:"Host",value:c.host||"",onChange:s=>p({...c,host:s.target.value}),sx:{mb:2}}),e.jsx(x,{fullWidth:!0,label:"Port",type:"number",value:c.port||"",onChange:s=>p({...c,port:parseInt(s.target.value)}),sx:{mb:2}}),e.jsx(x,{fullWidth:!0,label:"Database",value:c.database||"",onChange:s=>p({...c,database:s.target.value}),sx:{mb:2}}),e.jsx(x,{fullWidth:!0,label:"Username",value:c.username||"",onChange:s=>p({...c,username:s.target.value}),sx:{mb:2}}),e.jsx(x,{fullWidth:!0,label:"Password",type:"password",value:c.password||"",onChange:s=>p({...c,password:s.target.value})})]}),e.jsxs(B,{sx:{p:2},children:[e.jsx(h,{onClick:se,children:"Cancel"}),e.jsx(h,{variant:"outlined",onClick:ve,disabled:q,startIcon:q?e.jsx(re,{size:16}):e.jsx(ae,{}),children:"Test"}),e.jsx(h,{variant:"contained",onClick:ke,disabled:!C||pe,children:"Connect"})]})]}),e.jsxs(A,{open:ge,onClose:ne,maxWidth:"md",fullWidth:!0,children:[e.jsx(O,{children:"Run Query"}),e.jsxs(z,{children:[e.jsx(x,{fullWidth:!0,multiline:!0,rows:6,label:"SQL Query",value:v,onChange:s=>K(s.target.value),placeholder:"SELECT * FROM table_name LIMIT 100",sx:{mt:2}}),f&&e.jsxs(r,{sx:{mt:2},children:[e.jsxs(i,{variant:"subtitle2",sx:{mb:1},children:["Results (",f.row_count," rows, ",f.execution_time_ms?.toFixed(0),"ms)"]}),e.jsx(le,{variant:"outlined",sx:{p:2,maxHeight:300,overflow:"auto"},children:f.columns?.length>0?e.jsx(r,{component:"pre",sx:{fontSize:12,m:0},children:JSON.stringify(f.rows?.slice(0,10),null,2)}):e.jsx(i,{color:"text.secondary",children:"No results"})})]})]}),e.jsxs(B,{children:[e.jsx(h,{onClick:ne,children:"Close"}),e.jsx(h,{variant:"contained",onClick:Ie,disabled:!v||N,startIcon:N?e.jsx(re,{size:16}):e.jsx(ae,{}),children:"Execute"})]})]}),e.jsxs(A,{open:ye,onClose:te,maxWidth:"md",fullWidth:!0,children:[e.jsx(O,{children:"Database Schema"}),e.jsx(z,{children:Q?.tables?.length>0?e.jsx(r,{sx:{mt:2},children:Q.tables.map(s=>e.jsxs(le,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsxs(i,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:[s.name,s.row_count&&e.jsx(I,{size:"small",label:`${s.row_count} rows`,sx:{ml:1}})]}),e.jsx(r,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:s.columns?.map(o=>e.jsx(I,{size:"small",variant:"outlined",label:`${o.name}: ${o.data_type}`},o.name))})]},s.name))}):e.jsx(i,{color:"text.secondary",sx:{mt:2},children:"No schema information available"})}),e.jsx(B,{children:e.jsx(h,{onClick:te,children:"Close"})})]}),H&&e.jsx(qe,{severity:"error",onClose:De,sx:{position:"fixed",bottom:16,right:16,maxWidth:400},children:H})]})}function as(){return me(),e.jsx(Ye,{})}export{as as default};
