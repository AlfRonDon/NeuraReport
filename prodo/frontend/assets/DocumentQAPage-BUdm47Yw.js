import{g as me,j as t,i as v,bN as ut,B as r,u as Me,b$ as xt,f as n,k as mt,r as g,v as gt,a as We,ch as ht,o as p,n as c,bU as ne,a1 as re,aJ as O,b5 as ft,b6 as bt,af as yt,e as F,G as jt,T as L,D as kt,ag as vt,K as w,s as oe,bS as Ie,E as wt,A as Ct,cD as St,aj as ie,al as le,am as ce,ak as It,bP as Dt,bQ as Rt,aT as At,aU as $t,R as I,I as D,c6 as Et,N as x,p as Pe,a3 as Nt,cK as Tt,cL as zt,c1 as Lt,Q as _t,cM as Ft,ah as Mt}from"./index-CS2nn_Zr.js";import{u as Wt}from"./useSharedData-DgpbyG0s.js";import{u as Pt,I as Ot}from"./ImportFromMenu-BfilFZgX.js";import{T as De,F as Re}from"./useCrossPageActions-D9ut6hon.js";import{C as Bt}from"./ConnectionSelector-gPkx78kE.js";import{C as de}from"./ConfirmModal-DbnlUgfc.js";import{D as Qt}from"./DisabledTooltip-8cx7sKBB.js";import{A as qt}from"./AiUsageNotice-Bg2BoC2w.js";import{F as Ht}from"./Folder-CeiqL3nW.js";import{F as Ae}from"./InsertDriveFile-3QoKpQYG.js";import{C as Ut}from"./Clear-C_Rztneq.js";import{A as pe}from"./Article-hUc3iiWJ.js";import{P as Vt}from"./Person-CeY27xhP.js";import{F as Yt}from"./FormatQuote-BNsurOTC.js";import{C as Gt}from"./ContentCopy-BKVqIJGm.js";import{S as Kt}from"./Psychology-CUpVkmoQ.js";import"./SummarizeRounded-BzUuQV7q.js";import"./CheckCircleOutline-BB2cn-sY.js";import"./WarningAmber-xU07KL0O.js";const Jt=me(t.jsx("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"})),Xt=me(t.jsx("path",{d:"M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2m4 0v12h4V3z"})),Zt=me(t.jsx("path",{d:"M1 21h4V9H1zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73z"}));function es(e,i=[]){if(Array.isArray(e))return e;if(!e||typeof e!="object")return[];for(const a of i)if(Array.isArray(e[a]))return e[a];return[]}async function ts(e){return(await v.post("/docqa/sessions",{name:e})).data}async function ss({limit:e,offset:i}={}){const a={};e!=null&&(a.limit=e),i!=null&&(a.offset=i);const l=(await v.get("/docqa/sessions",{params:a})).data;if(Array.isArray(l))return{sessions:l,total:l.length};if(l&&typeof l=="object"){const u=es(l,["sessions","items","results"]);return{...l,sessions:u,total:l.total??u.length}}return{sessions:[],total:0}}async function as(e){return(await v.get(`/docqa/sessions/${e}`)).data}async function ns(e){return(await v.delete(`/docqa/sessions/${e}`)).data}async function rs(e,{name:i,content:a,pageCount:o}){return(await v.post(`/docqa/sessions/${e}/documents`,{name:i,content:a,page_count:o})).data}async function os(e,i){return(await v.delete(`/docqa/sessions/${e}/documents/${i}`)).data}async function is(e,{question:i,includeCitations:a=!0,maxResponseLength:o=2e3}){return(await v.post(`/docqa/sessions/${e}/ask`,{question:i,include_citations:a,max_response_length:o})).data}async function ls(e,i=50){return(await v.get(`/docqa/sessions/${e}/history`,{params:{limit:i}})).data}async function cs(e){return(await v.delete(`/docqa/sessions/${e}/history`)).data}async function ds(e,i,{feedbackType:a,comment:o}){return(await v.post(`/docqa/sessions/${e}/messages/${i}/feedback`,{feedback_type:a,comment:o})).data}async function ps(e,i,{includeCitations:a=!0,maxResponseLength:o=2e3}={}){return(await v.post(`/docqa/sessions/${e}/messages/${i}/regenerate`,{include_citations:a,max_response_length:o})).data}const us=ut((e,i)=>({sessions:[],currentSession:null,messages:[],loading:!1,asking:!1,error:null,setLoading:a=>e({loading:a}),setError:a=>e({error:a}),fetchSessions:async()=>{e({loading:!0,error:null});try{const a=await ss();e({sessions:a.sessions||[],loading:!1})}catch(a){e({error:a.message,loading:!1})}},createSession:async a=>{e({loading:!0,error:null});try{const l=(await ts(a)).session;return e(u=>({sessions:[...u.sessions,l].slice(0,100),currentSession:l,messages:[],loading:!1})),l}catch(o){return e({error:o.message,loading:!1}),null}},getSession:async a=>{e({loading:!0,error:null});try{const o=await as(a);let l=o.session?.messages||[];try{const u=await ls(a,50);Array.isArray(u?.messages)&&(l=u.messages)}catch{}return e({currentSession:o.session,messages:l,loading:!1}),o.session}catch(o){return e({error:o.message,loading:!1}),null}},deleteSession:async a=>{e({loading:!0,error:null});try{return await ns(a),e(o=>({sessions:o.sessions.filter(l=>l.id!==a),currentSession:o.currentSession?.id===a?null:o.currentSession,messages:o.currentSession?.id===a?[]:o.messages,loading:!1})),!0}catch(o){return e({error:o.message,loading:!1}),!1}},addDocument:async(a,o)=>{e({loading:!0,error:null});try{const l=await rs(a,o);return await i().getSession(a),e({loading:!1}),l.document}catch(l){return e({error:l.message,loading:!1}),null}},removeDocument:async(a,o)=>{e({loading:!0,error:null});try{return await os(a,o),await i().getSession(a),e({loading:!1}),!0}catch(l){return e({error:l.message,loading:!1}),!1}},askQuestion:async(a,o,l={})=>{const u={id:`temp-${Date.now()}`,role:"user",content:o,timestamp:new Date().toISOString(),citations:[]};e(m=>({messages:[...m.messages,u].slice(-500),asking:!0,error:null}));try{const m=await is(a,{question:o,...l});return e(f=>({messages:[...f.messages.filter(y=>y.id!==u.id),{...u,id:m.response?.message?.id||u.id},m.response?.message].filter(Boolean),asking:!1})),m.response}catch(m){return e(f=>({messages:f.messages.filter(y=>y.id!==u.id),error:m.message,asking:!1})),null}},clearHistory:async a=>{e({loading:!0,error:null});try{return await cs(a),e({messages:[],loading:!1}),!0}catch(o){return e({error:o.message,loading:!1}),!1}},submitFeedback:async(a,o,l,u=null)=>{try{const m=await ds(a,o,{feedbackType:l,comment:u});return e(f=>({messages:f.messages.map(y=>y.id===o?{...y,feedback:m.message?.feedback}:y)})),m.message}catch(m){return e({error:m.message}),null}},regenerateResponse:async(a,o,l={})=>{e({asking:!0,error:null});try{const u=await ps(a,o,l);return e(m=>({messages:m.messages.map(f=>f.id===o?u.response?.message:f),asking:!1})),u.response}catch(u){return e({error:u.message,asking:!1}),null}},reset:()=>e({currentSession:null,messages:[],error:null})})),xs=mt`
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
`;function k({variant:e="text",width:i,height:a,lines:o=1,animation:l="shimmer",sx:u=[],...m}){const f=Me(),y=Array.isArray(u)?u:[u],$={shimmer:{background:`linear-gradient(90deg,
        ${n(f.palette.text.primary,.06)} 25%,
        ${n(f.palette.text.primary,.12)} 50%,
        ${n(f.palette.text.primary,.06)} 75%)`,backgroundSize:"200% 100%",animation:`${xt} 1.5s infinite`},pulse:{bgcolor:n(f.palette.text.primary,.08),animation:`${xs} 1.5s infinite`},none:{bgcolor:n(f.palette.text.primary,.08)}}[l];return e==="text"?t.jsx(r,{sx:[{display:"flex",flexDirection:"column",gap:1},...y],...m,children:Array.from({length:o}).map((ge,C)=>t.jsx(r,{sx:{height:a||16,width:C===o-1&&o>1?"60%":i||"100%",borderRadius:1,...$}},C))}):e==="circular"?t.jsx(r,{sx:[{width:i||40,height:a||40,borderRadius:"50%",...$},...y],...m}):e==="rounded"?t.jsx(r,{sx:[{width:i||"100%",height:a||120,borderRadius:1,...$},...y],...m}):t.jsx(r,{sx:[{width:i||"100%",height:a||120,...$},...y],...m})}function ms({type:e="card",count:i=1}){const a=Array.from({length:i});return e==="card"?t.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:2},children:a.map((o,l)=>t.jsxs(r,{sx:{p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:["  ",t.jsxs(r,{sx:{display:"flex",gap:2,mb:2},children:[t.jsx(k,{variant:"circular",width:48,height:48}),t.jsxs(r,{sx:{flex:1},children:[t.jsx(k,{variant:"text",width:"60%",height:20}),t.jsx(k,{variant:"text",width:"40%",height:16,sx:{mt:1}})]})]}),t.jsx(k,{variant:"text",lines:3})]},l))}):e==="list"?t.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:a.map((o,l)=>t.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,py:1},children:[t.jsx(k,{variant:"circular",width:40,height:40}),t.jsxs(r,{sx:{flex:1},children:[t.jsx(k,{variant:"text",width:"70%"}),t.jsx(k,{variant:"text",width:"50%",height:14,sx:{mt:.5}})]})]},l))}):e==="table"?t.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:[t.jsx(k,{variant:"rectangular",height:48}),a.map((o,l)=>t.jsx(k,{variant:"rectangular",height:52},l))]}):e==="chat"?t.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:2},children:a.map((o,l)=>t.jsxs(r,{sx:{display:"flex",gap:2,alignSelf:l%2===0?"flex-start":"flex-end",maxWidth:"70%"},children:[l%2===0&&t.jsx(k,{variant:"circular",width:36,height:36}),t.jsx(k,{variant:"rounded",width:200+Math.random()*100,height:60+Math.random()*40}),l%2!==0&&t.jsx(k,{variant:"circular",width:36,height:36})]},l))}):t.jsx(k,{variant:"rectangular"})}const $e=x(r)(({theme:e})=>({display:"flex",height:"calc(100vh - 64px)",backgroundColor:"transparent",position:"relative",overflow:"hidden"})),gs=x(r)(({theme:e})=>({width:300,flexShrink:0,display:"flex",flexDirection:"column",background:n(e.palette.background.paper,.6),backdropFilter:"blur(20px)",borderRight:`1px solid ${n(e.palette.divider,.1)}`,position:"relative","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,height:200,background:`linear-gradient(180deg, ${n(e.palette.text.primary,.03)} 0%, transparent 100%)`,pointerEvents:"none"}})),hs=x(r)(({theme:e})=>({padding:e.spacing(3),position:"relative",zIndex:1})),fs=x(r)(({theme:e})=>({flex:1,overflow:"auto",padding:e.spacing(0,2,2),"&::-webkit-scrollbar":{width:6},"&::-webkit-scrollbar-track":{backgroundColor:"transparent"},"&::-webkit-scrollbar-thumb":{backgroundColor:n(e.palette.text.primary,.1),borderRadius:1,"&:hover":{backgroundColor:n(e.palette.text.primary,.2)}}})),bs=x(r,{shouldForwardProp:e=>e!=="selected"})(({theme:e,selected:i})=>({padding:e.spacing(1.5),borderRadius:8,cursor:"pointer",marginBottom:e.spacing(1),backgroundColor:i?e.palette.mode==="dark"?n(e.palette.text.primary,.1):c[100]:n(e.palette.background.paper,.4),border:`1px solid ${i?n(e.palette.divider,.3):"transparent"}`,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)",position:"relative",overflow:"hidden","&:hover":{backgroundColor:i?e.palette.mode==="dark"?n(e.palette.text.primary,.12):c[200]:e.palette.mode==="dark"?n(e.palette.text.primary,.05):c[50],transform:"translateX(4px)"},"&::before":i?{content:'""',position:"absolute",left:0,top:"50%",transform:"translateY(-50%)",width:3,height:"60%",background:e.palette.mode==="dark"?c[500]:c[900],borderRadius:"0 4px 4px 0"}:{}})),ys=x(Pe)(({theme:e})=>({height:24,fontSize:12,backgroundColor:e.palette.mode==="dark"?n(e.palette.text.primary,.08):c[100],color:e.palette.text.secondary,border:`1px solid ${n(e.palette.divider,.2)}`,"& .MuiChip-icon":{fontSize:14}})),js=x(r)(({theme:e})=>({flex:1,display:"flex",flexDirection:"column",backgroundColor:"transparent",position:"relative"})),ks=x(r)(({theme:e})=>({padding:e.spacing(2,3),display:"flex",alignItems:"center",justifyContent:"space-between",background:n(e.palette.background.paper,.4),backdropFilter:"blur(10px)",borderBottom:`1px solid ${n(e.palette.divider,.1)}`})),vs=x(r)(({theme:e})=>({flex:1,overflow:"auto",padding:e.spacing(3),display:"flex",flexDirection:"column",gap:e.spacing(2),"&::-webkit-scrollbar":{width:8},"&::-webkit-scrollbar-track":{backgroundColor:"transparent"},"&::-webkit-scrollbar-thumb":{backgroundColor:n(e.palette.text.primary,.1),borderRadius:4,"&:hover":{backgroundColor:n(e.palette.text.primary,.2)}}})),Ee=x(r,{shouldForwardProp:e=>!["isUser","index"].includes(e)})(({theme:e,isUser:i,index:a})=>({maxWidth:"75%",alignSelf:i?"flex-end":"flex-start",animation:`${i?Tt:zt} 0.4s ease-out`,animationDelay:`${a*.05}s`,animationFillMode:"both"})),Ne=x(r,{shouldForwardProp:e=>e!=="isUser"})(({theme:e,isUser:i})=>({padding:e.spacing(2,2.5),borderRadius:i?"20px 20px 4px 20px":"20px 20px 20px 4px",backgroundColor:i?e.palette.mode==="dark"?c[700]:c[900]:n(e.palette.background.paper,.8),color:i?e.palette.common.white:e.palette.text.primary,backdropFilter:i?"none":"blur(10px)",border:i?"none":`1px solid ${n(e.palette.divider,.1)}`,position:"relative",boxShadow:i?`0 4px 20px ${n(e.palette.common.black,.2)}`:`0 4px 20px ${n(e.palette.common.black,.05)}`})),Te=x(Lt,{shouldForwardProp:e=>e!=="isUser"})(({theme:e,isUser:i})=>({width:36,height:36,background:i?e.palette.mode==="dark"?c[700]:c[900]:e.palette.mode==="dark"?n(e.palette.text.primary,.1):c[100],border:`2px solid ${n(e.palette.background.paper,.8)}`,boxShadow:`0 2px 10px ${n(e.palette.common.black,.1)}`,"& svg":{fontSize:18,color:i?e.palette.common.white:e.palette.text.secondary}})),ws=x(r)(({theme:e})=>({marginTop:e.spacing(2),padding:e.spacing(1.5),backgroundColor:e.palette.mode==="dark"?n(e.palette.text.primary,.04):c[50],borderRadius:8,border:`1px solid ${n(e.palette.divider,.1)}`})),Cs=x(r)(({theme:e})=>({display:"flex",alignItems:"flex-start",gap:e.spacing(1),padding:e.spacing(1),borderRadius:8,backgroundColor:n(e.palette.background.paper,.5),marginTop:e.spacing(1),cursor:"pointer",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{backgroundColor:e.palette.mode==="dark"?n(e.palette.text.primary,.05):c[50]}})),Ss=x(Pe)(({theme:e})=>({borderRadius:20,backgroundColor:e.palette.mode==="dark"?n(e.palette.text.primary,.08):c[100],border:`1px solid ${n(e.palette.divider,.2)}`,color:e.palette.text.primary,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{backgroundColor:e.palette.mode==="dark"?n(e.palette.text.primary,.12):c[200],transform:"translateY(-2px)",boxShadow:`0 4px 12px ${n(e.palette.common.black,.1)}`}})),Is=x(r)(({theme:e})=>({padding:e.spacing(2,3,3),background:`linear-gradient(180deg, transparent 0%, ${n(e.palette.background.paper,.6)} 30%)`,backdropFilter:"blur(10px)"})),Ds=x(r)(({theme:e})=>({display:"flex",alignItems:"flex-end",gap:e.spacing(1.5),padding:e.spacing(1.5),backgroundColor:n(e.palette.background.paper,.8),borderRadius:24,border:`1px solid ${n(e.palette.divider,.15)}`,boxShadow:`0 4px 20px ${n(e.palette.common.black,.05)}`,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:focus-within":{borderColor:n(e.palette.divider,.4),boxShadow:`0 4px 30px ${n(e.palette.common.black,.08)}`}})),Rs=x(O)(({theme:e})=>({"& .MuiOutlinedInput-root":{backgroundColor:"transparent",fontSize:16,"& fieldset":{border:"none"}},"& .MuiInputBase-input":{padding:e.spacing(1,0),"&::placeholder":{color:n(e.palette.text.secondary,.6)}}})),As=x(F)(({theme:e})=>({width:44,height:44,background:e.palette.mode==="dark"?c[700]:c[900],color:e.palette.common.white,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{transform:"scale(1.05)",background:e.palette.mode==="dark"?c[500]:c[700],boxShadow:`0 4px 20px ${n(e.palette.common.black,.2)}`},"&:disabled":{background:n(e.palette.text.primary,.1),color:n(e.palette.text.primary,.3)}})),$s=x(r)(({theme:e})=>({display:"flex",alignItems:"center",gap:6,padding:e.spacing(2),"& span":{width:8,height:8,borderRadius:"50%",backgroundColor:e.palette.text.secondary,animation:`${Ft} 1.4s infinite ease-in-out`,"&:nth-of-type(1)":{animationDelay:"0s"},"&:nth-of-type(2)":{animationDelay:"0.2s"},"&:nth-of-type(3)":{animationDelay:"0.4s"}}})),Es=x(r)(({theme:e})=>({display:"flex",alignItems:"center",gap:e.spacing(1.5),padding:e.spacing(1.5,2),backgroundColor:e.palette.mode==="dark"?n(e.palette.text.primary,.08):c[100],borderRadius:8,marginBottom:e.spacing(1),animation:`${_t} 2s infinite ease-in-out`})),ze=x(r)(({theme:e})=>({flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:e.spacing(4),textAlign:"center"})),Le=x(r)(({theme:e})=>({width:120,height:120,borderRadius:"50%",background:e.palette.mode==="dark"?n(e.palette.text.primary,.08):c[100],display:"flex",alignItems:"center",justifyContent:"center",marginBottom:e.spacing(3),animation:`${Nt} 3s infinite ease-in-out`,"& svg":{fontSize:56,color:e.palette.text.secondary}})),Ns=x(r)(({theme:e})=>({padding:e.spacing(2),borderRadius:8,backgroundColor:n(e.palette.background.paper,.6),border:`1px solid ${n(e.palette.divider,.1)}`,cursor:"pointer",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{backgroundColor:e.palette.mode==="dark"?n(e.palette.text.primary,.05):c[50],borderColor:n(e.palette.divider,.2),transform:"translateY(-2px)"}})),V=x(F)(({theme:e})=>({width:28,height:28,color:n(e.palette.text.secondary,.6),"&:hover":{color:e.palette.text.primary,backgroundColor:e.palette.mode==="dark"?n(e.palette.text.primary,.08):c[100]}})),_e=x(w)(({theme:e})=>({borderRadius:8,padding:e.spacing(1.5,2),background:e.palette.mode==="dark"?c[700]:c[900],color:e.palette.common.white,fontWeight:600,textTransform:"none",boxShadow:`0 4px 20px ${n(e.palette.common.black,.15)}`,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{transform:"translateY(-2px)",background:e.palette.mode==="dark"?c[500]:c[700],boxShadow:`0 6px 28px ${n(e.palette.common.black,.2)}`}})),Ts=x(r)(({theme:e})=>({padding:e.spacing(2),borderTop:`1px solid ${n(e.palette.divider,.1)}`,backgroundColor:n(e.palette.background.paper,.3)})),zs=x(r)(({theme:e})=>({position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:n(e.palette.background.default,.8),backdropFilter:"blur(8px)",zIndex:10})),Ls=x(r)(({theme:e})=>({width:48,height:48,borderRadius:"50%",background:`conic-gradient(from 0deg, transparent, ${e.palette.text.secondary})`,animation:"spin 1s linear infinite","@keyframes spin":{to:{transform:"rotate(360deg)"}},"&::before":{content:'""',position:"absolute",inset:4,borderRadius:"50%",backgroundColor:e.palette.background.paper}})),ue=x(Mt)(({theme:e})=>({"& .MuiDialog-paper":{backgroundColor:n(e.palette.background.paper,.9),backdropFilter:"blur(20px)",borderRadius:8,border:`1px solid ${n(e.palette.divider,.1)}`}})),xe=5*1024*1024,Fe=10,R=200,_=3,A=2e3;function _s(){const e=Me(),{sessions:i,currentSession:a,messages:o,loading:l,asking:u,error:m,fetchSessions:f,createSession:y,getSession:$,deleteSession:ge,addDocument:C,removeDocument:Oe,askQuestion:Be,clearHistory:Qe,submitFeedback:qe,regenerateResponse:He,reset:Y}=us(),{connections:B,templates:he}=Wt();Pt(Re.DOCQA,{[De.CHAT_WITH]:async s=>{const d=await y(s.title?`Q&A: ${s.title}`:"Q&A: Imported");d&&await C(d.id,{name:s.title||"Imported Document",content:typeof s.content=="string"?s.content:JSON.stringify(s.content)})},[De.ADD_TO]:async s=>{a&&await C(a.id,{name:s.title||"Imported Document",content:typeof s.content=="string"?s.content:JSON.stringify(s.content)})}});const[Ue,M]=g.useState(!1),[Ve,E]=g.useState(!1),[Ye,Q]=g.useState(!1),[fe,Ge]=g.useState([]),[Ke,be]=g.useState(!1),[N,ye]=g.useState(""),[T,G]=g.useState(""),[z,K]=g.useState(""),[j,q]=g.useState(""),je=g.useRef(null),[H,J]=g.useState({open:!1,sessionId:null,sessionName:""}),[U,X]=g.useState({open:!1,docId:null,docName:""}),[W,Z]=g.useState({open:!1,sessionId:null,sessionName:"",messageCount:0}),[ee,Je]=g.useState(""),[Xe,Ze]=g.useState(""),h=gt(),[et,ke]=g.useState(!0),tt=g.useRef(null),ve=a?.documents?.length||0,{execute:S}=We();ht("DELETE_SESSION"),g.useEffect(()=>((async()=>(ke(!0),await f(),ke(!1)))(),()=>Y()),[f,Y]),g.useEffect(()=>{je.current?.scrollIntoView({behavior:"smooth"})},[o]);const st=()=>{if(N){if(N.length>R){h.show(`Session name must be ${R} characters or less`,"error");return}S({type:D.CREATE,label:`Create session "${N}"`,reversibility:I.FULLY_REVERSIBLE,successMessage:"Session created successfully",action:async()=>{await y(N),M(!1),ye("")}})}},at=()=>{if(!(!a||!T||!z)){if(T.length>R){h.show(`Document name must be ${R} characters or less`,"error");return}if(z.trim().length<Fe){h.show(`Document content must be at least ${Fe} characters`,"error");return}if(z.length>xe){h.show("Document content exceeds 5MB limit","error");return}S({type:D.UPLOAD,label:`Add document "${T}"`,reversibility:I.FULLY_REVERSIBLE,successMessage:"Document added successfully",action:async()=>{await C(a.id,{name:T,content:z}),E(!1),G(""),K("")}})}},nt=s=>{const d=s.target.files[0];if(!d)return;if(d.name.length>R){h.show(`File name must be ${R} characters or less`,"error"),s.target.value="";return}const b=[".txt",".md",".json",".csv"],P=d.name.toLowerCase();if(!b.some(ae=>P.endsWith(ae))){h.show(`Invalid file type. Supported formats: ${b.join(", ")}`,"error"),s.target.value="";return}if(d.size>xe){h.show("File size exceeds 5MB limit","error"),s.target.value="";return}const se=new FileReader;se.onload=ae=>{const Se=ae.target.result;if(Se.includes("\0")){h.show("File appears to be binary. Please upload a text file.","error"),s.target.value="";return}G(d.name),K(Se)},se.onerror=()=>{h.show("Failed to read file","error"),s.target.value=""},se.readAsText(d)},rt=async()=>{Q(!0),be(!0);try{const s=await Et({limit:50});Ge(s.filter(d=>d.status==="succeeded"))}catch{h.show("Failed to load reports","error")}finally{be(!1)}},ot=s=>{a&&S({type:D.UPLOAD,label:`Add report "${s.templateName}"`,reversibility:I.FULLY_REVERSIBLE,successMessage:`Report "${s.templateName}" added`,action:async()=>{await C(a.id,{name:`${s.templateName} (${s.startDate} – ${s.endDate})`,content:[`Report: ${s.templateName}`,`Period: ${s.startDate} to ${s.endDate}`,`Connection: ${s.connectionName}`,`Generated: ${new Date(s.createdAt).toLocaleString()}`,`Status: ${s.status}`,s.artifacts?.html_url?`HTML: ${s.artifacts.html_url}`:"",s.artifacts?.pdf_url?`PDF: ${s.artifacts.pdf_url}`:""].filter(Boolean).join(`
`)}),Q(!1)}})},we=()=>{if(!a||!j.trim())return;const s=j.trim();if(s.length<_){h.show(`Question must be at least ${_} characters`,"error");return}if(s.length>A){h.show(`Question must be ${A} characters or less`,"error");return}const d=s;S({type:D.ANALYZE,label:"Analyzing documents...",reversibility:I.SYSTEM_MANAGED,blocksNavigation:!0,action:async()=>{q(""),await Be(a.id,d)}})},it=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),we())},lt=s=>{navigator.clipboard.writeText(s),h.show("Copied to clipboard","success")},ct=g.useCallback(async s=>{const d=s?.quote||s?.document_name;if(d){if(!navigator?.clipboard?.writeText){h.show("Clipboard not available","warning");return}try{await navigator.clipboard.writeText(d),h.show("Citation copied","success")}catch(b){h.show(b.message||"Failed to copy citation","error")}}},[h]),Ce=async(s,d)=>{if(!a)return;await qe(a.id,s,d)&&h.show(d==="helpful"?"Thanks for the feedback!":"Thanks for letting us know","success")},dt=s=>{a&&S({type:D.GENERATE,label:"Regenerating response...",reversibility:I.SYSTEM_MANAGED,successMessage:"Response regenerated",errorMessage:"Failed to regenerate response",blocksNavigation:!0,action:async()=>{if(!await He(a.id,s))throw new Error("Regenerate failed")}})},te=i.filter(s=>s.name.toLowerCase().includes(ee.toLowerCase())),pt=["What are the main topics covered in these documents?","Can you summarize the key findings?","What are the most important insights?","Are there any conflicting information?"];return et?t.jsx($e,{children:t.jsx(zs,{children:t.jsxs(r,{sx:{textAlign:"center"},children:[t.jsx(r,{sx:{position:"relative",width:48,height:48,mx:"auto",mb:2},children:t.jsx(Ls,{})}),t.jsx(p,{variant:"body2",color:"text.secondary",children:"Loading your sessions..."})]})})}):t.jsxs($e,{children:[t.jsxs(gs,{children:[t.jsxs(hs,{children:[t.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:2},children:[t.jsx(r,{sx:{width:40,height:40,borderRadius:1,background:e.palette.mode==="dark"?c[700]:c[900],display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(ne,{sx:{color:"common.white",fontSize:24}})}),t.jsxs(r,{children:[t.jsx(p,{variant:"h6",sx:{fontWeight:600,lineHeight:1.2},children:"Document Q&A"}),t.jsx(p,{variant:"caption",color:"text.secondary",children:"AI-powered analysis"})]})]}),t.jsx(_e,{fullWidth:!0,startIcon:t.jsx(re,{}),onClick:()=>M(!0),children:"New Session"}),t.jsx(O,{fullWidth:!0,size:"small",placeholder:"Search sessions...",value:ee,onChange:s=>Je(s.target.value),sx:{mt:2},InputProps:{startAdornment:t.jsx(ft,{position:"start",children:t.jsx(bt,{sx:{fontSize:18,color:"text.secondary"}})}),sx:{borderRadius:1,backgroundColor:n(e.palette.background.paper,.5),"& fieldset":{borderColor:n(e.palette.divider,.1)}}}})]}),t.jsxs(fs,{children:[t.jsxs(p,{variant:"overline",sx:{color:"text.secondary",px:1,display:"block",mb:1},children:["Sessions (",te.length,")"]}),te.length===0?t.jsxs(r,{sx:{textAlign:"center",py:4},children:[t.jsx(Ht,{sx:{fontSize:40,color:"text.disabled",mb:1}}),t.jsx(p,{variant:"body2",color:"text.secondary",children:ee?"No matching sessions":"No sessions yet"})]}):te.map((s,d)=>t.jsx(yt,{in:!0,style:{transitionDelay:`${d*50}ms`},children:t.jsx(bs,{selected:a?.id===s.id,onClick:()=>$(s.id),children:t.jsxs(r,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[t.jsxs(r,{sx:{flex:1,minWidth:0,pl:1},children:[t.jsx(p,{variant:"subtitle2",sx:{fontWeight:a?.id===s.id?600:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.name}),t.jsx(r,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:t.jsx(ys,{size:"small",icon:t.jsx(Ae,{}),label:`${s.documents?.length||0} docs`})})]}),t.jsx(F,{size:"small",onClick:b=>{b.stopPropagation(),J({open:!0,sessionId:s.id,sessionName:s.name})},sx:{opacity:.5,"&:hover":{opacity:1,color:"text.primary"}},children:t.jsx(jt,{fontSize:"small"})})]})})},s.id))]}),a&&t.jsxs(Ts,{children:[t.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[t.jsx(p,{variant:"overline",sx:{color:"text.secondary"},children:"Documents"}),t.jsxs(r,{sx:{display:"flex",gap:.5},children:[t.jsx(Ot,{currentFeature:Re.DOCQA,onImport:s=>{a&&C(a.id,{name:s.title||"Imported",content:typeof s.data=="string"?s.data:JSON.stringify(s.data)})},size:"small"}),t.jsx(L,{title:"Add document",children:t.jsx(F,{size:"small",onClick:()=>E(!0),"aria-label":"Add document",sx:{bgcolor:e.palette.mode==="dark"?n(e.palette.text.primary,.08):c[100],"&:hover":{bgcolor:e.palette.mode==="dark"?n(e.palette.text.primary,.12):c[200]}},children:t.jsx(re,{fontSize:"small"})})})]})]}),t.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[a.documents?.map(s=>t.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,p:1,borderRadius:1.5,bgcolor:n(e.palette.background.paper,.5),"&:hover":{bgcolor:e.palette.mode==="dark"?n(e.palette.text.primary,.05):c[50]}},children:[t.jsx(kt,{sx:{fontSize:18,color:"text.secondary"}}),t.jsx(p,{variant:"caption",sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.name}),t.jsx(F,{size:"small",onClick:()=>X({open:!0,docId:s.id,docName:s.name}),sx:{opacity:.5,"&:hover":{opacity:1,color:"text.primary"}},children:t.jsx(vt,{sx:{fontSize:14}})})]},s.id)),(!a.documents||a.documents.length===0)&&t.jsx(p,{variant:"caption",color:"text.secondary",sx:{textAlign:"center",py:2},children:"No documents added yet"})]})]}),t.jsx(r,{sx:{p:2,borderTop:`1px solid ${n(e.palette.divider,.1)}`},children:t.jsx(Bt,{value:Xe,onChange:Ze,label:"Enrich with Database (Optional)",size:"small",showStatus:!0,fullWidth:!0})})]}),t.jsx(js,{children:a?t.jsxs(t.Fragment,{children:[t.jsxs(ks,{children:[t.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[t.jsx(r,{sx:{width:36,height:36,borderRadius:1,bgcolor:e.palette.mode==="dark"?n(e.palette.text.primary,.08):c[100],display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(ne,{sx:{color:"text.secondary",fontSize:20}})}),t.jsxs(r,{children:[t.jsx(p,{variant:"subtitle1",sx:{fontWeight:600},children:a.name}),t.jsxs(p,{variant:"caption",color:"text.secondary",children:[a.documents?.length||0," documents •"," ",o.length," messages •"," ",B.length," connections available"]})]})]}),o.length>0&&t.jsx(w,{size:"small",startIcon:t.jsx(Ut,{}),onClick:()=>Z({open:!0,sessionId:a.id,sessionName:a.name,messageCount:o.length}),sx:{borderRadius:1,textTransform:"none",color:"text.secondary"},children:"Clear Chat"})]}),t.jsx(r,{sx:{px:3,pt:2},children:t.jsx(qt,{title:"AI answers",description:"Responses are generated from documents in this session. Review citations before sharing.",chips:[{label:`Source: ${ve} document${ve===1?"":"s"}`,color:"info",variant:"outlined"},{label:"Confidence: Verify citations",color:"warning",variant:"outlined"},{label:"Reversible: No source changes",color:"success",variant:"outlined"}],dense:!0})}),t.jsxs(vs,{children:[o.length===0?t.jsxs(ze,{children:[t.jsx(Le,{children:t.jsx(oe,{})}),t.jsx(p,{variant:"h5",sx:{fontWeight:600,mb:1},children:a.documents?.length>0?"Ready to answer your questions":"Add documents to get started"}),t.jsx(p,{color:"text.secondary",sx:{mb:4,maxWidth:400},children:a.documents?.length>0?"Ask anything about your documents. I'll analyze them and provide accurate answers with citations.":"Upload documents to this session, then ask questions about their content."}),a.documents?.length>0&&t.jsx(r,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,maxWidth:600},children:pt.map((s,d)=>t.jsx(Ns,{onClick:()=>q(s),children:t.jsx(p,{variant:"body2",sx:{fontWeight:500},children:s})},d))}),!a.documents?.length&&t.jsxs(r,{sx:{display:"flex",gap:2},children:[t.jsx(w,{variant:"outlined",startIcon:t.jsx(Ie,{}),onClick:()=>E(!0),sx:{borderRadius:1,textTransform:"none",px:4,py:1.5},children:"Upload Document"}),t.jsx(w,{variant:"contained",startIcon:t.jsx(pe,{}),onClick:rt,sx:{borderRadius:1,textTransform:"none",px:4,py:1.5,background:e.palette.mode==="dark"?c[700]:c[900]},children:"Select Existing Report"})]}),B.length>0&&t.jsx(r,{sx:{mt:3,textAlign:"center"},children:t.jsxs(p,{variant:"caption",color:"text.secondary",children:[B.length," database connection",B.length!==1?"s":""," and ",he.length," template",he.length!==1?"s":""," available"]})})]}):t.jsxs(t.Fragment,{children:[o.map((s,d)=>t.jsx(Ee,{isUser:s.role==="user",index:d,children:t.jsxs(r,{sx:{display:"flex",gap:1.5,flexDirection:s.role==="user"?"row-reverse":"row",alignItems:"flex-start"},children:[t.jsx(Te,{isUser:s.role==="user",children:s.role==="user"?t.jsx(Vt,{}):t.jsx(oe,{})}),t.jsxs(r,{sx:{flex:1},children:[t.jsx(Ne,{isUser:s.role==="user",children:t.jsx(p,{variant:"body2",sx:{whiteSpace:"pre-wrap",lineHeight:1.6},children:s.content})}),s.citations?.length>0&&t.jsxs(ws,{children:[t.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[t.jsx(Yt,{sx:{fontSize:16,color:"text.secondary"}}),t.jsxs(p,{variant:"caption",sx:{fontWeight:600,color:"text.secondary"},children:["Sources (",s.citations.length,")"]})]}),s.citations.map((b,P)=>t.jsxs(Cs,{onClick:()=>ct(b),children:[t.jsx(Ae,{sx:{fontSize:16,color:"text.secondary",mt:.25}}),t.jsxs(r,{children:[t.jsx(p,{variant:"caption",sx:{fontWeight:600,display:"block"},children:b.document_name}),t.jsxs(p,{variant:"caption",color:"text.secondary",sx:{fontStyle:"italic"},children:['"',b.quote?.substring(0,120),'..."']})]})]},P))]}),s.metadata?.follow_up_questions?.length>0&&t.jsxs(r,{sx:{mt:2},children:[t.jsx(p,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"Related questions"}),t.jsx(r,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:s.metadata.follow_up_questions.map((b,P)=>t.jsx(Ss,{label:b,size:"small",clickable:!0,onClick:()=>q(b)},P))})]}),s.role==="assistant"&&t.jsxs(r,{sx:{display:"flex",gap:.5,mt:1.5},children:[t.jsx(L,{title:"Copy",children:t.jsx(V,{size:"small",onClick:()=>lt(s.content),children:t.jsx(Gt,{sx:{fontSize:16}})})}),t.jsx(L,{title:s.feedback?.feedback_type==="helpful"?"Marked as helpful":"Helpful",children:t.jsx(V,{size:"small",onClick:()=>Ce(s.id,"helpful"),sx:{color:s.feedback?.feedback_type==="helpful"?"text.primary":void 0,bgcolor:s.feedback?.feedback_type==="helpful"?e.palette.mode==="dark"?n(e.palette.text.primary,.1):c[100]:void 0},children:t.jsx(Zt,{sx:{fontSize:16}})})}),t.jsx(L,{title:s.feedback?.feedback_type==="not_helpful"?"Marked as not helpful":"Not helpful",children:t.jsx(V,{size:"small",onClick:()=>Ce(s.id,"not_helpful"),sx:{color:s.feedback?.feedback_type==="not_helpful"?"text.primary":void 0,bgcolor:s.feedback?.feedback_type==="not_helpful"?e.palette.mode==="dark"?n(e.palette.text.primary,.1):c[100]:void 0},children:t.jsx(Xt,{sx:{fontSize:16}})})}),t.jsx(L,{title:"Regenerate response",children:t.jsx(V,{size:"small",onClick:()=>dt(s.id),disabled:u,children:t.jsx(wt,{sx:{fontSize:16}})})})]})]})]})},d)),u&&t.jsx(Ee,{isUser:!1,index:o.length,children:t.jsxs(r,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[t.jsx(Te,{isUser:!1,children:t.jsx(oe,{})}),t.jsxs(r,{children:[t.jsxs(Es,{children:[t.jsx(Kt,{sx:{fontSize:18,color:"text.secondary"}}),t.jsx(p,{variant:"caption",sx:{fontWeight:500},children:"Analyzing documents..."})]}),t.jsx(Ne,{isUser:!1,children:t.jsxs($s,{children:[t.jsx("span",{}),t.jsx("span",{}),t.jsx("span",{})]})})]})]})})]}),t.jsx("div",{ref:je})]}),t.jsxs(Is,{children:[m&&t.jsx(Ct,{severity:"error",onClose:()=>Y(),sx:{mb:2,borderRadius:1},children:m}),t.jsxs(Ds,{children:[t.jsx(L,{title:"Attach file",children:t.jsx(F,{size:"small",onClick:()=>E(!0),sx:{color:"text.secondary"},children:t.jsx(Jt,{})})}),t.jsx(Rs,{ref:tt,fullWidth:!0,placeholder:a.documents?.length?"Ask a question about your documents...":"Add documents to start asking questions...",value:j,onChange:s=>q(s.target.value),onKeyDown:it,disabled:u||!a.documents?.length,multiline:!0,maxRows:4,inputProps:{maxLength:A}}),t.jsx(Qt,{disabled:!j.trim()||j.trim().length<_||j.trim().length>A||u||!a.documents?.length,reason:u?"Please wait for the current question to complete":a.documents?.length?j.trim()?j.trim().length<_?`Question must be at least ${_} characters`:j.trim().length>A?`Question exceeds ${A} character limit`:void 0:"Enter a question to ask":"Add at least one document first",hint:a.documents?.length?j.trim()?void 0:"Type your question in the field above":"Click the attach button or drag a file",children:t.jsx(As,{onClick:we,disabled:!j.trim()||j.trim().length<_||j.trim().length>A||u||!a.documents?.length,children:u?t.jsx(r,{sx:{width:20,height:20,border:"2px solid",borderColor:"rgba(255,255,255,0.3)",borderTopColor:"common.white",borderRadius:"50%",animation:"spin 0.8s linear infinite"}}):t.jsx(St,{})})})]})]})]}):t.jsxs(ze,{children:[t.jsx(Le,{children:t.jsx(ne,{})}),t.jsx(p,{variant:"h5",sx:{fontWeight:600,mb:1},children:"Document Intelligence"}),t.jsx(p,{color:"text.secondary",sx:{mb:4,maxWidth:450},children:"Create a session, upload your documents, and start asking questions. Our AI will analyze and provide accurate answers with citations."}),t.jsx(_e,{startIcon:t.jsx(re,{}),onClick:()=>M(!0),sx:{px:4,py:1.5},children:"Create Your First Session"})]})}),t.jsxs(ue,{open:Ue,onClose:()=>M(!1),maxWidth:"xs",fullWidth:!0,children:[t.jsxs(ie,{sx:{pb:1},children:[t.jsx(p,{variant:"h6",sx:{fontWeight:600},children:"Create Q&A Session"}),t.jsx(p,{variant:"body2",color:"text.secondary",children:"Start a new document analysis workspace"})]}),t.jsx(le,{children:t.jsx(O,{fullWidth:!0,label:"Session Name",placeholder:"e.g., Research Papers Analysis",value:N,onChange:s=>ye(s.target.value),sx:{mt:2},inputProps:{maxLength:R},InputProps:{sx:{borderRadius:1}}})}),t.jsxs(ce,{sx:{px:3,pb:3},children:[t.jsx(w,{onClick:()=>M(!1),sx:{borderRadius:1,textTransform:"none"},children:"Cancel"}),t.jsx(w,{variant:"contained",onClick:st,disabled:!N,sx:{borderRadius:1,textTransform:"none",px:3,background:e.palette.mode==="dark"?c[700]:c[900]},children:"Create Session"})]})]}),t.jsxs(ue,{open:Ve,onClose:()=>E(!1),maxWidth:"md",fullWidth:!0,children:[t.jsxs(ie,{sx:{pb:1},children:[t.jsx(p,{variant:"h6",sx:{fontWeight:600},children:"Add Document"}),t.jsx(p,{variant:"body2",color:"text.secondary",children:"Upload or paste document content for analysis"})]}),t.jsxs(le,{children:[t.jsxs(r,{sx:{mt:2,p:4,border:`2px dashed ${n(e.palette.divider,.4)}`,borderRadius:1,textAlign:"center",cursor:"pointer",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)",bgcolor:e.palette.mode==="dark"?n(e.palette.text.primary,.02):c[50],"&:hover":{borderColor:e.palette.mode==="dark"?c[500]:c[700],bgcolor:e.palette.mode==="dark"?n(e.palette.text.primary,.05):c[100]}},component:"label",children:[t.jsx(Ie,{sx:{fontSize:40,color:"text.secondary",mb:1}}),t.jsx(p,{variant:"body1",sx:{fontWeight:500,mb:.5},children:"Drop your file here or click to browse"}),t.jsx(p,{variant:"caption",color:"text.secondary",children:"Supports TXT, MD, JSON, CSV (max 5MB)"}),t.jsx("input",{type:"file",hidden:!0,onChange:nt,accept:".txt,.md,.json,.csv"})]}),t.jsx(It,{sx:{my:3},children:t.jsx(p,{variant:"caption",color:"text.secondary",children:"OR"})}),t.jsx(O,{fullWidth:!0,label:"Document Name",value:T,onChange:s=>G(s.target.value),sx:{mb:2},inputProps:{maxLength:R},InputProps:{sx:{borderRadius:1}}}),t.jsx(O,{fullWidth:!0,multiline:!0,rows:10,label:"Document Content",value:z,onChange:s=>K(s.target.value),placeholder:"Paste your document content here...",inputProps:{maxLength:xe},InputProps:{sx:{borderRadius:1}}})]}),t.jsxs(ce,{sx:{px:3,pb:3},children:[t.jsx(w,{onClick:()=>E(!1),sx:{borderRadius:1,textTransform:"none"},children:"Cancel"}),t.jsx(w,{variant:"contained",onClick:at,disabled:!T||!z,sx:{borderRadius:1,textTransform:"none",px:3,background:e.palette.mode==="dark"?c[700]:c[900]},children:"Add Document"})]})]}),t.jsxs(ue,{open:Ye,onClose:()=>Q(!1),maxWidth:"sm",fullWidth:!0,children:[t.jsxs(ie,{sx:{pb:1},children:[t.jsx(p,{variant:"h6",sx:{fontWeight:600},children:"Select Existing Report"}),t.jsx(p,{variant:"body2",color:"text.secondary",children:"Choose a generated report to add to this session"})]}),t.jsx(le,{children:Ke?t.jsx(r,{sx:{display:"flex",justifyContent:"center",py:4},children:t.jsx(ms,{rows:3})}):fe.length===0?t.jsxs(r,{sx:{textAlign:"center",py:4},children:[t.jsx(pe,{sx:{fontSize:48,color:"text.disabled",mb:1}}),t.jsx(p,{color:"text.secondary",children:"No generated reports found"}),t.jsx(p,{variant:"caption",color:"text.secondary",children:"Generate a report first, then come back to analyze it here."})]}):t.jsx(Dt,{sx:{pt:1},children:fe.map(s=>t.jsxs(Rt,{button:!0,onClick:()=>ot(s),sx:{borderRadius:1,mb:.5,border:`1px solid ${n(e.palette.divider,.1)}`,"&:hover":{bgcolor:e.palette.mode==="dark"?n(e.palette.text.primary,.06):c[50]}},children:[t.jsx(At,{sx:{minWidth:40},children:t.jsx(pe,{sx:{color:"text.secondary"}})}),t.jsx($t,{primary:s.templateName||s.id,secondary:`${s.startDate} – ${s.endDate} · ${s.connectionName||"Unknown source"}`,primaryTypographyProps:{variant:"body2",fontWeight:600},secondaryTypographyProps:{variant:"caption"}}),t.jsx(p,{variant:"caption",color:"text.secondary",sx:{whiteSpace:"nowrap",ml:1},children:new Date(s.createdAt).toLocaleDateString()})]},s.id))})}),t.jsx(ce,{sx:{px:3,pb:3},children:t.jsx(w,{onClick:()=>Q(!1),sx:{borderRadius:1,textTransform:"none"},children:"Cancel"})})]}),t.jsx(de,{open:H.open,onClose:()=>J({open:!1,sessionId:null,sessionName:""}),onConfirm:()=>{const s=H.sessionId,d=H.sessionName;J({open:!1,sessionId:null,sessionName:""}),S({type:D.DELETE,label:`Delete session "${d}"`,reversibility:I.IRREVERSIBLE,successMessage:`Session "${d}" deleted`,errorMessage:"Failed to delete session",action:async()=>{if(!await ge(s))throw new Error("Delete failed")}})},title:"Delete Session",message:`Are you sure you want to delete "${H.sessionName}"? All documents and chat history will be permanently removed.`,confirmLabel:"Delete",severity:"error"}),t.jsx(de,{open:U.open,onClose:()=>X({open:!1,docId:null,docName:""}),onConfirm:()=>{const s=U.docId,d=U.docName;X({open:!1,docId:null,docName:""}),S({type:D.DELETE,label:`Remove document "${d}"`,reversibility:I.PARTIALLY_REVERSIBLE,successMessage:`Document "${d}" removed`,errorMessage:"Failed to remove document",action:async()=>{if(!await Oe(a?.id,s))throw new Error("Remove failed")}})},title:"Remove Document",message:`Are you sure you want to remove "${U.docName}" from this session?`,confirmLabel:"Remove",severity:"warning"}),t.jsx(de,{open:W.open,onClose:()=>Z({open:!1,sessionId:null,sessionName:"",messageCount:0}),onConfirm:()=>{const s=W.sessionId,d=W.sessionName;Z({open:!1,sessionId:null,sessionName:"",messageCount:0}),S({type:D.DELETE,label:`Clear chat history for "${d}"`,reversibility:I.PARTIALLY_REVERSIBLE,successMessage:"Chat history cleared",errorMessage:"Failed to clear chat history",action:async()=>{await Qe(s)}})},title:"Clear Chat History",message:`Are you sure you want to clear all ${W.messageCount} messages from "${W.sessionName}"? This action cannot be undone.`,confirmLabel:"Clear History",severity:"warning"})]})}function aa(){return We(),t.jsx(_s,{})}export{aa as default};
