import{g as Ye,j as e,a as ye,r as a,v as Ke,R as B,I as O,c2 as ft,c3 as yt,P as oe,B as m,q as d,c1 as Le,n as l,s as be,o as u,T as jt,e as vt,ba as Qe,bb as Ue,bc as ge,aJ as Xe,K as M,C as Fe,V as Ze,aZ as Je,A as fe,a2 as et,f as i,p as N,u as kt,Z as St,w as Ct,l as ee,c4 as wt,c5 as It,c6 as zt,bh as xe,D as _e,H as Me,m as We,S as qe,M as me,ak as Rt,aY as Tt,bP as Dt,c7 as Et,aU as At,E as Be,$ as te,aV as Oe,c8 as Pt,c9 as Lt,ca as Ft,N as S,bQ as _t}from"./index-COTlR4Mk.js";import{A as Mt}from"./Article-BsRQBd0_.js";import{A as Wt}from"./ArrowForward-fUl__Ezw.js";import{F as Ne}from"./FilterList-B2nv-Yj9.js";import{P as qt}from"./PageHeader-C65lV-AS.js";import{P as tt}from"./PictureAsPdf-Bwg-ZKh2.js";import{C as Bt}from"./Check-JruGOof3.js";import{u as Ot,S as Nt}from"./SuccessCelebration-CvF7vhgL.js";import{A as Ht}from"./AiUsageNotice-D5uMWf9C.js";import{C as $t}from"./ConnectionSelector-DIWHs3I4.js";import{g as Vt,q as Gt}from"./summary-CKyCjl5W.js";import{C as Yt}from"./Container-5otpAWFw.js";const Kt=Ye(e.jsx("path",{d:"M9 11H7v2h2zm4 0h-2v2h2zm4 0h-2v2h2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V9h14z"})),He=Ye(e.jsx("path",{d:"M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V8h14zM7 10h5v5H7z"})),Qt={pdf:tt,excel:et};function Ut({onSelectTemplate:s}){const{execute:h}=ye(),[C,c]=a.useState(!1),[y,E]=a.useState(""),[x,g]=a.useState(!1),[W,H]=a.useState(!1),[o,q]=a.useState([]),[k,R]=a.useState(null),j=Ke(),T=a.useCallback((n,f,b={})=>h({type:O.EXECUTE,label:n,reversibility:B.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"template_recommender",...b},action:f}),[h]),I=a.useCallback(()=>{const n=y.trim();if(n)return h({type:O.ANALYZE,label:"Recommend templates",reversibility:B.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"template_recommender",action:"recommend_templates",requirement:n},action:async()=>{g(!0),R(null),q([]);try{const f=await ft({requirement:n,limit:5}),b=Array.isArray(f)?f:[];return q(b),b.length||R("No matching templates found. Try a different description."),b}catch(f){throw R(f.message||"Failed to get recommendations"),f}finally{g(!1)}}})},[h,y]),$=a.useCallback(()=>{const n=y.trim();if(n)return h({type:O.GENERATE,label:"Queue template recommendations",reversibility:B.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"template_recommender",action:"queue_recommendations",requirement:n},action:async()=>{H(!0),R(null);try{const f=await yt({requirement:n,limit:5});return f?.job_id?j.show("Recommendation job queued. Track it in Jobs.","success"):j.show("Failed to queue recommendation job.","error"),f}catch(f){throw j.show(f.message||"Failed to queue recommendations","error"),f}finally{H(!1)}}})},[h,y,j]),z=a.useCallback(n=>T("Select recommended template",()=>{s?.(n),c(!1)},{templateId:n?.id}),[T,s]),V=a.useCallback(n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),I())},[I]);return e.jsxs(oe,{sx:{border:1,borderColor:"divider",borderStyle:C?"solid":"dashed",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)",overflow:"hidden"},children:[e.jsxs(m,{sx:{px:2,py:1.5,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",bgcolor:C?"action.selected":"transparent","&:hover":{bgcolor:"action.hover"}},onClick:()=>T("Toggle template recommender",()=>c(n=>!n)),children:[e.jsxs(d,{direction:"row",alignItems:"center",spacing:1.5,children:[e.jsx(Le,{sx:{width:32,height:32,bgcolor:n=>n.palette.mode==="dark"?"rgba(255,255,255,0.08)":l[100]},children:e.jsx(be,{sx:{color:"text.secondary",fontSize:18}})}),e.jsxs(m,{children:[e.jsx(u,{variant:"subtitle2",fontWeight:600,children:"AI Template Picker"}),e.jsx(u,{variant:"caption",color:"text.secondary",children:"Describe what you need and let AI find the best template"})]})]}),e.jsx(jt,{title:C?"Collapse":"Expand",children:e.jsx(vt,{size:"small","aria-label":C?"Collapse":"Expand",children:C?e.jsx(Qe,{}):e.jsx(Ue,{})})})]}),e.jsx(ge,{in:C,children:e.jsx(m,{sx:{px:2,pb:2},children:e.jsxs(d,{spacing:2,children:[e.jsxs(d,{direction:"row",spacing:1,children:[e.jsx(Xe,{fullWidth:!0,size:"small",placeholder:"e.g., monthly sales report with charts, inventory tracking spreadsheet...",value:y,onChange:n=>E(n.target.value),onKeyDown:V,disabled:x,sx:{"& .MuiOutlinedInput-root":{bgcolor:"background.paper"}}}),e.jsx(M,{variant:"contained",onClick:I,disabled:x||W||!y.trim(),startIcon:x?e.jsx(Fe,{size:16,color:"inherit"}):e.jsx(be,{}),sx:{minWidth:120,textTransform:"none"},children:x?"Searching...":"Find"}),e.jsx(M,{variant:"outlined",onClick:$,disabled:x||W||!y.trim(),startIcon:W?e.jsx(Fe,{size:16,color:"inherit"}):e.jsx(Ze,{}),sx:{minWidth:120,textTransform:"none"},children:W?"Queueing...":"Queue"})]}),x&&e.jsx(Je,{}),k&&e.jsx(fe,{severity:"info",onClose:()=>T("Dismiss recommendations error",()=>R(null)),children:k}),o.length>0&&e.jsxs(d,{spacing:1.5,children:[e.jsxs(u,{variant:"caption",color:"text.secondary",children:[o.length," template",o.length!==1?"s":""," found"]}),o.map((n,f)=>{const b=n.template||n,G=b.kind||"pdf",Q=Qt[G]||tt,P=typeof n.score=="number"?n.score:null;return e.jsx(oe,{variant:"outlined",sx:{p:2,cursor:"pointer",transition:"all 0.15s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{borderColor:v=>v.palette.mode==="dark"?l[500]:l[700],bgcolor:"action.hover"}},onClick:()=>z(b),children:e.jsxs(d,{direction:"row",alignItems:"flex-start",spacing:2,children:[e.jsx(Le,{variant:"rounded",sx:{width:40,height:40,bgcolor:v=>v.palette.mode==="dark"?i(v.palette.text.primary,.08):l[100]},children:e.jsx(Q,{sx:{color:"text.secondary"}})}),e.jsxs(m,{sx:{flex:1,minWidth:0},children:[e.jsxs(d,{direction:"row",alignItems:"center",spacing:1,sx:{mb:.5},children:[e.jsx(u,{variant:"subtitle2",fontWeight:600,children:b.name||b.id}),e.jsx(N,{label:G.toUpperCase(),size:"small",variant:"outlined",sx:{height:20,fontSize:"10px",bgcolor:v=>v.palette.mode==="dark"?i(v.palette.text.primary,.1):l[200],color:"text.secondary"}}),P!==null&&e.jsx(N,{label:`${Math.round(P*100)}% match`,size:"small",sx:{height:20,fontSize:"10px",bgcolor:v=>v.palette.mode==="dark"?i(v.palette.text.primary,.1):l[200],color:"text.secondary"}})]}),n.explanation&&e.jsx(u,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:n.explanation}),!n.explanation&&b.description&&e.jsx(u,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:b.description})]}),e.jsx(M,{size:"small",variant:"outlined",startIcon:e.jsx(Bt,{}),onClick:v=>{v.stopPropagation(),z(b)},sx:{textTransform:"none",whiteSpace:"nowrap"},children:"Select"})]})},b.id||f)})]}),!x&&o.length===0&&e.jsxs(m,{children:[e.jsx(u,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"Try these examples:"}),e.jsx(d,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:["monthly financial report","inventory tracking","sales summary with charts","equipment status report"].map(n=>e.jsx(N,{label:n,size:"small",variant:"outlined",onClick:()=>T("Set example requirement",()=>E(n),{example:n}),sx:{cursor:"pointer"}},n))})]})]})})})]})}const se=S(u)(({theme:s})=>({fontSize:"0.8125rem",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.08em",color:s.palette.text.primary,marginBottom:s.spacing(1.5),display:"flex",alignItems:"center",gap:s.spacing(1),"&::after":{content:'""',flex:1,height:1,backgroundColor:i(s.palette.divider,.3)}})),$e=S(Xe)(({theme:s})=>({"& .MuiOutlinedInput-root":{borderRadius:12,backgroundColor:i(s.palette.background.paper,.6),transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{backgroundColor:i(s.palette.background.paper,.8)},"&.Mui-focused":{backgroundColor:s.palette.background.paper,boxShadow:`0 0 0 3px ${i(s.palette.text.primary,.08)}`}}})),Ve=S(N,{shouldForwardProp:s=>s!=="selected"})(({theme:s,selected:h})=>({borderRadius:10,fontWeight:500,fontSize:"0.75rem",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)",cursor:"pointer",...h&&{background:s.palette.mode==="dark"?l[700]:l[900],color:s.palette.common.white,boxShadow:`0 4px 12px ${i(s.palette.common.black,.15)}`,"& .MuiChip-icon":{color:s.palette.common.white}},...!h&&{backgroundColor:s.palette.mode==="dark"?i(s.palette.text.primary,.08):l[100],color:s.palette.text.primary,border:`1px solid ${i(s.palette.divider,.3)}`,"& .MuiChip-icon":{color:s.palette.text.secondary},"&:hover":{backgroundColor:s.palette.mode==="dark"?i(s.palette.text.primary,.14):l[200],transform:"translateY(-1px)"}}})),Ge=S(N)(({theme:s})=>({borderRadius:8,fontWeight:600,fontSize:"0.75rem",backgroundColor:s.palette.mode==="dark"?i(s.palette.text.primary,.08):l[100],color:s.palette.text.secondary,border:`1px solid ${i(s.palette.divider,.2)}`})),Xt=S(m)(({theme:s})=>({maxHeight:200,overflow:"auto",borderRadius:12,border:`1px solid ${i(s.palette.divider,.15)}`,backgroundColor:i(s.palette.background.paper,.4),"&::-webkit-scrollbar":{width:6},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:i(s.palette.text.primary,.2),borderRadius:8}})),Zt=S(_t,{shouldForwardProp:s=>s!=="selected"})(({theme:s,selected:h})=>({padding:s.spacing(1,1.5),cursor:"pointer",transition:"all 0.15s cubic-bezier(0.22, 1, 0.36, 1)",borderBottom:`1px solid ${i(s.palette.divider,.1)}`,...h&&{backgroundColor:s.palette.mode==="dark"?i(s.palette.text.primary,.08):l[100]},"&:hover":{backgroundColor:s.palette.mode==="dark"?i(s.palette.text.primary,.05):l[50]},"&:last-child":{borderBottom:"none"}})),Jt=S(M)(({theme:s})=>({borderRadius:12,textTransform:"none",fontWeight:600,fontSize:"0.875rem",padding:s.spacing(1.25,3),background:s.palette.mode==="dark"?l[700]:l[900],color:s.palette.common.white,boxShadow:`0 4px 14px ${i(s.palette.common.black,.15)}`,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{background:s.palette.mode==="dark"?l[500]:l[700],boxShadow:`0 6px 20px ${i(s.palette.common.black,.2)}`,transform:"translateY(-2px)"},"&:active":{transform:"translateY(0)"},"&:disabled":{background:s.palette.action.disabledBackground,color:s.palette.action.disabled,boxShadow:"none"}})),re=S(M)(({theme:s})=>({borderRadius:12,textTransform:"none",fontWeight:500,fontSize:"0.875rem",padding:s.spacing(1.25,2.5),borderColor:i(s.palette.divider,.3),color:s.palette.text.primary,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{borderColor:s.palette.mode==="dark"?l[500]:l[700],backgroundColor:s.palette.mode==="dark"?i(s.palette.text.primary,.04):l[50],transform:"translateY(-1px)"}})),ae=S(M)(({theme:s})=>({borderRadius:8,textTransform:"none",fontWeight:500,fontSize:"0.75rem",padding:s.spacing(.5,1.5),color:s.palette.text.secondary,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{backgroundColor:s.palette.mode==="dark"?i(s.palette.text.primary,.08):l[100],color:s.palette.text.primary}})),es=S(oe,{shouldForwardProp:s=>s!=="selected"})(({theme:s,selected:h})=>({padding:s.spacing(2),borderRadius:12,cursor:"pointer",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)",border:`1px solid ${h?s.palette.mode==="dark"?l[500]:l[700]:i(s.palette.divider,.2)}`,backgroundColor:h?s.palette.mode==="dark"?i(s.palette.text.primary,.05):l[50]:"transparent","&:hover":{borderColor:i(s.palette.divider,.4),backgroundColor:s.palette.mode==="dark"?i(s.palette.text.primary,.03):l[50],"& .view-summary-hint":{opacity:1,color:s.palette.text.primary}}})),ne=S(Je)(({theme:s})=>({borderRadius:4,height:6,backgroundColor:i(s.palette.text.primary,.1),"& .MuiLinearProgress-bar":{borderRadius:4,background:s.palette.mode==="dark"?l[500]:l[900]}})),K=S(M)(({theme:s})=>({borderRadius:8,textTransform:"none",fontWeight:500,fontSize:"0.75rem",padding:s.spacing(.5,1.5),borderColor:i(s.palette.divider,.3),transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{borderColor:s.palette.mode==="dark"?l[500]:l[700],backgroundColor:s.palette.mode==="dark"?i(s.palette.text.primary,.04):l[50]}})),ts=S(m)(({theme:s})=>({display:"flex",alignItems:"center",justifyContent:"space-between",padding:s.spacing(1.5,0),cursor:"pointer",color:s.palette.text.secondary,transition:"color 0.2s ease","&:hover":{color:s.palette.text.primary}})),A=s=>s.toISOString().split("T")[0],he=()=>{const s=new Date,h=new Date(s);h.setDate(s.getDate()-s.getDay());const C=new Date(s.getFullYear(),s.getMonth(),1),c=new Date(s.getFullYear(),s.getMonth()-1,1),y=new Date(s.getFullYear(),s.getMonth(),0);return{today:{label:"Today",start:A(s),end:A(s)},thisWeek:{label:"This Week",start:A(h),end:A(s)},thisMonth:{label:"This Month",start:A(C),end:A(s)},lastMonth:{label:"Last Month",start:A(c),end:A(y)}}};function ss(){const s=kt(),[h]=St(),C=Ct(),c=Ke(),{execute:y}=ye(),E=a.useCallback((t,r,p={})=>C(t,{label:r,intent:{from:"reports",...p}}),[C]),x=ee(t=>t.templates),g=ee(t=>t.activeConnection),W=ee(t=>t.setActiveConnectionId),H=ee(t=>t.setTemplates),[o,q]=a.useState(h.get("template")||""),[k,R]=a.useState(""),[j,T]=a.useState(""),[I,$]=a.useState("thisMonth"),[z,V]=a.useState({}),[n,f]=a.useState(!1),[b,G]=a.useState(!1),[Q,P]=a.useState(null),[v,ie]=a.useState(null),[je,st]=a.useState({}),[U,ve]=a.useState(!1),[w,le]=a.useState(null),[L,Y]=a.useState([]),[ce,ke]=a.useState(!1),[Se,rt]=a.useState([]),[D,Ce]=a.useState(null),[F,X]=a.useState(null),[de,we]=a.useState(!1),[Ie,ze]=a.useState(!1),[Re,at]=a.useState(!1),[nt,Te]=a.useState(null);x.find(t=>t.id===o)?.kind?.toUpperCase();const{celebrating:ot,celebrate:De,onComplete:it}=Ot(),pe=a.useRef(0),Z=a.useRef(0);a.useEffect(()=>{!o&&x.length>0&&q(x[0].id)},[x,o]),a.useEffect(()=>{const t=async()=>{f(!0);try{const r=await Lt();H(r)}catch(r){c.show(r.message||"Failed to load designs","error")}finally{f(!1)}};x.length===0&&t()},[x.length,H,c]),a.useEffect(()=>{(async()=>{if(!o||!g?.id)return;const r=++pe.current;try{const p=x.find(J=>J.id===o),_=await Ft(o,{connectionId:g.id,kind:p?.kind||"pdf"});r===pe.current&&st(_.keys||{})}catch(p){r===pe.current&&(console.error("Failed to fetch key options:",p),c.show("Could not load filter options. You can still generate reports.","warning"))}})()},[o,g?.id,x,c]);const lt=a.useCallback(t=>{q(t.target.value),V({}),P(null),le(null),Y([])},[]),ct=a.useCallback(t=>{t?.id&&(q(t.id),V({}),P(null),c.show(`Selected: ${t.name||t.id}`,"success"))},[c]),dt=a.useCallback((t,r)=>{V(p=>({...p,[t]:r}))},[]),Ee=a.useCallback(t=>{if($(t),t!=="custom"){const p=he()[t];p&&(R(p.start),T(p.end))}},[]);a.useEffect(()=>{if(!k&&!j&&I!=="custom"){const r=he()[I];r&&(R(r.start),T(r.end))}},[]);const Ae=a.useCallback(async()=>{if(!o||!g?.id){c.show("Please select a design and connect to a data source first","error");return}if(w&&L.length===0){c.show("Select at least one batch to run","error");return}if(k&&j&&new Date(k)>new Date(j)){c.show("Start date must be before or equal to end date","error");return}await y({type:O.EXECUTE,label:"Generate report",reversibility:B.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{templateId:o,connectionId:g?.id,action:"run_report"},action:async()=>{G(!0),ie(null),P(null);try{const t=x.find(gt=>gt.id===o),r=w?.batches||[],p=r.length>0&&L.length===r.length,_=r.length>0&&L.length>0&&!p,J=await wt({templateId:o,templateName:t?.name,connectionId:g.id,startDate:k||void 0,endDate:j||void 0,keyValues:Object.keys(z).length>0?z:void 0,batchIds:_?L:void 0,kind:t?.kind||"pdf",xlsx:t?.kind==="excel"});return P(J),c.show("Report generation started!","success"),De(),J}catch(t){throw ie(t.message||"Failed to generate report"),c.show(t.message||"Failed to generate report","error"),t}finally{G(!1)}}})},[o,g?.id,x,k,j,z,w,L,c,De,y]),Pe=Object.keys(je),pt=a.useCallback(async()=>{if(!o||!g?.id){c.show("Select a design and data source first","error");return}if(!k||!j){c.show("Provide a start and end date to discover batches","error");return}if(new Date(k)>new Date(j)){c.show("Start date must be before or equal to end date","error");return}await y({type:O.ANALYZE,label:"Discover batches",reversibility:B.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{templateId:o,connectionId:g?.id,action:"discover_batches"},action:async()=>{ve(!0),le(null);try{const t=x.find(_=>_.id===o),r=await It({templateId:o,connectionId:g.id,startDate:k,endDate:j,keyValues:Object.keys(z).length>0?z:void 0,kind:t?.kind||"pdf"});le(r);const p=Array.isArray(r?.batches)?r.batches.map(_=>_.id):[];return Y(p),r}catch(t){throw c.show(t.message||"Failed to discover batches","error"),t}finally{ve(!1)}}})},[o,g?.id,k,j,z,x,c,y]),ue=a.useCallback(async()=>{ke(!0);try{const t={limit:10};o&&(t.templateId=o);const r=await zt(t);rt(r)}catch(t){console.error("Failed to load run history:",t),c.show("Failed to load run history","warning")}finally{ke(!1)}},[o,c]);a.useEffect(()=>{ue()},[ue]);const ut=a.useCallback(t=>{Y(r=>r.includes(t)?r.filter(p=>p!==t):[...r,t])},[]),xt=a.useCallback(async t=>{if(D?.id===t.id){Ce(null),Te(null),X(null);return}if(Ce(t),Te(t.id),X(null),t?.id){const r=++Z.current;we(!0);try{const p=await Vt(t.id);r===Z.current&&X(p.summary||p)}catch(p){r===Z.current&&(console.error("Failed to fetch summary:",p),X(null))}finally{r===Z.current&&we(!1)}}},[D?.id]),mt=a.useCallback(async()=>{D?.id&&await y({type:O.GENERATE,label:"Queue summary",reversibility:B.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{runId:D?.id,action:"queue_report_summary"},action:async()=>{ze(!0);try{const t=await Gt(D.id);return t?.job_id||t?.jobId||null?c.show("Summary queued. Track progress in Report Progress.","success"):c.show("Failed to queue summary.","error"),t}catch(t){throw c.show(t?.message||"Failed to queue summary.","error"),t}finally{ze(!1)}}})},[D?.id,c,y]),ht=a.useCallback(()=>{const t=Array.isArray(w?.batches)?w.batches.map(r=>r.id):[];Y(t)},[w]),bt=a.useCallback(()=>{Y([])},[]);return e.jsxs(m,{sx:{minHeight:"100vh",p:3,bgcolor:"background.default"},children:[e.jsx(Nt,{trigger:ot,onComplete:it}),e.jsxs(Yt,{maxWidth:"lg",children:[e.jsx(qt,{title:"Run a Report",description:"Choose a design, set your date range, and generate a report.",actions:e.jsx(re,{variant:"outlined",startIcon:e.jsx(Ze,{}),disabled:!o||b,onClick:()=>E(`/schedules?template=${o}`,"Open schedules",{templateId:o}),children:"Schedule"})}),e.jsxs(d,{spacing:3,children:[e.jsxs(xe,{children:[e.jsxs(se,{children:[e.jsx(_e,{sx:{fontSize:14}}),"Design & Data Source"]}),e.jsxs(d,{direction:{xs:"column",md:"row"},spacing:2,children:[e.jsx(m,{sx:{flex:1},children:e.jsxs(Me,{fullWidth:!0,children:[e.jsx(We,{children:"Report Design"}),e.jsx(qe,{value:o,onChange:lt,label:"Report Design",children:x.map(t=>e.jsx(me,{value:t.id,children:e.jsxs(d,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx("span",{children:t.name||t.id}),e.jsx(N,{label:t.kind?.toUpperCase()||"PDF",size:"small",variant:"outlined",sx:{borderRadius:6,fontSize:"10px",height:20}})]})},t.id))})]})}),e.jsxs(m,{sx:{flex:1},children:[e.jsx($t,{value:g?.id||"",onChange:t=>W(t),label:"Data Source",showStatus:!0}),!g&&e.jsxs(u,{variant:"caption",color:"warning.main",sx:{mt:.75,display:"block"},children:["No data source selected."," ",e.jsx(u,{component:"span",variant:"caption",sx:{color:"primary.main",cursor:"pointer",textDecoration:"underline"},onClick:()=>E("/connections","Open connections"),children:"Add one"})]})]})]}),e.jsx(m,{sx:{mt:2},children:e.jsx(Ut,{onSelectTemplate:ct})})]}),e.jsxs(xe,{children:[e.jsxs(se,{children:[e.jsx(He,{sx:{fontSize:14}}),"Time Period"]}),e.jsxs(d,{direction:"row",spacing:1,sx:{mb:2,flexWrap:"wrap",gap:1},children:[Object.entries(he()).map(([t,r])=>e.jsx(Ve,{label:r.label,icon:e.jsx(He,{sx:{fontSize:14}}),onClick:()=>Ee(t),selected:I===t,variant:I===t?"filled":"outlined"},t)),e.jsx(Ve,{label:"Custom",icon:e.jsx(Kt,{sx:{fontSize:14}}),onClick:()=>Ee("custom"),selected:I==="custom",variant:I==="custom"?"filled":"outlined"})]}),e.jsxs(d,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx($e,{label:"Start Date",type:"date",value:k,onChange:t=>{R(t.target.value),$("custom")},InputLabelProps:{shrink:!0},fullWidth:!0,size:"small"}),e.jsx($e,{label:"End Date",type:"date",value:j,onChange:t=>{T(t.target.value),$("custom")},InputLabelProps:{shrink:!0},fullWidth:!0,size:"small"})]}),Pe.length>0&&e.jsxs(m,{sx:{mt:3},children:[e.jsx(Rt,{sx:{mb:2,borderColor:i(s.palette.divider,.2)}}),e.jsxs(se,{children:[e.jsx(Ne,{sx:{fontSize:14}}),"Filter Parameters"]}),e.jsx(d,{spacing:2,children:Pe.map(t=>e.jsxs(Me,{fullWidth:!0,size:"small",children:[e.jsx(We,{children:t}),e.jsxs(qe,{value:z[t]||"",onChange:r=>dt(t,r.target.value),label:t,children:[e.jsx(me,{value:"",children:e.jsx("em",{children:"All"})}),(je[t]||[]).map(r=>e.jsx(me,{value:r,children:r},r))]})]},t))})]})]}),e.jsxs(m,{children:[v&&e.jsx(fe,{severity:"error",sx:{mb:2,borderRadius:1},onClose:()=>ie(null),action:e.jsx(ae,{color:"inherit",size:"small",onClick:Ae,disabled:b,children:"Try Again"}),children:v}),b&&e.jsxs(m,{sx:{mb:2},children:[e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Generating report..."}),e.jsx(ne,{})]}),Q&&e.jsx(fe,{severity:"success",sx:{mb:2,borderRadius:1},children:e.jsxs(d,{direction:"row",spacing:2,alignItems:"center",flexWrap:"wrap",children:[e.jsxs(u,{variant:"body2",children:["Report started! ID: ",Q.job_id?.slice(0,8),"..."]}),e.jsx(re,{size:"small",variant:"outlined",onClick:()=>E("/jobs","Open jobs"),children:"View Progress"})]})}),e.jsxs(d,{direction:"row",spacing:2,alignItems:"center",justifyContent:"flex-end",children:[e.jsxs(u,{variant:"caption",color:"text.secondary",sx:{flex:1},children:["Reports run in the background."," ",e.jsx(u,{component:"span",variant:"caption",sx:{color:"primary.main",cursor:"pointer",textDecoration:"underline"},onClick:()=>E("/jobs","Open jobs"),children:"Track progress"})]}),e.jsx(Jt,{startIcon:e.jsx(Tt,{}),onClick:Ae,disabled:!o||!g||b,sx:{px:4,py:1.5},children:"Generate Report"})]})]}),e.jsxs(m,{children:[e.jsxs(ts,{onClick:()=>at(t=>!t),children:[e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Ne,{sx:{fontSize:16}}),e.jsx(u,{variant:"subtitle2",fontWeight:500,children:"Advanced: Find Data Batches"})]}),Re?e.jsx(Qe,{sx:{fontSize:20}}):e.jsx(Ue,{sx:{fontSize:20}})]}),e.jsx(ge,{in:Re,children:e.jsx(xe,{sx:{mt:1},children:e.jsxs(d,{spacing:2,children:[e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsx(u,{variant:"body2",color:"text.secondary",children:"Discover available data batches for the selected design and date range."}),e.jsx(re,{variant:"outlined",size:"small",onClick:pt,disabled:U||!o||!g,children:U?"Searching...":"Find Batches"})]}),U&&e.jsx(ne,{}),!U&&w&&e.jsxs(d,{spacing:2,children:[e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Ge,{label:`${w.batches_count||w.batches?.length||0} batches`}),e.jsx(Ge,{label:`${w.rows_total||0} rows`})]}),e.jsxs(d,{direction:"row",spacing:1,children:[e.jsx(ae,{size:"small",onClick:ht,children:"Select all"}),e.jsx(ae,{size:"small",onClick:bt,children:"Clear"})]}),e.jsx(Xt,{children:e.jsx(Dt,{dense:!0,disablePadding:!0,children:(w.batches||[]).map(t=>e.jsxs(Zt,{disableGutters:!0,onClick:()=>ut(t.id),selected:L.includes(t.id),children:[e.jsx(Et,{checked:L.includes(t.id),sx:{p:.5,mr:1}}),e.jsx(At,{primary:`${t.id}`,secondary:`${t.rows||0} rows`,primaryTypographyProps:{variant:"body2",fontWeight:500},secondaryTypographyProps:{variant:"caption"}})]},t.id))})})]})]})})})]}),e.jsxs(m,{children:[e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",sx:{mb:2},children:[e.jsxs(se,{sx:{mb:0,flex:1},children:[e.jsx(Be,{sx:{fontSize:14}}),"Recent Runs"]}),e.jsx(ae,{size:"small",onClick:ue,disabled:ce,startIcon:e.jsx(Be,{sx:{fontSize:14}}),children:"Refresh"})]}),ce&&e.jsx(ne,{sx:{mb:2}}),!ce&&Se.length===0&&e.jsxs(m,{sx:{py:4,textAlign:"center"},children:[e.jsx(_e,{sx:{fontSize:48,color:"text.disabled",mb:1}}),e.jsx(u,{variant:"body2",color:"text.secondary",children:o?"No recent runs for this design yet.":"No report runs yet. Generate a report to get started."})]}),e.jsx(m,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2},children:Se.map(t=>e.jsxs(m,{children:[e.jsx(es,{selected:D?.id===t.id,onClick:()=>xt(t),title:"Click to view summary",children:e.jsxs(d,{spacing:.5,children:[e.jsxs(d,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(u,{variant:"body2",fontWeight:600,children:t.templateName||t.templateId}),e.jsxs(d,{direction:"row",alignItems:"center",spacing:.5,className:"view-summary-hint",sx:{opacity:.6,transition:"all 0.2s"},children:[e.jsx(u,{variant:"caption",color:"text.secondary",children:D?.id===t.id?"Collapse":"Summary"}),e.jsx(Wt,{sx:{fontSize:12,transform:D?.id===t.id?"rotate(90deg)":"none",transition:"transform 0.2s"}})]})]}),e.jsxs(u,{variant:"caption",color:"text.secondary",children:[new Date(t.createdAt).toLocaleString()," Â· ",t.startDate," to ",t.endDate]}),e.jsxs(d,{direction:"row",spacing:1,sx:{mt:.5},flexWrap:"wrap",useFlexGap:!0,children:[t.artifacts?.pdf_url&&e.jsx(K,{size:"small",variant:"outlined",startIcon:e.jsx(Oe,{sx:{fontSize:14}}),href:te(t.artifacts.pdf_url),target:"_blank",onClick:r=>r.stopPropagation(),children:"PDF"}),t.artifacts?.html_url&&e.jsx(K,{size:"small",variant:"outlined",startIcon:e.jsx(Oe,{sx:{fontSize:14}}),href:te(t.artifacts.html_url),target:"_blank",onClick:r=>r.stopPropagation(),children:"HTML"}),t.artifacts?.xlsx_url&&e.jsx(K,{size:"small",variant:"outlined",startIcon:e.jsx(et,{sx:{fontSize:14}}),href:te(t.artifacts.xlsx_url),target:"_blank",onClick:r=>r.stopPropagation(),children:"XLSX"}),t.artifacts?.docx_url&&e.jsx(K,{size:"small",variant:"outlined",startIcon:e.jsx(Mt,{sx:{fontSize:14}}),href:te(t.artifacts.docx_url),target:"_blank",onClick:r=>r.stopPropagation(),children:"DOCX"}),e.jsx(K,{size:"small",variant:"outlined",startIcon:e.jsx(Pt,{sx:{fontSize:14}}),onClick:r=>{r.stopPropagation(),E(`/agents?analyzeRunId=${t.id}`,"Analyze with AI",{runId:t.id})},"data-testid":`analyze-ai-${t.id}`,children:"Analyze"})]})]})}),e.jsx(ge,{in:nt===t.id,children:e.jsxs(m,{sx:{mt:1,ml:2,pl:2,borderLeft:2,borderColor:"divider"},children:[e.jsx(Ht,{title:"AI summary",description:"Summaries are generated from the selected report run. Review before sharing.",chips:[{label:"Source: Selected run",color:"info",variant:"outlined"},{label:"Confidence: Review required",color:"warning",variant:"outlined"}],dense:!0,sx:{mb:1.5}}),de&&e.jsx(ne,{sx:{mb:1}}),!de&&F?e.jsxs(oe,{sx:{p:2,borderRadius:1.5,bgcolor:s.palette.mode==="dark"?i(s.palette.text.primary,.04):l[50],border:1,borderColor:"divider"},children:[e.jsx(u,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:typeof F=="string"?F:F.text||F.content||"No summary available"}),F.key_points&&e.jsxs(m,{sx:{mt:1.5},children:[e.jsx(u,{variant:"caption",fontWeight:600,color:"text.primary",children:"Key Points:"}),e.jsx("ul",{style:{margin:"4px 0",paddingLeft:20},children:F.key_points.map((r,p)=>e.jsx("li",{children:e.jsx(u,{variant:"caption",children:r})},p))})]})]}):!de&&e.jsxs(d,{spacing:1,children:[e.jsx(u,{variant:"body2",color:"text.secondary",children:"No summary available for this run."}),e.jsx(re,{size:"small",variant:"outlined",startIcon:e.jsx(be,{sx:{fontSize:14}}),onClick:mt,disabled:Ie,sx:{alignSelf:"flex-start"},children:Ie?"Queueing...":"Generate summary"})]})]})})]},t.id))})]})]})]})]})}function bs(){return ye(),e.jsx(ss,{})}export{bs as default};
