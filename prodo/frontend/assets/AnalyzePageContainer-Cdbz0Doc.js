import{r as i,b2 as q,b3 as J,b4 as H,j as e,b5 as U,b6 as G,J as F,c as de,b7 as Te,b8 as Y,b9 as se,ba as je,bb as ie,bc as Me,bd as ce,aM as Se,S as j,T as v,B as M,O as Ce,t as Pe,v as E,s as _,be as Fe,P as O,k as Le,p as we,ah as xe,E as he,bf as $e,Q as Ne,d as _e,u as De,b as We,R as X,I as K,q as Ue,b1 as Be,F as Z,as as me,aD as Ve,aJ as Oe,N as qe}from"./index-B8Eu23bA.js";import{Z as Je,I as He}from"./ZoomableChart-CJTNLwGR.js";import{C as Ge}from"./CheckCircleOutline-BKKyaL-x.js";import{F as Ye}from"./InsertDriveFile-CpjWG4CB.js";import{I as Qe}from"./Insights-DHQilfoV.js";import{C as be}from"./BarChart-ClLuOAaO.js";import{G as ge}from"./Grid-5L9Rvqba.js";import{T as Xe,a as oe}from"./Tabs-D_BhmpzR.js";import{A as Ke,a as Ze,b as et}from"./AccordionSummary-CvHbDzcW.js";import{T as Ie}from"./TableContainer-CxteWhu6.js";import{T as ze,a as Ae,b as ee,c as N,d as ke}from"./TableRow-Gv3OwSlT.js";import{C as tt,a as nt}from"./CardContent-xJVpuEbT.js";import{S as fe}from"./Surface-DvkcgJ6N.js";import{S as st}from"./Switch-CKmzMGzD.js";import"./PieChart-BVneXJBn.js";import"./index-B21QI1NW.js";import"./index-Chjiymov.js";import"./KeyboardArrowRight-BOQXGjwe.js";const te=i.createContext({}),pe=i.createContext({});function ot(t){return q("MuiStep",t)}J("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const at=t=>{const{classes:n,orientation:s,alternativeLabel:l,completed:r}=t;return G({root:["root",s,l&&"alternativeLabel",r&&"completed"]},ot,n)},rt=F("div",{name:"MuiStep",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.root,n[s.orientation],s.alternativeLabel&&n.alternativeLabel,s.completed&&n.completed]}})({variants:[{props:{orientation:"horizontal"},style:{paddingLeft:8,paddingRight:8}},{props:{alternativeLabel:!0},style:{flex:1,position:"relative"}}]}),lt=i.forwardRef(function(n,s){const l=H({props:n,name:"MuiStep"}),{active:r,children:o,className:c,component:p="div",completed:h,disabled:g,expanded:m=!1,index:u,last:b,...y}=l,{activeStep:C,connector:A,alternativeLabel:k,orientation:R,nonLinear:x}=i.useContext(te);let[a=!1,f=!1,L=!1]=[r,h,g];C===u?a=r!==void 0?r:!0:!x&&C>u?f=h!==void 0?h:!0:!x&&C<u&&(L=g!==void 0?g:!0);const w=i.useMemo(()=>({index:u,last:b,expanded:m,icon:u+1,active:a,completed:f,disabled:L}),[u,b,m,a,f,L]),I={...l,active:a,orientation:R,alternativeLabel:k,completed:f,disabled:L,expanded:m,component:p},S=at(I),P=e.jsxs(rt,{as:p,className:U(S.root,c),ref:s,ownerState:I,...y,children:[A&&k&&u!==0?A:null,o]});return e.jsx(pe.Provider,{value:w,children:A&&!k&&u!==0?e.jsxs(i.Fragment,{children:[A,P]}):P})}),it=de(e.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"})),ct=de(e.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}));function dt(t){return q("MuiStepIcon",t)}const ae=J("MuiStepIcon",["root","active","completed","error","text"]);var ve;const pt=t=>{const{classes:n,active:s,completed:l,error:r}=t;return G({root:["root",s&&"active",l&&"completed",r&&"error"],text:["text"]},dt,n)},re=F(Te,{name:"MuiStepIcon",slot:"Root"})(Y(({theme:t})=>({display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),color:(t.vars||t).palette.text.disabled,[`&.${ae.completed}`]:{color:(t.vars||t).palette.primary.main},[`&.${ae.active}`]:{color:(t.vars||t).palette.primary.main},[`&.${ae.error}`]:{color:(t.vars||t).palette.error.main}}))),ut=F("text",{name:"MuiStepIcon",slot:"Text"})(Y(({theme:t})=>({fill:(t.vars||t).palette.primary.contrastText,fontSize:t.typography.caption.fontSize,fontFamily:t.typography.fontFamily}))),xt=i.forwardRef(function(n,s){const l=H({props:n,name:"MuiStepIcon"}),{active:r=!1,className:o,completed:c=!1,error:p=!1,icon:h,...g}=l,m={...l,active:r,completed:c,error:p},u=pt(m);if(typeof h=="number"||typeof h=="string"){const b=U(o,u.root);return p?e.jsx(re,{as:ct,className:b,ref:s,ownerState:m,...g}):c?e.jsx(re,{as:it,className:b,ref:s,ownerState:m,...g}):e.jsxs(re,{className:b,ref:s,ownerState:m,...g,children:[ve||(ve=e.jsx("circle",{cx:"12",cy:"12",r:"12"})),e.jsx(ut,{className:u.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:m,children:h})]})}return h});function ht(t){return q("MuiStepLabel",t)}const D=J("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),mt=t=>{const{classes:n,orientation:s,active:l,completed:r,error:o,disabled:c,alternativeLabel:p}=t;return G({root:["root",s,o&&"error",c&&"disabled",p&&"alternativeLabel"],label:["label",l&&"active",r&&"completed",o&&"error",c&&"disabled",p&&"alternativeLabel"],iconContainer:["iconContainer",l&&"active",r&&"completed",o&&"error",c&&"disabled",p&&"alternativeLabel"],labelContainer:["labelContainer",p&&"alternativeLabel"]},ht,n)},bt=F("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.root,n[s.orientation]]}})({display:"flex",alignItems:"center",[`&.${D.alternativeLabel}`]:{flexDirection:"column"},[`&.${D.disabled}`]:{cursor:"default"},variants:[{props:{orientation:"vertical"},style:{textAlign:"left",padding:"8px 0"}}]}),gt=F("span",{name:"MuiStepLabel",slot:"Label"})(Y(({theme:t})=>({...t.typography.body2,display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),[`&.${D.active}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${D.completed}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${D.alternativeLabel}`]:{marginTop:16},[`&.${D.error}`]:{color:(t.vars||t).palette.error.main}}))),ft=F("span",{name:"MuiStepLabel",slot:"IconContainer"})({flexShrink:0,display:"flex",paddingRight:8,[`&.${D.alternativeLabel}`]:{paddingRight:0}}),vt=F("span",{name:"MuiStepLabel",slot:"LabelContainer"})(Y(({theme:t})=>({width:"100%",color:(t.vars||t).palette.text.secondary,[`&.${D.alternativeLabel}`]:{textAlign:"center"}}))),Re=i.forwardRef(function(n,s){const l=H({props:n,name:"MuiStepLabel"}),{children:r,className:o,componentsProps:c={},error:p=!1,icon:h,optional:g,slots:m={},slotProps:u={},StepIconComponent:b,StepIconProps:y,...C}=l,{alternativeLabel:A,orientation:k}=i.useContext(te),{active:R,disabled:x,completed:a,icon:f}=i.useContext(pe),L=h||f;let w=b;L&&!w&&(w=xt);const I={...l,active:R,alternativeLabel:A,completed:a,disabled:x,error:p,orientation:k},S=mt(I),P={slots:m,slotProps:{stepIcon:y,...c,...u}},[B,W]=se("root",{elementType:bt,externalForwardedProps:{...P,...C},ownerState:I,ref:s,className:U(S.root,o)}),[$,Q]=se("label",{elementType:gt,externalForwardedProps:P,ownerState:I}),[V,ne]=se("stepIcon",{elementType:w,externalForwardedProps:P,ownerState:I});return e.jsxs(B,{...W,children:[L||V?e.jsx(ft,{className:S.iconContainer,ownerState:I,children:e.jsx(V,{completed:a,active:R,error:p,icon:L,...ne})}):null,e.jsxs(vt,{className:S.labelContainer,ownerState:I,children:[r?e.jsx($,{...Q,className:U(S.label,Q?.className),children:r}):null,g]})]})});Re.muiName="StepLabel";function yt(t){return q("MuiStepConnector",t)}J("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const jt=t=>{const{classes:n,orientation:s,alternativeLabel:l,active:r,completed:o,disabled:c}=t,p={root:["root",s,l&&"alternativeLabel",r&&"active",o&&"completed",c&&"disabled"],line:["line",`line${je(s)}`]};return G(p,yt,n)},St=F("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.root,n[s.orientation],s.alternativeLabel&&n.alternativeLabel,s.completed&&n.completed]}})({flex:"1 1 auto",variants:[{props:{orientation:"vertical"},style:{marginLeft:12}},{props:{alternativeLabel:!0},style:{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"}}]}),Ct=F("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.line,n[`line${je(s.orientation)}`]]}})(Y(({theme:t})=>{const n=t.palette.mode==="light"?t.palette.grey[400]:t.palette.grey[600];return{display:"block",borderColor:t.vars?t.vars.palette.StepConnector.border:n,variants:[{props:{orientation:"horizontal"},style:{borderTopStyle:"solid",borderTopWidth:1}},{props:{orientation:"vertical"},style:{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24}}]}})),Lt=i.forwardRef(function(n,s){const l=H({props:n,name:"MuiStepConnector"}),{className:r,...o}=l,{alternativeLabel:c,orientation:p="horizontal"}=i.useContext(te),{active:h,disabled:g,completed:m}=i.useContext(pe),u={...l,alternativeLabel:c,orientation:p,active:h,completed:m,disabled:g},b=jt(u);return e.jsx(St,{className:U(b.root,r),ref:s,ownerState:u,...o,children:e.jsx(Ct,{className:b.line,ownerState:u})})});function wt(t){return q("MuiStepper",t)}J("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);const It=t=>{const{orientation:n,nonLinear:s,alternativeLabel:l,classes:r}=t;return G({root:["root",n,s&&"nonLinear",l&&"alternativeLabel"]},wt,r)},zt=F("div",{name:"MuiStepper",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.root,n[s.orientation],s.alternativeLabel&&n.alternativeLabel,s.nonLinear&&n.nonLinear]}})({display:"flex",variants:[{props:{orientation:"horizontal"},style:{flexDirection:"row",alignItems:"center"}},{props:{orientation:"vertical"},style:{flexDirection:"column"}},{props:{alternativeLabel:!0},style:{alignItems:"flex-start"}}]}),At=e.jsx(Lt,{}),kt=i.forwardRef(function(n,s){const l=H({props:n,name:"MuiStepper"}),{activeStep:r=0,alternativeLabel:o=!1,children:c,className:p,component:h="div",connector:g=At,nonLinear:m=!1,orientation:u="horizontal",...b}=l,y={...l,nonLinear:m,alternativeLabel:o,orientation:u,component:h},C=It(y),A=i.Children.toArray(c).filter(Boolean),k=A.map((x,a)=>i.cloneElement(x,{index:a,last:a+1===A.length,...x.props})),R=i.useMemo(()=>({activeStep:r,alternativeLabel:o,connector:g,nonLinear:m,orientation:u}),[r,o,g,m,u]);return e.jsx(te.Provider,{value:R,children:e.jsx(zt,{as:h,ownerState:y,className:U(C.root,p),ref:s,...b,children:k})})}),Rt=de(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}));async function ye({file:t,templateId:n,connectionId:s,onProgress:l,background:r=!1,signal:o}){if(!t)throw new Error("No file provided for analysis");const c=new FormData;if(c.append("file",t),n&&c.append("template_id",n),s&&c.append("connection_id",s),r){const h=await ie(`${ce}/analyze/upload?background=true`,{method:"POST",body:c});if(!h.ok){const g=await h.text().catch(()=>"");throw new Error(g||`Failed to queue analysis (${h.status})`)}return h.json()}const p=await ie(`${ce}/analyze/upload`,{method:"POST",body:c,signal:o});return Me(p,{onEvent:l,errorMessage:"Document analysis failed"})}async function Et(t,{question:n,includeSampleData:s=!0,tableIds:l}={}){if(!t)throw new Error("Analysis ID is required");const r={question:n||"",include_sample_data:s};Array.isArray(l)&&l.length&&(r.table_ids=l);const o=await ie(`${ce}/analyze/${encodeURIComponent(t)}/charts/suggest`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!o.ok){const c=await o.text().catch(()=>"");throw new Error(c||`Failed to get chart suggestions (${o.status})`)}return o.json()}function Tt(t,n=0){if(!t||typeof t!="object")return null;const s=typeof t.type=="string"?t.type.toLowerCase().trim():"bar",l=typeof t.xField=="string"?t.xField.trim():"";let r=t.yFields;typeof r=="string"&&(r=[r]),Array.isArray(r)||(r=[]);const o=r.map(c=>typeof c=="string"?c.trim():String(c)).filter(Boolean);return!l||!o.length?null:{id:t.id?String(t.id):`chart_${n+1}`,type:s,xField:l,yFields:o,groupField:t.groupField??null,aggregation:t.aggregation??null,title:t.title??null,description:t.description??null}}function Mt(t){if(!t)return{valid:!1,error:"No file selected"};const n=50;if(t.size>n*1024*1024)return{valid:!1,error:`File too large. Maximum size is ${n}MB.`};const s=t.name.toLowerCase();return[".pdf",".xlsx",".xls",".xlsm"].some(o=>s.endsWith(o))?{valid:!0}:{valid:!1,error:"Only PDF and Excel files are supported."}}const Pt=".pdf,.xlsx,.xls,.xlsm";function Ft({onFileSelect:t,isUploading:n=!1,progress:s=0,progressStage:l="",error:r=null,disabled:o=!1}){const[c,p]=i.useState(!1),[h,g]=i.useState(null),[m,u]=i.useState(null),b=i.useCallback(x=>{x.preventDefault(),x.stopPropagation(),x.type==="dragenter"||x.type==="dragover"?p(!0):x.type==="dragleave"&&p(!1)},[]),y=i.useCallback(x=>{u(null);const a=Mt(x);if(!a.valid){u(a.error),g(null);return}g(x),t?.(x)},[t]),C=i.useCallback(x=>{if(x.preventDefault(),x.stopPropagation(),p(!1),o||n)return;const a=x.dataTransfer?.files;a&&a.length>0&&y(a[0])},[o,n,y]),A=i.useCallback(x=>{const a=x.target?.files;a&&a.length>0&&y(a[0]),x.target.value=""},[y]),k=i.useCallback(()=>{g(null),u(null),t?.(null)},[t]),R=r||m;return e.jsxs(Se,{variant:"outlined",onDragEnter:b,onDragLeave:b,onDragOver:b,onDrop:C,sx:{p:4,textAlign:"center",cursor:o||n?"default":"pointer",transition:"all 0.2s ease",borderStyle:"dashed",borderWidth:2,borderColor:c||R||h?"text.secondary":"divider",bgcolor:c?"action.hover":R?"error.lighter":h?"success.lighter":"background.paper","&:hover":{borderColor:o||n?void 0:"text.secondary",bgcolor:o||n?void 0:"action.hover"}},children:[e.jsx("input",{type:"file",accept:Pt,onChange:A,disabled:o||n,style:{display:"none"},id:"document-upload-input"}),n?e.jsxs(j,{spacing:2,alignItems:"center",children:[e.jsx(v,{variant:"body1",color:"text.secondary",children:l||"Analyzing document..."}),e.jsx(M,{sx:{width:"100%",maxWidth:400},children:e.jsx(Ce,{variant:"determinate",value:s})}),e.jsxs(v,{variant:"body2",color:"text.secondary",children:[s,"% complete"]})]}):h?e.jsxs(j,{spacing:2,alignItems:"center",children:[e.jsx(Pe,{sx:{fontSize:48,color:"text.secondary"}}),e.jsxs(j,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Ye,{color:"action"}),e.jsx(v,{variant:"body1",children:h.name}),e.jsx(E,{size:"small",label:`${(h.size/1024/1024).toFixed(2)} MB`,variant:"outlined"})]}),e.jsx(_,{variant:"outlined",size:"small",onClick:k,children:"Choose different file"})]}):e.jsx("label",{htmlFor:"document-upload-input",style:{cursor:o?"default":"pointer"},children:e.jsxs(j,{spacing:2,alignItems:"center",children:[e.jsx(Fe,{sx:{fontSize:48,color:"text.secondary"}}),e.jsx(v,{variant:"h6",color:"text.primary",children:"Drop a document here or click to browse"}),e.jsx(v,{variant:"body2",color:"text.secondary",children:"Supports PDF and Excel files (max 50MB)"}),e.jsxs(j,{direction:"row",spacing:1,children:[e.jsx(E,{label:"PDF",size:"small",variant:"outlined"}),e.jsx(E,{label:"XLSX",size:"small",variant:"outlined"}),e.jsx(E,{label:"XLS",size:"small",variant:"outlined"})]})]})}),R&&e.jsx(O,{severity:"error",sx:{mt:2,textAlign:"left"},children:R})]})}function le({children:t,value:n,index:s,...l}){return e.jsx("div",{role:"tabpanel",hidden:n!==s,id:`analysis-tabpanel-${s}`,"aria-labelledby":`analysis-tab-${s}`,...l,children:n===s&&e.jsx(M,{sx:{py:2},children:t})})}function $t({metric:t}){const n=(s,l)=>{if(s==null)return"N/A";if(typeof s=="number"){const r=s.toLocaleString(void 0,{maximumFractionDigits:2});return l?`${r} ${l}`:r}return String(s)};return e.jsx(tt,{variant:"outlined",children:e.jsxs(nt,{sx:{py:1.5,"&:last-child":{pb:1.5}},children:[e.jsx(v,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:t.key}),e.jsx(v,{variant:"h6",fontWeight:600,children:n(t.value,t.unit)}),t.context&&e.jsx(v,{variant:"caption",color:"text.secondary",children:t.context})]})})}function Nt({table:t,maxRows:n=50}){const s=t.rows?.slice(0,n)||[],l=(t.rows?.length||0)>n;return e.jsxs(Ie,{sx:{maxHeight:400},children:[e.jsxs(ze,{size:"small",stickyHeader:!0,children:[e.jsx(Ae,{children:e.jsx(ee,{children:t.headers?.map((r,o)=>e.jsx(N,{sx:{fontWeight:600,bgcolor:"background.paper"},children:e.jsxs(j,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx("span",{children:r}),t.data_types?.[o]&&e.jsx(E,{label:t.data_types[o],size:"small",variant:"outlined",sx:{fontSize:"0.65rem",height:18}})]})},o))})}),e.jsx(ke,{children:s.map((r,o)=>e.jsx(ee,{hover:!0,children:r.map((c,p)=>e.jsx(N,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis"},children:c||"-"},p))},o))})]}),l&&e.jsxs(v,{variant:"caption",color:"text.secondary",sx:{p:1,display:"block"},children:["Showing ",n," of ",t.rows.length," rows"]})]})}function _t({result:t}){const[n,s]=i.useState(0),[l,r]=i.useState(0),{document_name:o,document_type:c,processing_time_ms:p,summary:h,tables:g=[],data_points:m=[],chart_suggestions:u=[],raw_data:b=[],field_catalog:y=[],warnings:C=[]}=t||{},A=(a,f)=>{s(f)},k=()=>{if(!b||b.length===0)return;const a=Object.keys(b[0]),L=[a.join(","),...b.map(P=>a.map(B=>{const W=P[B];if(W==null)return"";const $=String(W);return $.includes(",")||$.includes('"')?`"${$.replace(/"/g,'""')}"`:$}).join(","))].join(`
`),w=new Blob([L],{type:"text/csv;charset=utf-8;"}),I=URL.createObjectURL(w),S=document.createElement("a");S.href=I,S.download=`${o||"analysis"}_data.csv`,S.click(),URL.revokeObjectURL(I)},R=()=>{if(!b||b.length===0)return;const a=JSON.stringify(b,null,2),f=new Blob([a],{type:"application/json;charset=utf-8;"}),L=URL.createObjectURL(f),w=document.createElement("a");w.href=L,w.download=`${o||"analysis"}_data.json`,w.click(),URL.revokeObjectURL(L)},x=u[l]||null;return e.jsxs(M,{children:[e.jsxs(j,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsxs(j,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(v,{variant:"h6",children:o||"Analysis Results"}),e.jsx(E,{label:c?.toUpperCase(),size:"small",variant:"outlined",sx:{bgcolor:a=>a.palette.mode==="dark"?we(a.palette.text.primary,.1):Le[400],color:"text.secondary"}}),p&&e.jsx(E,{label:`${(p/1e3).toFixed(1)}s`,size:"small",variant:"outlined"})]}),e.jsxs(j,{direction:"row",spacing:1,children:[e.jsx(_,{startIcon:e.jsx(xe,{}),size:"small",onClick:k,disabled:!b?.length,children:"Export CSV"}),e.jsx(_,{startIcon:e.jsx(xe,{}),size:"small",onClick:R,disabled:!b?.length,children:"Export JSON"})]})]}),h&&e.jsx(O,{severity:"info",sx:{mb:2},children:h}),C.length>0&&e.jsx(O,{severity:"warning",sx:{mb:2},children:C.join("; ")}),m.length>0&&e.jsxs(M,{sx:{mb:3},children:[e.jsx(v,{variant:"subtitle2",sx:{mb:1},children:"Key Metrics"}),e.jsx(ge,{container:!0,spacing:2,children:m.slice(0,8).map((a,f)=>e.jsx(ge,{size:{xs:6,sm:4,md:3},children:e.jsx($t,{metric:a})},f))})]}),e.jsxs(Se,{variant:"outlined",sx:{mb:3},children:[e.jsxs(Xe,{value:n,onChange:A,sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(oe,{icon:e.jsx(be,{}),label:`Charts (${u.length})`,iconPosition:"start"}),e.jsx(oe,{icon:e.jsx(he,{}),label:`Tables (${g.length})`,iconPosition:"start"}),e.jsx(oe,{icon:e.jsx(Qe,{}),label:`Fields (${y.length})`,iconPosition:"start"})]}),e.jsx(le,{value:n,index:0,children:u.length>0?e.jsxs(M,{children:[e.jsx(j,{direction:"row",spacing:1,sx:{mb:2,flexWrap:"wrap",gap:1},children:u.map((a,f)=>e.jsx(E,{label:a.title||`Chart ${f+1}`,onClick:()=>r(f),color:l===f?"primary":"default",variant:l===f?"filled":"outlined",icon:a.type==="line"?e.jsx($e,{}):e.jsx(be,{})},f))}),x&&e.jsx(Je,{data:b,spec:x,height:400,showBrush:b.length>15})]}):e.jsx(v,{color:"text.secondary",textAlign:"center",py:4,children:"No chart suggestions available"})}),e.jsx(le,{value:n,index:1,children:g.length>0?e.jsx(j,{spacing:2,children:g.map((a,f)=>e.jsxs(Ke,{defaultExpanded:f===0,children:[e.jsx(Ze,{expandIcon:e.jsx(Ne,{}),children:e.jsxs(j,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(he,{fontSize:"small",color:"action"}),e.jsx(v,{fontWeight:500,children:a.title||a.id||`Table ${f+1}`}),e.jsx(E,{label:`${a.rows?.length||0} rows`,size:"small",variant:"outlined"}),e.jsx(E,{label:`${a.headers?.length||0} cols`,size:"small",variant:"outlined"}),a.source_page&&e.jsx(E,{label:`Page ${a.source_page}`,size:"small"}),a.source_sheet&&e.jsx(E,{label:a.source_sheet,size:"small"})]})}),e.jsx(et,{sx:{p:0},children:e.jsx(Nt,{table:a})})]},f))}):e.jsx(v,{color:"text.secondary",textAlign:"center",py:4,children:"No tables extracted"})}),e.jsx(le,{value:n,index:2,children:y.length>0?e.jsx(Ie,{children:e.jsxs(ze,{size:"small",children:[e.jsx(Ae,{children:e.jsxs(ee,{children:[e.jsx(N,{sx:{fontWeight:600},children:"Field Name"}),e.jsx(N,{sx:{fontWeight:600},children:"Type"}),e.jsx(N,{sx:{fontWeight:600},children:"Sample Values"})]})}),e.jsx(ke,{children:y.map((a,f)=>e.jsxs(ee,{hover:!0,children:[e.jsx(N,{children:a.name}),e.jsx(N,{children:e.jsx(E,{label:a.type,size:"small",color:a.type==="numeric"?"success":a.type==="datetime"?"info":"default",variant:"outlined"})}),e.jsx(N,{children:a.sample_values?.slice(0,3).join(", ")||"-"})]},f))})]})}):e.jsx(v,{color:"text.secondary",textAlign:"center",py:4,children:"No field information available"})})]})]})}const Dt=[{label:"Upload Document",icon:e.jsx(Rt,{fontSize:"small"})},{label:"AI Analysis",icon:e.jsx(Z,{fontSize:"small"})},{label:"View Results",icon:e.jsx(He,{fontSize:"small"})}];function an(){const[t,n]=i.useState(0),[s,l]=i.useState(null),[r,o]=i.useState(!1),[c,p]=i.useState(0),[h,g]=i.useState(""),[m,u]=i.useState(null),[b,y]=i.useState(null),[C,A]=i.useState(""),[k,R]=i.useState(!1),[x,a]=i.useState(!1),[f,L]=i.useState(null),w=i.useRef(null),I=_e(),{execute:S}=De(),P=We(),B=i.useCallback((d,z,T={})=>P(d,{label:z,intent:{from:"analyze",...T}}),[P]),W=i.useCallback(d=>{l(d),y(null),u(null),L(null),d&&n(0)},[]),$=i.useCallback(()=>{if(s)return S({type:K.ANALYZE,label:x?"Queue analysis":"Analyze document",reversibility:X.FULLY_REVERSIBLE,blocksNavigation:!x,suppressSuccessToast:!0,intent:{fileName:s?.name,background:x},action:async()=>{if(w.current=new AbortController,o(!0),p(0),g("Starting analysis..."),y(null),L(null),x){try{const d=await ye({file:s,background:!0}),z=d?.job_id||d?.jobId||null;L(z),u(null),n(0),I.show("Analysis queued in background","success")}catch(d){d.name!=="AbortError"&&y(d.message||"Failed to queue analysis")}finally{o(!1),p(0),g(""),w.current=null}return}n(1);try{const d=await ye({file:s,signal:w.current?.signal,onProgress:z=>{z.event==="stage"&&(p(z.progress||0),g(z.detail||z.stage||"Processing..."))}});d.event==="result"&&(u(d),n(2))}catch(d){d.name==="AbortError"?(I.show("Analysis cancelled","info"),n(0)):(y(d.message||"Analysis failed"),n(0))}finally{o(!1),p(100),w.current=null}}})},[S,s,x,I]),Q=i.useCallback(()=>S({type:K.UPDATE,label:"Cancel analysis",reversibility:X.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"analyze"},action:()=>{w.current&&(w.current.abort(),o(!1),n(0),p(0),g(""),I.show("Analysis cancelled","info"))}}),[S,I]),V=i.useCallback(()=>{if(!(!m?.analysis_id||!C.trim()))return S({type:K.GENERATE,label:"Generate charts",reversibility:X.FULLY_REVERSIBLE,blocksNavigation:!0,suppressSuccessToast:!0,intent:{analysisId:m.analysis_id},action:async()=>{R(!0);try{const d=await Et(m.analysis_id,{question:C,includeSampleData:!0});if(d?.charts){const z=d.charts.map((T,Ee)=>Tt(T,Ee)).filter(Boolean);u(T=>({...T,chart_suggestions:[...z,...T.chart_suggestions||[]]}))}}catch(d){y(d.message||"Failed to generate charts")}finally{R(!1),A("")}}})},[m?.analysis_id,C,S]),ne=i.useCallback(()=>S({type:K.UPDATE,label:"Reset analysis",reversibility:X.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"analyze"},action:()=>{l(null),u(null),y(null),n(0),A(""),L(null)}}),[S]),ue=(()=>{const d=[];if(s&&d.push({label:s.name,color:"primary",variant:"outlined"}),m){const z=m.tables?.length||0,T=m.chart_suggestions?.length||0;z>0&&d.push({label:`${z} table${z!==1?"s":""} found`,color:"success"}),T>0&&d.push({label:`${T} chart${T!==1?"s":""}`,color:"info"})}return d})();return e.jsxs(M,{sx:{py:3,px:3},children:[e.jsxs(j,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:3},children:[e.jsxs(M,{children:[e.jsx(v,{variant:"h5",fontWeight:700,children:"Analyze Document"}),e.jsx(v,{variant:"body2",color:"text.secondary",children:"Upload PDF or Excel files to extract tables and generate interactive visualizations."})]}),m&&e.jsx(_,{variant:"outlined",size:"small",startIcon:e.jsx(Ue,{}),onClick:ne,sx:{textTransform:"none",fontWeight:600},children:"New Analysis"})]}),e.jsxs(j,{spacing:3,children:[ue.length>0&&e.jsx(j,{direction:"row",spacing:1,flexWrap:"wrap",children:ue.map((d,z)=>e.jsx(E,{label:d.label,size:"small",variant:d.variant||"filled",icon:d.color==="success"?e.jsx(Ge,{}):void 0,sx:{fontWeight:500,bgcolor:T=>T.palette.mode==="dark"?we(T.palette.text.primary,.1):Le[400],color:"text.secondary"}},z))}),f&&e.jsxs(O,{severity:"info",action:e.jsx(_,{size:"small",onClick:()=>B("/jobs","Open jobs"),sx:{textTransform:"none"},children:"View Jobs"}),sx:{alignItems:"center"},children:["Analysis queued in background. Job ID: ",f]}),e.jsxs(fe,{sx:{p:3},children:[e.jsx(kt,{activeStep:t,sx:{mb:3,"& .MuiStepLabel-label":{fontWeight:500},"& .MuiStepLabel-label.Mui-active":{fontWeight:700,color:"text.secondary"},"& .MuiStepLabel-label.Mui-completed":{fontWeight:600,color:"text.secondary"}},children:Dt.map((d,z)=>e.jsx(lt,{completed:t>z,children:e.jsx(Re,{StepIconProps:{sx:{"&.Mui-completed":{color:"text.secondary"},"&.Mui-active":{color:"text.secondary"}}},children:e.jsxs(j,{direction:"row",alignItems:"center",spacing:.5,children:[d.icon,e.jsx("span",{children:d.label})]})})},d.label))}),t===0&&e.jsxs(M,{children:[e.jsx(Ft,{onFileSelect:W,isUploading:r,progress:c,progressStage:h,error:b,disabled:r}),s&&!r&&e.jsxs(j,{spacing:2,sx:{mt:3},children:[e.jsx(Be,{control:e.jsx(st,{checked:x,onChange:d=>a(d.target.checked)}),label:"Run in background",sx:{alignSelf:"center"}}),e.jsx(j,{direction:"row",justifyContent:"center",children:e.jsx(_,{variant:"contained",size:"large",onClick:$,startIcon:e.jsx(Z,{}),sx:{px:4,py:1.5,fontWeight:700,fontSize:"1rem",textTransform:"none",borderRadius:1,boxShadow:"0 4px 14px rgba(79, 70, 229, 0.25)","&:hover":{boxShadow:"0 6px 20px rgba(79, 70, 229, 0.35)"}},children:x?"Queue Analysis":"Analyze with AI"})})]})]}),t===1&&e.jsxs(M,{sx:{textAlign:"center",py:6},children:[e.jsxs(M,{sx:{position:"relative",display:"inline-flex",mb:3},children:[e.jsx(me,{size:80,thickness:4,variant:c>0?"determinate":"indeterminate",value:c,sx:{color:"text.secondary"}}),e.jsx(M,{sx:{position:"absolute",top:0,left:0,bottom:0,right:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(v,{variant:"caption",fontWeight:700,color:"text.secondary",children:[c,"%"]})})]}),e.jsx(v,{variant:"h6",fontWeight:600,gutterBottom:!0,children:h||"Analyzing document..."}),e.jsx(v,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"AI is extracting tables, metrics, and generating chart suggestions"}),e.jsx(Ce,{variant:"determinate",value:c,sx:{height:6,borderRadius:1,maxWidth:400,mx:"auto",mb:3,bgcolor:"action.hover","& .MuiLinearProgress-bar":{borderRadius:1}}}),e.jsx(_,{variant:"outlined",color:"inherit",startIcon:e.jsx(Ve,{}),onClick:Q,sx:{textTransform:"none",fontWeight:500},children:"Cancel Analysis"})]}),t===2&&m&&e.jsxs(M,{children:[e.jsx(_t,{result:m}),e.jsx(Oe,{sx:{my:3}}),e.jsxs(fe,{variant:"outlined",sx:{p:2.5,bgcolor:"action.hover",border:"1px dashed",borderColor:"divider"},children:[e.jsxs(j,{direction:"row",alignItems:"center",spacing:1,sx:{mb:2},children:[e.jsx(Z,{color:"inherit",fontSize:"small",sx:{color:"text.secondary"}}),e.jsx(v,{variant:"subtitle1",fontWeight:600,children:"Ask for more insights"})]}),e.jsxs(j,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(qe,{fullWidth:!0,placeholder:"e.g., Show me revenue trends over time, Compare categories by month...",value:C,onChange:d=>A(d.target.value),onKeyDown:d=>d.key==="Enter"&&!d.shiftKey&&V(),disabled:k,size:"small",sx:{"& .MuiOutlinedInput-root":{bgcolor:"background.paper"}}}),e.jsx(_,{variant:"contained",onClick:V,disabled:!C.trim()||k,startIcon:k?e.jsx(me,{size:16,color:"inherit"}):e.jsx(Z,{}),sx:{minWidth:160,textTransform:"none",fontWeight:600,whiteSpace:"nowrap"},children:k?"Generating...":"Generate Charts"})]})]})]}),b&&t!==0&&e.jsx(O,{severity:"error",sx:{mt:2},children:b})]}),e.jsxs(M,{sx:{textAlign:"center",py:1},children:[e.jsx(v,{variant:"body2",color:"text.secondary",children:"Supported formats: PDF, Excel (XLSX, XLS) â€¢ Max file size: 50MB"}),e.jsx(v,{variant:"caption",color:"text.disabled",children:"AI-powered extraction with zoomable, interactive time series charts"})]})]})]})}export{an as default};
