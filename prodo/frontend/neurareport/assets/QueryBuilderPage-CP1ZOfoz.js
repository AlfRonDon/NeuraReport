import{i as I,bN as Je,u as Ke,v as Xe,a as Le,ch as Ve,l as Se,r as x,R as F,I as $,j as t,B as z,o as h,q as f,J as Ze,bc as Ce,bh as D,T as oe,e as O,G as je,p as G,n as m,f as u,H as et,m as tt,S as rt,M as nt,t as ot,C as we,ci as st,A as se,b0 as at,aY as it,aj as lt,al as ct,am as dt,K as Y,bd as ut,bi as pt,N as C,O as yt,aJ as xt,ah as mt}from"./index-tNjrNcyx.js";import{S as ft}from"./Save-BetSEFm3.js";import{C as gt}from"./ContentCopy-CSRr3Ypv.js";import{L as ht}from"./Lightbulb-B6WhFsgN.js";import{S as bt}from"./Bookmark-B-0khTqH.js";import{D as vt}from"./DataTable-F_AvoqZV.js";import{C as Ie}from"./ConfirmModal-BBknfNQr.js";import{g as St}from"./sqlSafety-CLxawa7_.js";import{A as Ct}from"./AiUsageNotice-DsJkyA9j.js";import{u as jt,F as Qe,O as ke}from"./useCrossPageActions-DrOddMdH.js";import{S as wt}from"./SendToMenu-BAH-IA3-.js";import{D as It}from"./DisabledTooltip-D1wsVXFZ.js";import{S as Qt}from"./Switch-CfAkngKV.js";import"./KeyboardArrowDown-DDM4t9XR.js";import"./FilterList-HB9KZahR.js";import"./Check-Bn4nI-8y.js";import"./MoreVert-DkxcPdp7.js";import"./TableRow-DBskq6ho.js";import"./TableContainer-C-NObv0f.js";import"./KeyboardArrowRight-Bcg6K-f5.js";import"./CheckCircleOutline-DkNeJ2sB.js";import"./WarningAmber-D6zaqvXu.js";import"./SummarizeRounded-C-wzhQHR.js";function kt(e,a){let n;try{n=e()}catch{return}return{getItem:s=>{var i;const y=j=>j===null?null:JSON.parse(j,void 0),p=(i=n.getItem(s))!=null?i:null;return p instanceof Promise?p.then(y):y(p)},setItem:(s,i)=>n.setItem(s,JSON.stringify(i,void 0)),removeItem:s=>n.removeItem(s)}}const ae=e=>a=>{try{const n=e(a);return n instanceof Promise?n:{then(o){return ae(o)(n)},catch(o){return this}}}catch(n){return{then(o){return this},catch(o){return ae(o)(n)}}}},qt=(e,a)=>(n,o,s)=>{let i={storage:kt(()=>localStorage),partialize:l=>l,version:0,merge:(l,b)=>({...b,...l}),...a},y=!1,p=0;const j=new Set,q=new Set;let S=i.storage;if(!S)return e((...l)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),n(...l)},o,s);const Q=()=>{const l=i.partialize({...o()});return S.setItem(i.name,{state:l,version:i.version})},M=s.setState;s.setState=(l,b)=>(M(l,b),Q());const k=e((...l)=>(n(...l),Q()),o,s);s.getInitialState=()=>k;let w;const T=()=>{var l,b;if(!S)return;const L=++p;y=!1,j.forEach(g=>{var v;return g((v=o())!=null?v:k)});const c=((b=i.onRehydrateStorage)==null?void 0:b.call(i,(l=o())!=null?l:k))||void 0;return ae(S.getItem.bind(S))(i.name).then(g=>{if(g)if(typeof g.version=="number"&&g.version!==i.version){if(i.migrate){const v=i.migrate(g.state,g.version);return v instanceof Promise?v.then(H=>[!0,H]):[!0,v]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,g.state];return[!1,void 0]}).then(g=>{var v;if(L!==p)return;const[H,N]=g;if(w=i.merge(N,(v=o())!=null?v:k),n(w,!0),H)return Q()}).then(()=>{L===p&&(c?.(w,void 0),w=o(),y=!0,q.forEach(g=>g(w)))}).catch(g=>{L===p&&c?.(void 0,g)})};return s.persist={setOptions:l=>{i={...i,...l},l.storage&&(S=l.storage)},clearStorage:()=>{S?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>T(),hasHydrated:()=>y,onHydrate:l=>(j.add(l),()=>{j.delete(l)}),onFinishHydration:l=>(q.add(l),()=>{q.delete(l)})},i.skipHydration||T(),w||k},Et=qt,He=(e,a=[])=>{if(Array.isArray(e))return e;if(!e||typeof e!="object")return[];for(const n of a)if(Array.isArray(e[n]))return e[n];return[]};async function Rt({question:e,connectionId:a,tables:n,context:o}){const{data:s}=await I.post("/nl2sql/generate",{question:e,connection_id:a,tables:n?.length?n:void 0,context:o||void 0});return s}async function Tt({sql:e,connectionId:a,limit:n=100,offset:o=0,includeTotal:s=!1}){const{data:i}=await I.post("/nl2sql/execute",{sql:e,connection_id:a,limit:n,offset:o,include_total:s});return i}async function Lt(e,a){const n=a??e,{data:o}=await I.post("/nl2sql/explain",null,{params:{sql:n}});return o}async function Ht({name:e,sql:a,connectionId:n,description:o,originalQuestion:s,tags:i}){const{data:y}=await I.post("/nl2sql/save",{name:e,sql:a,connection_id:n,description:o||void 0,original_question:s||void 0,tags:i?.length?i:void 0});return y}async function At({connectionId:e,tags:a}={}){const{data:n}=await I.get("/nl2sql/saved",{params:{connection_id:e||void 0,tags:a?.length?a:void 0}});if(Array.isArray(n))return{queries:n,total:n.length};if(n&&typeof n=="object"){const o=He(n,["queries","saved_queries","items","results"]);return{...n,queries:o,total:n.total??n.count??o.length}}return{queries:[],total:0}}async function Dt(e){const{data:a}=await I.get(`/nl2sql/saved/${encodeURIComponent(e)}`);return a&&typeof a=="object"&&a.query?a.query:a}async function zt(e){const{data:a}=await I.delete(`/nl2sql/saved/${encodeURIComponent(e)}`);return a}async function Ae(e={}){const a=typeof e=="string"?{connectionId:e,limit:50}:e||{},{connectionId:n,limit:o=50}=a,{data:s}=await I.get("/nl2sql/history",{params:{connection_id:n||void 0,limit:o}});if(Array.isArray(s))return{history:s,total:s.length};if(s&&typeof s=="object"){const i=He(s,["history","queries","items","results"]);return{...s,history:i,total:s.total??s.count??i.length}}return{history:[],total:0}}async function De(e){const{data:a}=await I.delete(`/nl2sql/history/${encodeURIComponent(e)}`);return a}const qe=Je(Et((e,a)=>({currentQuestion:"",generatedSQL:"",explanation:"",confidence:0,warnings:[],results:null,columns:[],totalCount:null,executionTimeMs:null,includeTotal:!1,isGenerating:!1,isExecuting:!1,error:null,savedQueries:[],queryHistory:[],selectedConnectionId:null,selectedTables:[],setCurrentQuestion:n=>e({currentQuestion:n}),setGeneratedSQL:n=>e({generatedSQL:n}),setSelectedConnection:n=>e({selectedConnectionId:n,selectedTables:[]}),setSelectedTables:n=>e({selectedTables:n}),setGenerationResult:({sql:n,explanation:o,confidence:s,warnings:i,originalQuestion:y})=>e({generatedSQL:n,explanation:o,confidence:s,warnings:i||[],currentQuestion:y,error:null}),setExecutionResult:({columns:n,rows:o,rowCount:s,totalCount:i,executionTimeMs:y,truncated:p})=>e({results:o,columns:n,totalCount:i,executionTimeMs:y,error:null}),setIncludeTotal:n=>e({includeTotal:!!n}),setError:n=>e({error:n,isGenerating:!1,isExecuting:!1}),setIsGenerating:n=>e({isGenerating:n}),setIsExecuting:n=>e({isExecuting:n}),clearResults:()=>e({results:null,columns:[],totalCount:null,executionTimeMs:null}),clearAll:()=>e({currentQuestion:"",generatedSQL:"",explanation:"",confidence:0,warnings:[],results:null,columns:[],totalCount:null,executionTimeMs:null,error:null}),setSavedQueries:n=>e({savedQueries:n}),addSavedQuery:n=>e(o=>({savedQueries:[n,...o.savedQueries]})),removeSavedQuery:n=>e(o=>({savedQueries:o.savedQueries.filter(s=>s.id!==n)})),setQueryHistory:n=>e({queryHistory:n}),addToHistory:n=>e(o=>({queryHistory:[n,...o.queryHistory].slice(0,100)})),explainQuery:async(n,o)=>{e({isGenerating:!0,error:null});try{const s=await Lt(n,o);return e({explanation:s.explanation||"",isGenerating:!1}),s}catch(s){return e({error:s.message,isGenerating:!1}),null}},fetchSavedQuery:async n=>{try{return await Dt(n)}catch(o){return e({error:o.message}),null}},fetchQueryHistory:async(n=null)=>{try{const o=await Ae({connectionId:n}),s=Array.isArray(o)?o:o?.history||[];return e({queryHistory:s}),s}catch(o){return e({error:o.message}),[]}},deleteQueryHistoryEntry:async n=>{try{return await De(n),e(o=>({queryHistory:o.queryHistory.filter(s=>s.id!==n)})),!0}catch(o){return e({error:o.message}),!1}},loadSavedQuery:n=>e({currentQuestion:n.original_question||"",generatedSQL:n.sql,selectedConnectionId:n.connection_id,explanation:"",confidence:0,warnings:[],results:null,columns:[],error:null})}),{name:"neura-query-store",partialize:e=>({selectedConnectionId:e.selectedConnectionId,queryHistory:e.queryHistory.slice(0,20)}),onRehydrateStorage:()=>e=>{if(e&&e.selectedConnectionId!=null){const a=e.selectedConnectionId;(typeof a!="string"||a.trim()==="")&&(e.selectedConnectionId=null)}}})),Mt=C(z)(({theme:e})=>({padding:e.spacing(3),maxWidth:1400,margin:"0 auto",width:"100%",minHeight:"100vh",backgroundColor:e.palette.background.default})),_t=C(f)(({theme:e})=>({marginBottom:e.spacing(3),animation:`${yt} 0.5s ease-out`})),Ee=C(Y)(({theme:e})=>({borderRadius:12,textTransform:"none",fontWeight:500,borderColor:u(e.palette.divider,.2),transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{borderColor:e.palette.mode==="dark"?m[500]:m[700],backgroundColor:e.palette.mode==="dark"?u(e.palette.text.primary,.08):m[100]}})),Re=C(Y)(({theme:e})=>({borderRadius:12,textTransform:"none",fontWeight:600,background:e.palette.mode==="dark"?m[700]:m[900],color:e.palette.common.white,boxShadow:`0 4px 14px ${u(e.palette.common.black,.15)}`,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{background:e.palette.mode==="dark"?m[500]:m[700],boxShadow:`0 6px 20px ${u(e.palette.common.black,.2)}`,transform:"translateY(-1px)"},"&:active":{transform:"translateY(0)"},"&:disabled":{background:u(e.palette.text.disabled,.2),color:e.palette.text.disabled,boxShadow:"none"}})),Ft=C(Y)(({theme:e})=>({borderRadius:12,textTransform:"none",fontWeight:600,background:e.palette.mode==="dark"?m[500]:m[700],color:e.palette.common.white,boxShadow:`0 4px 14px ${u(e.palette.common.black,.15)}`,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{background:e.palette.mode==="dark"?m[500]:m[500],boxShadow:`0 6px 20px ${u(e.palette.common.black,.2)}`,transform:"translateY(-1px)"},"&:disabled":{background:u(e.palette.text.disabled,.2),color:e.palette.text.disabled,boxShadow:"none"}})),P=C(xt)(({theme:e})=>({"& .MuiOutlinedInput-root":{borderRadius:12,backgroundColor:u(e.palette.background.default,.5),transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{backgroundColor:u(e.palette.background.default,.7)},"&.Mui-focused":{backgroundColor:u(e.palette.background.default,.9),boxShadow:`0 0 0 3px ${u(e.palette.text.primary,.08)}`}}})),$t=C(f)(({theme:e})=>({padding:e.spacing(1),borderRadius:10,backgroundColor:e.palette.mode==="dark"?u(e.palette.text.primary,.04):m[50],cursor:"pointer",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{backgroundColor:e.palette.mode==="dark"?u(e.palette.text.primary,.08):m[100],transform:"translateX(4px)"}})),Gt=C(f)(({theme:e})=>({padding:e.spacing(1),borderRadius:10,backgroundColor:e.palette.mode==="dark"?u(e.palette.text.primary,.04):m[50],cursor:"pointer",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{backgroundColor:e.palette.mode==="dark"?u(e.palette.text.primary,.08):m[100],transform:"translateX(4px)"}})),Nt=C(z)(({theme:e})=>({marginTop:e.spacing(2),padding:e.spacing(1.5),backgroundColor:e.palette.mode==="dark"?u(e.palette.text.primary,.05):m[50],borderRadius:12,border:`1px solid ${u(e.palette.divider,.2)}`})),Te=C(G)(({theme:e,confidence:a})=>({height:20,fontSize:"12px",fontWeight:600,backgroundColor:e.palette.mode==="dark"?u(e.palette.text.primary,.1):m[100],color:e.palette.text.secondary,borderRadius:6})),Wt=C(mt)(({theme:e})=>({"& .MuiBackdrop-root":{backgroundColor:u(e.palette.common.black,.6),backdropFilter:"blur(8px)"},"& .MuiDialog-paper":{backgroundColor:u(e.palette.background.paper,.95),backdropFilter:"blur(20px)",border:`1px solid ${u(e.palette.divider,.1)}`,borderRadius:8,boxShadow:`0 24px 64px ${u(e.palette.common.black,.25)}`}}));function Bt(){const e=Ke(),a=Xe(),{execute:n}=Le(),o=Ve("EXECUTE_WRITE_QUERY"),{registerOutput:s}=jt(Qe.QUERY),i=Se(r=>r.savedConnections),{currentQuestion:y,generatedSQL:p,explanation:j,confidence:q,warnings:S,results:Q,columns:M,totalCount:k,executionTimeMs:w,includeTotal:T,isGenerating:l,isExecuting:b,error:L,selectedConnectionId:c,savedQueries:g,queryHistory:v,setCurrentQuestion:H,setGeneratedSQL:N,setSelectedConnection:ze,setGenerationResult:ie,setExecutionResult:le,setError:E,setIsGenerating:J,setIsExecuting:K,clearResults:ce,clearAll:Ut,setSavedQueries:de,addSavedQuery:ue,removeSavedQuery:pe,setIncludeTotal:Me,setQueryHistory:W,loadSavedQuery:_e}=qe(),[Fe,B]=x.useState(!1),[A,ye]=x.useState(""),[X,xe]=x.useState(""),[me,$e]=x.useState(!1),[fe,Ge]=x.useState(!1),[ge,he]=x.useState(null),[V,Z]=x.useState({open:!1,queryId:null,queryName:""}),[U,ee]=x.useState({open:!1,entryId:null,question:""}),te=x.useRef(0),_=St(p),Ne=i.find(r=>r.id===c)?.name||(c?"Selected connection":"No connection selected"),be="query-builder-connection-label";x.useEffect(()=>{(async()=>{try{const{connections:d}=await ut();Se.getState().setSavedConnections(d||[])}catch(d){console.error("Failed to fetch connections:",d),a.show("Failed to load connections. Please refresh the page.","error")}})()},[a]),x.useEffect(()=>{if(!c){he(null);return}const r=++te.current;(async()=>{try{const R=await pt(c);r===te.current&&he(R)}catch(R){r===te.current&&(console.error("Failed to fetch schema:",R),a.show("Failed to load database schema","warning"))}})()},[c,a]),x.useEffect(()=>{(async()=>{try{const{queries:d}=await At();de(d||[])}catch(d){console.error("Failed to fetch saved queries:",d)}})()},[de]),x.useEffect(()=>{(async()=>{try{const{history:d}=await Ae({limit:50});W(d||[])}catch(d){console.error("Failed to fetch history:",d)}})()},[W]);const ve=x.useCallback(()=>{!y.trim()||!c||n({type:$.GENERATE,label:"Generate SQL query",reversibility:F.SYSTEM_MANAGED,blocksNavigation:!0,action:async()=>{J(!0),E(null),ce();try{const r=await Rt({question:y,connectionId:c});ie({sql:r.sql,explanation:r.explanation,confidence:r.confidence,warnings:r.warnings,originalQuestion:r.original_question})}catch(r){const d=r.response?.data?.message||r.message||"Failed to generate SQL";throw E(d),new Error(d)}finally{J(!1)}}})},[y,c,J,E,ce,ie,n]),re=x.useCallback(()=>{n({type:$.EXECUTE,label:"Execute SQL query",reversibility:F.SYSTEM_MANAGED,blocksNavigation:!0,successMessage:"Query executed successfully",action:async()=>{K(!0),E(null);try{const r=await Tt({sql:p,connectionId:c,limit:100,includeTotal:T});le({columns:r.columns,rows:r.rows,rowCount:r.row_count,totalCount:r.total_count,executionTimeMs:r.execution_time_ms,truncated:r.truncated}),s({type:ke.TABLE,title:`Query: ${y.substring(0,60)}`,summary:`${r.row_count} rows, ${r.columns?.length||0} columns`,data:{columns:r.columns,rows:r.rows},format:"table"}),a.show(`Query returned ${r.row_count} rows`,"success")}catch(r){const d=r.response?.data?.detail||r.response?.data?.message||r.message||"Failed to execute query";throw E(d),new Error(d)}finally{K(!1)}}})},[n,p,T,c,E,le,K,a]),We=x.useCallback(()=>{if(!(!p.trim()||!c)){if(_){const d=i.find(R=>R.id===c)?.name||c||"selected connection";o(d,re);return}re()}},[o,i,p,re,c,_]),Be=x.useCallback(()=>{!A.trim()||!p.trim()||!c||n({type:$.CREATE,label:`Save query "${A}"`,reversibility:F.FULLY_REVERSIBLE,successMessage:"Query saved successfully",errorMessage:"Failed to save query",action:async()=>{const r=await Ht({name:A,sql:p,connectionId:c,description:X||void 0,originalQuestion:y||void 0});ue(r.query),B(!1),ye(""),xe("")}})},[A,X,p,c,y,ue,n]),Ue=x.useCallback(r=>{n({type:$.DELETE,label:"Delete saved query",reversibility:F.IRREVERSIBLE,successMessage:"Query deleted",errorMessage:"Failed to delete query",action:async()=>{await zt(r),pe(r)}})},[pe,n]),Oe=x.useCallback(r=>{r&&n({type:$.DELETE,label:"Delete history entry",reversibility:F.IRREVERSIBLE,successMessage:"History entry deleted",errorMessage:"Failed to delete history entry",action:async()=>{await De(r);const d=qe.getState().queryHistory;W(d.filter(R=>R.id!==r))}})},[W,n]),Pe=x.useCallback(async()=>{try{await navigator.clipboard.writeText(p),a.show("SQL copied to clipboard","success")}catch{a.show("Failed to copy to clipboard","error")}},[p,a]),Ye=M.map(r=>({field:r,header:r,sortable:!0})),ne=p.trim()?c?null:"Select a connection first":"Generate SQL before executing";return t.jsxs(Mt,{children:[t.jsxs(_t,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[t.jsxs(z,{children:[t.jsx(h,{variant:"h5",fontWeight:600,sx:{color:e.palette.text.primary},children:"Query Builder"}),t.jsx(h,{variant:"body2",sx:{color:e.palette.text.secondary},children:"Ask questions in natural language and get SQL queries"})]}),t.jsxs(f,{direction:"row",spacing:1,children:[t.jsxs(Ee,{variant:"outlined",size:"small",startIcon:t.jsx(bt,{}),onClick:()=>Ge(!fe),children:["Saved (",g.length,")"]}),t.jsx(Ee,{variant:"outlined",size:"small",startIcon:t.jsx(Ze,{}),onClick:()=>$e(!me),children:"History"})]})]}),t.jsx(Ct,{title:"AI query draft",description:"AI turns questions into SQL using the selected connection's schema. Review the SQL before executing.",chips:[{label:`Source: ${Ne}`,variant:"outlined"},{label:"Confidence: Varies per query",variant:"outlined"},{label:"Read-only recommended",variant:"outlined"}],dense:!0,sx:{mb:2}}),t.jsx(Ce,{in:fe,children:t.jsxs(D,{children:[t.jsx(h,{variant:"subtitle2",sx:{color:e.palette.text.secondary,mb:1},children:"Saved Queries"}),g.length===0?t.jsx(h,{variant:"body2",sx:{color:e.palette.text.disabled},children:"No saved queries yet"}):t.jsx(f,{spacing:1,children:g.slice(0,5).map(r=>t.jsxs($t,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[t.jsxs(z,{sx:{flex:1},onClick:()=>_e(r),children:[t.jsx(h,{variant:"body2",fontWeight:500,sx:{color:e.palette.text.primary},children:r.name}),r.description&&t.jsx(h,{variant:"caption",sx:{color:e.palette.text.secondary},children:r.description})]}),t.jsx(oe,{title:"Delete saved query",children:t.jsx(O,{size:"small",onClick:()=>Z({open:!0,queryId:r.id,queryName:r.name}),"aria-label":"Delete saved query",children:t.jsx(je,{fontSize:"small",sx:{color:e.palette.text.secondary}})})})]},r.id))})]})}),t.jsx(Ce,{in:me,children:t.jsxs(D,{children:[t.jsx(h,{variant:"subtitle2",sx:{color:e.palette.text.secondary,mb:1},children:"Recent Queries"}),v.length===0?t.jsx(h,{variant:"body2",sx:{color:e.palette.text.disabled},children:"No query history yet"}):t.jsx(f,{spacing:1,children:v.slice(0,5).map(r=>t.jsxs(Gt,{direction:"row",alignItems:"center",justifyContent:"space-between",onClick:()=>{H(r.question),N(r.sql)},children:[t.jsxs(z,{sx:{flex:1,minWidth:0},children:[t.jsx(h,{variant:"body2",sx:{color:e.palette.text.primary},noWrap:!0,children:r.question}),t.jsxs(f,{direction:"row",spacing:1,mt:.5,children:[t.jsx(Te,{size:"small",label:`${Math.round(r.confidence*100)}%`,confidence:r.confidence}),r.success?t.jsx(G,{size:"small",label:"Success",sx:{height:20,fontSize:"12px",bgcolor:e.palette.mode==="dark"?u(e.palette.text.primary,.1):m[100],color:e.palette.text.secondary,borderRadius:1.5}}):t.jsx(G,{size:"small",label:"Failed",sx:{height:20,fontSize:"12px",bgcolor:e.palette.mode==="dark"?u(e.palette.text.primary,.1):m[100],color:e.palette.text.secondary,borderRadius:1.5}})]})]}),t.jsx(O,{size:"small",onClick:d=>{d.stopPropagation(),ee({open:!0,entryId:r.id,question:r.question})},children:t.jsx(je,{fontSize:"small",sx:{color:e.palette.text.secondary}})})]},r.id))})]})}),t.jsxs(D,{children:[t.jsxs(et,{fullWidth:!0,size:"small",children:[t.jsx(tt,{id:be,children:"Database Connection"}),t.jsx(rt,{value:c||"",label:"Database Connection",labelId:be,id:"query-builder-connection-select",onChange:r=>ze(r.target.value),startAdornment:t.jsx(ot,{sx:{mr:1,color:e.palette.text.secondary}}),children:i.map(r=>t.jsx(nt,{value:r.id,children:r.name||r.database_path},r.id))})]}),ge&&t.jsx(z,{mt:2,children:t.jsxs(h,{variant:"caption",sx:{color:e.palette.text.secondary},children:["Available tables: ",ge.tables?.map(r=>r.name).join(", ")]})})]}),t.jsxs(D,{children:[t.jsx(P,{fullWidth:!0,multiline:!0,minRows:2,maxRows:4,placeholder:"Ask a question about your data... (e.g., 'Show me all customers who made purchases last month')",value:y,onChange:r=>H(r.target.value),onKeyDown:r=>{r.key==="Enter"&&r.ctrlKey&&ve()}}),t.jsxs(f,{direction:"row",justifyContent:"space-between",alignItems:"center",mt:2,children:[t.jsx(h,{variant:"caption",sx:{color:e.palette.text.secondary},children:"Press Ctrl+Enter to generate"}),t.jsx(Re,{startIcon:l?t.jsx(we,{size:16,color:"inherit"}):t.jsx(st,{}),onClick:ve,disabled:!y.trim()||!c||l,children:l?"Generating...":"Generate SQL"})]})]}),L&&t.jsx(se,{severity:"error",sx:{mb:2,borderRadius:1},onClose:()=>E(null),children:L}),p&&t.jsxs(D,{children:[t.jsxs(f,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:1,children:[t.jsxs(f,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(h,{variant:"subtitle2",sx:{color:e.palette.text.secondary},children:"Generated SQL"}),q>0&&t.jsx(Te,{size:"small",label:`${Math.round(q*100)}% confidence`,confidence:q})]}),t.jsxs(f,{direction:"row",spacing:1,children:[t.jsx(oe,{title:"Copy SQL",children:t.jsx(O,{size:"small",onClick:Pe,"aria-label":"Copy SQL",children:t.jsx(gt,{fontSize:"small",sx:{color:e.palette.text.secondary}})})}),t.jsx(oe,{title:"Save Query",children:t.jsx(O,{size:"small",onClick:()=>B(!0),"aria-label":"Save Query",children:t.jsx(ft,{fontSize:"small",sx:{color:e.palette.text.secondary}})})})]})]}),t.jsx(P,{fullWidth:!0,multiline:!0,minRows:3,maxRows:10,value:p,onChange:r=>N(r.target.value),sx:{"& .MuiOutlinedInput-root":{fontFamily:"monospace",fontSize:"0.875rem"}}}),S.length>0&&t.jsx(f,{spacing:.5,mt:1,children:S.map((r,d)=>t.jsx(se,{severity:"warning",sx:{py:0,borderRadius:1},children:r},d))}),j&&t.jsx(Nt,{children:t.jsxs(f,{direction:"row",alignItems:"flex-start",spacing:1,children:[t.jsx(ht,{sx:{color:e.palette.text.secondary,fontSize:18,mt:.25}}),t.jsx(h,{variant:"body2",sx:{color:e.palette.text.secondary},children:j})]})}),t.jsxs(f,{direction:{xs:"column",sm:"row"},alignItems:{xs:"stretch",sm:"center"},justifyContent:"space-between",mt:2,spacing:1.5,children:[t.jsx(at,{control:t.jsx(Qt,{size:"small",checked:T,onChange:r=>Me(r.target.checked)}),label:"Include total row count (slower)",sx:{color:e.palette.text.secondary}}),t.jsxs(f,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",children:[t.jsx(G,{size:"small",label:"Read-only recommended",variant:"outlined",sx:{fontSize:"12px"}}),_&&t.jsx(G,{size:"small",label:`${_.toUpperCase()} detected`,sx:{fontSize:"12px",bgcolor:r=>r.palette.mode==="dark"?u(r.palette.text.primary,.1):m[200],color:"text.secondary"}})]}),t.jsx(It,{disabled:!!ne||b,reason:b?"Query is currently running...":ne,hint:c?p.trim()?void 0:"Enter a question and click Generate first":"Select a database from the dropdown above",children:t.jsx(Ft,{startIcon:b?t.jsx(we,{size:16,color:"inherit"}):t.jsx(it,{}),onClick:We,disabled:!!ne||b,children:b?"Executing...":"Execute Query"})})]}),_&&t.jsx(se,{severity:"warning",sx:{mt:1.5,borderRadius:1},children:"Write queries can modify data and may not be reversible. You will be asked to confirm before execution."})]}),Q&&t.jsxs(D,{children:[t.jsxs(f,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:2,children:[t.jsxs(f,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(h,{variant:"subtitle2",sx:{color:e.palette.text.secondary},children:"Results"}),t.jsx(wt,{outputType:ke.TABLE,payload:{title:`Query: ${y.substring(0,60)}`,content:JSON.stringify({columns:M,rows:Q}),data:{columns:M,rows:Q}},sourceFeature:Qe.QUERY})]}),t.jsxs(f,{direction:"row",spacing:2,children:[k!==null&&t.jsxs(h,{variant:"caption",sx:{color:e.palette.text.secondary},children:[k," total rows"]}),w!==null&&t.jsxs(h,{variant:"caption",sx:{color:e.palette.text.secondary},children:[w,"ms"]})]})]}),t.jsx(vt,{columns:Ye,data:Q,pageSize:10,loading:!1})]}),t.jsxs(Wt,{open:Fe,onClose:()=>B(!1),maxWidth:"sm",fullWidth:!0,children:[t.jsx(lt,{sx:{color:e.palette.text.primary},children:"Save Query"}),t.jsx(ct,{children:t.jsxs(f,{spacing:2,mt:1,children:[t.jsx(P,{fullWidth:!0,label:"Name",value:A,onChange:r=>ye(r.target.value),placeholder:"e.g., Monthly Sales Report"}),t.jsx(P,{fullWidth:!0,multiline:!0,rows:2,label:"Description (optional)",value:X,onChange:r=>xe(r.target.value),placeholder:"What does this query do?"})]})}),t.jsxs(dt,{sx:{p:2.5},children:[t.jsx(Y,{onClick:()=>B(!1),sx:{borderRadius:1,textTransform:"none"},children:"Cancel"}),t.jsx(Re,{onClick:Be,disabled:!A.trim(),children:"Save"})]})]}),t.jsx(Ie,{open:V.open,onClose:()=>Z({open:!1,queryId:null,queryName:""}),onConfirm:()=>{Ue(V.queryId),Z({open:!1,queryId:null,queryName:""})},title:"Delete Saved Query",message:`Are you sure you want to delete "${V.queryName}"? This action cannot be undone.`,confirmLabel:"Delete",severity:"error"}),t.jsx(Ie,{open:U.open,onClose:()=>ee({open:!1,entryId:null,question:""}),onConfirm:()=>{Oe(U.entryId),ee({open:!1,entryId:null,question:""})},title:"Delete History Entry",message:`Are you sure you want to delete this history entry? "${U.question?.substring(0,50)}${U.question?.length>50?"...":""}"`,confirmLabel:"Delete",severity:"warning"})]})}function mr(){return Le(),t.jsx(Bt,{})}export{mr as default};
