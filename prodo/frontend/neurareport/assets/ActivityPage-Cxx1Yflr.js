import{u as $,v as H,w as U,a as F,r as s,x as W,R as G,I as J,y as P,j as t,B as f,o as u,q as I,z as Y,C as _,E as K,G as X,H as E,m as R,S as D,M as l,J as B,K as q,L as Q,N as g,O as w,e as V,n as T,f as x,Q as Z,U as ee,V as te,X as ae,t as oe,D as ne,p as se,Y as ie}from"./index-tNjrNcyx.js";import{D as re}from"./Star-WYaMTifX.js";import{C as le}from"./ConfirmModal-BBknfNQr.js";import"./CheckCircleOutline-DkNeJ2sB.js";import"./WarningAmber-D6zaqvXu.js";const ce=g(f)(({theme:e})=>({padding:e.spacing(3),maxWidth:1e3,margin:"0 auto",width:"100%",minHeight:"100vh",backgroundColor:e.palette.background.default})),de=g(I)(({theme:e})=>({marginBottom:e.spacing(3),animation:`${w} 0.5s ease-out`})),pe=g(I)(({theme:e})=>({marginBottom:e.spacing(3),animation:`${w} 0.5s ease-out 0.1s both`})),ue=g(f)(({theme:e})=>({backgroundColor:x(e.palette.background.paper,.8),backdropFilter:"blur(20px)",borderRadius:8,border:`1px solid ${x(e.palette.divider,.1)}`,padding:e.spacing(2),boxShadow:`0 8px 32px ${x(e.palette.common.black,.08)}`,animation:`${w} 0.5s ease-out 0.2s both`})),xe=g(V)(({theme:e})=>({borderRadius:8,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{backgroundColor:e.palette.mode==="dark"?x(e.palette.text.primary,.08):T[100],color:e.palette.text.primary}})),fe=g(f)(({theme:e})=>({padding:e.spacing(6),textAlign:"center",animation:`${w} 0.5s ease-out`})),ye={template:e=>`/templates/${e}/edit`,connection:()=>"/connections",job:()=>"/jobs",schedule:()=>"/schedules"},L={template:ne,connection:oe,job:ae,schedule:te,favorite:re,settings:ee,default:B},ge=(e,n)=>{const a={created:{color:e.palette.text.secondary},deleted:{color:e.palette.text.secondary},updated:{color:e.palette.text.secondary},completed:{color:e.palette.text.secondary},failed:{color:e.palette.text.secondary},started:{color:e.palette.text.secondary},favorite_added:{color:e.palette.text.secondary},favorite_removed:{color:e.palette.text.secondary},default:{color:e.palette.text.secondary}};return a[n]||a.default};function he(e){if(!e)return"";const n=new Date(e),d=new Date-n,i=Math.floor(d/6e4),c=Math.floor(d/36e5),p=Math.floor(d/864e5);return i<1?"Just now":i<60?`${i}m ago`:c<24?`${c}h ago`:p<7?`${p}d ago`:n.toLocaleDateString()}function me(e){return(e||"").replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase())}function be({activity:e,onNavigate:n}){const a=$(),d=e.entity_type||"default",i=String(d).toLowerCase().replace(/s$/,""),c=e.action||"",p=String(c).toLowerCase(),j=L[i]||L.default,h=ge(a,c).color,y=e.details?.url||null,m=ye[i],r=!p.includes("deleted")&&(m||y),k=()=>{if(r&&n){const C=m?m(e.entity_id):y;C&&n(C)}};return t.jsxs(f,{onClick:k,sx:{display:"flex",alignItems:"flex-start",gap:2,py:2,borderBottom:`1px solid ${x(a.palette.divider,.06)}`,"&:last-child":{borderBottom:"none"},cursor:r?"pointer":"default",borderRadius:1,mx:-1,px:1,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":r?{bgcolor:a.palette.mode==="dark"?x(a.palette.text.primary,.04):T[50],transform:"translateX(4px)"}:{}},children:[t.jsx(f,{sx:{width:36,height:36,borderRadius:1,bgcolor:x(h,.15),display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,transition:"transform 0.2s cubic-bezier(0.22, 1, 0.36, 1)",".MuiBox-root:hover > &":r?{animation:`${Z} 0.5s cubic-bezier(0.22, 1, 0.36, 1)`}:{}},children:t.jsx(j,{sx:{fontSize:16,color:h}})}),t.jsxs(f,{sx:{flex:1,minWidth:0},children:[t.jsxs(I,{direction:"row",alignItems:"center",spacing:1,sx:{mb:.5},children:[t.jsx(u,{sx:{fontSize:"14px",fontWeight:500,color:a.palette.text.primary},children:me(c)}),t.jsx(se,{label:i,size:"small",sx:{height:18,fontSize:"0.625rem",bgcolor:a.palette.mode==="dark"?x(a.palette.text.primary,.08):T[100],color:a.palette.text.secondary,borderRadius:1}})]}),e.entity_name&&t.jsx(u,{sx:{fontSize:"14px",color:a.palette.text.secondary,mb:.5},children:e.entity_name}),e.entity_id&&!e.entity_name&&t.jsxs(u,{sx:{fontSize:"0.75rem",color:a.palette.text.disabled,fontFamily:"monospace",mb:.5},children:[e.entity_id.slice(0,20),"..."]}),t.jsx(u,{sx:{fontSize:"12px",color:a.palette.text.disabled},children:he(e.timestamp)})]}),r&&t.jsx(ie,{sx:{fontSize:14,color:a.palette.text.disabled,opacity:0,transition:"opacity 0.2s cubic-bezier(0.22, 1, 0.36, 1)",".MuiBox-root:hover > &":{opacity:1}}})]})}function je(){const e=$(),n=H(),a=U(),{execute:d}=F(),i=s.useRef(!1),c=s.useCallback((o,S,O={})=>a(o,{label:S,intent:{from:"activity",...O}}),[a]),[p,j]=s.useState([]),[v,h]=s.useState(!0),[y,m]=s.useState(""),[r,k]=s.useState(""),[C,A]=s.useState(!1),[M,z]=s.useState(!1),b=s.useCallback(async()=>{h(!0);try{const o=await W({limit:100,entityType:y||void 0,action:r||void 0});j(o?.activities||[])}catch(o){n.show(o.message||"Failed to load activity log","error")}finally{h(!1)}},[y,r,n]);s.useEffect(()=>{i.current||(i.current=!0,b())},[b]),s.useEffect(()=>{i.current&&b()},[y,r,b]);const N=s.useCallback(async()=>{await d({type:J.DELETE,label:"Clear activity log",reversibility:G.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{action:"clear_activity_log"},action:async()=>{z(!0);try{const o=await P();return j([]),n.show(`Cleared ${o.cleared} activity entries`,"success"),o}catch(o){throw n.show(o.message||"Failed to clear activity log","error"),o}finally{z(!1),A(!1)}}})},[n,d]);return t.jsxs(ce,{children:[t.jsxs(de,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[t.jsxs(f,{children:[t.jsx(u,{variant:"h5",fontWeight:600,sx:{color:e.palette.text.primary},children:"Activity Log"}),t.jsx(u,{variant:"body2",sx:{color:e.palette.text.secondary},children:"Track actions and events in your workspace"})]}),t.jsxs(I,{direction:"row",spacing:1,children:[t.jsx(Y,{onClick:b,disabled:v,"data-testid":"refresh-activity-button","aria-label":"Refresh activities",sx:{color:e.palette.text.secondary},children:v?t.jsx(_,{size:20}):t.jsx(K,{})}),t.jsx(xe,{onClick:()=>A(!0),disabled:p.length===0,"data-testid":"clear-activity-button","aria-label":"Clear all activities",sx:{color:e.palette.text.secondary},children:t.jsx(X,{})})]})]}),t.jsxs(pe,{direction:"row",spacing:2,children:[t.jsxs(E,{size:"small",children:[t.jsx(R,{children:"Entity Type"}),t.jsxs(D,{value:y,onChange:o=>m(o.target.value),label:"Entity Type","data-testid":"entity-type-filter",children:[t.jsx(l,{value:"",children:"All"}),t.jsx(l,{value:"template",children:"Template"}),t.jsx(l,{value:"connection",children:"Connection"}),t.jsx(l,{value:"job",children:"Job"}),t.jsx(l,{value:"schedule",children:"Schedule"})]})]}),t.jsxs(E,{size:"small",children:[t.jsx(R,{children:"Action"}),t.jsxs(D,{value:r,onChange:o=>k(o.target.value),label:"Action","data-testid":"action-filter",children:[t.jsx(l,{value:"",children:"All"}),t.jsx(l,{value:"favorite_added",children:"Favorite added"}),t.jsx(l,{value:"favorite_removed",children:"Favorite removed"}),t.jsx(l,{value:"template_deleted",children:"Template deleted"}),t.jsx(l,{value:"job_cancelled",children:"Job cancelled"})]})]})]}),t.jsx(ue,{children:v?t.jsx(f,{sx:{py:4,textAlign:"center"},children:t.jsx(_,{size:32})}):p.length===0?t.jsxs(fe,{children:[t.jsx(B,{sx:{fontSize:48,color:e.palette.text.disabled,mb:2}}),t.jsx(u,{sx:{fontSize:"0.875rem",color:e.palette.text.secondary},children:"No activity recorded yet"}),t.jsx(u,{sx:{fontSize:"0.75rem",color:e.palette.text.disabled,mt:.5,mb:2},children:"Actions like creating templates, running jobs, and more will appear here"}),t.jsx(q,{variant:"contained",startIcon:t.jsx(Q,{}),onClick:()=>c("/","Go to Dashboard",{action:"empty-state-cta"}),sx:{textTransform:"none"},children:"Go to Dashboard"})]}):p.map(o=>t.jsx(be,{activity:o,onNavigate:S=>c(S,"Open activity item",{route:S,activityId:o.id})},o.id))}),t.jsx(le,{open:C,onClose:()=>A(!1),onConfirm:N,title:"Clear Activity Log",message:"Are you sure you want to clear all activity log entries? This action cannot be undone.",confirmLabel:"Clear All",severity:"warning",loading:M})]})}function ke(){return F(),t.jsx(je,{})}export{ke as default};
