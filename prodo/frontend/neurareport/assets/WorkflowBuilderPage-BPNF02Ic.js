import{g as _,j as e,u as Ee,v as Se,a as ae,ck as Ie,r as n,R as h,I as g,V as We,cl as Ae,a7 as Te,t as De,B as r,bT as z,o as c,p as Ne,J as Re,aY as ze,a1 as se,ak as Le,P as v,K as y,bJ as _e,n as b,f as d,e as L,G as Me,E as Pe,ah as Be,aj as $e,al as Ue,aJ as Ye,am as Fe,A as Ge,N as f,b3 as Ve}from"./index-tNjrNcyx.js";import{u as Oe}from"./useSharedData-BFNfRFc2.js";import{C as Xe}from"./ConnectionSelector-DPzRBoqg.js";import{T as He}from"./TemplateSelector-BfMrWm58.js";import{C as le}from"./Code-CP1TKb_0.js";import{E as Je}from"./Email-abjox0uH.js";import{S as ne}from"./Stop-Cdt-qgxM.js";import{S as Ke}from"./Save-BetSEFm3.js";import{C as qe}from"./CardContent-CusmpNLe.js";const Qe=_(e.jsx("path",{d:"m14 4 2.29 2.29-2.88 2.88 1.42 1.42 2.88-2.88L20 10V4zm-4 0H4v6l2.29-2.29 4.71 4.7V20h2v-8.41l-5.29-5.3z"})),Ze=_(e.jsx("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8m0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4z"})),et=_(e.jsx("path",{d:"M10 15h5.88c.27-.31.67-.5 1.12-.5.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5c-.44 0-.84-.19-1.12-.5H11.9c-.46 2.28-2.48 4-4.9 4-2.76 0-5-2.24-5-5 0-2.42 1.72-4.44 4-4.9v2.07c-1.16.41-2 1.53-2 2.83 0 1.65 1.35 3 3 3s3-1.35 3-3zm2.5-11c1.65 0 3 1.35 3 3h2c0-2.76-2.24-5-5-5s-5 2.24-5 5c0 1.43.6 2.71 1.55 3.62l-2.35 3.9c-.68.14-1.2.75-1.2 1.48 0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5c0-.16-.02-.31-.07-.45l3.38-5.63C10.49 9.61 9.5 8.42 9.5 7c0-1.65 1.35-3 3-3m4.5 9c-.64 0-1.23.2-1.72.54l-3.05-5.07C11.53 8.35 11 7.74 11 7c0-.83.67-1.5 1.5-1.5S14 6.17 14 7c0 .15-.02.29-.06.43l2.19 3.65c.28-.05.57-.08.87-.08 2.76 0 5 2.24 5 5s-2.24 5-5 5c-1.85 0-3.47-1.01-4.33-2.5h2.67c.48.32 1.05.5 1.66.5 1.65 0 3-1.35 3-3s-1.35-3-3-3"})),tt=f(r)(({theme:o})=>({display:"flex",flexDirection:"column",height:"calc(100vh - 64px)",backgroundColor:o.palette.background.default})),ot=f(r)(({theme:o})=>({display:"flex",alignItems:"center",justifyContent:"space-between",padding:o.spacing(1.5,2),borderBottom:`1px solid ${d(o.palette.divider,.1)}`,backgroundColor:d(o.palette.background.paper,.8)})),st=f(r)(({theme:o})=>({flex:1,display:"flex",overflow:"hidden"})),nt=f(r)(({theme:o})=>({width:260,flexShrink:0,borderRight:`1px solid ${d(o.palette.divider,.1)}`,backgroundColor:d(o.palette.background.paper,.6),padding:o.spacing(2),overflow:"auto"})),rt=f(r)(({theme:o})=>({flex:1,padding:o.spacing(3),overflow:"auto",backgroundColor:o.palette.background.default,backgroundImage:`radial-gradient(${d(o.palette.divider,.15)} 1px, transparent 1px)`,backgroundSize:"20px 20px"})),at=f(r)(({theme:o})=>({width:300,flexShrink:0,borderLeft:`1px solid ${d(o.palette.divider,.1)}`,backgroundColor:d(o.palette.background.paper,.6),display:"flex",flexDirection:"column"})),lt=f(Ve)(({theme:o})=>({cursor:"grab",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)",marginBottom:o.spacing(1),"&:hover":{transform:"translateX(4px)",boxShadow:`0 4px 12px ${d(o.palette.common.black,.1)}`}})),it=f(v)(({theme:o})=>({padding:o.spacing(2),minWidth:200,borderRadius:8,border:`2px solid ${d(o.palette.divider,.3)}`,cursor:"pointer",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{borderColor:o.palette.mode==="dark"?b[500]:b[700],boxShadow:`0 4px 20px ${d(o.palette.common.black,.1)}`}})),ct=f(v)(({theme:o,status:i})=>({padding:o.spacing(2),marginBottom:o.spacing(1),borderLeft:`4px solid ${i==="completed"?o.palette.mode==="dark"?b[500]:b[700]:i==="running"?o.palette.mode==="dark"?b[300]:b[500]:i==="failed"?o.palette.text.secondary:b[400]}`})),m=f(y)(({theme:o})=>({borderRadius:8,textTransform:"none",fontWeight:500})),dt=f(r)(({theme:o})=>({flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:o.spacing(4),textAlign:"center"})),re=[{type:"trigger",label:"Trigger",icon:We,color:"warning",category:"Triggers"},{type:"webhook",label:"Webhook",icon:et,color:"info",category:"Triggers"},{type:"action",label:"Action",icon:le,color:"primary",category:"Actions"},{type:"email",label:"Send Email",icon:Je,color:"secondary",category:"Actions"},{type:"notify",label:"Notification",icon:Ae,color:"success",category:"Actions"},{type:"condition",label:"Condition",icon:Qe,color:"info",category:"Logic"},{type:"loop",label:"Loop",icon:Ze,color:"warning",category:"Logic"},{type:"approval",label:"Approval",icon:Te,color:"success",category:"Logic"},{type:"data",label:"Data Transform",icon:De,color:"primary",category:"Data"}];function xt(){const o=Ee(),i=Se(),{execute:a}=ae(),{workflows:M,currentWorkflow:s,executions:P,currentExecution:pt,pendingApprovals:E,loading:ie,executing:S,error:B,fetchWorkflows:$,createWorkflow:U,getWorkflow:Y,updateWorkflow:F,deleteWorkflow:ut,executeWorkflow:G,fetchExecutions:k,cancelExecution:V,retryExecution:O,fetchPendingApprovals:X,approveStep:H,rejectStep:J,reset:j}=Ie(),{activeConnectionId:I}=Oe(),[ce,W]=n.useState(!1),[w,K]=n.useState(""),[A,q]=n.useState(I||""),[T,Q]=n.useState(""),[x,D]=n.useState([]),[N,Z]=n.useState(null),[C,ee]=n.useState(!1);n.useEffect(()=>($(),X(),()=>j()),[$,X,j]),n.useEffect(()=>{s?.nodes&&D(s.nodes)},[s]);const p=n.useCallback((t,l,u={})=>a({type:g.EXECUTE,label:t,reversibility:h.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"workflows",...u},action:l}),[a]),te=n.useCallback(()=>p("Open create workflow",()=>W(!0)),[p]),oe=n.useCallback(()=>p("Close create workflow",()=>W(!1)),[p]),de=n.useCallback(()=>{if(w)return a({type:g.CREATE,label:"Create workflow",reversibility:h.SYSTEM_MANAGED,intent:{source:"workflows",name:w},action:async()=>{const t=await U({name:w,connectionId:A||void 0,templateId:T||void 0,nodes:[],edges:[],triggers:[]});return t&&(W(!1),K(""),q(I||""),Q(""),i.show("Workflow created","success")),t}})},[I,U,a,w,A,T,i]),xe=n.useCallback(t=>{if(s)return p("Add workflow node",()=>{const l={id:`node_${Date.now()}`,type:t.type,label:t.label,config:{},position:{x:100+x.length*50,y:100+x.length*50}};D([...x,l]),i.show(`${t.label} node added`,"success")},{workflowId:s.id,nodeType:t.type})},[s,p,i,x]),pe=n.useCallback(t=>a({type:g.DELETE,label:"Remove workflow node",reversibility:h.SYSTEM_MANAGED,intent:{source:"workflows",nodeId:t},action:async()=>{D(x.filter(l=>l.id!==t)),N?.id===t&&Z(null),i.show("Node removed","success")}}),[a,N?.id,i,x]),ue=n.useCallback(t=>p("Select workflow node",()=>Z(t),{nodeId:t?.id}),[p]),fe=n.useCallback(()=>{if(s)return a({type:g.UPDATE,label:"Save workflow",reversibility:h.SYSTEM_MANAGED,intent:{source:"workflows",workflowId:s.id},action:async()=>{await F(s.id,{nodes:x}),i.show("Workflow saved","success")}})},[s,a,i,F,x]),he=n.useCallback(()=>{if(s)return a({type:g.EXECUTE,label:"Run workflow",reversibility:h.FULLY_REVERSIBLE,blocksNavigation:!0,intent:{source:"workflows",workflowId:s.id},action:async()=>{const t=await G(s.id);return t&&(i.show("Workflow execution started","success"),ee(!0),k(s.id)),t}})},[s,a,G,k,i]),ge=n.useCallback(t=>{if(s)return a({type:g.UPDATE,label:"Cancel execution",reversibility:h.SYSTEM_MANAGED,intent:{source:"workflows",workflowId:s.id,executionId:t},action:async()=>{await V(s.id,t),i.show("Execution cancelled","info")}})},[V,s,a,i]),be=n.useCallback(t=>{if(s)return a({type:g.UPDATE,label:"Retry execution",reversibility:h.SYSTEM_MANAGED,intent:{source:"workflows",workflowId:s.id,executionId:t},action:async()=>{await O(s.id,t),i.show("Retry started","success")}})},[s,a,O,i]),we=n.useCallback(()=>{if(s)return p("Toggle executions",()=>{const t=!C;ee(t),t&&k(s.id)},{workflowId:s.id,open:!C})},[s,p,k,C]),me=n.useCallback((t,l)=>a({type:g.UPDATE,label:"Approve step",reversibility:h.SYSTEM_MANAGED,intent:{source:"workflows",executionId:t,stepId:l},action:async()=>{await H(t,l)}}),[H,a]),ye=n.useCallback((t,l)=>a({type:g.UPDATE,label:"Reject step",reversibility:h.SYSTEM_MANAGED,intent:{source:"workflows",executionId:t,stepId:l},action:async()=>{await J(t,l,"Rejected")}}),[a,J]),ke=n.useCallback(t=>a({type:g.EXECUTE,label:"Open workflow",reversibility:h.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"workflows",workflowId:t},action:async()=>{await Y(t)}}),[a,Y]),je=n.useCallback(()=>p("Dismiss workflow error",()=>j()),[p,j]),Ce=re.reduce((t,l)=>(t[l.category]||(t[l.category]=[]),t[l.category].push(l),t),{});return e.jsxs(tt,{children:[e.jsxs(ot,{children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(z,{sx:{color:"text.secondary"}}),e.jsx(c,{variant:"subtitle1",sx:{fontWeight:600},children:s?.name||"Workflows"}),s&&e.jsx(Ne,{size:"small",label:`${x.length} nodes`,sx:{borderRadius:1}})]}),e.jsx(r,{sx:{display:"flex",gap:1},children:s?e.jsxs(e.Fragment,{children:[e.jsx(m,{size:"small",startIcon:e.jsx(Re,{}),onClick:we,children:"Executions"}),e.jsx(m,{size:"small",variant:"outlined",sx:{color:"text.secondary"},startIcon:S?e.jsx(ne,{}):e.jsx(ze,{}),onClick:he,disabled:S||x.length===0,children:S?"Running...":"Run"}),e.jsx(m,{variant:"contained",size:"small",startIcon:e.jsx(Ke,{}),onClick:fe,children:"Save"})]}):e.jsx(m,{variant:"contained",size:"small",startIcon:e.jsx(se,{}),onClick:te,children:"New Workflow"})})]}),e.jsx(st,{children:s?e.jsxs(e.Fragment,{children:[e.jsxs(nt,{children:[e.jsx(c,{variant:"subtitle2",sx:{mb:2,fontWeight:600},children:"Add Node"}),Object.entries(Ce).map(([t,l])=>e.jsxs(r,{sx:{mb:2},children:[e.jsx(c,{variant:"caption",color:"text.secondary",sx:{fontWeight:600},children:t}),l.map(u=>e.jsx(lt,{variant:"outlined",onClick:()=>xe(u),children:e.jsx(qe,{sx:{p:1.5,"&:last-child":{pb:1.5}},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(u.icon,{color:u.color,fontSize:"small"}),e.jsx(c,{variant:"body2",children:u.label})]})})},u.type))]},t)),E.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Le,{sx:{my:2}}),e.jsxs(c,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:["Pending Approvals (",E.length,")"]}),E.map(t=>e.jsxs(v,{variant:"outlined",sx:{p:1.5,mb:1},children:[e.jsx(c,{variant:"caption",sx:{fontWeight:500},children:t.workflow_name}),e.jsxs(r,{sx:{display:"flex",gap:1,mt:1},children:[e.jsx(y,{size:"small",variant:"contained",onClick:()=>me(t.execution_id,t.step_id),children:"Approve"}),e.jsx(y,{size:"small",variant:"outlined",sx:{color:"text.secondary"},onClick:()=>ye(t.execution_id,t.step_id),children:"Reject"})]})]},t.id))]})]}),e.jsx(rt,{children:x.length>0?e.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:2,alignItems:"center"},children:x.map((t,l)=>{const u=re.find(R=>R.type===t.type),ve=u?.icon||le;return e.jsxs(_e.Fragment,{children:[e.jsx(it,{onClick:()=>ue(t),sx:{borderColor:N?.id===t.id?o.palette.mode==="dark"?b[500]:b[700]:void 0},children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(r,{sx:{width:36,height:36,borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:d(o.palette[u?.color||"primary"].main,.1)},children:e.jsx(ve,{color:u?.color||"primary"})}),e.jsxs(r,{sx:{flex:1},children:[e.jsx(c,{variant:"subtitle2",sx:{fontWeight:600},children:t.label}),e.jsx(c,{variant:"caption",color:"text.secondary",children:t.type})]}),e.jsx(L,{size:"small",onClick:R=>{R.stopPropagation(),pe(t.id)},children:e.jsx(Me,{fontSize:"small"})})]})}),l<x.length-1&&e.jsx(r,{sx:{width:2,height:40,bgcolor:d(o.palette.divider,.5),borderRadius:1}})]},t.id)})}):e.jsx(r,{sx:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(c,{color:"text.secondary",children:"Add nodes from the palette to build your workflow"})})}),C&&e.jsxs(at,{children:[e.jsx(r,{sx:{p:2,borderBottom:`1px solid ${d(o.palette.divider,.1)}`},children:e.jsx(c,{variant:"subtitle1",sx:{fontWeight:600},children:"Executions"})}),e.jsx(r,{sx:{flex:1,overflow:"auto",p:2},children:P.length>0?P.map(t=>e.jsx(ct,{status:t.status,variant:"outlined",children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(r,{children:[e.jsx(c,{variant:"body2",sx:{fontWeight:500},children:t.status}),e.jsx(c,{variant:"caption",color:"text.secondary",children:new Date(t.started_at).toLocaleString()})]}),e.jsxs(r,{sx:{display:"flex",gap:.5},children:[t.status==="running"&&e.jsx(L,{size:"small",onClick:()=>ge(t.id),children:e.jsx(ne,{fontSize:"small"})}),t.status==="failed"&&e.jsx(L,{size:"small",onClick:()=>be(t.id),children:e.jsx(Pe,{fontSize:"small"})})]})]})},t.id)):e.jsx(c,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:4},children:"No executions yet"})})]})]}):e.jsxs(dt,{sx:{width:"100%"},children:[e.jsx(z,{sx:{fontSize:64,color:"text.disabled",mb:2}}),e.jsx(c,{variant:"h5",sx:{fontWeight:600,mb:1},children:"No Workflow Selected"}),e.jsx(c,{color:"text.secondary",sx:{mb:3},children:"Create a new workflow to automate your processes."}),e.jsx(m,{variant:"contained",startIcon:e.jsx(se,{}),onClick:te,children:"Create Workflow"}),M.length>0&&e.jsxs(r,{sx:{mt:4,width:"100%",maxWidth:400},children:[e.jsx(c,{variant:"subtitle2",sx:{mb:2},children:"Recent Workflows"}),M.slice(0,5).map(t=>e.jsxs(v,{sx:{p:2,mb:1,cursor:"pointer",display:"flex",alignItems:"center",gap:2,"&:hover":{bgcolor:o.palette.mode==="dark"?d(o.palette.text.primary,.05):b[50]}},variant:"outlined",onClick:()=>ke(t.id),children:[e.jsx(z,{sx:{color:"text.secondary"}}),e.jsxs(r,{children:[e.jsx(c,{variant:"body2",sx:{fontWeight:500},children:t.name}),e.jsxs(c,{variant:"caption",color:"text.secondary",children:[t.nodes?.length||0," nodes"]})]})]},t.id))]})]})}),e.jsxs(Be,{open:ce,onClose:oe,maxWidth:"xs",fullWidth:!0,children:[e.jsx($e,{children:"Create New Workflow"}),e.jsxs(Ue,{children:[e.jsx(Ye,{autoFocus:!0,fullWidth:!0,label:"Workflow Name",value:w,onChange:t=>K(t.target.value),sx:{mt:2}}),e.jsx(Xe,{value:A,onChange:q,label:"Database Connection",size:"small",sx:{mt:2}}),e.jsx(He,{value:T,onChange:Q,label:"Report Template",size:"small",sx:{mt:2}})]}),e.jsxs(Fe,{children:[e.jsx(y,{onClick:oe,children:"Cancel"}),e.jsx(y,{variant:"contained",onClick:de,disabled:!w||ie,children:"Create"})]})]}),B&&e.jsx(Ge,{severity:"error",onClose:je,sx:{position:"fixed",bottom:16,right:16,maxWidth:400},children:B})]})}function Ct(){return ae(),e.jsx(xt,{})}export{Ct as default};
