{"version":3,"file":"ConnectionForm-CqFnuocs.js","sources":["../../src/components/Drawer/Drawer.jsx","../../src/utils/validation.js","../../src/features/connections/components/ConnectionForm.jsx"],"sourcesContent":["/**\n * Premium Drawer Component\n * Slide-out panel with theme-based styling\n */\nimport {\n  Drawer as MuiDrawer,\n  Box,\n  Typography,\n  IconButton,\n  Button,\n  Stack,\n  CircularProgress,\n  useTheme,\n  alpha,\n  keyframes,\n} from '@mui/material'\nimport CloseIcon from '@mui/icons-material/Close'\nimport { neutral, palette } from '@/app/theme'\n\n// =============================================================================\n// ANIMATIONS\n// =============================================================================\n\nconst fadeIn = keyframes`\n  from {\n    opacity: 0;\n    transform: translateX(20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(0);\n  }\n`\n\nexport default function Drawer({\n  open,\n  onClose,\n  title,\n  subtitle,\n  children,\n  anchor = 'right',\n  width = 480,\n  actions,\n  loading = false,\n  confirmLabel = 'Save',\n  cancelLabel = 'Cancel',\n  onConfirm,\n  onCancel,\n  confirmDisabled = false,\n}) {\n  const theme = useTheme()\n\n  const handleCancel = () => {\n    onCancel?.()\n    onClose()\n  }\n\n  return (\n    <MuiDrawer\n      anchor={anchor}\n      open={open}\n      onClose={onClose}\n      PaperProps={{\n        sx: {\n          width: { xs: '100%', sm: width },\n          maxWidth: '100%',\n          bgcolor: alpha(theme.palette.background.paper, 0.98),\n          backdropFilter: 'blur(20px)',\n          borderLeft: `1px solid ${alpha(theme.palette.divider, 0.08)}`,\n          boxShadow: `0 0 64px ${alpha(theme.palette.common.black, 0.25)}`,\n        },\n      }}\n      slotProps={{\n        backdrop: {\n          sx: {\n            bgcolor: alpha(theme.palette.common.black, 0.5),\n            backdropFilter: 'blur(4px)',\n          },\n        },\n      }}\n    >\n      <Box\n        sx={{\n          display: 'flex',\n          flexDirection: 'column',\n          height: '100%',\n          animation: `${fadeIn} 0.3s ease-out`,\n        }}\n      >\n        {/* Header */}\n        <Box\n          sx={{\n            px: 3,\n            py: 2.5,\n            display: 'flex',\n            alignItems: 'flex-start',\n            justifyContent: 'space-between',\n            borderBottom: `1px solid ${alpha(theme.palette.divider, 0.08)}`,\n          }}\n        >\n          <Box>\n            <Typography\n              sx={{\n                fontSize: '1.125rem',\n                fontWeight: 600,\n                color: theme.palette.text.primary,\n                letterSpacing: '-0.01em',\n              }}\n            >\n              {title}\n            </Typography>\n            {subtitle && (\n              <Typography\n                sx={{\n                  fontSize: '14px',\n                  color: theme.palette.text.secondary,\n                  mt: 0.5,\n                }}\n              >\n                {subtitle}\n              </Typography>\n            )}\n          </Box>\n          <IconButton\n            onClick={onClose}\n            size=\"small\"\n            sx={{\n              color: theme.palette.text.secondary,\n              borderRadius: 1,  // 8px via theme spacing\n              transition: 'all 0.2s ease',\n              '&:hover': {\n                bgcolor: theme.palette.mode === 'dark' ? alpha(theme.palette.text.primary, 0.08) : neutral[100],\n                color: theme.palette.text.primary,\n                transform: 'rotate(90deg)',\n              },\n            }}\n          >\n            <CloseIcon sx={{ fontSize: 18 }} />\n          </IconButton>\n        </Box>\n\n        {/* Content */}\n        <Box\n          sx={{\n            flex: 1,\n            overflow: 'auto',\n            p: 3,\n            bgcolor: alpha(theme.palette.background.default, 0.5),\n          }}\n        >\n          {children}\n        </Box>\n\n        {/* Footer Actions */}\n        {(actions || onConfirm) && (\n          <Box\n            sx={{\n              px: 3,\n              py: 2.5,\n              borderTop: `1px solid ${alpha(theme.palette.divider, 0.08)}`,\n              bgcolor: theme.palette.background.paper,\n            }}\n          >\n            {actions || (\n              <Stack direction=\"row\" spacing={1.5} justifyContent=\"flex-end\">\n                <Button\n                  variant=\"outlined\"\n                  onClick={handleCancel}\n                  disabled={loading}\n                  sx={{\n                    borderRadius: 1,  // 8px via theme spacing\n                    textTransform: 'none',\n                    fontWeight: 500,\n                    color: theme.palette.text.secondary,\n                    borderColor: alpha(theme.palette.divider, 0.2),\n                    transition: 'all 0.2s ease',\n                    '&:hover': {\n                      borderColor: alpha(theme.palette.text.primary, 0.3),\n                      bgcolor: alpha(theme.palette.text.primary, 0.05),\n                    },\n                  }}\n                >\n                  {cancelLabel}\n                </Button>\n                <Button\n                  variant=\"contained\"\n                  onClick={onConfirm}\n                  disabled={confirmDisabled || loading}\n                  startIcon={loading ? <CircularProgress size={16} color=\"inherit\" /> : null}\n                  sx={{\n                    borderRadius: 1,  // 8px via theme spacing\n                    textTransform: 'none',\n                    fontWeight: 600,\n                    bgcolor: theme.palette.mode === 'dark' ? neutral[700] : neutral[900],\n                    boxShadow: `0 4px 14px ${alpha(theme.palette.common.black, 0.15)}`,\n                    transition: 'all 0.2s ease',\n                    '&:hover': {\n                      bgcolor: theme.palette.mode === 'dark' ? neutral[500] : neutral[700],\n                      boxShadow: `0 6px 20px ${alpha(theme.palette.common.black, 0.2)}`,\n                      transform: 'translateY(-1px)',\n                    },\n                    '&:active': {\n                      transform: 'translateY(0)',\n                    },\n                  }}\n                >\n                  {confirmLabel}\n                </Button>\n              </Stack>\n            )}\n          </Box>\n        )}\n      </Box>\n    </MuiDrawer>\n  )\n}\n","/**\n * Client-side Form Validation Utilities\n *\n * This module provides validation functions for common form fields\n * to catch errors before form submission.\n */\n\n/**\n * Validation result object\n * @typedef {Object} ValidationResult\n * @property {boolean} valid - Whether the value passes validation\n * @property {string|null} error - Error message if invalid\n */\n\n/**\n * Check if a value is empty (null, undefined, or whitespace-only string)\n */\nexport function isEmpty(value) {\n  if (value === null || value === undefined) return true\n  if (typeof value === 'string') return value.trim().length === 0\n  if (Array.isArray(value)) return value.length === 0\n  return false\n}\n\n/**\n * Validate a required field\n * @param {*} value - Value to validate\n * @param {string} fieldName - Name of the field for error message\n * @returns {ValidationResult}\n */\nexport function validateRequired(value, fieldName = 'This field') {\n  if (isEmpty(value)) {\n    return { valid: false, error: `${fieldName} is required` }\n  }\n  return { valid: true, error: null }\n}\n\n/**\n * Validate minimum string length\n * @param {string} value - Value to validate\n * @param {number} minLength - Minimum length\n * @param {string} fieldName - Name of the field\n * @returns {ValidationResult}\n */\nexport function validateMinLength(value, minLength, fieldName = 'This field') {\n  if (typeof value !== 'string') {\n    return { valid: false, error: `${fieldName} must be a string` }\n  }\n  if (value.trim().length < minLength) {\n    return { valid: false, error: `${fieldName} must be at least ${minLength} characters` }\n  }\n  return { valid: true, error: null }\n}\n\n/**\n * Validate maximum string length\n * @param {string} value - Value to validate\n * @param {number} maxLength - Maximum length\n * @param {string} fieldName - Name of the field\n * @returns {ValidationResult}\n */\nexport function validateMaxLength(value, maxLength, fieldName = 'This field') {\n  if (typeof value !== 'string') {\n    return { valid: true, error: null }\n  }\n  if (value.length > maxLength) {\n    return { valid: false, error: `${fieldName} must be at most ${maxLength} characters` }\n  }\n  return { valid: true, error: null }\n}\n\n/**\n * Validate email format\n * @param {string} value - Email to validate\n * @returns {ValidationResult}\n */\nexport function validateEmail(value) {\n  if (isEmpty(value)) {\n    return { valid: true, error: null } // Let required validation handle empty\n  }\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n  if (!emailRegex.test(value)) {\n    return { valid: false, error: 'Please enter a valid email address' }\n  }\n  return { valid: true, error: null }\n}\n\n/**\n * Validate URL format\n * @param {string} value - URL to validate\n * @param {Object} options - Validation options\n * @param {boolean} options.requireProtocol - Whether to require http/https\n * @returns {ValidationResult}\n */\nexport function validateUrl(value, { requireProtocol = true } = {}) {\n  if (isEmpty(value)) {\n    return { valid: true, error: null }\n  }\n  try {\n    const url = new URL(value)\n    if (requireProtocol && !['http:', 'https:'].includes(url.protocol)) {\n      return { valid: false, error: 'URL must start with http:// or https://' }\n    }\n    return { valid: true, error: null }\n  } catch {\n    return { valid: false, error: 'Please enter a valid URL' }\n  }\n}\n\n/**\n * Validate database connection string\n * @param {string} value - Connection string to validate\n * @param {string} dbType - Database type\n * @returns {ValidationResult}\n */\nexport function validateDbConnectionString(value, dbType) {\n  if (isEmpty(value)) {\n    return { valid: true, error: null }\n  }\n\n  const dbTypeNorm = (dbType || '').toLowerCase()\n\n  // PostgreSQL connection string patterns\n  if (dbTypeNorm === 'postgresql' || dbTypeNorm === 'postgres') {\n    if (!value.startsWith('postgresql://') && !value.startsWith('postgres://')) {\n      return {\n        valid: false,\n        error: 'PostgreSQL connection must start with postgresql:// or postgres://',\n      }\n    }\n  }\n\n  // MySQL connection string patterns\n  if (dbTypeNorm === 'mysql') {\n    if (!value.startsWith('mysql://') && !value.startsWith('mysql+pymysql://')) {\n      return {\n        valid: false,\n        error: 'MySQL connection must start with mysql:// or mysql+pymysql://',\n      }\n    }\n  }\n\n  // SQLite connection string patterns\n  if (dbTypeNorm === 'sqlite') {\n    if (!value.startsWith('sqlite:///') && !value.startsWith('sqlite://')) {\n      return {\n        valid: false,\n        error: 'SQLite connection must start with sqlite:// or sqlite:///',\n      }\n    }\n  }\n\n  // SQL Server connection string patterns\n  if (dbTypeNorm === 'mssql' || dbTypeNorm === 'sqlserver') {\n    if (!value.startsWith('mssql://') && !value.startsWith('mssql+pyodbc://')) {\n      return {\n        valid: false,\n        error: 'SQL Server connection must start with mssql:// or mssql+pyodbc://',\n      }\n    }\n  }\n\n  return { valid: true, error: null }\n}\n\n/**\n * Validate a date string\n * @param {string} value - Date string to validate\n * @param {string} fieldName - Name of the field\n * @returns {ValidationResult}\n */\nexport function validateDate(value, fieldName = 'Date') {\n  if (isEmpty(value)) {\n    return { valid: true, error: null }\n  }\n  const date = new Date(value)\n  if (isNaN(date.getTime())) {\n    return { valid: false, error: `${fieldName} is not a valid date` }\n  }\n  return { valid: true, error: null }\n}\n\n/**\n * Validate date range (start must be before or equal to end)\n * @param {string} startDate - Start date string\n * @param {string} endDate - End date string\n * @returns {ValidationResult}\n */\nexport function validateDateRange(startDate, endDate) {\n  if (isEmpty(startDate) || isEmpty(endDate)) {\n    return { valid: true, error: null }\n  }\n  const start = new Date(startDate)\n  const end = new Date(endDate)\n  if (isNaN(start.getTime()) || isNaN(end.getTime())) {\n    return { valid: false, error: 'Invalid date format' }\n  }\n  if (start > end) {\n    return { valid: false, error: 'Start date must be before or equal to end date' }\n  }\n  return { valid: true, error: null }\n}\n\n/**\n * Validate file type\n * @param {File} file - File to validate\n * @param {string[]} allowedTypes - Allowed MIME types or extensions\n * @returns {ValidationResult}\n */\nexport function validateFileType(file, allowedTypes) {\n  if (!file) {\n    return { valid: true, error: null }\n  }\n\n  const fileName = file.name.toLowerCase()\n  const fileType = file.type.toLowerCase()\n\n  const isAllowed = allowedTypes.some((type) => {\n    // Check extension\n    if (type.startsWith('.')) {\n      return fileName.endsWith(type.toLowerCase())\n    }\n    // Check MIME type\n    return fileType === type.toLowerCase() || fileType.startsWith(`${type.toLowerCase()}/`)\n  })\n\n  if (!isAllowed) {\n    return {\n      valid: false,\n      error: `File type not allowed. Accepted: ${allowedTypes.join(', ')}`,\n    }\n  }\n\n  return { valid: true, error: null }\n}\n\n/**\n * Validate file size\n * @param {File} file - File to validate\n * @param {number} maxSizeBytes - Maximum file size in bytes\n * @returns {ValidationResult}\n */\nexport function validateFileSize(file, maxSizeBytes) {\n  if (!file) {\n    return { valid: true, error: null }\n  }\n\n  if (file.size > maxSizeBytes) {\n    const maxSizeMB = (maxSizeBytes / (1024 * 1024)).toFixed(1)\n    return {\n      valid: false,\n      error: `File size exceeds maximum of ${maxSizeMB}MB`,\n    }\n  }\n\n  return { valid: true, error: null }\n}\n\n/**\n * Run multiple validators and return first error\n * @param {Array<() => ValidationResult>} validators - Array of validator functions\n * @returns {ValidationResult}\n */\nexport function runValidators(validators) {\n  for (const validator of validators) {\n    const result = validator()\n    if (!result.valid) {\n      return result\n    }\n  }\n  return { valid: true, error: null }\n}\n\n/**\n * Validate an entire form and return all errors\n * @param {Object} values - Form values object\n * @param {Object} schema - Validation schema mapping field names to validators\n * @returns {Object} Object with { valid: boolean, errors: { fieldName: errorMessage } }\n *\n * @example\n * const result = validateForm(\n *   { name: '', email: 'invalid' },\n *   {\n *     name: (v) => validateRequired(v, 'Name'),\n *     email: (v) => runValidators([\n *       () => validateRequired(v, 'Email'),\n *       () => validateEmail(v),\n *     ]),\n *   }\n * )\n * // result = { valid: false, errors: { name: 'Name is required', email: null } }\n */\nexport function validateForm(values, schema) {\n  const errors = {}\n  let valid = true\n\n  for (const [fieldName, validator] of Object.entries(schema)) {\n    const result = validator(values[fieldName], values)\n    if (!result.valid) {\n      valid = false\n      errors[fieldName] = result.error\n    } else {\n      errors[fieldName] = null\n    }\n  }\n\n  return { valid, errors }\n}\n\n/**\n * Create a field validator that combines multiple validation rules\n * @param  {...Function} rules - Validation functions\n * @returns {Function} Combined validator function\n */\nexport function combineValidators(...rules) {\n  return (value, allValues) => {\n    for (const rule of rules) {\n      const result = rule(value, allValues)\n      if (!result.valid) {\n        return result\n      }\n    }\n    return { valid: true, error: null }\n  }\n}\n","import { useState, useCallback, useMemo, useRef } from 'react'\nimport {\n  Box,\n  TextField,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n  Stack,\n  Button,\n  Alert,\n  Collapse,\n  Typography,\n  Switch,\n  FormControlLabel,\n  Divider,\n  FormHelperText,\n  CircularProgress,\n  Tooltip,\n  InputAdornment,\n  IconButton,\n} from '@mui/material'\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore'\nimport ExpandLessIcon from '@mui/icons-material/ExpandLess'\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle'\nimport ErrorIcon from '@mui/icons-material/Error'\nimport HelpOutlineIcon from '@mui/icons-material/HelpOutline'\n\n// Help text for each field\nconst FIELD_HELP = {\n  name: 'A friendly name to identify this connection. Example: \"Production Database\" or \"Local Dev\".',\n  db_type: 'The type of database you\\'re connecting to. Contact your database administrator if you\\'re unsure.',\n  host: 'The server address where your database is hosted. This could be a domain name (db.example.com) or an IP address (192.168.1.1). Use \"localhost\" for local databases.',\n  port: 'The port number your database listens on. Default ports: PostgreSQL (5432), MySQL (3306), SQL Server (1433). Usually you don\\'t need to change this.',\n  database: 'The name of the specific database you want to connect to on the server. Ask your database administrator if you\\'re not sure.',\n  database_sqlite: 'The file path to your SQLite database file. Example: /home/user/data/myapp.db',\n  username: 'Your database username. This is the account that will be used to run queries.',\n  password: 'Your database password. This will be stored securely and encrypted.',\n  ssl: 'Enable SSL/TLS encryption for secure connections. Recommended for production databases, especially over the internet.',\n}\n\nfunction HelpIcon({ field }) {\n  const helpText = FIELD_HELP[field]\n  if (!helpText) return null\n\n  return (\n    <Tooltip title={helpText} arrow placement=\"top\">\n      <IconButton size=\"small\" sx={{ p: 0.5 }} aria-label={helpText}>\n        <HelpOutlineIcon sx={{ fontSize: 16, color: 'text.secondary' }} />\n      </IconButton>\n    </Tooltip>\n  )\n}\nimport { testConnection } from '@/api/client'\nimport { useInteraction, InteractionType, Reversibility } from '@/components/ux/governance'\nimport {\n  validateRequired,\n  validateMinLength,\n  validateMaxLength,\n  combineValidators,\n} from '@/utils/validation'\n\nconst DB_TYPES = [\n  { value: 'sqlite', label: 'SQLite', port: null, requiresAuth: false },\n  { value: 'postgresql', label: 'PostgreSQL', port: 5432, requiresAuth: true },\n  { value: 'mysql', label: 'MySQL', port: 3306, requiresAuth: true },\n  { value: 'mssql', label: 'SQL Server', port: 1433, requiresAuth: true },\n  { value: 'mariadb', label: 'MariaDB', port: 3306, requiresAuth: true },\n]\n\n// Field validators\nconst validators = {\n  name: combineValidators(\n    (v) => validateRequired(v, 'Connection name'),\n    (v) => validateMinLength(v, 2, 'Connection name'),\n    (v) => validateMaxLength(v, 100, 'Connection name')\n  ),\n  host: (value, allValues) => {\n    if (allValues.db_type === 'sqlite') return { valid: true, error: null }\n    return combineValidators(\n      (v) => validateRequired(v, 'Host'),\n      (v) => validateMaxLength(v, 255, 'Host')\n    )(value)\n  },\n  database: combineValidators(\n    (v) => validateRequired(v, 'Database name'),\n    (v) => validateMaxLength(v, 255, 'Database name')\n  ),\n  port: (value) => {\n    const port = parseInt(value, 10)\n    if (isNaN(port) || port < 1 || port > 65535) {\n      return { valid: false, error: 'Port must be between 1 and 65535' }\n    }\n    return { valid: true, error: null }\n  },\n}\n\nexport default function ConnectionForm({ connection, onSave, onCancel, loading }) {\n  const initialDbType = DB_TYPES.some((type) => type.value === connection?.db_type)\n    ? connection?.db_type\n    : 'sqlite'\n  const [formData, setFormData] = useState({\n    name: connection?.name || '',\n    db_type: initialDbType,\n    host: connection?.host || 'localhost',\n    port: connection?.port || 5432,\n    database: connection?.database || '',\n    username: connection?.username || '',\n    password: '',\n    ssl: connection?.ssl ?? true,\n  })\n  const [showAdvanced, setShowAdvanced] = useState(false)\n  const [error, setError] = useState(null)\n  const [touched, setTouched] = useState({})\n  const [fieldErrors, setFieldErrors] = useState({})\n  const [testing, setTesting] = useState(false)\n  const [testResult, setTestResult] = useState(null) // 'success' | 'error' | null\n  const submitDebounceRef = useRef(false)\n  const { execute } = useInteraction()\n\n  const handleChange = useCallback((field) => (event) => {\n    const value = event.target.type === 'checkbox' ? event.target.checked : event.target.value\n    setFormData((prev) => {\n      const newData = { ...prev, [field]: value }\n      // Validate on change if field was already touched\n      if (touched[field] && validators[field]) {\n        const result = validators[field](value, newData)\n        setFieldErrors((e) => ({ ...e, [field]: result.error }))\n      }\n      return newData\n    })\n    setError(null)\n  }, [touched])\n\n  const handleBlur = useCallback((field) => () => {\n    setTouched((prev) => ({ ...prev, [field]: true }))\n    if (validators[field]) {\n      const result = validators[field](formData[field], formData)\n      setFieldErrors((prev) => ({ ...prev, [field]: result.error }))\n    }\n  }, [formData])\n\n  const handleDbTypeChange = useCallback((event) => {\n    const dbType = event.target.value\n    const typeConfig = DB_TYPES.find((t) => t.value === dbType)\n    setFormData((prev) => ({\n      ...prev,\n      db_type: dbType,\n      port: typeConfig?.port || prev.port,\n    }))\n    setTestResult(null)\n  }, [])\n\n  const buildConnectionUrl = useCallback(() => {\n    if (formData.db_type === 'sqlite') {\n      // For SQLite we rely on the explicit `database` path field (sent as `database`)\n      // because `sqlite:///relative/path.db` parses as an absolute path on Windows.\n      return null\n    }\n    const auth = formData.username\n      ? `${formData.username}${formData.password ? `:${formData.password}` : ''}@`\n      : ''\n    return `${formData.db_type}://${auth}${formData.host}:${formData.port}/${formData.database}`\n  }, [formData])\n\n  const handleTestConnection = useCallback(async () => {\n    // Validate required fields first\n    const requiredErrors = {}\n    if (!formData.database.trim()) {\n      requiredErrors.database = 'Database is required to test'\n    }\n    if (formData.db_type !== 'sqlite' && !formData.host.trim()) {\n      requiredErrors.host = 'Host is required to test'\n    }\n\n    if (Object.keys(requiredErrors).length > 0) {\n      setFieldErrors((prev) => ({ ...prev, ...requiredErrors }))\n      setTouched((prev) => ({ ...prev, database: true, host: true }))\n      return\n    }\n\n    await execute({\n      type: InteractionType.EXECUTE,\n      label: 'Test connection',\n      reversibility: Reversibility.SYSTEM_MANAGED,\n      suppressSuccessToast: true,\n      suppressErrorToast: true,\n      intent: {\n        dbType: formData.db_type,\n        action: 'test_connection',\n      },\n      action: async () => {\n        setTesting(true)\n        setTestResult(null)\n        setError(null)\n\n        try {\n          const db_url = buildConnectionUrl()\n          const result = await testConnection({\n            db_url,\n            db_type: formData.db_type,\n            database: formData.database,\n          })\n          if (\n            result?.status === 'healthy'\n            || result?.healthy\n            || result?.status === 'ok'\n            || result?.ok\n          ) {\n            setTestResult('success')\n          } else {\n            setTestResult('error')\n            setError(result?.message || result?.error || 'Connection test failed')\n          }\n          return result\n        } catch (err) {\n          setTestResult('error')\n          setError(err.message || 'Connection test failed')\n          throw err\n        } finally {\n          setTesting(false)\n        }\n      },\n    })\n  }, [buildConnectionUrl, execute, formData])\n\n  const handleSubmit = useCallback((e) => {\n    e.preventDefault()\n\n    // Debounce protection against double-submit\n    if (submitDebounceRef.current) return\n    submitDebounceRef.current = true\n    setTimeout(() => { submitDebounceRef.current = false }, 1000)\n\n    // Mark all fields as touched\n    const allTouched = { name: true, host: true, database: true, port: true }\n    setTouched(allTouched)\n\n    // Validate all fields\n    const errors = {}\n    let hasErrors = false\n\n    for (const [field, validator] of Object.entries(validators)) {\n      const result = validator(formData[field], formData)\n      if (!result.valid) {\n        errors[field] = result.error\n        hasErrors = true\n      }\n    }\n\n    setFieldErrors(errors)\n\n    if (hasErrors) {\n      const firstError = Object.values(errors).find(Boolean)\n      setError(firstError || 'Please fix the errors above')\n      return\n    }\n\n    const db_url = buildConnectionUrl()\n\n    onSave({\n      ...formData,\n      db_url,\n    })\n  }, [formData, onSave, buildConnectionUrl])\n\n  const isSqlite = formData.db_type === 'sqlite'\n\n  // Compute whether the form has minimum required data for submission\n  const isFormValid = useMemo(() => {\n    const nameValid = formData.name.trim().length >= 2\n    const dbValid = formData.database.trim().length > 0\n    if (isSqlite) return nameValid && dbValid\n    const hostValid = formData.host.trim().length > 0\n    return nameValid && dbValid && hostValid\n  }, [formData.name, formData.database, formData.host, isSqlite])\n\n  return (\n    <Box component=\"form\" onSubmit={handleSubmit}>\n      <Stack spacing={3}>\n        {error && (\n          <Alert\n            severity=\"error\"\n            onClose={() => setError(null)}\n            action={\n              testResult === 'error' && (\n                <Button\n                  color=\"inherit\"\n                  size=\"small\"\n                  onClick={handleTestConnection}\n                  disabled={testing}\n                >\n                  Try Again\n                </Button>\n              )\n            }\n          >\n            {error}\n          </Alert>\n        )}\n\n        <Alert severity=\"info\">\n          Use a read-only account when possible. Testing only checks connectivity. Saved credentials are encrypted for\n          reuse. Deleting a connection never deletes data from your database.\n        </Alert>\n\n        <TextField\n          label={\n            <Stack direction=\"row\" alignItems=\"center\" spacing={0.5} component=\"span\">\n              <span>Connection Name</span>\n              <HelpIcon field=\"name\" />\n            </Stack>\n          }\n          value={formData.name}\n          onChange={handleChange('name')}\n          onBlur={handleBlur('name')}\n          placeholder=\"e.g., Production Database\"\n          required\n          fullWidth\n          inputProps={{ maxLength: 100 }}\n          error={touched.name && Boolean(fieldErrors.name)}\n          helperText={touched.name && fieldErrors.name}\n        />\n\n        <FormControl fullWidth>\n          <InputLabel>\n            <Stack direction=\"row\" alignItems=\"center\" spacing={0.5} component=\"span\">\n              <span>Database Type</span>\n              <HelpIcon field=\"db_type\" />\n            </Stack>\n          </InputLabel>\n          <Select\n            value={formData.db_type}\n            onChange={handleDbTypeChange}\n            label=\"Database Type      \"\n          >\n            {DB_TYPES.map((type) => (\n              <MenuItem key={type.value} value={type.value}>\n                {type.label}\n              </MenuItem>\n            ))}\n          </Select>\n          <FormHelperText>Not sure? Ask your database administrator</FormHelperText>\n        </FormControl>\n\n        {!isSqlite && (\n          <Stack direction=\"row\" spacing={2}>\n            <TextField\n              label={\n                <Stack direction=\"row\" alignItems=\"center\" spacing={0.5} component=\"span\">\n                  <span>Server Address</span>\n                  <HelpIcon field=\"host\" />\n                </Stack>\n              }\n              value={formData.host}\n              onChange={handleChange('host')}\n              onBlur={handleBlur('host')}\n              placeholder=\"e.g., db.example.com\"\n              required\n              sx={{ flex: 2 }}\n              error={touched.host && Boolean(fieldErrors.host)}\n              helperText={touched.host ? fieldErrors.host : 'The URL or IP address of your database server'}\n            />\n            <TextField\n              label={\n                <Stack direction=\"row\" alignItems=\"center\" spacing={0.5} component=\"span\">\n                  <span>Port</span>\n                  <HelpIcon field=\"port\" />\n                </Stack>\n              }\n              type=\"number\"\n              value={formData.port}\n              onChange={handleChange('port')}\n              onBlur={handleBlur('port')}\n              sx={{ flex: 1 }}\n              error={touched.port && Boolean(fieldErrors.port)}\n              helperText={touched.port ? fieldErrors.port : 'Usually automatic'}\n            />\n          </Stack>\n        )}\n\n        <TextField\n          label={\n            <Stack direction=\"row\" alignItems=\"center\" spacing={0.5} component=\"span\">\n              <span>{isSqlite ? 'Database Path' : 'Database Name'}</span>\n              <HelpIcon field={isSqlite ? 'database_sqlite' : 'database'} />\n            </Stack>\n          }\n          value={formData.database}\n          onChange={handleChange('database')}\n          onBlur={handleBlur('database')}\n          placeholder={isSqlite ? '/path/to/database.db' : 'e.g., my_database'}\n          required\n          fullWidth\n          error={touched.database && Boolean(fieldErrors.database)}\n          helperText={touched.database ? fieldErrors.database : (isSqlite ? 'Full path to your SQLite file' : 'The name of the database on the server')}\n        />\n\n        {!isSqlite && (\n          <>\n            <TextField\n              label={\n                <Stack direction=\"row\" alignItems=\"center\" spacing={0.5} component=\"span\">\n                  <span>Username</span>\n                  <HelpIcon field=\"username\" />\n                </Stack>\n              }\n              value={formData.username}\n              onChange={handleChange('username')}\n              placeholder=\"e.g., postgres\"\n              fullWidth\n              helperText=\"The database account to use\"\n            />\n\n            <TextField\n              label={\n                <Stack direction=\"row\" alignItems=\"center\" spacing={0.5} component=\"span\">\n                  <span>Password</span>\n                  <HelpIcon field=\"password\" />\n                </Stack>\n              }\n              type=\"password\"\n              value={formData.password}\n              onChange={handleChange('password')}\n              placeholder=\"Enter password\"\n              fullWidth\n              helperText=\"Stored securely and encrypted\"\n            />\n          </>\n        )}\n\n        {/* Advanced Settings */}\n        <Box>\n          <Button\n            variant=\"text\"\n            size=\"small\"\n            onClick={() => setShowAdvanced((prev) => !prev)}\n            endIcon={showAdvanced ? <ExpandLessIcon /> : <ExpandMoreIcon />}\n            sx={{ textTransform: 'none', fontWeight: 500 }}\n          >\n            Advanced Settings\n          </Button>\n\n          <Collapse in={showAdvanced}>\n            <Box sx={{ mt: 2, p: 2, bgcolor: 'action.hover', borderRadius: 1 }}>\n              <Stack spacing={2}>\n                {!isSqlite && (\n                  <FormControlLabel\n                    control={\n                      <Switch\n                        checked={formData.ssl}\n                        onChange={handleChange('ssl')}\n                      />\n                    }\n                    label={\n                      <Stack direction=\"row\" alignItems=\"center\" spacing={0.5}>\n                        <span>Use Secure Connection (SSL)</span>\n                        <HelpIcon field=\"ssl\" />\n                      </Stack>\n                    }\n                  />\n                )}\n                {isSqlite && (\n                  <Typography variant=\"caption\" color=\"text.secondary\">\n                    SQLite databases use file-based storage and do not require additional configuration.\n                  </Typography>\n                )}\n              </Stack>\n            </Box>\n          </Collapse>\n        </Box>\n\n        <Divider />\n\n        {/* Test Connection Result */}\n        {testResult && (\n          <Alert\n            severity={testResult === 'success' ? 'success' : 'error'}\n            icon={testResult === 'success' ? <CheckCircleIcon /> : <ErrorIcon />}\n            onClose={() => setTestResult(null)}\n            action={\n              testResult === 'error' && (\n                <Button\n                  color=\"inherit\"\n                  size=\"small\"\n                  onClick={handleTestConnection}\n                  disabled={testing}\n                >\n                  Retry\n                </Button>\n              )\n            }\n          >\n            {testResult === 'success'\n              ? 'Connection successful! Database is reachable.'\n              : error || 'Connection failed. Check your settings and try again.'}\n          </Alert>\n        )}\n\n        {/* Actions */}\n        <Stack direction=\"row\" spacing={2} justifyContent=\"flex-end\">\n          <Button\n            variant=\"text\"\n            onClick={handleTestConnection}\n            disabled={loading || testing}\n            startIcon={testing ? <CircularProgress size={16} /> : null}\n          >\n            {testing ? 'Testing...' : 'Test Connection'}\n          </Button>\n          <Button\n            variant=\"outlined\"\n            onClick={onCancel}\n            disabled={loading}\n          >\n            Cancel\n          </Button>\n          <Button\n            type=\"submit\"\n            variant=\"contained\"\n            disabled={loading || !isFormValid}\n          >\n            {connection ? 'Update Connection' : 'Add Connection'}\n          </Button>\n        </Stack>\n      </Stack>\n    </Box>\n  )\n}\n"],"names":["fadeIn","keyframes","Drawer","open","onClose","title","subtitle","children","anchor","width","actions","loading","confirmLabel","cancelLabel","onConfirm","onCancel","confirmDisabled","theme","useTheme","handleCancel","jsx","MuiDrawer","alpha","jsxs","Box","Typography","IconButton","neutral","CloseIcon","Stack","Button","CircularProgress","isEmpty","value","validateRequired","fieldName","validateMinLength","minLength","validateMaxLength","maxLength","combineValidators","rules","allValues","rule","result","FIELD_HELP","HelpIcon","field","helpText","Tooltip","HelpOutlineIcon","DB_TYPES","validators","v","port","ConnectionForm","connection","onSave","initialDbType","type","formData","setFormData","useState","showAdvanced","setShowAdvanced","error","setError","touched","setTouched","fieldErrors","setFieldErrors","testing","setTesting","testResult","setTestResult","submitDebounceRef","useRef","execute","useInteraction","handleChange","useCallback","event","prev","newData","e","handleBlur","handleDbTypeChange","dbType","typeConfig","t","buildConnectionUrl","auth","handleTestConnection","requiredErrors","InteractionType","Reversibility","db_url","testConnection","err","handleSubmit","errors","hasErrors","validator","firstError","isSqlite","isFormValid","useMemo","nameValid","dbValid","hostValid","Alert","TextField","FormControl","InputLabel","Select","MenuItem","FormHelperText","Fragment","ExpandLessIcon","ExpandMoreIcon","Collapse","FormControlLabel","Switch","Divider","CheckCircleIcon","ErrorIcon"],"mappings":"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"}