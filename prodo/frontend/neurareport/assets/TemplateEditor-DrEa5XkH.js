import{a8 as yt,a9 as bt,r as l,aa as vt,j as e,ab as wt,ac as St,N as Ct,o as f,at as It,g as G,B as c,q as j,p as K,f as v,a1 as je,T,e as U,n as S,b2 as ee,J as ye,dg as st,dh as nt,c8 as At,bo as kt,ba as Tt,bb as Et,di as be,bc as zt,A as at,K as D,dj as Dt,w as Rt,dk as Mt,v as Lt,a as it,l as Be,dl as Ht,dm as Nt,R as he,I as pe,dn as $t,dp as Ft,dq as Ut,az as Wt,aA as Bt,aH as fe,aI as Pt,ak as me,aJ as Pe,C as ge,ci as _t,ah as _e,aj as Oe,ag as Ke,al as Ye,am as Ot}from"./index-tNjrNcyx.js";import{A as Kt}from"./ArrowBack-DZSCerTh.js";import{C as Yt}from"./Code-CP1TKb_0.js";import{S as Gt}from"./Save-BetSEFm3.js";import{C as ve}from"./CompareArrows-x_SQINqo.js";import{F as Ge}from"./Fullscreen-CVqSZSi9.js";import{S as Ve,T as Vt}from"./TemplateChatEditor-CBGGvyfh.js";import{S as Jt}from"./Surface-BP-OE1Iu.js";import{a as qt}from"./sanitize-BsPzJ-uc.js";import{K as Xt,S as I}from"./KeyboardArrowDown-DDM4t9XR.js";import{T as Ce,a as Y}from"./ToggleButtonGroup-CoYXTHmz.js";import{F as Zt}from"./FilterList-HB9KZahR.js";import{A as ot}from"./AccessTime-lMRy3h0r.js";import{G as $}from"./Grid-DP3jmde8.js";import{R as Je}from"./Restore-BI1eOOPq.js";import{C as Qt}from"./ConfirmModal-BBknfNQr.js";import{A as er}from"./AiUsageNotice-DsJkyA9j.js";import"./Lightbulb-B6WhFsgN.js";import"./Autocomplete-DhsBc69q.js";import"./TableRow-DBskq6ho.js";import"./CheckCircleOutline-DkNeJ2sB.js";import"./WarningAmber-D6zaqvXu.js";function tr(t){return yt("MuiAlertTitle",t)}bt("MuiAlertTitle",["root"]);const rr=t=>{const{classes:r}=t;return St({root:["root"]},tr,r)},sr=Ct(f,{name:"MuiAlertTitle",slot:"Root"})(It(({theme:t})=>({fontWeight:t.typography.fontWeightMedium,marginTop:-2}))),nr=l.forwardRef(function(r,a){const d=vt({props:r,name:"MuiAlertTitle"}),{className:n,...u}=d,y=d,i=rr(y);return e.jsx(sr,{gutterBottom:!0,component:"div",ownerState:y,ref:a,className:wt(i.root,n),...u})}),ar=G(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"})),qe=G(e.jsx("path",{d:"M5 16h3v3h2v-5H5zm3-8H5v2h5V5H8zm6 11h2v-3h3v-2h-5zm2-11V5h-2v5h5V8z"})),ir=G(e.jsx("path",{d:"M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"})),we=G(e.jsx("path",{d:"M19 13H5v-2h14z"})),or=G(e.jsx("path",{d:"M7.41 18.59 8.83 20 12 16.83 15.17 20l1.41-1.41L12 14zm9.18-13.18L15.17 4 12 7.17 8.83 4 7.41 5.41 12 10z"})),lr=G(e.jsx("path",{d:"M12 5.83 15.17 9l1.41-1.41L12 3 7.41 7.59 8.83 9zm0 12.34L8.83 15l-1.41 1.41L12 21l4.59-4.59L15.17 15z"})),cr={manual:"Manual edit",ai:"AI edit",undo:"Undo"},dr={manual:"primary",ai:"secondary",undo:"warning"},ur={manual:"filled",ai:"filled",undo:"outlined"},te=t=>String(t).padStart(2,"0"),xr=t=>{if(!t)return null;const r=new Date(t);return Number.isNaN(r.getTime())?null:`${r.getFullYear()}-${te(r.getMonth()+1)}-${te(r.getDate())} ${te(r.getHours())}:${te(r.getMinutes())}`},hr=t=>{if(!t||typeof t!="object")return null;const r=typeof t.lastEditType=="string"?t.lastEditType.trim().toLowerCase():null,a=r==="manual"||r==="ai"||r==="undo"?r:null,d=a?cr[a]:null,n=xr(t.lastEditAt);if(!d&&!n)return null;const u=d&&n?`${d} · ${n}`:d||(n?`Edited ${n}`:null);return{type:a,typeLabel:d,timestampLabel:n,chipLabel:u,color:a&&dr[a]||"default",variant:a&&ur[a]||"outlined"}},pr=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");function B(t){if(!t)return null;t=pr(t);const r=t.replace(/(&lt;|<)(\/?)([\w-]+)/g,(a,d,n,u)=>`<span class="html-bracket">&lt;</span><span class="html-slash">${n}</span><span class="html-tag">${u}</span>`).replace(/(\s)([\w-]+)(=)/g,(a,d,n,u)=>`${d}<span class="html-attr">${n}</span><span class="html-eq">=</span>`).replace(/("[^"]*"|'[^']*')/g,'<span class="html-string">$1</span>').replace(/(>)/g,'<span class="html-bracket">$1</span>').replace(/(\{[^}]+\})/g,'<span class="html-token">$1</span>');return e.jsx("span",{dangerouslySetInnerHTML:{__html:qt(r)}})}function fr(t,r,a=3){const d=(t||"").split(`
`),n=(r||"").split(`
`),u=[],y=Math.max(d.length,n.length);let i=null;const b=[];for(let x=0;x<y;x++){const g=d[x]??null,o=n[x]??null;g===o&&g!==null?(i===null&&(i=x),b.push({type:"unchanged",lineNumber:{before:x+1,after:x+1},content:g})):(b.length>0&&(b.length<=a*2+1?u.push(...b):(u.push(...b.slice(0,a)),u.push({type:"collapsed",count:b.length-a*2,startLine:i+a+1}),u.push(...b.slice(-a))),b.length=0,i=null),g!==null&&o!==null?u.push({type:"modified",lineNumber:{before:x+1,after:x+1},beforeContent:g,afterContent:o}):g!==null?u.push({type:"removed",lineNumber:{before:x+1,after:null},content:g}):o!==null&&u.push({type:"added",lineNumber:{before:null,after:x+1},content:o}))}return b.length>0&&(b.length<=a?u.push(...b):(u.push(...b.slice(0,a)),b.length>a&&u.push({type:"collapsed",count:b.length-a,startLine:i+a+1}))),u}function mr({item:t,viewMode:r,expanded:a,onToggleExpand:d,syntaxHighlight:n}){const u={width:48,minWidth:48,px:1,py:.5,bgcolor:"action.hover",color:"text.disabled",fontFamily:"monospace",fontSize:"0.75rem",textAlign:"right",userSelect:"none",borderRight:"1px solid",borderColor:"divider"},y={flex:1,px:1.5,py:.5,fontFamily:"monospace",fontSize:"12px",whiteSpace:"pre-wrap",wordBreak:"break-all",minHeight:24,"& .html-tag":{color:ee.cyan[600]},"& .html-attr":{color:ee.teal[500]},"& .html-string":{color:ee.rose[400]},"& .html-bracket":{color:S[500]},"& .html-slash":{color:S[500]},"& .html-eq":{color:S[300]},"& .html-token":{color:ee.emerald[400],fontWeight:600}};return t.type==="collapsed"?e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"center",py:.5,px:2,bgcolor:i=>i.palette.mode==="dark"?v(i.palette.text.primary,.04):S[50],borderTop:"1px dashed",borderBottom:"1px dashed",borderColor:"divider",cursor:"pointer","&:hover":{bgcolor:i=>i.palette.mode==="dark"?v(i.palette.text.primary,.08):S[100]}},onClick:()=>d?.(t.startLine),children:[e.jsx(lr,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),e.jsxs(f,{variant:"caption",color:"text.secondary",children:[t.count," unchanged lines (click to expand)"]})]}):t.type==="unchanged"?e.jsxs(c,{sx:{display:"flex",bgcolor:"transparent"},children:[e.jsx(c,{sx:u,children:t.lineNumber.before}),r==="split"&&e.jsx(c,{sx:u,children:t.lineNumber.after}),e.jsx(c,{sx:y,children:n?B(t.content):t.content})]}):t.type==="removed"?e.jsxs(c,{sx:{display:"flex",bgcolor:i=>i.palette.mode==="dark"?v(i.palette.text.primary,.04):S[50]},children:[e.jsx(c,{sx:{...u,bgcolor:i=>i.palette.mode==="dark"?v(i.palette.text.primary,.08):S[100]},children:t.lineNumber.before}),r==="split"&&e.jsx(c,{sx:u}),e.jsxs(c,{sx:{...y,color:"text.secondary",textDecoration:"line-through"},children:[e.jsx(we,{sx:{fontSize:14,mr:.5,verticalAlign:"middle"}}),n?B(t.content):t.content]})]}):t.type==="added"?e.jsxs(c,{sx:{display:"flex",bgcolor:i=>i.palette.mode==="dark"?v(i.palette.text.primary,.06):S[200]},children:[e.jsx(c,{sx:u}),r==="split"&&e.jsx(c,{sx:{...u,bgcolor:i=>i.palette.mode==="dark"?v(i.palette.text.primary,.1):S[200]},children:t.lineNumber.after}),e.jsxs(c,{sx:{...y,color:"text.primary"},children:[e.jsx(je,{sx:{fontSize:14,mr:.5,verticalAlign:"middle"}}),n?B(t.content):t.content]})]}):t.type==="modified"?r==="split"?e.jsx(e.Fragment,{children:e.jsxs(c,{sx:{display:"flex",bgcolor:i=>i.palette.mode==="dark"?v(i.palette.text.primary,.04):S[50]},children:[e.jsx(c,{sx:{...u,bgcolor:i=>i.palette.mode==="dark"?v(i.palette.text.primary,.08):S[100]},children:t.lineNumber.before}),e.jsx(c,{sx:{...y,color:"text.secondary",textDecoration:"line-through",flex:.5},children:n?B(t.beforeContent):t.beforeContent}),e.jsx(c,{sx:{...u,bgcolor:i=>i.palette.mode==="dark"?v(i.palette.text.primary,.1):S[200]},children:t.lineNumber.after}),e.jsx(c,{sx:{...y,color:"text.primary",flex:.5},children:n?B(t.afterContent):t.afterContent})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(c,{sx:{display:"flex",bgcolor:i=>i.palette.mode==="dark"?v(i.palette.text.primary,.04):S[50]},children:[e.jsx(c,{sx:{...u,bgcolor:i=>i.palette.mode==="dark"?v(i.palette.text.primary,.08):S[100]},children:t.lineNumber.before}),e.jsxs(c,{sx:{...y,color:"text.secondary",textDecoration:"line-through"},children:[e.jsx(we,{sx:{fontSize:14,mr:.5,verticalAlign:"middle"}}),n?B(t.beforeContent):t.beforeContent]})]}),e.jsxs(c,{sx:{display:"flex",bgcolor:i=>i.palette.mode==="dark"?v(i.palette.text.primary,.06):S[200]},children:[e.jsx(c,{sx:{...u,bgcolor:i=>i.palette.mode==="dark"?v(i.palette.text.primary,.1):S[200]},children:t.lineNumber.after}),e.jsxs(c,{sx:{...y,color:"text.primary"},children:[e.jsx(je,{sx:{fontSize:14,mr:.5,verticalAlign:"middle"}}),n?B(t.afterContent):t.afterContent]})]})]}):null}function gr({beforeText:t,afterText:r,contextLines:a=3}){const[d,n]=l.useState("unified"),[u,y]=l.useState(!0),[i,b]=l.useState(new Set),[x,g]=l.useState(0),o=l.useMemo(()=>fr(t,r,a),[t,r,a]),w=l.useMemo(()=>{let h=0,m=0,C=0;return o.forEach(R=>{R.type==="added"&&h++,R.type==="removed"&&m++,R.type==="modified"&&C++}),{added:h,removed:m,modified:C,total:h+m+C}},[o]),E=l.useMemo(()=>o.map((h,m)=>h.type!=="unchanged"&&h.type!=="collapsed"?m:null).filter(h=>h!==null),[o]),L=h=>{b(m=>{const C=new Set(m);return C.has(h)?C.delete(h):C.add(h),C})},z=h=>{if(E.length===0)return;let m=x+h;m<0&&(m=E.length-1),m>=E.length&&(m=0),g(m)};return!t&&!r?e.jsx(c,{sx:{p:3,textAlign:"center"},children:e.jsx(f,{color:"text.secondary",children:"No content to compare"})}):t===r?e.jsx(c,{sx:{p:3,textAlign:"center"},children:e.jsx(f,{color:"text.secondary",children:"No differences found"})}):e.jsxs(c,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(j,{direction:"row",spacing:2,alignItems:"center",justifyContent:"space-between",sx:{px:2,py:1,borderBottom:"1px solid",borderColor:"divider"},children:[e.jsxs(j,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(K,{size:"small",icon:e.jsx(je,{}),label:`+${w.added}`,variant:"outlined",sx:{borderColor:h=>v(h.palette.divider,.3),color:"text.secondary"}}),e.jsx(K,{size:"small",icon:e.jsx(we,{}),label:`-${w.removed}`,variant:"outlined",sx:{borderColor:h=>v(h.palette.divider,.3),color:"text.secondary"}}),w.modified>0&&e.jsx(K,{size:"small",icon:e.jsx(ve,{}),label:`~${w.modified}`,variant:"outlined",sx:{borderColor:h=>v(h.palette.divider,.3),color:"text.secondary"}})]}),e.jsxs(j,{direction:"row",spacing:1,alignItems:"center",children:[E.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{variant:"caption",color:"text.secondary",children:[x+1," / ",E.length]}),e.jsx(T,{title:"Previous change",children:e.jsx(U,{size:"small",onClick:()=>z(-1),"aria-label":"Previous change",children:e.jsx(ir,{fontSize:"small"})})}),e.jsx(T,{title:"Next change",children:e.jsx(U,{size:"small",onClick:()=>z(1),"aria-label":"Next change",children:e.jsx(Xt,{fontSize:"small"})})})]}),e.jsxs(Ce,{size:"small",value:d,exclusive:!0,onChange:(h,m)=>m&&n(m),children:[e.jsx(Y,{value:"unified",children:e.jsx(T,{title:"Unified view",children:e.jsx(or,{fontSize:"small"})})}),e.jsx(Y,{value:"split",children:e.jsx(T,{title:"Split view",children:e.jsx(ve,{fontSize:"small"})})})]})]})]}),e.jsx(c,{sx:{flex:1,overflow:"auto",bgcolor:"background.default","& > *:nth-of-type(even)":{bgcolor:h=>v(h.palette.action.hover,.3)}},children:o.map((h,m)=>e.jsx(mr,{item:h,viewMode:d,syntaxHighlight:u,onToggleExpand:L},m))})]})}const re={manual:{icon:kt,label:"Manual",color:"default"},ai:{icon:At,label:"AI",color:"default"},chat:{icon:nt,label:"Chat AI",color:"default"},undo:{icon:st,label:"Undo",color:"default"},default:{icon:ye,label:"Edit",color:"default"}};function jr(t){if(!t)return"Unknown time";const r=new Date(t),d=new Date-r,n=Math.floor(d/1e3),u=Math.floor(n/60),y=Math.floor(u/60),i=Math.floor(y/24);return n<60?"Just now":u<60?`${u}m ago`:y<24?`${y}h ago`:i<7?`${i}d ago`:r.toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function yr({entry:t,isLatest:r}){const a=re[t.type]||re.default,d=a.icon;return e.jsxs(c,{sx:{display:"flex",gap:1.5,py:1,px:1.5,borderRadius:1,bgcolor:r?n=>n.palette.mode==="dark"?v(n.palette.text.primary,.04):S[50]:"transparent","&:hover":{bgcolor:"action.hover"}},children:[e.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",pt:.5},children:[e.jsx(c,{sx:{width:28,height:28,borderRadius:"50%",bgcolor:n=>n.palette.mode==="dark"?v(n.palette.text.primary,.08):S[100],display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(d,{sx:{fontSize:16,color:"text.secondary"}})}),e.jsx(c,{sx:{width:2,flex:1,mt:.5,bgcolor:"divider",minHeight:8}})]}),e.jsxs(c,{sx:{flex:1,minWidth:0},children:[e.jsxs(j,{direction:"row",spacing:1,alignItems:"center",sx:{mb:.25},children:[e.jsx(K,{label:a.label,size:"small",variant:"outlined",sx:{height:20,fontSize:"12px",borderColor:n=>v(n.palette.divider,.3),color:"text.secondary"}}),r&&e.jsx(K,{label:"Latest",size:"small",sx:{height:20,fontSize:"12px",bgcolor:n=>n.palette.mode==="dark"?S[700]:S[900],color:"common.white"}})]}),t.notes&&e.jsx(f,{variant:"body2",color:"text.primary",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:t.notes}),e.jsxs(j,{direction:"row",spacing:.5,alignItems:"center",sx:{mt:.5},children:[e.jsx(ot,{sx:{fontSize:12,color:"text.disabled"}}),e.jsx(f,{variant:"caption",color:"text.disabled",children:jr(t.timestamp)})]})]})]})}const Xe=500;function br({history:t=[],maxVisible:r=5}){const[a,d]=l.useState(!1),[n,u]=l.useState("all"),y=l.useMemo(()=>{if(!Array.isArray(t))return[];let o=[...t.length>Xe?t.slice(-Xe):t].reverse();return n!=="all"&&(o=o.filter(w=>w.type===n)),o},[t,n]),i=a?y:y.slice(0,r),b=y.length>r,x=l.useMemo(()=>{const g=new Set(["all"]);return t.forEach(o=>{o.type&&g.add(o.type)}),Array.from(g)},[t]);return!t||t.length===0?e.jsxs(c,{sx:{py:2,px:1.5,textAlign:"center"},children:[e.jsx(ye,{sx:{fontSize:32,color:"text.disabled",mb:1}}),e.jsx(f,{variant:"body2",color:"text.secondary",children:"No edit history yet"}),e.jsx(f,{variant:"caption",color:"text.disabled",children:"Your changes will appear here"})]}):e.jsxs(c,{children:[e.jsxs(j,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[e.jsxs(j,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(ye,{fontSize:"small",color:"action"}),e.jsx(f,{variant:"subtitle2",children:"History"}),e.jsx(K,{label:y.length,size:"small",sx:{height:18,fontSize:"12px"}})]}),x.length>2&&e.jsxs(Ce,{size:"small",value:n,exclusive:!0,onChange:(g,o)=>o&&u(o),sx:{"& .MuiToggleButton-root":{py:.25,px:.75,fontSize:"12px"}},children:[e.jsx(Y,{value:"all",children:e.jsx(T,{title:"All edits",children:e.jsx(Zt,{sx:{fontSize:14}})})}),x.filter(g=>g!=="all").map(g=>{const o=re[g]||re.default,w=o.icon;return e.jsx(Y,{value:g,children:e.jsx(T,{title:o.label,children:e.jsx(w,{sx:{fontSize:14}})})},g)})]})]}),e.jsxs(c,{sx:{borderRadius:1.5,border:"1px solid",borderColor:"divider",bgcolor:"background.paper",overflow:"hidden"},children:[i.map((g,o)=>e.jsx(yr,{entry:g,isLatest:o===0},`${g.timestamp}-${o}`)),b&&e.jsx(c,{sx:{borderTop:"1px solid",borderColor:"divider",py:.75,textAlign:"center"},children:e.jsx(U,{size:"small",onClick:()=>d(!a),sx:{fontSize:"12px"},children:a?e.jsxs(e.Fragment,{children:[e.jsx(Tt,{fontSize:"small"}),e.jsx(f,{variant:"caption",sx:{ml:.5},children:"Show less"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Et,{fontSize:"small"}),e.jsxs(f,{variant:"caption",sx:{ml:.5},children:["Show ",y.length-r," more"]})]})})})]})]})}function vr({mode:t="manual"}){return e.jsxs($,{container:!0,spacing:2.5,sx:{alignItems:"stretch"},children:[e.jsx($,{size:{xs:12,md:t==="chat"?5:6},sx:{minWidth:0},children:e.jsxs(j,{spacing:1.5,sx:{height:"100%"},children:[e.jsx(I,{variant:"text",width:80,height:28}),e.jsx(c,{sx:{borderRadius:1.5,border:"1px solid",borderColor:"divider",bgcolor:"background.paper",p:1.5,minHeight:t==="chat"?400:200,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(I,{variant:"rectangular",width:"80%",height:t==="chat"?350:180,sx:{borderRadius:1}})}),e.jsx(I,{variant:"text",width:150,height:20})]})}),e.jsx($,{size:{xs:12,md:t==="chat"?7:6},sx:{minWidth:0},children:t==="chat"?e.jsxs(c,{sx:{height:600,borderRadius:1,border:"1px solid",borderColor:"divider",overflow:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs(c,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider"},children:[e.jsx(I,{variant:"text",width:180,height:28}),e.jsx(I,{variant:"text",width:250,height:18})]}),e.jsx(c,{sx:{flex:1,p:2},children:e.jsx(j,{spacing:2,children:[1,2,3].map(r=>e.jsxs(j,{direction:"row",spacing:1.5,children:[e.jsx(I,{variant:"circular",width:32,height:32}),e.jsxs(c,{sx:{flex:1},children:[e.jsx(I,{variant:"text",width:80,height:18}),e.jsx(I,{variant:"rectangular",width:"80%",height:60,sx:{borderRadius:1,mt:.5}})]})]},r))})}),e.jsx(c,{sx:{p:2,borderTop:"1px solid",borderColor:"divider"},children:e.jsx(I,{variant:"rectangular",height:56,sx:{borderRadius:1}})})]}):e.jsxs(j,{spacing:1.5,sx:{height:"100%"},children:[e.jsx(I,{variant:"text",width:150,height:28}),e.jsx(I,{variant:"rectangular",height:260,sx:{borderRadius:1}}),e.jsx(I,{variant:"rectangular",height:100,sx:{borderRadius:1}}),e.jsxs(j,{direction:"row",spacing:1.5,children:[e.jsx(I,{variant:"rectangular",width:100,height:36,sx:{borderRadius:1}}),e.jsx(I,{variant:"rectangular",width:120,height:36,sx:{borderRadius:1}}),e.jsx(I,{variant:"rectangular",width:130,height:36,sx:{borderRadius:1}}),e.jsx(I,{variant:"rectangular",width:90,height:36,sx:{borderRadius:1}})]}),e.jsx(I,{variant:"text",width:350,height:18}),e.jsxs(c,{children:[e.jsx(I,{variant:"text",width:80,height:24}),e.jsx(j,{spacing:.5,sx:{mt:1},children:[1,2,3].map(r=>e.jsx(I,{variant:"text",width:`${90-r*10}%`,height:18},r))})]})]})})]})}function wr({onSave:t,onUndo:r,onRedo:a,onApplyAi:d,onEscape:n,enabled:u=!0,dirty:y=!1,hasInstructions:i=!1}){const b=l.useCallback(x=>{if(!u)return;const o=navigator.platform.toUpperCase().indexOf("MAC")>=0?x.metaKey:x.ctrlKey,w=x.shiftKey;if(o&&x.key==="s"){x.preventDefault(),y&&t&&t();return}if(o&&x.key==="z"&&!w){x.preventDefault(),r&&r();return}if(o&&x.key==="z"&&w){x.preventDefault(),a&&a();return}if(o&&x.key==="Enter"&&i){x.preventDefault(),d&&d();return}if(x.key==="Escape"){n&&n();return}},[u,y,i,t,r,a,d,n]);l.useEffect(()=>{if(u)return window.addEventListener("keydown",b),()=>{window.removeEventListener("keydown",b)}},[u,b])}function Se(t){const a=typeof navigator<"u"&&navigator.platform.toUpperCase().indexOf("MAC")>=0?"⌘":"Ctrl";return{save:`${a}+S`,undo:`${a}+Z`,redo:`${a}+Shift+Z`,applyAi:`${a}+Enter`}[t]||t}const Ze=[{key:"save",label:"Save HTML",description:"Save current changes"},{key:"undo",label:"Undo",description:"Revert to previous version"},{key:"applyAi",label:"Apply AI",description:"Apply AI instructions (when filled)"}];function Sr({children:t}){return e.jsx(c,{component:"kbd",sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",px:.75,py:.25,minWidth:24,height:22,borderRadius:.5,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",boxShadow:r=>`0 1px 0 ${v(r.palette.common.black,.1)}`,fontFamily:"monospace",fontSize:"12px",fontWeight:600,color:"text.secondary"},children:t})}function Qe({shortcutKey:t}){const a=Se(t).split("+");return e.jsx(j,{direction:"row",spacing:.5,alignItems:"center",children:a.map((d,n)=>e.jsx(Sr,{children:d},n))})}function et({compact:t=!1}){return t?e.jsxs(j,{direction:"row",spacing:2,sx:{py:1,px:1.5,borderRadius:1,bgcolor:r=>r.palette.mode==="dark"?v(r.palette.text.primary,.04):S[50],border:"1px solid",borderColor:r=>v(r.palette.divider,.1)},children:[e.jsxs(j,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(be,{sx:{fontSize:14,color:"text.disabled"}}),e.jsx(f,{variant:"caption",color:"text.disabled",children:"Shortcuts:"})]}),Ze.slice(0,3).map(r=>e.jsxs(j,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(Qe,{shortcutKey:r.key}),e.jsx(f,{variant:"caption",color:"text.secondary",children:r.label})]},r.key))]}):e.jsxs(c,{sx:{p:2,borderRadius:1.5,bgcolor:"background.paper",border:"1px solid",borderColor:"divider"},children:[e.jsxs(j,{direction:"row",spacing:1,alignItems:"center",sx:{mb:2},children:[e.jsx(be,{fontSize:"small",color:"action"}),e.jsx(f,{variant:"subtitle2",children:"Keyboard Shortcuts"})]}),e.jsx(j,{spacing:1.5,children:Ze.map(r=>e.jsxs(j,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(c,{children:[e.jsx(f,{variant:"body2",children:r.label}),e.jsx(f,{variant:"caption",color:"text.secondary",children:r.description})]}),e.jsx(Qe,{shortcutKey:r.key})]},r.key))})]})}function lt(t){if(!t)return"Unknown time";const r=new Date(t),d=new Date-r,n=Math.floor(d/6e4),u=Math.floor(n/60);return n<1?"Just now":n<60?`${n} minute${n>1?"s":""} ago`:u<24?`${u} hour${u>1?"s":""} ago`:r.toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function Cr({show:t,draftData:r,onRestore:a,onDiscard:d,restoring:n=!1}){return!t||!r?null:e.jsx(zt,{in:t,children:e.jsxs(at,{severity:"info",icon:e.jsx(Je,{}),sx:{mb:2,borderRadius:1,"& .MuiAlert-message":{width:"100%"}},action:e.jsxs(j,{direction:"row",spacing:1,children:[e.jsx(D,{size:"small",variant:"contained",startIcon:e.jsx(Je,{}),onClick:a,disabled:n,children:n?"Restoring...":"Restore"}),e.jsx(D,{size:"small",variant:"outlined",color:"inherit",startIcon:e.jsx(ar,{}),onClick:d,disabled:n,children:"Discard"})]}),children:[e.jsx(nr,{sx:{fontWeight:600},children:"Unsaved Draft Found"}),e.jsxs(j,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(f,{variant:"body2",children:"You have unsaved changes from a previous session."}),e.jsxs(j,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(ot,{sx:{fontSize:14,color:"text.secondary"}}),e.jsx(f,{variant:"caption",color:"text.secondary",children:lt(r.savedAt)})]})]})]})})}function Ir({lastSaved:t,dirty:r}){return!t&&!r?null:e.jsxs(j,{direction:"row",spacing:.5,alignItems:"center",sx:{py:.5,px:1,borderRadius:1,bgcolor:a=>r?v(a.palette.text.primary,.05):v(a.palette.text.primary,.05)},children:[e.jsx(c,{sx:{width:6,height:6,borderRadius:"50%",bgcolor:"text.secondary"}}),e.jsx(f,{variant:"caption",color:"text.secondary",children:r?"Unsaved changes":t?`Draft saved ${lt(t)}`:"All changes saved"})]})}const tt="neura-template-draft-",rt=1440*60*1e3;function Ar(t,{autoSaveInterval:r=1e4,enabled:a=!0}={}){const[d,n]=l.useState(!1),[u,y]=l.useState(null),[i,b]=l.useState(null),x=l.useRef(null),g=l.useRef(null),o=`${tt}${t}`;l.useEffect(()=>{if(!(!t||!a))try{const h=localStorage.getItem(o);if(h){const m=JSON.parse(h);Date.now()-(m.savedAt||0)<rt?(n(!0),y(m)):localStorage.removeItem(o)}}catch(h){console.warn("Failed to load draft:",h)}},[t,o,a]),l.useEffect(()=>{if(a)try{Object.keys(localStorage).filter(m=>m.startsWith(tt)).forEach(m=>{try{const C=localStorage.getItem(m);if(C){const R=JSON.parse(C);Date.now()-(R.savedAt||0)>=rt&&localStorage.removeItem(m)}}catch{localStorage.removeItem(m)}})}catch(h){console.warn("Failed to clean up drafts:",h)}},[a]);const w=l.useCallback((h,m="")=>{if(!t||!a)return!1;try{const C={html:h,instructions:m,savedAt:Date.now(),templateId:t};return localStorage.setItem(o,JSON.stringify(C)),b(new Date),!0}catch(C){return console.warn("Failed to save draft:",C),!1}},[t,o,a]),E=l.useCallback(()=>{if(t)try{localStorage.removeItem(o),n(!1),y(null)}catch(h){console.warn("Failed to discard draft:",h)}},[t,o]),L=l.useCallback((h,m="")=>{a&&(g.current={html:h,instructions:m},x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{g.current&&w(g.current.html,g.current.instructions)},r))},[a,r,w]);l.useEffect(()=>()=>{if(x.current&&clearTimeout(x.current),g.current)try{const h={html:g.current.html,instructions:g.current.instructions,savedAt:Date.now(),templateId:t};localStorage.setItem(o,JSON.stringify(h))}catch{}},[t,o]);const z=l.useCallback(()=>{E()},[E]);return{hasDraft:d,draftData:u,lastSaved:i,saveDraft:w,discardDraft:E,scheduleAutoSave:L,clearDraftAfterSave:z}}const kr={gap:{xs:2,md:2.5}},Tr=l.forwardRef(function(r,a){return e.jsx("textarea",{...r,ref:a})});function Er(){const{templateId:t}=Dt(),r=Rt(),a=Mt(),d=Lt(),{execute:n}=it(),u=Be(s=>s.templates),y=Be(s=>s.updateTemplate),i=a.state?.from||"/generate",b=l.useMemo(()=>u.find(s=>s.id===t)||null,[u,t]),[x,g]=l.useState(!0),[o,w]=l.useState(""),[E,L]=l.useState(""),[z,h]=l.useState(""),[m,C]=l.useState(null),[R,se]=l.useState(!1),[X,Ie]=l.useState(!1),[ne,Ae]=l.useState(!1),[ct,V]=l.useState(null),[ke,J]=l.useState(null),[W,q]=l.useState([]),[ae,Te]=l.useState(null),[F,Ee]=l.useState("manual"),[ze,P]=l.useState(!1),[De,Z]=l.useState(!1),[k,Re]=l.useState(!1),[Me,ie]=l.useState({open:!1,nextMode:null}),A=o!==E,oe=(z||"").trim().length>0,{navigator:H}=l.useContext(Ht),le=l.useRef(A);le.current=A,l.useEffect(()=>{const s=H.push,p=H.replace;return H.push=(...N)=>{le.current&&!window.confirm("You have unsaved changes in the template editor. Leave without saving?")||s.apply(H,N)},H.replace=(...N)=>{le.current&&!window.confirm("You have unsaved changes in the template editor. Leave without saving?")||p.apply(H,N)},()=>{H.push=s,H.replace=p}},[H]);const{hasDraft:dt,draftData:_,lastSaved:ut,scheduleAutoSave:Le,discardDraft:ce,clearDraftAfterSave:Q,saveDraft:xt}=Ar(t,{enabled:F==="manual"});l.useEffect(()=>{A&&F==="manual"&&Le(o,z)},[o,z,A,F,Le]);const M=l.useCallback(s=>{!s||!t||typeof y!="function"||y(t,p=>{if(!p)return p;const N=p.generator||{},xe={...N.summary||{}},jt=["lastEditType","lastEditAt","lastEditNotes"];let We=!1;return jt.forEach(O=>{Object.prototype.hasOwnProperty.call(s,O)&&s[O]!==void 0&&xe[O]!==s[O]&&(xe[O]=s[O],We=!0)}),We?{...p,generator:{...N,summary:xe}}:p})},[t,y]),He=l.useCallback(async()=>{if(t){g(!0),Te(null);try{const s=await Nt(t);if(!s||typeof s!="object"||typeof s.html!="string")throw new Error("Template not found or returned invalid data");const p=s.html;w(p),L(p),V(s?.metadata||null),J(s?.diff_summary||null),q(Array.isArray(s?.history)?s.history:[]),s?.metadata&&M(s.metadata)}catch(s){Te(String(s?.message||s)),d.show(String(s),"error")}finally{g(!1)}}},[t,d,M]);l.useEffect(()=>{He()},[He]),l.useEffect(()=>{if(!o){C(null);return}const s=new Blob([o],{type:"text/html"}),p=URL.createObjectURL(s);return C(p),()=>{URL.revokeObjectURL(p)}},[o]),l.useEffect(()=>{const s=p=>{A&&(p.preventDefault(),p.returnValue="")};return window.addEventListener("beforeunload",s),()=>{window.removeEventListener("beforeunload",s)}},[A]);const de=l.useCallback(async()=>{t&&await n({type:pe.UPDATE,label:"Save template",reversibility:he.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{templateId:t,action:"edit_manual"},action:async()=>{se(!0);try{const s=await $t(t,o),p=typeof s?.html=="string"?s.html:o;return w(p),L(p),V(s?.metadata||null),J(s?.diff_summary||null),q(Array.isArray(s?.history)?s.history:W),s?.metadata&&M(s.metadata),Q(),d.show("Template HTML saved.","success"),s}catch(s){throw d.show(String(s),"error"),s}finally{se(!1)}}})},[t,o,d,M,Q,W,n]),Ne=l.useCallback(async()=>{if(!t)return;const s=(z||"").trim();if(!s){d.show("Enter AI instructions before applying.","info");return}await n({type:pe.GENERATE,label:"Apply AI edit",reversibility:he.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{templateId:t,action:"edit_ai"},action:async()=>{Ie(!0);try{const p=await Ft(t,s,o),N=typeof p?.html=="string"?p.html:o;w(N),L(N),V(p?.metadata||null),J(p?.diff_summary||null),q(Array.isArray(p?.history)?p.history:W),p?.metadata&&M(p.metadata),h(""),Q();const ue=Array.isArray(p?.summary)?p.summary:[];return ue.length?d.show(`AI updated template: ${ue.join("; ")}`,"success"):d.show("AI updated the template HTML.","success"),p}catch(p){throw d.show(String(p),"error"),p}finally{Ie(!1)}}})},[t,o,z,d,M,Q,W,n]),$e=l.useCallback(async()=>{t&&await n({type:pe.UPDATE,label:"Undo template edit",reversibility:he.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{templateId:t,action:"undo_edit"},action:async()=>{Ae(!0);try{const s=await Ut(t),p=typeof s?.html=="string"?s.html:o;return w(p),L(p),V(s?.metadata||null),J(s?.diff_summary||null),q(Array.isArray(s?.history)?s.history:W),s?.metadata&&M(s.metadata),d.show("Reverted to the previous template version.","success"),s}catch(s){throw d.show(String(s),"error"),s}finally{Ae(!1)}}})},[t,o,d,M,W,n]),ht=()=>{A&&typeof window<"u"&&!window.confirm("You have unsaved changes. Leave the editor and discard them?")||r(i,{label:"Back to templates",intent:{referrer:i}})},pt=(s,p)=>{if(p!==null){if(A&&p==="chat"){ie({open:!0,nextMode:p});return}Ee(p)}},ft=l.useCallback(s=>{w(s),L(s)},[]),mt=l.useCallback(s=>{s?.metadata&&(V(s.metadata),M(s.metadata)),s?.diff_summary&&J(s.diff_summary),Array.isArray(s?.history)&&q(s.history)},[M]),gt=l.useCallback(()=>{_&&(w(_.html||""),_.instructions&&h(_.instructions),ce(),d.show("Draft restored successfully.","success"))},[_,ce,d]);wr({onSave:de,onUndo:$e,onApplyAi:Ne,onEscape:()=>{ze&&P(!1),De&&Z(!1)},enabled:F==="manual"&&!x,dirty:A,hasInstructions:oe});const Fe=hr(ct),Ue=i==="/"?"Setup":"Generate";return e.jsxs(e.Fragment,{children:[e.jsx(c,{sx:{mb:2},children:e.jsxs(Wt,{separator:e.jsx(Pt,{fontSize:"small"}),"aria-label":"breadcrumb",children:[e.jsx(Bt,{component:fe,to:i,underline:"hover",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:Ue}),e.jsx(f,{color:"text.primary",fontWeight:600,children:"Edit Design"})]})}),e.jsxs(Jt,{sx:kr,children:[e.jsxs(j,{direction:"row",justifyContent:"space-between",alignItems:"flex-start",spacing:1.5,flexWrap:"wrap",children:[e.jsxs(c,{sx:{minWidth:0,flex:1},children:[e.jsxs(j,{direction:"row",spacing:1.5,alignItems:"center",flexWrap:"wrap",children:[e.jsx(f,{variant:"h5",fontWeight:600,children:b?.name||"Design Editor"}),e.jsx(Ir,{lastSaved:ut,dirty:A})]}),e.jsx(f,{variant:"body2",color:"text.secondary",children:t?`ID: ${t}`:"No template selected"}),Fe&&e.jsxs(f,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:["Last edit: ",Fe.chipLabel]}),ke&&e.jsxs(f,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:["Recent change: ",ke]})]}),e.jsxs(j,{direction:"row",spacing:1.5,alignItems:"center",flexWrap:"wrap",children:[e.jsxs(Ce,{value:F,exclusive:!0,onChange:pt,size:"small","aria-label":"Edit mode",children:[e.jsx(Y,{value:"manual","aria-label":"Manual edit mode",children:e.jsx(T,{title:"Code Editor - Edit HTML directly with AI assistance",children:e.jsxs(j,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(Yt,{fontSize:"small"}),e.jsx(f,{variant:"body2",sx:{display:{xs:"none",sm:"block"}},children:"Code"})]})})}),e.jsx(Y,{value:"chat","aria-label":"Chat edit mode",children:e.jsx(T,{title:"Chat Editor - Conversational AI editing",children:e.jsxs(j,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(nt,{fontSize:"small"}),e.jsx(f,{variant:"body2",sx:{display:{xs:"none",sm:"block"}},children:"Chat"})]})})})]}),e.jsx(T,{title:"Keyboard shortcuts",children:e.jsx(U,{size:"small",onClick:()=>Z(!0),"aria-label":"Keyboard shortcuts",children:e.jsx(be,{fontSize:"small"})})}),e.jsxs(D,{variant:"outlined",onClick:ht,startIcon:e.jsx(Kt,{}),sx:{textTransform:"none",fontWeight:600},children:["Back to ",Ue]})]})]}),e.jsx(er,{dense:!0,title:"AI editing",description:"AI edits apply to this report design. Review changes before saving.",chips:[{label:"Source: Design + instructions",color:"info",variant:"outlined"},{label:"Confidence: Review required",color:"warning",variant:"outlined"},{label:"Undo available",color:"success",variant:"outlined"}],sx:{mb:1}}),e.jsx(Cr,{show:dt&&!x&&F==="manual",draftData:_,onRestore:gt,onDiscard:ce}),ae&&e.jsx(at,{severity:"error",action:e.jsx(D,{color:"inherit",size:"small",component:fe,to:i,children:"Back"}),children:ae}),!x&&ae&&!o?e.jsxs(c,{sx:{textAlign:"center",py:8},children:[e.jsx(f,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Template Not Found"}),e.jsxs(f,{variant:"body2",color:"text.secondary",sx:{mb:3},children:["The template “",t,"” could not be loaded. It may have been deleted or the ID is invalid."]}),e.jsx(D,{variant:"contained",component:fe,to:"/templates",children:"Go to Templates"})]}):x?e.jsxs(e.Fragment,{children:[e.jsx(me,{}),e.jsx(vr,{mode:F})]}):F==="chat"?e.jsxs(e.Fragment,{children:[e.jsx(me,{}),e.jsxs($,{container:!0,spacing:2.5,sx:{alignItems:"stretch"},children:[e.jsx($,{size:{xs:12,md:k?12:5},sx:{minWidth:0},children:e.jsxs(j,{spacing:1.5,sx:{height:"100%"},children:[e.jsxs(j,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(f,{variant:"subtitle1",children:"Preview"}),e.jsx(T,{title:k?"Exit fullscreen":"Fullscreen preview",children:e.jsx(U,{size:"small",onClick:()=>Re(!k),"aria-label":k?"Exit fullscreen":"Fullscreen preview",children:k?e.jsx(qe,{fontSize:"small"}):e.jsx(Ge,{fontSize:"small"})})})]}),m?e.jsx(c,{sx:{borderRadius:1.5,border:"1px solid",borderColor:"divider",bgcolor:"background.paper",p:1.5,minHeight:k?600:400,transition:"min-height 0.2s cubic-bezier(0.22, 1, 0.36, 1)"},children:e.jsx(Ve,{src:m,title:`Template preview for ${t}`,fit:"contain",pageShadow:!0,frameAspectRatio:"210 / 297",clampToParentHeight:!0})}):e.jsx(c,{sx:{borderRadius:1.5,border:"1px dashed",borderColor:"divider",bgcolor:"background.default",p:2,minHeight:400,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(f,{variant:"body2",color:"text.secondary",children:"No HTML loaded yet."})})]})}),!k&&e.jsx($,{size:{xs:12,md:7},sx:{minWidth:0},children:e.jsx(c,{sx:{height:600},children:e.jsx(Vt,{templateId:t,templateName:b?.name||"Template",currentHtml:o,onHtmlUpdate:ft,onApplySuccess:mt})})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{}),e.jsxs($,{container:!0,spacing:2.5,sx:{alignItems:"stretch"},children:[e.jsx($,{size:{xs:12,md:k?12:6},sx:{minWidth:0},children:e.jsxs(j,{spacing:1.5,sx:{height:"100%"},children:[e.jsxs(j,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(f,{variant:"subtitle1",children:"Preview"}),e.jsx(T,{title:k?"Exit fullscreen":"Fullscreen preview",children:e.jsx(U,{size:"small",onClick:()=>Re(!k),"aria-label":k?"Exit fullscreen":"Fullscreen preview",children:k?e.jsx(qe,{fontSize:"small"}):e.jsx(Ge,{fontSize:"small"})})})]}),m?e.jsx(c,{sx:{borderRadius:1.5,border:"1px solid",borderColor:"divider",bgcolor:"background.paper",p:1.5,minHeight:k?500:200,flex:1,transition:"min-height 0.2s cubic-bezier(0.22, 1, 0.36, 1)"},children:e.jsx(Ve,{src:m,title:`Template preview for ${t}`,fit:"contain",pageShadow:!0,frameAspectRatio:"210 / 297",clampToParentHeight:!0})}):e.jsx(c,{sx:{borderRadius:1.5,border:"1px dashed",borderColor:"divider",bgcolor:"background.default",p:2,minHeight:200,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(f,{variant:"body2",color:"text.secondary",children:"No HTML loaded yet."})})]})}),!k&&e.jsx($,{size:{xs:12,md:6},sx:{minWidth:0},children:e.jsxs(j,{spacing:1.5,sx:{height:"100%"},children:[e.jsx(f,{variant:"subtitle1",children:"HTML & AI Guidance"}),e.jsx(Pe,{label:"Design HTML",value:o,onChange:s=>w(s.target.value),inputProps:{"aria-label":"Template HTML"},multiline:!0,minRows:10,maxRows:24,fullWidth:!0,variant:"outlined",size:"small",error:A,helperText:A?`Unsaved changes. Press ${Se("save")} to save.`:"HTML is in sync with the saved template.",InputLabelProps:{shrink:!0},sx:{"& .MuiInputBase-input":{fontFamily:"monospace",fontSize:"14px"}}}),e.jsx(Pe,{label:"AI Instructions",value:z,onChange:s=>h(s.target.value),multiline:!0,rows:3,InputProps:{inputComponent:Tr},fullWidth:!0,variant:"outlined",size:"small",placeholder:"Describe how the template should change. AI will preserve tokens and structure unless you ask otherwise.",helperText:oe?`Press ${Se("applyAi")} or click Apply to run AI.`:"Enter instructions to enable AI editing.",InputLabelProps:{shrink:!0}}),e.jsxs(j,{direction:"row",spacing:1,flexWrap:"wrap",sx:{gap:1},children:[e.jsx(D,{variant:"contained",color:"primary",onClick:de,disabled:R||x||!A||X,startIcon:R?e.jsx(ge,{size:16}):e.jsx(Gt,{}),sx:{minWidth:110},children:R?"Saving...":"Save"}),e.jsx(D,{variant:"outlined",onClick:Ne,disabled:X||x||!oe,startIcon:X?e.jsx(ge,{size:16}):e.jsx(_t,{}),sx:{minWidth:130,color:"text.secondary",borderColor:"divider"},children:X?"Applying...":"Apply AI"}),e.jsx(D,{variant:"text",color:"inherit",onClick:$e,disabled:ne||x,startIcon:ne?e.jsx(ge,{size:16}):e.jsx(st,{}),children:ne?"Undoing...":"Undo"}),e.jsx(D,{variant:"text",onClick:()=>P(!0),disabled:x||!A,startIcon:e.jsx(ve,{}),sx:{color:"text.secondary"},children:"View Diff"})]}),e.jsx(f,{variant:"caption",color:"text.secondary",children:"AI edits are generated and may need review before use in production runs."}),e.jsx(et,{compact:!0}),e.jsx(br,{history:W,maxVisible:5})]})})]})]})]}),e.jsxs(_e,{open:ze,onClose:()=>P(!1),maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"80vh",maxHeight:800}},children:[e.jsxs(Oe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(c,{children:[e.jsx(f,{variant:"h6",children:"HTML Changes"}),e.jsx(f,{variant:"caption",color:"text.secondary",children:"Compare saved version with current edits"})]}),e.jsx(T,{title:"Close",children:e.jsx(U,{onClick:()=>P(!1),"aria-label":"Close dialog",children:e.jsx(Ke,{})})})]}),e.jsx(Ye,{dividers:!0,sx:{p:0,display:"flex",flexDirection:"column"},children:e.jsx(gr,{beforeText:E,afterText:o,contextLines:3})}),e.jsxs(Ot,{children:[e.jsx(D,{onClick:()=>P(!1),children:"Close"}),e.jsx(D,{variant:"contained",onClick:()=>{de(),P(!1)},disabled:R||!A,children:"Save Changes"})]})]}),e.jsxs(_e,{open:De,onClose:()=>Z(!1),maxWidth:"xs",fullWidth:!0,children:[e.jsxs(Oe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Keyboard Shortcuts",e.jsx(T,{title:"Close",children:e.jsx(U,{onClick:()=>Z(!1),"aria-label":"Close dialog",children:e.jsx(Ke,{})})})]}),e.jsx(Ye,{children:e.jsx(et,{})})]}),e.jsx(Qt,{open:Me.open,onClose:()=>ie({open:!1,nextMode:null}),onConfirm:()=>{A&&xt(o,z),ie({open:!1,nextMode:null}),Ee(Me.nextMode||"chat"),d.show("Draft saved. Your current edits are still available in chat and manual modes.","info")},title:"Switch to Chat Mode",message:"Switching to chat mode keeps your current edits and saves a draft for manual mode.",confirmLabel:"Switch",severity:"warning"})]})}function Zr(){return it(),e.jsx(Er,{})}export{Zr as default};
