import{g as Oe,j as e,a as ye,r as a,v as Ne,R as $,I as O,c2 as pt,c3 as xt,P as ae,B as S,q as c,c1 as Ae,n as i,s as be,o as u,T as mt,e as ht,ba as gt,bb as bt,bc as ft,aJ as Ge,K as E,C as Ee,V as fe,aZ as He,A as Q,a2 as yt,f as o,p as D,u as jt,Z as vt,w as kt,l as X,c4 as St,c5 as Ct,c6 as wt,bh as Ve,D as It,H as Pe,m as Fe,S as Le,M as pe,bP as Rt,c7 as Tt,aU as zt,aY as Dt,E as At,$ as Me,aV as We,c8 as Et,c9 as Pt,ca as Ft,N as p,O as Lt,ak as Mt,bQ as Wt}from"./index-tNjrNcyx.js";import{A as qt}from"./ArrowForward-DgwYVkll.js";import{F as Bt}from"./FilterList-HB9KZahR.js";import{P as Ye}from"./PictureAsPdf-BSOoTkA1.js";import{C as _t}from"./Check-Bn4nI-8y.js";import{u as $t,S as Ot}from"./SuccessCelebration-B-BrV1Tt.js";import{A as Nt}from"./AiUsageNotice-DsJkyA9j.js";import{R as Gt}from"./ReportGlossaryNotice-BnF054i2.js";import{C as Ht}from"./ConnectionSelector-DPzRBoqg.js";import{g as Vt,q as Yt}from"./summary-Dw1uatUB.js";import{C as Qt}from"./Container-Dm8m7rXg.js";import{G as xe}from"./Grid-DP3jmde8.js";import"./Article-BY3KnkPt.js";const Ut=Oe(e.jsx("path",{d:"M9 11H7v2h2zm4 0h-2v2h2zm4 0h-2v2h2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V9h14z"})),Kt=Oe(e.jsx("path",{d:"M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V8h14zM7 10h5v5H7z"})),Zt={pdf:Ye,excel:yt};function Jt({onSelectTemplate:t}){const{execute:m}=ye(),[C,d]=a.useState(!1),[j,P]=a.useState(""),[b,h]=a.useState(!1),[q,N]=a.useState(!1),[l,B]=a.useState([]),[v,T]=a.useState(null),y=Ne(),z=a.useCallback((n,f,g={})=>m({type:O.EXECUTE,label:n,reversibility:$.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"template_recommender",...g},action:f}),[m]),I=a.useCallback(()=>{const n=j.trim();if(n)return m({type:O.ANALYZE,label:"Recommend templates",reversibility:$.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"template_recommender",action:"recommend_templates",requirement:n},action:async()=>{h(!0),T(null),B([]);try{const f=await pt({requirement:n,limit:5}),g=Array.isArray(f)?f:[];return B(g),g.length||T("No matching templates found. Try a different description."),g}catch(f){throw T(f.message||"Failed to get recommendations"),f}finally{h(!1)}}})},[m,j]),G=a.useCallback(()=>{const n=j.trim();if(n)return m({type:O.GENERATE,label:"Queue template recommendations",reversibility:$.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{source:"template_recommender",action:"queue_recommendations",requirement:n},action:async()=>{N(!0),T(null);try{const f=await xt({requirement:n,limit:5});return f?.job_id?y.show("Recommendation job queued. Track it in Jobs.","success"):y.show("Failed to queue recommendation job.","error"),f}catch(f){throw y.show(f.message||"Failed to queue recommendations","error"),f}finally{N(!1)}}})},[m,j,y]),R=a.useCallback(n=>z("Select recommended template",()=>{t?.(n),d(!1)},{templateId:n?.id}),[z,t]),H=a.useCallback(n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),I())},[I]);return e.jsxs(ae,{sx:{border:1,borderColor:"divider",borderStyle:C?"solid":"dashed",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)",overflow:"hidden"},children:[e.jsxs(S,{sx:{px:2,py:1.5,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",bgcolor:C?"action.selected":"transparent","&:hover":{bgcolor:"action.hover"}},onClick:()=>z("Toggle template recommender",()=>d(n=>!n)),children:[e.jsxs(c,{direction:"row",alignItems:"center",spacing:1.5,children:[e.jsx(Ae,{sx:{width:32,height:32,bgcolor:n=>n.palette.mode==="dark"?"rgba(255,255,255,0.08)":i[100]},children:e.jsx(be,{sx:{color:"text.secondary",fontSize:18}})}),e.jsxs(S,{children:[e.jsx(u,{variant:"subtitle2",fontWeight:600,children:"AI Template Picker"}),e.jsx(u,{variant:"caption",color:"text.secondary",children:"Describe what you need and let AI find the best template"})]})]}),e.jsx(mt,{title:C?"Collapse":"Expand",children:e.jsx(ht,{size:"small","aria-label":C?"Collapse":"Expand",children:C?e.jsx(gt,{}):e.jsx(bt,{})})})]}),e.jsx(ft,{in:C,children:e.jsx(S,{sx:{px:2,pb:2},children:e.jsxs(c,{spacing:2,children:[e.jsxs(c,{direction:"row",spacing:1,children:[e.jsx(Ge,{fullWidth:!0,size:"small",placeholder:"e.g., monthly sales report with charts, inventory tracking spreadsheet...",value:j,onChange:n=>P(n.target.value),onKeyDown:H,disabled:b,sx:{"& .MuiOutlinedInput-root":{bgcolor:"background.paper"}}}),e.jsx(E,{variant:"contained",onClick:I,disabled:b||q||!j.trim(),startIcon:b?e.jsx(Ee,{size:16,color:"inherit"}):e.jsx(be,{}),sx:{minWidth:120,textTransform:"none"},children:b?"Searching...":"Find"}),e.jsx(E,{variant:"outlined",onClick:G,disabled:b||q||!j.trim(),startIcon:q?e.jsx(Ee,{size:16,color:"inherit"}):e.jsx(fe,{}),sx:{minWidth:120,textTransform:"none"},children:q?"Queueing...":"Queue"})]}),b&&e.jsx(He,{}),v&&e.jsx(Q,{severity:"info",onClose:()=>z("Dismiss recommendations error",()=>T(null)),children:v}),l.length>0&&e.jsxs(c,{spacing:1.5,children:[e.jsxs(u,{variant:"caption",color:"text.secondary",children:[l.length," template",l.length!==1?"s":""," found"]}),l.map((n,f)=>{const g=n.template||n,V=g.kind||"pdf",U=Zt[V]||Ye,F=typeof n.score=="number"?n.score:null;return e.jsx(ae,{variant:"outlined",sx:{p:2,cursor:"pointer",transition:"all 0.15s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{borderColor:k=>k.palette.mode==="dark"?i[500]:i[700],bgcolor:"action.hover"}},onClick:()=>R(g),children:e.jsxs(c,{direction:"row",alignItems:"flex-start",spacing:2,children:[e.jsx(Ae,{variant:"rounded",sx:{width:40,height:40,bgcolor:k=>k.palette.mode==="dark"?o(k.palette.text.primary,.08):i[100]},children:e.jsx(U,{sx:{color:"text.secondary"}})}),e.jsxs(S,{sx:{flex:1,minWidth:0},children:[e.jsxs(c,{direction:"row",alignItems:"center",spacing:1,sx:{mb:.5},children:[e.jsx(u,{variant:"subtitle2",fontWeight:600,children:g.name||g.id}),e.jsx(D,{label:V.toUpperCase(),size:"small",variant:"outlined",sx:{height:20,fontSize:"10px",bgcolor:k=>k.palette.mode==="dark"?o(k.palette.text.primary,.1):i[200],color:"text.secondary"}}),F!==null&&e.jsx(D,{label:`${Math.round(F*100)}% match`,size:"small",sx:{height:20,fontSize:"10px",bgcolor:k=>k.palette.mode==="dark"?o(k.palette.text.primary,.1):i[200],color:"text.secondary"}})]}),n.explanation&&e.jsx(u,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:n.explanation}),!n.explanation&&g.description&&e.jsx(u,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:g.description})]}),e.jsx(E,{size:"small",variant:"outlined",startIcon:e.jsx(_t,{}),onClick:k=>{k.stopPropagation(),R(g)},sx:{textTransform:"none",whiteSpace:"nowrap"},children:"Select"})]})},g.id||f)})]}),!b&&l.length===0&&e.jsxs(S,{children:[e.jsx(u,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"Try these examples:"}),e.jsx(c,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:["monthly financial report","inventory tracking","sales summary with charts","equipment status report"].map(n=>e.jsx(D,{label:n,size:"small",variant:"outlined",onClick:()=>z("Set example requirement",()=>P(n),{example:n}),sx:{cursor:"pointer"}},n))})]})]})})})]})}const Xt=p(S)(({theme:t})=>({minHeight:"100vh",padding:t.spacing(3),backgroundColor:t.palette.background.default})),er=p(S)(({theme:t})=>({marginBottom:t.spacing(4),animation:`${Lt} 0.5s ease-out`})),tr=p(u)(({theme:t})=>({fontSize:"1.75rem",fontWeight:600,letterSpacing:"-0.02em",color:t.palette.mode==="dark"?i[100]:i[900]})),me=p(u)(({theme:t})=>({fontSize:"12px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.1em",color:t.palette.text.secondary,marginBottom:t.spacing(1.5),display:"flex",alignItems:"center",gap:t.spacing(1),"&::after":{content:'""',flex:1,height:1,backgroundColor:o(t.palette.divider,.3)}})),qe=p(u)(({theme:t})=>({fontSize:"1rem",fontWeight:600,color:t.palette.text.primary,marginBottom:t.spacing(2)})),Be=p(Ge)(({theme:t})=>({"& .MuiOutlinedInput-root":{borderRadius:12,backgroundColor:o(t.palette.background.paper,.6),transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{backgroundColor:o(t.palette.background.paper,.8)},"&.Mui-focused":{backgroundColor:t.palette.background.paper,boxShadow:`0 0 0 3px ${o(t.palette.text.primary,.08)}`}}})),_e=p(D,{shouldForwardProp:t=>t!=="selected"})(({theme:t,selected:m})=>({borderRadius:10,fontWeight:500,fontSize:"0.75rem",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)",cursor:"pointer",...m&&{background:t.palette.mode==="dark"?i[700]:i[900],color:t.palette.common.white,boxShadow:`0 4px 12px ${o(t.palette.common.black,.15)}`,"& .MuiChip-icon":{color:t.palette.common.white}},...!m&&{backgroundColor:o(t.palette.action.hover,.5),"&:hover":{backgroundColor:t.palette.mode==="dark"?o(t.palette.text.primary,.1):i[100],transform:"translateY(-1px)"}}})),$e=p(D)(({theme:t})=>({borderRadius:8,fontWeight:600,fontSize:"0.75rem",backgroundColor:t.palette.mode==="dark"?o(t.palette.text.primary,.08):i[100],color:t.palette.text.secondary,border:`1px solid ${o(t.palette.divider,.2)}`})),rr=p(S)(({theme:t})=>({maxHeight:200,overflow:"auto",borderRadius:12,border:`1px solid ${o(t.palette.divider,.1)}`,backgroundColor:o(t.palette.background.paper,.4),"&::-webkit-scrollbar":{width:6},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:o(t.palette.text.primary,.2),borderRadius:8}})),sr=p(Wt,{shouldForwardProp:t=>t!=="selected"})(({theme:t,selected:m})=>({padding:t.spacing(1,1.5),cursor:"pointer",transition:"all 0.15s cubic-bezier(0.22, 1, 0.36, 1)",borderBottom:`1px solid ${o(t.palette.divider,.05)}`,...m&&{backgroundColor:t.palette.mode==="dark"?o(t.palette.text.primary,.08):i[100]},"&:hover":{backgroundColor:t.palette.mode==="dark"?o(t.palette.text.primary,.05):i[50]},"&:last-child":{borderBottom:"none"}})),ar=p(E)(({theme:t})=>({borderRadius:12,textTransform:"none",fontWeight:600,fontSize:"0.875rem",padding:t.spacing(1.25,3),background:t.palette.mode==="dark"?i[700]:i[900],color:t.palette.common.white,boxShadow:`0 4px 14px ${o(t.palette.common.black,.15)}`,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{background:t.palette.mode==="dark"?i[500]:i[700],boxShadow:`0 6px 20px ${o(t.palette.common.black,.2)}`,transform:"translateY(-2px)"},"&:active":{transform:"translateY(0)"},"&:disabled":{background:t.palette.action.disabledBackground,color:t.palette.action.disabled,boxShadow:"none"}})),ee=p(E)(({theme:t})=>({borderRadius:12,textTransform:"none",fontWeight:500,fontSize:"0.875rem",padding:t.spacing(1.25,2.5),borderColor:o(t.palette.divider,.3),color:t.palette.text.primary,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{borderColor:t.palette.mode==="dark"?i[500]:i[700],backgroundColor:t.palette.mode==="dark"?o(t.palette.text.primary,.04):i[50],transform:"translateY(-1px)"}})),te=p(E)(({theme:t})=>({borderRadius:8,textTransform:"none",fontWeight:500,fontSize:"0.75rem",padding:t.spacing(.5,1.5),color:t.palette.text.secondary,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{backgroundColor:t.palette.mode==="dark"?o(t.palette.text.primary,.08):i[100],color:t.palette.text.primary}})),or=p(Ve)(({theme:t})=>({height:"100%",animationDelay:"0.1s"})),nr=p(ae,{shouldForwardProp:t=>t!=="selected"})(({theme:t,selected:m})=>({padding:t.spacing(1.5),borderRadius:12,cursor:"pointer",transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)",border:`1px solid ${m?t.palette.mode==="dark"?i[500]:i[700]:o(t.palette.divider,.1)}`,backgroundColor:m?t.palette.mode==="dark"?o(t.palette.text.primary,.05):i[50]:"transparent","&:hover":{borderColor:o(t.palette.divider,.3),backgroundColor:t.palette.mode==="dark"?o(t.palette.text.primary,.03):i[50],transform:"translateX(4px)","& .view-summary-hint":{opacity:1,color:t.palette.text.primary}}})),ir=p(ae)(({theme:t})=>({padding:t.spacing(2),borderRadius:12,backgroundColor:t.palette.mode==="dark"?o(t.palette.text.primary,.04):i[50],border:`1px solid ${o(t.palette.divider,.1)}`})),re=p(He)(({theme:t})=>({borderRadius:4,height:6,backgroundColor:o(t.palette.text.primary,.1),"& .MuiLinearProgress-bar":{borderRadius:4,background:t.palette.mode==="dark"?i[500]:i[900]}})),lr=p(Q)(({theme:t})=>({borderRadius:8,backgroundColor:t.palette.mode==="dark"?o(t.palette.text.primary,.05):i[50],border:`1px solid ${o(t.palette.divider,.2)}`,"& .MuiAlert-icon":{color:t.palette.text.secondary},"& .MuiAlert-message":{color:t.palette.text.primary}})),cr=p(Q)(({theme:t})=>({borderRadius:8,backgroundColor:t.palette.mode==="dark"?o(t.palette.text.primary,.05):i[50],border:`1px solid ${o(t.palette.divider,.2)}`,"& .MuiAlert-icon":{color:t.palette.text.secondary},"& .MuiAlert-message":{color:t.palette.text.primary}})),dr=p(Q)(({theme:t})=>({borderRadius:8,backgroundColor:t.palette.mode==="dark"?o(t.palette.text.primary,.05):i[50],border:`1px solid ${o(t.palette.divider,.2)}`,"& .MuiAlert-icon":{color:t.palette.text.secondary},"& .MuiAlert-message":{color:t.palette.text.primary}})),ur=p(be)(({theme:t})=>({color:t.palette.text.secondary})),he=p(E)(({theme:t})=>({borderRadius:8,textTransform:"none",fontWeight:500,fontSize:"0.75rem",padding:t.spacing(.5,1.5),borderColor:o(t.palette.divider,.3),transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)","&:hover":{borderColor:t.palette.mode==="dark"?i[500]:i[700],backgroundColor:t.palette.mode==="dark"?o(t.palette.text.primary,.04):i[50]}})),se=p(Mt)(({theme:t})=>({borderColor:o(t.palette.divider,.08),margin:t.spacing(2,0)})),A=t=>t.toISOString().split("T")[0],ge=()=>{const t=new Date,m=new Date(t);m.setDate(t.getDate()-t.getDay());const C=new Date(t.getFullYear(),t.getMonth(),1),d=new Date(t.getFullYear(),t.getMonth()-1,1),j=new Date(t.getFullYear(),t.getMonth(),0);return{today:{label:"Today",start:A(t),end:A(t)},thisWeek:{label:"This Week",start:A(m),end:A(t)},thisMonth:{label:"This Month",start:A(C),end:A(t)},lastMonth:{label:"Last Month",start:A(d),end:A(j)}}};function pr(){const t=jt(),[m]=vt(),C=kt(),d=Ne(),{execute:j}=ye(),P=a.useCallback((r,s,x={})=>C(r,{label:s,intent:{from:"reports",...x}}),[C]),b=X(r=>r.templates),h=X(r=>r.activeConnection),q=X(r=>r.setActiveConnectionId),N=X(r=>r.setTemplates),[l,B]=a.useState(m.get("template")||""),[v,T]=a.useState(""),[y,z]=a.useState(""),[I,G]=a.useState("thisMonth"),[R,H]=a.useState({}),[n,f]=a.useState(!1),[g,V]=a.useState(!1),[U,F]=a.useState(null),[k,oe]=a.useState(null),[je,Qe]=a.useState({}),[K,ve]=a.useState(!1),[w,ne]=a.useState(null),[L,Y]=a.useState([]),[ie,ke]=a.useState(!1),[Se,Ue]=a.useState([]),[_,Ke]=a.useState(null),[M,le]=a.useState(null),[ce,Ce]=a.useState(!1),[we,Ie]=a.useState(!1),Ze=b.find(r=>r.id===l)?.kind?.toUpperCase()||"PDF",Je=v&&y?`${v} to ${y}`:"Select dates",Xe=h?.name||"No connection",{celebrating:et,celebrate:Re,onComplete:tt}=$t(),de=a.useRef(0),Z=a.useRef(0);a.useEffect(()=>{const r=async()=>{f(!0);try{const s=await Pt();N(s),!l&&s.length>0&&B(s[0].id)}catch(s){d.show(s.message||"Failed to load designs","error")}finally{f(!1)}};b.length===0&&r()},[b.length,N,l,d]),a.useEffect(()=>{(async()=>{if(!l||!h?.id)return;const s=++de.current;try{const x=b.find(J=>J.id===l),W=await Ft(l,{connectionId:h.id,kind:x?.kind||"pdf"});s===de.current&&Qe(W.keys||{})}catch(x){s===de.current&&(console.error("Failed to fetch key options:",x),d.show("Could not load filter options. You can still generate reports.","warning"))}})()},[l,h?.id,b,d]);const rt=a.useCallback(r=>{B(r.target.value),H({}),F(null),ne(null),Y([])},[]),st=a.useCallback(r=>{r?.id&&(B(r.id),H({}),F(null),d.show(`Selected: ${r.name||r.id}`,"success"))},[d]),at=a.useCallback((r,s)=>{H(x=>({...x,[r]:s}))},[]),Te=a.useCallback(r=>{if(G(r),r!=="custom"){const x=ge()[r];x&&(T(x.start),z(x.end))}},[]);a.useEffect(()=>{if(!v&&!y&&I!=="custom"){const s=ge()[I];s&&(T(s.start),z(s.end))}},[]);const ze=a.useCallback(async()=>{if(!l||!h?.id){d.show("Please select a design and connect to a data source first","error");return}if(w&&L.length===0){d.show("Select at least one batch to run","error");return}if(v&&y&&new Date(v)>new Date(y)){d.show("Start date must be before or equal to end date","error");return}await j({type:O.EXECUTE,label:"Generate report",reversibility:$.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{templateId:l,connectionId:h?.id,action:"run_report"},action:async()=>{V(!0),oe(null),F(null);try{const r=b.find(ut=>ut.id===l),s=w?.batches||[],x=s.length>0&&L.length===s.length,W=s.length>0&&L.length>0&&!x,J=await St({templateId:l,templateName:r?.name,connectionId:h.id,startDate:v||void 0,endDate:y||void 0,keyValues:Object.keys(R).length>0?R:void 0,batchIds:W?L:void 0,kind:r?.kind||"pdf"});return F(J),d.show("Report generation started!","success"),Re(),J}catch(r){throw oe(r.message||"Failed to generate report"),d.show(r.message||"Failed to generate report","error"),r}finally{V(!1)}}})},[l,h?.id,b,v,y,R,w,L,d,Re,j]),De=Object.keys(je),ot=a.useCallback(async()=>{if(!l||!h?.id){d.show("Select a design and data source first","error");return}if(!v||!y){d.show("Provide a start and end date to discover batches","error");return}if(new Date(v)>new Date(y)){d.show("Start date must be before or equal to end date","error");return}await j({type:O.ANALYZE,label:"Discover batches",reversibility:$.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{templateId:l,connectionId:h?.id,action:"discover_batches"},action:async()=>{ve(!0),ne(null);try{const r=b.find(W=>W.id===l),s=await Ct({templateId:l,connectionId:h.id,startDate:v,endDate:y,keyValues:Object.keys(R).length>0?R:void 0,kind:r?.kind||"pdf"});ne(s);const x=Array.isArray(s?.batches)?s.batches.map(W=>W.id):[];return Y(x),s}catch(r){throw d.show(r.message||"Failed to discover batches","error"),r}finally{ve(!1)}}})},[l,h?.id,v,y,R,b,d,j]),ue=a.useCallback(async()=>{ke(!0);try{const r={limit:10};l&&(r.templateId=l);const s=await wt(r);Ue(s)}catch(r){console.error("Failed to load run history:",r),d.show("Failed to load run history","warning")}finally{ke(!1)}},[l,d]);a.useEffect(()=>{ue()},[ue]);const nt=a.useCallback(r=>{Y(s=>s.includes(r)?s.filter(x=>x!==r):[...s,r])},[]),it=a.useCallback(async r=>{if(Ke(r),le(null),r?.id){const s=++Z.current;Ce(!0);try{const x=await Vt(r.id);s===Z.current&&le(x.summary||x)}catch(x){s===Z.current&&(console.error("Failed to fetch summary:",x),le(null))}finally{s===Z.current&&Ce(!1)}}},[]),lt=a.useCallback(async()=>{_?.id&&await j({type:O.GENERATE,label:"Queue summary",reversibility:$.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{runId:_?.id,action:"queue_report_summary"},action:async()=>{Ie(!0);try{const r=await Yt(_.id);return r?.job_id||r?.jobId||null?d.show("Summary queued. Track progress in Report Progress.","success"):d.show("Failed to queue summary.","error"),r}catch(r){throw d.show(r?.message||"Failed to queue summary.","error"),r}finally{Ie(!1)}}})},[_?.id,d,j]),ct=a.useCallback(()=>{const r=Array.isArray(w?.batches)?w.batches.map(s=>s.id):[];Y(r)},[w]),dt=a.useCallback(()=>{Y([])},[]);return e.jsxs(Xt,{children:[e.jsx(Ot,{trigger:et,onComplete:tt}),e.jsxs(Qt,{maxWidth:"lg",children:[e.jsxs(er,{children:[e.jsx(tr,{children:"Run a Report"}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Choose a design, set your date range, and generate a new report run."})]}),e.jsx(Gt,{sx:{mb:3}}),!h&&e.jsx(lr,{severity:"warning",sx:{mb:3},children:"Please select a data source below or add one from the Connections page."}),e.jsx(S,{sx:{mb:3},children:e.jsx(Jt,{onSelectTemplate:st})}),e.jsxs(xe,{container:!0,spacing:3,children:[e.jsx(xe,{size:{xs:12,md:8},children:e.jsxs(Ve,{children:[e.jsxs(me,{children:[e.jsx(It,{sx:{fontSize:14}}),"Report Settings"]}),e.jsxs(c,{spacing:3,children:[e.jsx(Q,{severity:"info",sx:{borderRadius:1},action:e.jsx(E,{size:"small",onClick:()=>P("/jobs","Open jobs"),sx:{textTransform:"none"},children:"View Progress"}),children:"Reports run in the background. Track progress in Report Progress and download finished files in History."}),e.jsxs(S,{sx:{p:1.5,borderRadius:1,border:"1px solid",borderColor:"divider",bgcolor:o(t.palette.background.paper,.6)},children:[e.jsx(u,{variant:"subtitle2",sx:{mb:1},children:"Outcome preview"}),e.jsxs(c,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:[e.jsx(D,{size:"small",label:`Output: ${Ze}`,variant:"outlined"}),e.jsx(D,{size:"small",label:`Connection: ${Xe}`,variant:"outlined"}),e.jsx(D,{size:"small",label:`Dates: ${Je}`,variant:"outlined"})]})]}),e.jsxs(Pe,{fullWidth:!0,children:[e.jsx(Fe,{children:"Report Design"}),e.jsx(Le,{value:l,onChange:rt,label:"Report Design",children:b.map(r=>e.jsx(pe,{value:r.id,children:e.jsxs(c,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx("span",{children:r.name||r.id}),e.jsx(D,{label:r.kind?.toUpperCase()||"PDF",size:"small",variant:"outlined",sx:{borderRadius:6,fontSize:"10px",height:20}})]})},r.id))})]}),e.jsx(Ht,{value:h?.id||"",onChange:r=>q(r),label:"Data Source",showStatus:!0}),e.jsxs(S,{children:[e.jsx(qe,{children:"Time Period"}),e.jsxs(c,{direction:"row",spacing:1,sx:{mb:2,flexWrap:"wrap",gap:1},children:[Object.entries(ge()).map(([r,s])=>e.jsx(_e,{label:s.label,icon:e.jsx(Kt,{sx:{fontSize:14}}),onClick:()=>Te(r),selected:I===r,variant:I===r?"filled":"outlined"},r)),e.jsx(_e,{label:"Custom",icon:e.jsx(Ut,{sx:{fontSize:14}}),onClick:()=>Te("custom"),selected:I==="custom",variant:I==="custom"?"filled":"outlined"})]}),e.jsxs(c,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(Be,{label:"Start Date",type:"date",value:v,onChange:r=>{T(r.target.value),G("custom")},InputLabelProps:{shrink:!0},fullWidth:!0,size:"small"}),e.jsx(Be,{label:"End Date",type:"date",value:y,onChange:r=>{z(r.target.value),G("custom")},InputLabelProps:{shrink:!0},fullWidth:!0,size:"small"})]})]}),De.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(se,{}),e.jsxs(S,{children:[e.jsxs(me,{children:[e.jsx(Bt,{sx:{fontSize:14}}),"Filter Parameters"]}),e.jsx(c,{spacing:2,children:De.map(r=>e.jsxs(Pe,{fullWidth:!0,size:"small",children:[e.jsx(Fe,{children:r}),e.jsxs(Le,{value:R[r]||"",onChange:s=>at(r,s.target.value),label:r,children:[e.jsx(pe,{value:"",children:e.jsx("em",{children:"All"})}),(je[r]||[]).map(s=>e.jsx(pe,{value:s,children:s},s))]})]},r))})]})]}),e.jsx(se,{}),e.jsxs(c,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsx(qe,{sx:{mb:0},children:"Find Data Batches"}),e.jsx(ee,{variant:"outlined",size:"small",onClick:ot,disabled:K||!l||!h,children:K?"Searching...":"Find Batches"})]}),K&&e.jsx(re,{}),!K&&w&&e.jsxs(c,{spacing:2,children:[e.jsxs(c,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx($e,{label:`${w.batches_count||w.batches?.length||0} batches`}),e.jsx($e,{label:`${w.rows_total||0} rows`})]}),e.jsxs(c,{direction:"row",spacing:1,children:[e.jsx(te,{size:"small",onClick:ct,children:"Select all"}),e.jsx(te,{size:"small",onClick:dt,children:"Clear"})]}),e.jsx(rr,{children:e.jsx(Rt,{dense:!0,disablePadding:!0,children:(w.batches||[]).map(r=>e.jsxs(sr,{disableGutters:!0,onClick:()=>nt(r.id),selected:L.includes(r.id),children:[e.jsx(Tt,{checked:L.includes(r.id),sx:{p:.5,mr:1}}),e.jsx(zt,{primary:`${r.id}`,secondary:`${r.rows||0} rows`,primaryTypographyProps:{variant:"body2",fontWeight:500},secondaryTypographyProps:{variant:"caption"}})]},r.id))})})]}),k&&e.jsx(dr,{severity:"error",onClose:()=>oe(null),action:e.jsx(te,{color:"inherit",size:"small",onClick:ze,disabled:g,children:"Try Again"}),children:k}),g&&e.jsxs(S,{children:[e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Generating report..."}),e.jsx(re,{})]}),e.jsxs(c,{direction:"row",spacing:2,justifyContent:"flex-end",flexWrap:"wrap",children:[e.jsx(ee,{variant:"outlined",startIcon:e.jsx(fe,{}),disabled:!l||g,onClick:()=>P(`/schedules?template=${l}`,"Open schedules",{templateId:l}),children:"Schedule"}),e.jsx(ar,{startIcon:e.jsx(Dt,{}),onClick:ze,disabled:!l||!h||g,children:"Generate Report"})]})]})]})}),e.jsx(xe,{size:{xs:12,md:4},children:e.jsxs(or,{children:[e.jsx(me,{children:"Output"}),U?e.jsxs(c,{spacing:2,children:[e.jsxs(cr,{severity:"success",children:["Report started! ID: ",U.job_id?.slice(0,8),"..."]}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"Your report is being generated. Track it in Report Progress."}),e.jsx(ee,{size:"small",variant:"outlined",onClick:()=>P("/jobs","Open jobs"),sx:{alignSelf:"flex-start"},children:"View Progress"})]}):e.jsx(u,{variant:"body2",color:"text.secondary",children:'Configure your report parameters and click "Generate Report" to create a new report.'}),_&&e.jsxs(e.Fragment,{children:[e.jsx(se,{}),e.jsx(Nt,{title:"AI summary",description:"Summaries are generated from the selected report run. Review before sharing.",chips:[{label:"Source: Selected run",color:"info",variant:"outlined"},{label:"Confidence: Review required",color:"warning",variant:"outlined"}],dense:!0,sx:{mb:2}}),e.jsxs(c,{spacing:1.5,children:[e.jsxs(c,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(ur,{fontSize:"small"}),e.jsx(u,{variant:"subtitle2",fontWeight:600,children:"AI Summary"})]}),ce&&e.jsx(re,{}),!ce&&M?e.jsxs(ir,{children:[e.jsx(u,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:typeof M=="string"?M:M.text||M.content||"No summary available"}),M.key_points&&e.jsxs(S,{sx:{mt:1.5},children:[e.jsx(u,{variant:"caption",fontWeight:600,color:"text.primary",children:"Key Points:"}),e.jsx("ul",{style:{margin:"4px 0",paddingLeft:20},children:M.key_points.map((r,s)=>e.jsx("li",{children:e.jsx(u,{variant:"caption",children:r})},s))})]})]}):!ce&&e.jsxs(c,{spacing:1,children:[e.jsx(u,{variant:"body2",color:"text.secondary",children:"Click on a run below to view its AI summary."}),e.jsx(ee,{size:"small",variant:"outlined",startIcon:e.jsx(fe,{}),onClick:lt,disabled:we,sx:{alignSelf:"flex-start"},children:we?"Queueing...":"Queue summary"})]})]})]}),e.jsx(se,{}),e.jsxs(c,{spacing:1.5,children:[e.jsxs(c,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsx(u,{variant:"subtitle2",fontWeight:600,children:"Recent Runs"}),e.jsx(te,{size:"small",onClick:ue,disabled:ie,startIcon:e.jsx(At,{sx:{fontSize:14}}),children:"Refresh"})]}),ie&&e.jsx(re,{}),!ie&&Se.length===0&&e.jsx(u,{variant:"body2",color:"text.secondary",children:l?"No recent runs for this design yet.":"No report runs yet. Generate a report to get started."}),e.jsx(c,{spacing:1,children:Se.map(r=>e.jsx(nr,{selected:_?.id===r.id,onClick:()=>it(r),title:"Click to view summary",children:e.jsxs(c,{spacing:.5,children:[e.jsxs(c,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(u,{variant:"body2",fontWeight:600,children:r.templateName||r.templateId}),e.jsxs(c,{direction:"row",alignItems:"center",spacing:.5,className:"view-summary-hint",sx:{opacity:.6,transition:"all 0.2s cubic-bezier(0.22, 1, 0.36, 1)"},children:[e.jsx(u,{variant:"caption",color:"text.secondary",children:"View"}),e.jsx(qt,{sx:{fontSize:12}})]})]}),e.jsxs(u,{variant:"caption",color:"text.secondary",children:[new Date(r.createdAt).toLocaleString()," Â· ",r.startDate," to ",r.endDate]}),e.jsxs(c,{direction:"row",spacing:1,sx:{mt:.5},flexWrap:"wrap",useFlexGap:!0,children:[r.artifacts?.pdf_url&&e.jsx(he,{size:"small",variant:"outlined",startIcon:e.jsx(We,{sx:{fontSize:14}}),href:Me(r.artifacts.pdf_url),target:"_blank",onClick:s=>s.stopPropagation(),children:"PDF"}),r.artifacts?.html_url&&e.jsx(he,{size:"small",variant:"outlined",startIcon:e.jsx(We,{sx:{fontSize:14}}),href:Me(r.artifacts.html_url),target:"_blank",onClick:s=>s.stopPropagation(),children:"HTML"}),e.jsx(he,{size:"small",variant:"outlined",startIcon:e.jsx(Et,{sx:{fontSize:14}}),onClick:s=>{s.stopPropagation(),P(`/agents?analyzeRunId=${r.id}`,"Analyze with AI",{runId:r.id})},"data-testid":`analyze-ai-${r.id}`,children:"Analyze"})]})]})},r.id))})]})]})})]})]})]})}function Rr(){return ye(),e.jsx(pr,{})}export{Rr as default};
