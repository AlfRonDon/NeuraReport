import{g as Pe,j as e,r,f as k,b2 as ye,n as M,B as h,v as Fe,aC as G,a as We,cB as Ne,R as je,I as ve,cC as De,q as S,o as w,e as Ce,E as Be,aJ as ue,C as fe,cD as He,cE as Oe,cF as Ue,P as pe,a7 as xe,K as Z,ba as _e,bb as Le,bc as Ie,aZ as $e,p as le}from"./index-tNjrNcyx.js";import{L as Ve}from"./Lightbulb-B6WhFsgN.js";import{A as Se}from"./Autocomplete-DhsBc69q.js";import{T as Qe,a as Ge,b as Ee,c as ae,d as Ye}from"./TableRow-DBskq6ho.js";const Ke=Pe(e.jsx("path",{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-1 9h-4v4h-2v-4H9V9h4V5h2v4h4z"})),qe=Pe(e.jsx("path",{d:"M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3m-2 10H6V7h12zm-9-6c-.83 0-1.5-.67-1.5-1.5S8.17 10 9 10s1.5.67 1.5 1.5S9.83 13 9 13m7.5-1.5c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5.67-1.5 1.5-1.5 1.5.67 1.5 1.5M8 15h8v2H8z"})),Re={width:794,height:1123},Je=.01,Ze=()=>typeof window<"u"&&window.devicePixelRatio?window.devicePixelRatio:1,ke=t=>{if(!t||t==="none"||t==="auto"||typeof t!="string")return null;const i=t.toLowerCase(),o=Number.parseFloat(i);if(!Number.isFinite(o)||o<=0)return null;if(i.endsWith("px"))return o;if(typeof window<"u"){if(i.endsWith("vh"))return window.innerHeight*(o/100);if(i.endsWith("vw"))return window.innerWidth*(o/100)}return null},Xe=t=>{if(!Number.isFinite(t)||t<=0)return 1;const i=Ze(),o=Math.max(100,Math.round(i*100));return Math.max(Je,Math.round(t*o)/o)},et=t=>{if(t==null)return null;const i=(o,a)=>{const u=Number(o),g=Number(a);return!Number.isFinite(u)||!Number.isFinite(g)||u<=0||g<=0?null:{css:`${u} / ${g}`,ratio:u/g}};if(Array.isArray(t)&&t.length===2)return i(t[0],t[1]);if(typeof t=="number")return t>0?i(t,1):null;if(typeof t=="string"){const o=t.trim();if(!o)return null;const a=o.match(/^(\d*\.?\d+)\s*\/\s*(\d*\.?\d+)$/);if(a)return i(a[1],a[2]);const u=Number(o);return Number.isFinite(u)&&u>0?i(u,1):{css:o,ratio:null}}return null};function tt({src:t,title:i,pageWidth:o=Re.width,pageHeight:a=Re.height,sx:u,loading:g="lazy",background:f="white",frameAspectRatio:y=null,fit:W="contain",contentAlign:m="center",pageShadow:A=!1,pageBorderColor:b=k(M[900],.12),pageRadius:_=0,marginGuides:E=!1,clampToParentHeight:O=!1,pageChrome:R=!0}){const N=r.useRef(null),P=r.useRef(null),p=r.useRef(null),j=r.useRef(null),[C,s]=r.useState(1),[c,L]=r.useState({width:o,height:a}),Y=r.useRef(c),T=r.useMemo(()=>et(y),[y]),K=r.useMemo(()=>E?typeof E=="object"?{inset:Math.max(0,Number(E.inset??E.offset??36)),color:E.color||k(ye.violet[500],.28)}:{inset:36,color:k(ye.violet[500],.28)}:null,[E]),U=r.useCallback(l=>{p.current&&cancelAnimationFrame(p.current),p.current=requestAnimationFrame(()=>{p.current=null,l()})},[]),D=r.useCallback(l=>{const d=l||Y.current,I=N.current;if(!I||!d.width||!d.height)return;const F=I.getBoundingClientRect(),n=F.width||I.clientWidth||d.width;let x=F.height||I.clientHeight||0;if(!x&&T?.ratio&&(x=n/T.ratio),x||(x=d.height),O){let H=I.parentElement;for(;H;){const me=H.getBoundingClientRect?.()?.height||H.clientHeight||0,de=typeof window<"u"?window.getComputedStyle?.(H):null;if(de){const be=ke(de.maxHeight);be&&(x=Math.min(x,be));const we=ke(de.height);we&&(x=Math.min(x,we))}if(me>0){x=Math.min(x,me);break}H=H.parentElement}}const v=n/d.width,re=x>0?x/d.height:v;let B;W==="width"?(B=v,re>0&&re<B&&(B=re)):W==="height"?B=re:B=Math.min(v,re),(!Number.isFinite(B)||B<=0)&&(B=1);const ge=Xe(B);s(H=>Math.abs(H-ge)<.002?H:ge)},[T?.ratio,W,O]),z=r.useCallback(l=>{const d={width:Math.max(1,Math.ceil(l?.width||o)),height:Math.max(1,Math.ceil(l?.height||a))};Y.current=d,L(d),U(()=>D(d))},[a,o,U,D]),X=r.useCallback(()=>{const l={width:o,height:a},d=P.current;if(!d)return l;try{const I=d.contentDocument||d.contentWindow?.document;if(!I)return l;const F=I.body,n=I.documentElement;F&&(F.style.overflow="hidden"),n&&(n.style.overflow="hidden");const x=Math.max(F?.scrollWidth||0,F?.offsetWidth||0,n?.scrollWidth||0,n?.offsetWidth||0,l.width),v=Math.max(F?.scrollHeight||0,F?.offsetHeight||0,n?.scrollHeight||0,n?.offsetHeight||0,l.height);return{width:Math.ceil(x),height:Math.ceil(v)}}catch{return l}},[a,o]),ee=r.useCallback(()=>{const l=X();z(l),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{j.current=null;const d=X();z(d)},150)},[z,X]);r.useEffect(()=>{const l=P.current;if(!l)return;const d=()=>ee();return l.addEventListener("load",d),()=>{l.removeEventListener("load",d)}},[ee,t]),r.useEffect(()=>{z({width:o,height:a})},[z,a,o,t]),r.useEffect(()=>{if(typeof ResizeObserver>"u")return;const l=N.current;if(!l)return;const d=new ResizeObserver(()=>U(()=>D()));return d.observe(l),()=>d.disconnect()},[U,D]),r.useEffect(()=>{const l=()=>U(()=>D());return window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[U,D]),r.useEffect(()=>()=>{p.current&&cancelAnimationFrame(p.current),j.current&&clearTimeout(j.current)},[]);const q=c.height*C,oe=c.width*C,J=m==="top",$={position:"relative",width:"100%",overflow:"hidden",...u};T?.css&&($.aspectRatio=T.css,$.height="auto");const V=!!T?.css,te=R&&Number.isFinite(Number(_))?Math.max(Number(_),0):0,Q=R&&A?typeof A=="string"?A:`0 32px 48px ${k(M[900],.18)}`:"none",ne=R&&typeof b=="string"&&b.trim()?b:null,se=R?f:"transparent",ie=K?Math.max(0,Math.min(K.inset,Math.min(c.width,c.height)/2)):0;return e.jsxs(h,{ref:N,sx:$,children:[e.jsx(h,{sx:{position:V?"absolute":"relative",top:V?J?0:"50%":0,left:V?"50%":0,width:c.width,height:c.height,transform:`scale(${C})`,transformOrigin:"top left",pointerEvents:"auto"},style:V?{marginLeft:`${-oe/2}px`,...J?{}:{marginTop:`${-q/2}px`}}:void 0,children:e.jsxs(h,{sx:{width:c.width,height:c.height,borderRadius:te,overflow:"hidden",bgcolor:se,boxShadow:Q,border:ne?`1px solid ${ne}`:"none",position:"relative"},children:[e.jsx("iframe",{ref:P,src:t,title:i,loading:g,style:{width:c.width,height:c.height,border:0,display:"block",background:R?f:void 0}}),K&&ie>0&&e.jsx(h,{"aria-hidden":!0,sx:{position:"absolute",inset:ie,border:"1px dashed",borderColor:K.color,borderRadius:Math.max(te-6,0),pointerEvents:"none"},style:{borderStyle:"dashed"}})]})}),!V&&e.jsx(h,{sx:{width:"100%",height:q,visibility:"hidden",pointerEvents:"none"}})]})}const Me={edit:{welcomeMessage:null,placeholder:"Describe the changes you want...",sendLabel:"Generate edit suggestions"},create:{welcomeMessage:Ne,placeholder:"Describe the report template you need...",sendLabel:"Generate template"}},ze={user:{icon:Ue,label:"You",bgcolor:M[900],textColor:"common.white"},assistant:{icon:qe,label:"NeuraReport",bgcolor:"background.paper",textColor:"text.primary"}};function nt({message:t}){const{role:i,content:o,timestamp:a}=t,u=ze[i]||ze.assistant,g=u.icon,f=i==="user";return e.jsxs(h,{sx:{display:"flex",flexDirection:f?"row-reverse":"row",gap:1.5,px:2,py:1.5},children:[e.jsx(h,{sx:{width:32,height:32,borderRadius:"50%",bgcolor:f?M[900]:M[500],display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(g,{sx:{fontSize:18,color:"white"}})}),e.jsxs(h,{sx:{flex:1,maxWidth:f?"calc(100% - 100px)":"calc(100% - 48px)",minWidth:0},children:[e.jsxs(S,{direction:"row",spacing:1,alignItems:"center",sx:{mb:.5,justifyContent:f?"flex-end":"flex-start"},children:[e.jsx(w,{variant:"caption",fontWeight:600,color:"text.primary",children:u.label}),a&&e.jsx(w,{variant:"caption",color:"text.disabled",children:new Date(a).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx(h,{sx:{p:2,borderRadius:1,bgcolor:f?M[900]:"background.paper",color:f?"common.white":"text.primary",boxShadow:f?`0 2px 8px ${k(M[900],.2)}`:"0 1px 3px rgba(0,0,0,0.08)"},children:e.jsxs(w,{variant:"body2",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word",lineHeight:1.6},children:[o,t.streaming&&e.jsx(h,{component:"span",sx:{display:"inline-block",width:6,height:16,ml:.5,bgcolor:"currentColor",animation:"blink 1s steps(1) infinite","@keyframes blink":{"50%":{opacity:0}}}})]})})]})]})}function st({changes:t,proposedHtml:i,onApply:o,onReject:a,applying:u}){const[g,f]=r.useState(!1),[y,W]=r.useState(null);return r.useEffect(()=>{if(!i){W(null);return}const m=new Blob([i],{type:"text/html"}),A=URL.createObjectURL(m);return W(A),()=>{URL.revokeObjectURL(A)}},[i]),!t||t.length===0?null:e.jsx(pe,{elevation:0,sx:{p:2,mx:2,mb:2,borderRadius:1,border:"1px solid",borderColor:m=>k(m.palette.divider,.3),bgcolor:m=>m.palette.mode==="dark"?k(m.palette.text.primary,.04):M[50]},children:e.jsxs(S,{spacing:2,children:[e.jsxs(S,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(xe,{sx:{color:"text.secondary"},fontSize:"small"}),e.jsx(w,{variant:"subtitle2",fontWeight:600,children:"Ready to Apply Changes"})]}),e.jsxs(h,{children:[e.jsx(w,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Proposed modifications:"}),e.jsx(S,{spacing:.5,children:t.map((m,A)=>e.jsxs(S,{direction:"row",spacing:1,alignItems:"flex-start",children:[e.jsx(w,{variant:"body2",color:"text.secondary",children:"•"}),e.jsx(w,{variant:"body2",children:m})]},A))})]}),i&&e.jsxs(h,{children:[e.jsx(Z,{size:"small",variant:"text",onClick:()=>f(!g),endIcon:g?e.jsx(_e,{}):e.jsx(Le,{}),sx:{mb:1},children:g?"Hide Preview":"Show Preview"}),e.jsx(Ie,{in:g,children:e.jsx(h,{sx:{borderRadius:1,border:"1px solid",borderColor:"divider",bgcolor:"background.paper",p:1,height:300,overflow:"hidden"},children:y&&e.jsx(tt,{src:y,title:"Proposed changes preview",fit:"contain",pageShadow:!0,frameAspectRatio:"210 / 297"})})})]}),e.jsxs(S,{direction:"row",spacing:1.5,children:[e.jsx(Z,{variant:"contained",onClick:o,disabled:u,startIcon:u?e.jsx(fe,{size:16}):e.jsx(xe,{}),children:u?"Applying...":"Apply Changes"}),e.jsx(Z,{variant:"outlined",color:"inherit",onClick:a,disabled:u,children:"Request Different Changes"})]})]})})}function rt({questions:t,onQuestionClick:i}){return!t||t.length===0?null:e.jsxs(h,{sx:{px:2,pb:1.5},children:[e.jsxs(S,{direction:"row",alignItems:"center",spacing:1,sx:{mb:1},children:[e.jsx(Ve,{fontSize:"small",color:"action"}),e.jsx(w,{variant:"caption",color:"text.secondary",children:"Quick responses:"})]}),e.jsx(S,{direction:"row",flexWrap:"wrap",gap:1,children:t.map((o,a)=>e.jsx(le,{label:o,size:"small",variant:"outlined",onClick:()=>i(o),sx:{cursor:"pointer","&:hover":{bgcolor:"action.hover"}}},a))})]})}const ce=new Set(["UNRESOLVED","INPUT_SAMPLE","LATER_SELECTED"]);function he(t){return t.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())}function Te(t){if(!t||ce.has(t))return null;const i=t.split(".");if(i.length===2){const o=i[0].replace(/_/g," ");return`${i[1].replace(/_/g," ")} from ${o}`}return t.replace(/_/g," ")}const Ae=["Preparing mapping...","Building contract...","Generating report assets...","Finalizing template..."];function ot({mappingData:t,catalog:i,schemaInfo:o,onApprove:a,onSkip:u,onQueue:g,approving:f}){const[y,W]=r.useState(()=>({...t||{}})),[m,A]=r.useState(!1),[b,_]=r.useState(null),[E,O]=r.useState(0),R=(i||[]).map(s=>s),N=(s,c)=>{W(L=>({...L,[s]:c||""}))};r.useEffect(()=>{if(!f){O(0);return}const s=setInterval(()=>{O(c=>(c+1)%Ae.length)},3e3);return()=>clearInterval(s)},[f]);const P=Object.keys(y),p=P.filter(s=>!ce.has(y[s])&&y[s]),j=P.filter(s=>ce.has(y[s])||!y[s]),C=o?[o["child table"],o["parent table"]].filter(Boolean).join(" and "):null;return f?e.jsx(pe,{elevation:0,sx:{p:2.5,mx:2,mb:2,borderRadius:1,border:"1px solid",borderColor:s=>k(s.palette.primary.main,.3),bgcolor:s=>s.palette.mode==="dark"?k(s.palette.primary.main,.08):k(s.palette.primary.main,.04)},children:e.jsxs(S,{spacing:2,alignItems:"center",children:[e.jsxs(S,{direction:"row",spacing:1.5,alignItems:"center",children:[e.jsx(fe,{size:22,thickness:5}),e.jsx(w,{variant:"subtitle2",fontWeight:600,children:"Setting up your template..."})]}),e.jsx(h,{sx:{width:"100%"},children:e.jsx($e,{variant:"indeterminate",sx:{height:6,borderRadius:3,bgcolor:s=>k(s.palette.primary.main,.12),"& .MuiLinearProgress-bar":{borderRadius:3}}})}),e.jsx(w,{variant:"body2",color:"text.secondary",sx:{minHeight:20,transition:"opacity 0.3s"},children:Ae[E]}),g&&e.jsx(Z,{variant:"outlined",size:"small",startIcon:e.jsx(Ke,{}),onClick:g,sx:{textTransform:"none",mt:.5},children:"Queue & Continue — I'll finish this in the background"})]})}):e.jsx(pe,{elevation:0,sx:{p:2,mx:2,mb:2,borderRadius:1,border:"1px solid",borderColor:s=>k(s.palette.divider,.3),bgcolor:s=>s.palette.mode==="dark"?k(s.palette.text.primary,.04):M[50]},children:e.jsxs(S,{spacing:1.5,children:[e.jsxs(w,{variant:"body2",sx:{lineHeight:1.7},children:[C&&e.jsxs(e.Fragment,{children:["I found your data in the ",e.jsx("strong",{children:C})," table",C.includes(" and ")?"s":"",". "]}),p.length>0&&e.jsxs(e.Fragment,{children:["I was able to connect ",e.jsxs("strong",{children:[p.length," of ",P.length]})," template fields to your database. "]}),j.length>0&&e.jsxs(e.Fragment,{children:[p.length>0?"However, ":"",e.jsxs("strong",{children:[j.length," field",j.length>1?"s":""]})," still need",j.length===1?"s":""," to be configured."]}),j.length===0&&p.length>0&&e.jsx(e.Fragment,{children:"All fields are mapped and ready to go!"})]}),p.length>0&&e.jsxs(h,{children:[e.jsx(w,{variant:"caption",color:"text.secondary",fontWeight:600,sx:{mb:.5,display:"block"},children:"Connected fields:"}),e.jsx(S,{direction:"row",flexWrap:"wrap",gap:.5,children:p.map(s=>e.jsx(le,{label:`${he(s)} → ${Te(y[s])||y[s]}`,size:"small",variant:"outlined",color:"success",sx:{fontSize:"0.7rem"}},s))})]}),j.length>0&&e.jsxs(h,{children:[e.jsx(w,{variant:"caption",color:"text.secondary",fontWeight:600,sx:{mb:.5,display:"block"},children:"Needs your input:"}),e.jsx(S,{spacing:.5,children:j.map(s=>e.jsxs(S,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(w,{variant:"body2",sx:{minWidth:120},children:he(s)}),b===s?e.jsx(Se,{freeSolo:!0,size:"small",options:R,value:y[s]||"",onChange:(c,L)=>{N(s,L),_(null)},onBlur:()=>_(null),renderInput:c=>e.jsx(ue,{...c,variant:"outlined",autoFocus:!0,size:"small",placeholder:"Pick a column...",sx:{"& .MuiInputBase-root":{fontSize:"0.8rem",py:0}}}),sx:{flex:1,minWidth:150}}):e.jsx(le,{label:"Select column...",size:"small",color:"warning",variant:"outlined",onClick:()=>_(s),sx:{cursor:"pointer",fontSize:"0.75rem"}})]},s))})]}),p.length>0&&e.jsx(Z,{size:"small",variant:"text",onClick:()=>A(!m),endIcon:m?e.jsx(_e,{}):e.jsx(Le,{}),sx:{alignSelf:"flex-start",textTransform:"none",fontSize:"0.75rem"},children:m?"Hide all mappings":"View all mappings"}),e.jsx(Ie,{in:m,children:e.jsx(h,{sx:{maxHeight:250,overflow:"auto",border:"1px solid",borderColor:"divider",borderRadius:.5},children:e.jsxs(Qe,{size:"small",stickyHeader:!0,children:[e.jsx(Ge,{children:e.jsxs(Ee,{children:[e.jsx(ae,{sx:{fontWeight:600,bgcolor:"background.paper",width:"40%",py:.5},children:"Field"}),e.jsx(ae,{sx:{fontWeight:600,bgcolor:"background.paper",py:.5},children:"Source"})]})}),e.jsx(Ye,{children:P.map(s=>{const c=y[s],L=ce.has(c)||!c;return e.jsxs(Ee,{sx:{"&:hover":{bgcolor:"action.hover"}},children:[e.jsx(ae,{sx:{py:.5},children:e.jsx(w,{variant:"body2",fontSize:"0.8rem",children:he(s)})}),e.jsx(ae,{sx:{py:.5},children:b===s?e.jsx(Se,{freeSolo:!0,size:"small",options:R,value:c||"",onChange:(Y,T)=>{N(s,T),_(null)},onBlur:()=>_(null),renderInput:Y=>e.jsx(ue,{...Y,variant:"outlined",autoFocus:!0,size:"small",sx:{"& .MuiInputBase-root":{fontSize:"0.8rem",py:0}}}),sx:{minWidth:150}}):e.jsx(le,{label:L?"Not set":Te(c)||c,size:"small",color:L?"warning":"default",variant:"outlined",onClick:()=>_(s),sx:{cursor:"pointer",fontSize:"0.7rem"}})})]},s)})})]})})}),e.jsx(w,{variant:"body2",color:"text.secondary",fontSize:"0.8rem",children:"Looks good? Approve to finalize, or tell me what you'd like to change."}),e.jsxs(S,{direction:"row",spacing:1.5,children:[e.jsx(Z,{variant:"contained",onClick:()=>a(y),disabled:f,startIcon:e.jsx(xe,{}),sx:{textTransform:"none"},children:"Looks Good, Approve"}),e.jsx(Z,{variant:"outlined",onClick:()=>a(t),disabled:f,sx:{textTransform:"none"},children:"You do this"})]})]})})}function ht({templateId:t,templateName:i,currentHtml:o,onHtmlUpdate:a,onApplySuccess:u,onRequestSave:g,onMappingApprove:f,onMappingSkip:y,onMappingQueue:W,mappingPreviewData:m,mappingApproving:A=!1,mode:b="edit",chatApi:_=null}){const E=Me[b]||Me.edit,O=_||((n,x)=>Oe(t,n,x)),R=Fe(),N=r.useRef(null),P=r.useRef(null),[p,j]=r.useState(""),[C,s]=r.useState(!1),[c,L]=r.useState(!1),[Y,T]=r.useState(null),K=G(n=>n.getOrCreateSession),U=G(n=>n.getSession),D=G(n=>n.addUserMessage),z=G(n=>n.addAssistantMessage),X=G(n=>n.getMessagesForApi),ee=G(n=>n.setProposedChanges),q=G(n=>n.clearProposedChanges),oe=G(n=>n.clearSession),{execute:J}=We();r.useEffect(()=>{t&&K(t,i,E.welcomeMessage)},[t,i,K,E.welcomeMessage]);const $=U(t),V=$?.messages||[],te=$?.proposedChanges,Q=$?.proposedHtml,ne=$?.readyToApply;r.useEffect(()=>{N.current?.scrollIntoView({behavior:"smooth"})},[V.length]),r.useEffect(()=>{P.current?.focus()},[]);const se=r.useCallback(async()=>{const n=p.trim();!n||C||!t||(j(""),T(null),D(t,n),await J({type:ve.GENERATE,label:E.sendLabel,reversibility:je.FULLY_REVERSIBLE,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{templateId:t,action:b==="create"?"template_chat_create":"template_chat"},action:async()=>{s(!0);try{const x=X(t),v=await O(x,o);return z(t,v.message,{proposedChanges:v.proposed_changes,proposedHtml:v.updated_html,readyToApply:v.ready_to_apply}),ee(t,{proposedChanges:v.proposed_changes,proposedHtml:v.updated_html,readyToApply:v.ready_to_apply}),b==="create"&&v.updated_html&&a?.(v.updated_html),v.follow_up_questions&&T(v.follow_up_questions),v}catch(x){throw R.show(String(x.message||x),"error"),z(t,"I apologize, but I encountered an error. Please try again or rephrase your request."),x}finally{s(!1)}}}))},[p,C,t,o,D,z,X,ee,R,J,O,b,E.sendLabel]),ie=r.useCallback(async()=>{!Q||!t||await J({type:ve.UPDATE,label:"Apply template changes",reversibility:je.SYSTEM_MANAGED,suppressSuccessToast:!0,suppressErrorToast:!0,intent:{templateId:t,action:"apply_template_changes"},action:async()=>{L(!0);try{let n;return b==="create"?n={updated_html:Q}:n=await De(t,Q),q(t),a?.(Q),u?.(n),b==="create"?z(t,"Your template is ready! Opening the save dialog so you can name and save it."):z(t,"The changes have been applied successfully. Is there anything else you'd like to modify?"),R.show("Template changes applied successfully.","success"),b==="create"&&g&&g(),n}catch(n){throw R.show(String(n.message||n),"error"),n}finally{L(!1)}}})},[Q,t,b,q,z,a,u,g,R,J]),l=r.useCallback(()=>{q(t),z(t,"No problem! What different changes would you like me to make instead?")},[t,q,z]),d=r.useCallback(n=>{j(n),T(null),P.current?.focus()},[]),I=r.useCallback(n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),se())},[se]),F=r.useCallback(()=>{oe(t,i,E.welcomeMessage),T(null),b==="create"&&a?.(""),R.show("Chat cleared. Starting fresh conversation.","info")},[t,i,oe,R,E.welcomeMessage,b,a]);return e.jsxs(h,{sx:{height:"100%",minHeight:0,display:"flex",flexDirection:"column",bgcolor:"background.default",borderRadius:1,border:"1px solid",borderColor:"divider",overflow:"hidden"},children:[e.jsx(h,{sx:{p:2,borderBottom:"1px solid",borderColor:"divider",bgcolor:"background.paper"},children:e.jsxs(S,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(h,{children:[e.jsx(w,{variant:"subtitle1",fontWeight:600,children:b==="create"?"AI Template Creator":"AI Template Editor"}),e.jsx(w,{variant:"caption",color:"text.secondary",children:b==="create"?"Describe the report you need and I'll build it for you":"Describe the changes you want and I'll help you implement them"})]}),e.jsx(Ce,{size:"small",onClick:F,title:"Clear chat and start over",children:e.jsx(Be,{fontSize:"small"})})]})}),e.jsxs(h,{sx:{flex:1,overflow:"auto",py:1,minHeight:0},children:[V.map(n=>e.jsx(nt,{message:n},n.id)),ne&&te&&e.jsx(st,{changes:te,proposedHtml:Q,onApply:ie,onReject:l,applying:c}),m&&f&&e.jsx(ot,{mappingData:m.mapping,catalog:m.catalog,schemaInfo:m.schema_info,onApprove:f,onSkip:y,onQueue:W,approving:A}),e.jsx(rt,{questions:Y,onQuestionClick:d}),e.jsx("div",{ref:N})]}),e.jsxs(h,{sx:{p:2,borderTop:"1px solid",borderColor:"divider",bgcolor:"background.paper"},children:[e.jsxs(h,{sx:{display:"flex",gap:1,p:1.5,borderRadius:1,bgcolor:n=>k(n.palette.action.hover,.5),border:1,borderColor:"divider",transition:"all 150ms cubic-bezier(0.22, 1, 0.36, 1)","&:focus-within":{borderColor:n=>n.palette.mode==="dark"?M[500]:M[700],boxShadow:n=>`0 0 0 2px ${k(n.palette.text.primary,.08)}`}},children:[e.jsx(ue,{inputRef:P,fullWidth:!0,multiline:!0,maxRows:4,placeholder:C?"Processing...":ne?"Apply the changes above or describe different modifications...":E.placeholder,value:p,onChange:n=>j(n.target.value),onKeyDown:I,disabled:C,variant:"standard",InputProps:{disableUnderline:!0,sx:{fontSize:"1rem",lineHeight:1.5}},sx:{"& .MuiInputBase-root":{py:.5}}}),e.jsx(Ce,{onClick:se,disabled:!p.trim()||C,sx:{bgcolor:n=>p.trim()&&!C?n.palette.mode==="dark"?M[700]:M[900]:"action.disabledBackground",color:p.trim()&&!C?"common.white":"text.disabled","&:hover":{bgcolor:n=>p.trim()&&!C?n.palette.mode==="dark"?M[500]:M[700]:"action.disabledBackground"}},children:C?e.jsx(fe,{size:20,color:"inherit"}):e.jsx(He,{fontSize:"small"})})]}),e.jsx(S,{direction:"row",spacing:2,justifyContent:"center",sx:{mt:1},children:e.jsx(w,{variant:"caption",color:"text.disabled",children:"Press Enter to send, Shift+Enter for new line"})})]})]})}export{tt as S,ht as T};
