{"version":3,"file":"SchemaBuilderPage-DOaLZ66b.js","sources":["../../src/stores/connectionStore.js","../../src/api/federation.js","../../src/stores/federationStore.js","../../src/features/federation/containers/SchemaBuilderPageContainer.jsx","../../src/pages/federation/SchemaBuilderPage.jsx"],"sourcesContent":["import { useCallback, useMemo, useState } from 'react'\nimport { bootstrapState, healthcheckConnection, deleteConnection } from '../api/client'\nimport { useAppStore } from './useAppStore'\n\nconst normalizeConnections = (connections) =>\n  Array.isArray(connections) ? connections : []\n\nexport default function useConnectionStore() {\n  const connections = useAppStore((s) => s.savedConnections)\n  const setSavedConnections = useAppStore((s) => s.setSavedConnections)\n  const updateSavedConnection = useAppStore((s) => s.updateSavedConnection)\n  const removeSavedConnection = useAppStore((s) => s.removeSavedConnection)\n\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState(null)\n\n  const normalizedConnections = useMemo(\n    () => normalizeConnections(connections),\n    [connections]\n  )\n\n  const setConnections = useCallback((next) => {\n    const resolved = typeof next === 'function' ? next(connections) : next\n    setSavedConnections(normalizeConnections(resolved))\n  }, [connections, setSavedConnections])\n\n  const fetchConnections = useCallback(async () => {\n    setLoading(true)\n    setError(null)\n    try {\n      const data = await bootstrapState()\n      const next = normalizeConnections(data?.connections)\n      setSavedConnections(next)\n      setLoading(false)\n      return next\n    } catch (err) {\n      setError(err.message || 'Failed to load connections')\n      setLoading(false)\n      return []\n    }\n  }, [setSavedConnections])\n\n  const healthCheck = useCallback(async (connectionId) => {\n    try {\n      const result = await healthcheckConnection(connectionId)\n      updateSavedConnection(connectionId, {\n        lastLatencyMs: result.latency_ms,\n        status: 'connected',\n      })\n      return result\n    } catch (err) {\n      updateSavedConnection(connectionId, { status: 'error' })\n      throw err\n    }\n  }, [updateSavedConnection])\n\n  const removeConnection = useCallback(async (connectionId) => {\n    setLoading(true)\n    setError(null)\n    try {\n      await deleteConnection(connectionId)\n      removeSavedConnection(connectionId)\n      setLoading(false)\n      return true\n    } catch (err) {\n      setError(err.message || 'Failed to delete connection')\n      setLoading(false)\n      return false\n    }\n  }, [removeSavedConnection])\n\n  const getConnection = useCallback(\n    (connectionId) =>\n      normalizedConnections.find((conn) => conn.id === connectionId) || null,\n    [normalizedConnections]\n  )\n\n  const reset = useCallback(() => {\n    setSavedConnections([])\n    setError(null)\n  }, [setSavedConnections])\n\n  return useMemo(() => ({\n    connections: normalizedConnections,\n    loading,\n    error,\n    setConnections,\n    setLoading,\n    setError,\n    fetchConnections,\n    healthCheck,\n    removeConnection,\n    getConnection,\n    reset,\n  }), [\n    normalizedConnections,\n    loading,\n    error,\n    setConnections,\n    setLoading,\n    setError,\n    fetchConnections,\n    healthCheck,\n    removeConnection,\n    getConnection,\n    reset,\n  ])\n}\n","/**\n * Cross-Database Federation API Client\n */\nimport apiClient from './client';\n\nfunction asArray(payload, keys = []) {\n  if (Array.isArray(payload)) return payload;\n  if (!payload || typeof payload !== 'object') return [];\n  for (const key of keys) {\n    if (Array.isArray(payload[key])) return payload[key];\n  }\n  return [];\n}\n\n/**\n * Create a virtual schema\n */\nexport async function createVirtualSchema({ name, connectionIds, description }) {\n  const response = await apiClient.post('/federation/schemas', {\n    name,\n    connection_ids: connectionIds,\n    description,\n  });\n  return response.data;\n}\n\n/**\n * List virtual schemas\n */\nexport async function listVirtualSchemas({ limit, offset } = {}) {\n  const params = {};\n  if (limit != null) params.limit = limit;\n  if (offset != null) params.offset = offset;\n  const response = await apiClient.get('/federation/schemas', { params });\n  const payload = response.data;\n  if (Array.isArray(payload)) {\n    return { schemas: payload, total: payload.length };\n  }\n  if (payload && typeof payload === 'object') {\n    const schemas = asArray(payload, ['schemas', 'items', 'results']);\n    return { ...payload, schemas, total: payload.total ?? schemas.length };\n  }\n  return { schemas: [], total: 0 };\n}\n\n/**\n * Get a virtual schema by ID\n */\nexport async function getVirtualSchema(schemaId) {\n  const response = await apiClient.get(`/federation/schemas/${schemaId}`);\n  const payload = response.data;\n  if (payload && typeof payload === 'object' && payload.schema) {\n    return payload;\n  }\n  if (payload && typeof payload === 'object') {\n    return { status: 'ok', schema: payload };\n  }\n  return { status: 'ok', schema: null };\n}\n\n/**\n * Get join suggestions for connections\n */\nexport async function suggestJoins(connectionIds) {\n  const response = await apiClient.post('/federation/suggest-joins', {\n    connection_ids: connectionIds,\n  });\n  const payload = response.data;\n  if (Array.isArray(payload)) {\n    return { suggestions: payload };\n  }\n  if (payload && typeof payload === 'object') {\n    return { ...payload, suggestions: asArray(payload, ['suggestions', 'joins']) };\n  }\n  return { suggestions: [] };\n}\n\n/**\n * Execute a federated query\n */\nexport async function executeFederatedQuery({ schemaId, query, limit = 100 }) {\n  const response = await apiClient.post('/federation/query', {\n    virtual_schema_id: schemaId,\n    sql: query,\n    limit,\n  });\n  const payload = response.data;\n  if (payload && typeof payload === 'object' && Object.prototype.hasOwnProperty.call(payload, 'result')) {\n    return payload;\n  }\n  return { status: 'ok', result: payload };\n}\n\n/**\n * Delete a virtual schema\n */\nexport async function deleteVirtualSchema(schemaId) {\n  const response = await apiClient.delete(`/federation/schemas/${schemaId}`);\n  return response.data;\n}\n\nexport default {\n  createVirtualSchema,\n  listVirtualSchemas,\n  getVirtualSchema,\n  suggestJoins,\n  executeFederatedQuery,\n  deleteVirtualSchema,\n};\n","/**\n * Cross-Database Federation Store\n */\nimport { create } from 'zustand';\nimport * as federationApi from '../api/federation';\n\nconst useFederationStore = create((set, get) => ({\n  // State\n  schemas: [],\n  currentSchema: null,\n  joinSuggestions: [],\n  queryResult: null,\n  loading: false,\n  error: null,\n\n  // Actions\n  setLoading: (loading) => set({ loading }),\n  setError: (error) => set({ error }),\n\n  // Fetch all schemas\n  fetchSchemas: async () => {\n    set({ loading: true, error: null });\n    try {\n      const response = await federationApi.listVirtualSchemas();\n      set({ schemas: response.schemas || [], loading: false });\n    } catch (err) {\n      set({ error: err.message, loading: false });\n    }\n  },\n\n  // Create virtual schema\n  createSchema: async (data) => {\n    set({ loading: true, error: null });\n    try {\n      const response = await federationApi.createVirtualSchema(data);\n      const schema = response.schema;\n      set((state) => ({\n        schemas: [...state.schemas, schema].slice(0, 200),\n        currentSchema: schema,\n        loading: false,\n      }));\n      return schema;\n    } catch (err) {\n      set({ error: err.message, loading: false });\n      return null;\n    }\n  },\n\n  // Delete schema\n  deleteSchema: async (schemaId) => {\n    set({ loading: true, error: null });\n    try {\n      await federationApi.deleteVirtualSchema(schemaId);\n      set((state) => ({\n        schemas: state.schemas.filter((s) => s.id !== schemaId),\n        currentSchema: state.currentSchema?.id === schemaId ? null : state.currentSchema,\n        loading: false,\n      }));\n      return true;\n    } catch (err) {\n      set({ error: err.message, loading: false });\n      return false;\n    }\n  },\n\n  // Get join suggestions for current schema's connections\n  suggestJoins: async () => {\n    const { currentSchema } = get();\n    if (!currentSchema?.connections || currentSchema.connections.length < 2) {\n      set({ error: 'Need at least 2 connections to suggest joins', loading: false });\n      return [];\n    }\n    set({ loading: true, error: null });\n    try {\n      const response = await federationApi.suggestJoins(currentSchema.connections);\n      set({ joinSuggestions: response.suggestions || [], loading: false });\n      return response.suggestions;\n    } catch (err) {\n      set({ error: err.message, loading: false });\n      return [];\n    }\n  },\n\n  // Execute federated query\n  executeQuery: async (schemaId, query) => {\n    set({ loading: true, error: null, queryResult: null });\n    try {\n      const response = await federationApi.executeFederatedQuery({ schemaId, query });\n      set({ queryResult: response.result, loading: false });\n      return response.result;\n    } catch (err) {\n      set({ error: err.message, loading: false });\n      return null;\n    }\n  },\n\n  // Get schema details\n  getSchema: async (schemaId) => {\n    set({ loading: true, error: null });\n    try {\n      const response = await federationApi.getVirtualSchema(schemaId);\n      set({ currentSchema: response.schema || response, loading: false });\n      return response;\n    } catch (err) {\n      set({ error: err.message, loading: false });\n      return null;\n    }\n  },\n\n  // Set current schema\n  setCurrentSchema: (schema) => set({ currentSchema: schema, joinSuggestions: [], queryResult: null }),\n\n  // Reset state\n  reset: () => set({\n    currentSchema: null,\n    joinSuggestions: [],\n    queryResult: null,\n    error: null,\n  }),\n}));\n\nexport default useFederationStore;\n","/**\n * Cross-Database Federation Schema Builder Page\n */\nimport React, { useState, useEffect, useCallback } from 'react';\nimport {\n  Box,\n  Paper,\n  Typography,\n  Button,\n  TextField,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n  Chip,\n  Alert,\n  CircularProgress,\n  Grid,\n  Card,\n  CardContent,\n  CardActions,\n  IconButton,\n  Tooltip,\n  Divider,\n  List,\n  ListItem,\n  ListItemText,\n  ListItemIcon,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  alpha,\n} from '@mui/material';\nimport {\n  Add as AddIcon,\n  Delete as DeleteIcon,\n  Link as LinkIcon,\n  Storage as DatabaseIcon,\n  AutoAwesome as AIIcon,\n  PlayArrow as RunIcon,\n  JoinInner as JoinIcon,\n} from '@mui/icons-material';\nimport useFederationStore from '@/stores/federationStore';\nimport { useConnectionStore } from '@/stores';\nimport ConfirmModal from '@/components/Modal/ConfirmModal';\nimport { getWriteOperation } from '@/utils/sqlSafety';\nimport { useConfirmedAction, useInteraction, InteractionType, Reversibility } from '@/components/ux/governance';\nimport AiUsageNotice from '@/components/ai/AiUsageNotice';\nimport { neutral, palette } from '@/app/theme';\nimport useCrossPageActions from '@/hooks/useCrossPageActions';\nimport SendToMenu from '@/components/common/SendToMenu';\nimport { OutputType, FeatureKey } from '@/utils/crossPageTypes';\n\nexport default function SchemaBuilderPage() {\n  const {\n    schemas,\n    currentSchema,\n    joinSuggestions,\n    queryResult,\n    loading,\n    error,\n    fetchSchemas,\n    createSchema,\n    deleteSchema,\n    suggestJoins,\n    executeQuery,\n    setCurrentSchema,\n    reset,\n  } = useFederationStore();\n\n  const { connections, fetchConnections } = useConnectionStore();\n  const confirmWriteQuery = useConfirmedAction('EXECUTE_WRITE_QUERY');\n  const { execute } = useInteraction();\n  const { registerOutput } = useCrossPageActions(FeatureKey.FEDERATION);\n\n  const [createDialogOpen, setCreateDialogOpen] = useState(false);\n  const [newSchemaName, setNewSchemaName] = useState('');\n  const [newSchemaDescription, setNewSchemaDescription] = useState('');\n  const [selectedConnections, setSelectedConnections] = useState([]);\n  const [queryInput, setQueryInput] = useState('');\n  const [deleteConfirm, setDeleteConfirm] = useState({ open: false, schemaId: null, schemaName: '' });\n\n  const [initialLoading, setInitialLoading] = useState(true);\n  const writeOperation = getWriteOperation(queryInput);\n\n  useEffect(() => {\n    const init = async () => {\n      setInitialLoading(true);\n      await Promise.all([fetchSchemas(), fetchConnections()]);\n      setInitialLoading(false);\n    };\n    init();\n    return () => reset();\n  }, [fetchSchemas, fetchConnections, reset]);\n\n  const handleCreateSchema = async () => {\n    if (!newSchemaName || selectedConnections.length < 2) return;\n    await execute({\n      type: InteractionType.CREATE,\n      label: 'Create federation schema',\n      reversibility: Reversibility.SYSTEM_MANAGED,\n      suppressSuccessToast: true,\n      suppressErrorToast: true,\n      intent: {\n        connectionIds: selectedConnections,\n        action: 'create_federation_schema',\n      },\n      action: async () => {\n        const result = await createSchema({\n          name: newSchemaName,\n          connectionIds: selectedConnections,\n          description: newSchemaDescription,\n        });\n        if (!result) {\n          throw new Error('Create schema failed');\n        }\n        setCreateDialogOpen(false);\n        setNewSchemaName('');\n        setNewSchemaDescription('');\n        setSelectedConnections([]);\n        return result;\n      },\n    });\n  };\n\n  const handleSuggestJoins = async () => {\n    if (!currentSchema) return;\n    await execute({\n      type: InteractionType.GENERATE,\n      label: 'Suggest joins',\n      reversibility: Reversibility.SYSTEM_MANAGED,\n      suppressSuccessToast: true,\n      suppressErrorToast: true,\n      intent: {\n        schemaId: currentSchema.id,\n        action: 'suggest_joins',\n      },\n      action: async () => {\n        const result = await suggestJoins(); // Store gets connections from currentSchema\n        if (!result) {\n          throw new Error('Suggest joins failed');\n        }\n        return result;\n      },\n    });\n  };\n\n  const runExecuteQuery = useCallback(async () => {\n    if (!currentSchema || !queryInput.trim()) return;\n    await execute({\n      type: InteractionType.EXECUTE,\n      label: 'Run federated query',\n      reversibility: writeOperation ? Reversibility.IRREVERSIBLE : Reversibility.FULLY_REVERSIBLE,\n      suppressSuccessToast: true,\n      suppressErrorToast: true,\n      intent: {\n        schemaId: currentSchema.id,\n        action: 'execute_federation_query',\n        writeOperation,\n      },\n      action: async () => {\n        const result = await executeQuery(currentSchema.id, queryInput);\n        if (!result) {\n          throw new Error('Query execution failed');\n        }\n        // Register query result for cross-page use\n        const rows = result.rows || [];\n        const columns = rows.length > 0 ? Object.keys(rows[0]).map((k) => ({ name: k })) : [];\n        registerOutput({\n          type: OutputType.TABLE,\n          title: `Federation: ${currentSchema.name || 'Query'} (${rows.length} rows)`,\n          summary: queryInput.slice(0, 100),\n          data: { columns, rows },\n          format: 'table',\n        });\n        return result;\n      },\n    });\n  }, [currentSchema, executeQuery, queryInput, execute, writeOperation, registerOutput]);\n\n  const handleExecuteQuery = useCallback(async () => {\n    if (!currentSchema || !queryInput.trim()) return;\n    if (writeOperation) {\n      confirmWriteQuery(currentSchema.name || currentSchema.id || 'selected schema', runExecuteQuery);\n      return;\n    }\n    await runExecuteQuery();\n  }, [confirmWriteQuery, currentSchema, queryInput, runExecuteQuery, writeOperation]);\n\n  const handleDeleteRequest = useCallback((schema) => {\n    setDeleteConfirm({\n      open: true,\n      schemaId: schema?.id || null,\n      schemaName: schema?.name || 'this schema',\n    });\n  }, []);\n\n  const handleDeleteSchemaConfirm = async () => {\n    const schemaId = deleteConfirm.schemaId;\n    const schemaName = deleteConfirm.schemaName;\n    setDeleteConfirm({ open: false, schemaId: null, schemaName: '' });\n    if (!schemaId) return;\n    await execute({\n      type: InteractionType.DELETE,\n      label: 'Delete federation schema',\n      reversibility: Reversibility.SYSTEM_MANAGED,\n      suppressSuccessToast: true,\n      suppressErrorToast: true,\n      intent: {\n        schemaId,\n        schemaName,\n        action: 'delete_federation_schema',\n      },\n      action: async () => {\n        const result = await deleteSchema(schemaId);\n        if (!result) {\n          throw new Error('Delete schema failed');\n        }\n        return result;\n      },\n    });\n  };\n\n  const toggleConnection = (connId) => {\n    setSelectedConnections(prev =>\n      prev.includes(connId)\n        ? prev.filter(id => id !== connId)\n        : [...prev, connId]\n    );\n  };\n\n  // Show loading during initial fetch\n  if (initialLoading) {\n    return (\n      <Box sx={{ p: 3, maxWidth: 1400, mx: 'auto' }}>\n        <Box sx={{ display: 'flex', alignItems: 'center', gap: 2, mb: 3 }}>\n          <JoinIcon />\n          <Typography variant=\"h5\">Cross-Database Federation</Typography>\n        </Box>\n        <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: 300 }}>\n          <CircularProgress />\n        </Box>\n      </Box>\n    );\n  }\n\n  return (\n    <Box sx={{ p: 3, maxWidth: 1400, mx: 'auto' }}>\n      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>\n        <Box>\n          <Typography variant=\"h5\" sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\n            <JoinIcon /> Cross-Database Federation\n          </Typography>\n          <Typography variant=\"body1\" color=\"text.secondary\">\n            Create virtual schemas to query across multiple databases\n          </Typography>\n        </Box>\n        <Button\n          variant=\"contained\"\n          startIcon={<AddIcon />}\n          onClick={() => setCreateDialogOpen(true)}\n        >\n          New Virtual Schema\n        </Button>\n      </Box>\n\n      {error && (\n        <Alert severity=\"error\" sx={{ mb: 2 }} onClose={() => reset()}>\n          {error}\n        </Alert>\n      )}\n\n      <AiUsageNotice\n        title=\"AI join suggestions\"\n        description=\"Join suggestions are generated from schema metadata. Review before running cross-database queries.\"\n        chips={[\n          { label: 'Source: Selected schemas', variant: 'outlined' },\n          { label: 'Confidence: Provided per suggestion', variant: 'outlined' },\n          { label: 'Read-only recommended', variant: 'outlined' },\n        ]}\n        dense\n        sx={{ mb: 2 }}\n      />\n\n      <Grid container spacing={3}>\n        {/* Schema List */}\n        <Grid size={{ xs: 12, md: 4 }}>\n          <Paper sx={{ p: 2 }}>\n            <Typography variant=\"h6\" gutterBottom>\n              Virtual Schemas\n            </Typography>\n            {schemas.length === 0 ? (\n              <Typography color=\"text.secondary\" sx={{ py: 2, textAlign: 'center' }}>\n                No virtual schemas yet. Create one to get started.\n              </Typography>\n            ) : (\n              <List>\n                {schemas.map((schema) => (\n                  <ListItem\n                    key={schema.id}\n                    button\n                    selected={currentSchema?.id === schema.id}\n                    onClick={() => setCurrentSchema(schema)}\n                    secondaryAction={\n                      <Tooltip title=\"Delete schema\">\n                        <IconButton\n                          edge=\"end\"\n                          aria-label={`Delete ${schema.name}`}\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            handleDeleteRequest(schema);\n                          }}\n                        >\n                          <DeleteIcon />\n                        </IconButton>\n                      </Tooltip>\n                    }\n                  >\n                    <ListItemIcon>\n                      <DatabaseIcon />\n                    </ListItemIcon>\n                    <ListItemText\n                      primary={schema.name}\n                      secondary={`${schema.connections?.length || 0} databases`}\n                    />\n                  </ListItem>\n                ))}\n              </List>\n            )}\n          </Paper>\n        </Grid>\n\n        {/* Schema Details & Query */}\n        <Grid size={{ xs: 12, md: 8 }}>\n          {currentSchema ? (\n            <Paper sx={{ p: 3 }}>\n              <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>\n                <Typography variant=\"h6\">{currentSchema.name}</Typography>\n                <Button\n                  variant=\"outlined\"\n                  startIcon={loading ? <CircularProgress size={20} /> : <AIIcon />}\n                  onClick={handleSuggestJoins}\n                  disabled={loading}\n                >\n                  AI Join Suggestions\n                </Button>\n              </Box>\n\n              {currentSchema.description && (\n                <Typography color=\"text.secondary\" sx={{ mb: 2 }}>\n                  {currentSchema.description}\n                </Typography>\n              )}\n\n              <Box sx={{ display: 'flex', gap: 1, mb: 3, flexWrap: 'wrap' }}>\n                {(currentSchema.connections || []).map((conn, idx) => (\n                  <Chip\n                    key={idx}\n                    icon={<DatabaseIcon />}\n                    label={conn.name || conn}\n                    variant=\"outlined\"\n                  />\n                ))}\n              </Box>\n\n              {/* Join Suggestions */}\n              {joinSuggestions.length > 0 && (\n                <Box sx={{ mb: 3 }}>\n                  <Typography variant=\"subtitle1\" gutterBottom>\n                    Suggested Joins\n                  </Typography>\n                  <Grid container spacing={2}>\n                    {joinSuggestions.map((suggestion, idx) => (\n                      <Grid size={{ xs: 12, sm: 6 }} key={idx}>\n                        <Card variant=\"outlined\">\n                          <CardContent sx={{ py: 1.5 }}>\n                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>\n                              <LinkIcon sx={{ color: 'text.secondary' }} />\n                              <Typography variant=\"subtitle2\">\n                                {suggestion.left_table} â†” {suggestion.right_table}\n                              </Typography>\n                            </Box>\n                            <Typography variant=\"body2\" color=\"text.secondary\">\n                              {suggestion.left_column} = {suggestion.right_column}\n                            </Typography>\n                            {suggestion.reason && (\n                              <Typography variant=\"caption\" color=\"text.secondary\" display=\"block\" sx={{ mt: 0.5 }}>\n                                {suggestion.reason}\n                              </Typography>\n                            )}\n                            <Chip\n                              size=\"small\"\n                              label={`${Math.round((suggestion.confidence || 0) * 100)}% confidence`}\n                              sx={{ mt: 1, bgcolor: (theme) => theme.palette.mode === 'dark' ? alpha(theme.palette.text.primary, 0.1) : neutral[200], color: 'text.secondary' }}\n                            />\n                          </CardContent>\n                        </Card>\n                      </Grid>\n                    ))}\n                  </Grid>\n                </Box>\n              )}\n\n              <Divider sx={{ my: 2 }} />\n\n              {/* Query Input */}\n              <Typography variant=\"subtitle1\" gutterBottom>\n                Federated Query\n              </Typography>\n              <TextField\n                fullWidth\n                multiline\n                rows={4}\n                placeholder=\"SELECT * FROM db1.users u JOIN db2.orders o ON u.id = o.user_id\"\n                value={queryInput}\n                onChange={(e) => setQueryInput(e.target.value)}\n                sx={{ mb: 2, fontFamily: 'monospace' }}\n              />\n              <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 1, mb: 2 }}>\n                <Chip\n                  size=\"small\"\n                  label=\"Read-only recommended\"\n                  variant=\"outlined\"\n                  sx={{ fontSize: '12px' }}\n                />\n                {writeOperation && (\n                  <Chip\n                    size=\"small\"\n                    label={`${writeOperation.toUpperCase()} detected`}\n                    sx={{ fontSize: '12px', bgcolor: (theme) => theme.palette.mode === 'dark' ? alpha(theme.palette.text.primary, 0.1) : neutral[200], color: 'text.secondary' }}\n                  />\n                )}\n              </Box>\n              <Button\n                variant=\"contained\"\n                startIcon={loading ? <CircularProgress size={20} /> : <RunIcon />}\n                onClick={handleExecuteQuery}\n                disabled={!queryInput.trim() || loading}\n              >\n                Execute Query\n              </Button>\n              {writeOperation && (\n                <Alert severity=\"warning\" sx={{ mt: 2 }}>\n                  Write queries can modify data and may not be reversible. You will be asked to confirm before execution.\n                </Alert>\n              )}\n\n              {/* Query Results */}\n              {queryResult && (\n                <Box sx={{ mt: 3 }}>\n                  <Typography variant=\"subtitle1\" gutterBottom>\n                    Results ({queryResult.rows?.length || 0} rows)\n                  </Typography>\n                  <Box sx={{ overflowX: 'auto' }}>\n                    <pre style={{ fontSize: 12, margin: 0 }}>\n                      {JSON.stringify(queryResult, null, 2)}\n                    </pre>\n                  </Box>\n                </Box>\n              )}\n            </Paper>\n          ) : (\n            <Paper sx={{ p: 4, textAlign: 'center' }}>\n              <DatabaseIcon sx={{ fontSize: 48, color: 'text.secondary', mb: 2 }} />\n              <Typography color=\"text.secondary\">\n                Select a virtual schema or create a new one to get started\n              </Typography>\n            </Paper>\n          )}\n        </Grid>\n      </Grid>\n\n      {/* Create Schema Dialog */}\n      <Dialog open={createDialogOpen} onClose={() => setCreateDialogOpen(false)} maxWidth=\"sm\" fullWidth>\n        <DialogTitle>Create Virtual Schema</DialogTitle>\n        <DialogContent>\n          <TextField\n            fullWidth\n            label=\"Schema Name\"\n            value={newSchemaName}\n            onChange={(e) => setNewSchemaName(e.target.value)}\n            sx={{ mt: 2, mb: 2 }}\n          />\n          <TextField\n            fullWidth\n            label=\"Description\"\n            value={newSchemaDescription}\n            onChange={(e) => setNewSchemaDescription(e.target.value)}\n            multiline\n            rows={2}\n            sx={{ mb: 2 }}\n          />\n          <Typography variant=\"subtitle2\" gutterBottom>\n            Select Databases (minimum 2)\n          </Typography>\n          <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>\n            {connections.map((conn) => (\n              <Card\n                key={conn.id}\n                variant=\"outlined\"\n                sx={{\n                  cursor: 'pointer',\n                  borderColor: selectedConnections.includes(conn.id) ? 'text.secondary' : 'divider',\n                  bgcolor: selectedConnections.includes(conn.id) ? 'action.selected' : 'background.paper',\n                }}\n                onClick={() => toggleConnection(conn.id)}\n              >\n                <CardContent sx={{ py: 1, '&:last-child': { pb: 1 } }}>\n                  <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\n                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\n                      <DatabaseIcon />\n                      <Typography>{conn.name}</Typography>\n                    </Box>\n                    {selectedConnections.includes(conn.id) && (\n                      <Chip label=\"Selected\" size=\"small\" sx={{ bgcolor: (theme) => theme.palette.mode === 'dark' ? alpha(theme.palette.text.primary, 0.1) : neutral[200], color: 'text.secondary' }} />\n                    )}\n                  </Box>\n                </CardContent>\n              </Card>\n            ))}\n          </Box>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setCreateDialogOpen(false)}>Cancel</Button>\n          <Button\n            variant=\"contained\"\n            onClick={handleCreateSchema}\n            disabled={!newSchemaName || selectedConnections.length < 2}\n          >\n            Create\n          </Button>\n        </DialogActions>\n      </Dialog>\n\n      <ConfirmModal\n        open={deleteConfirm.open}\n        onClose={() => setDeleteConfirm({ open: false, schemaId: null, schemaName: '' })}\n        onConfirm={handleDeleteSchemaConfirm}\n        title=\"Delete Virtual Schema\"\n        message={`Delete \"${deleteConfirm.schemaName}\"? This will remove the virtual schema and its saved join logic.`}\n        confirmLabel=\"Delete\"\n        severity=\"error\"\n      />\n    </Box>\n  );\n}\n","import { useInteraction } from '@/components/ux/governance'\nimport SchemaBuilderPageContainer from '@/features/federation/containers/SchemaBuilderPageContainer'\n\nexport default function SchemaBuilderPage() {\n  useInteraction()\n  return <SchemaBuilderPageContainer />\n}\n"],"names":["normalizeConnections","connections","useConnectionStore","useAppStore","s","setSavedConnections","updateSavedConnection","removeSavedConnection","loading","setLoading","useState","error","setError","normalizedConnections","useMemo","setConnections","useCallback","next","resolved","fetchConnections","data","bootstrapState","err","healthCheck","connectionId","result","healthcheckConnection","removeConnection","deleteConnection","getConnection","conn","reset","asArray","payload","keys","key","createVirtualSchema","name","connectionIds","description","apiClient","listVirtualSchemas","limit","offset","params","schemas","getVirtualSchema","schemaId","suggestJoins","executeFederatedQuery","query","deleteVirtualSchema","useFederationStore","create","set","get","response","federationApi.listVirtualSchemas","schema","federationApi.createVirtualSchema","state","federationApi.deleteVirtualSchema","currentSchema","federationApi.suggestJoins","federationApi.executeFederatedQuery","federationApi.getVirtualSchema","SchemaBuilderPage","joinSuggestions","queryResult","fetchSchemas","createSchema","deleteSchema","executeQuery","setCurrentSchema","confirmWriteQuery","useConfirmedAction","execute","useInteraction","registerOutput","useCrossPageActions","FeatureKey","createDialogOpen","setCreateDialogOpen","newSchemaName","setNewSchemaName","newSchemaDescription","setNewSchemaDescription","selectedConnections","setSelectedConnections","queryInput","setQueryInput","deleteConfirm","setDeleteConfirm","initialLoading","setInitialLoading","writeOperation","getWriteOperation","useEffect","handleCreateSchema","InteractionType","Reversibility","handleSuggestJoins","runExecuteQuery","rows","columns","k","OutputType","handleExecuteQuery","handleDeleteRequest","handleDeleteSchemaConfirm","schemaName","toggleConnection","connId","prev","id","jsxs","Box","jsx","JoinIcon","Typography","CircularProgress","Button","AddIcon","Alert","AiUsageNotice","Grid","Paper","List","ListItem","Tooltip","IconButton","e","DeleteIcon","ListItemIcon","DatabaseIcon","ListItemText","AIIcon","idx","Chip","suggestion","Card","CardContent","LinkIcon","theme","alpha","neutral","Divider","TextField","RunIcon","Dialog","DialogTitle","DialogContent","DialogActions","ConfirmModal","SchemaBuilderPageContainer"],"mappings":"iwBAIA,MAAMA,EAAwBC,GAC5B,MAAM,QAAQA,CAAW,EAAIA,EAAc,CAAA,EAE9B,SAASC,IAAqB,CAC3C,MAAMD,EAAcE,EAAaC,GAAMA,EAAE,gBAAgB,EACnDC,EAAsBF,EAAaC,GAAMA,EAAE,mBAAmB,EAC9DE,EAAwBH,EAAaC,GAAMA,EAAE,qBAAqB,EAClEG,EAAwBJ,EAAaC,GAAMA,EAAE,qBAAqB,EAElE,CAACI,EAASC,CAAU,EAAIC,EAAAA,SAAS,EAAK,EACtC,CAACC,EAAOC,CAAQ,EAAIF,EAAAA,SAAS,IAAI,EAEjCG,EAAwBC,EAAAA,QAC5B,IAAMd,EAAqBC,CAAW,EACtC,CAACA,CAAW,CAChB,EAEQc,EAAiBC,cAAaC,GAAS,CAC3C,MAAMC,EAAW,OAAOD,GAAS,WAAaA,EAAKhB,CAAW,EAAIgB,EAClEZ,EAAoBL,EAAqBkB,CAAQ,CAAC,CACpD,EAAG,CAACjB,EAAaI,CAAmB,CAAC,EAE/Bc,EAAmBH,EAAAA,YAAY,SAAY,CAC/CP,EAAW,EAAI,EACfG,EAAS,IAAI,EACb,GAAI,CACF,MAAMQ,EAAO,MAAMC,GAAc,EAC3BJ,EAAOjB,EAAqBoB,GAAM,WAAW,EACnD,OAAAf,EAAoBY,CAAI,EACxBR,EAAW,EAAK,EACTQ,CACT,OAASK,EAAK,CACZ,OAAAV,EAASU,EAAI,SAAW,4BAA4B,EACpDb,EAAW,EAAK,EACT,CAAA,CACT,CACF,EAAG,CAACJ,CAAmB,CAAC,EAElBkB,EAAcP,cAAY,MAAOQ,GAAiB,CACtD,GAAI,CACF,MAAMC,EAAS,MAAMC,GAAsBF,CAAY,EACvD,OAAAlB,EAAsBkB,EAAc,CAClC,cAAeC,EAAO,WACtB,OAAQ,WAChB,CAAO,EACMA,CACT,OAASH,EAAK,CACZ,MAAAhB,EAAsBkB,EAAc,CAAE,OAAQ,OAAO,CAAE,EACjDF,CACR,CACF,EAAG,CAAChB,CAAqB,CAAC,EAEpBqB,EAAmBX,cAAY,MAAOQ,GAAiB,CAC3Df,EAAW,EAAI,EACfG,EAAS,IAAI,EACb,GAAI,CACF,aAAMgB,GAAiBJ,CAAY,EACnCjB,EAAsBiB,CAAY,EAClCf,EAAW,EAAK,EACT,EACT,OAASa,EAAK,CACZ,OAAAV,EAASU,EAAI,SAAW,6BAA6B,EACrDb,EAAW,EAAK,EACT,EACT,CACF,EAAG,CAACF,CAAqB,CAAC,EAEpBsB,EAAgBb,EAAAA,YACnBQ,GACCX,EAAsB,KAAMiB,GAASA,EAAK,KAAON,CAAY,GAAK,KACpE,CAACX,CAAqB,CAC1B,EAEQkB,EAAQf,EAAAA,YAAY,IAAM,CAC9BX,EAAoB,CAAA,CAAE,EACtBO,EAAS,IAAI,CACf,EAAG,CAACP,CAAmB,CAAC,EAExB,OAAOS,EAAAA,QAAQ,KAAO,CACpB,YAAaD,EACb,QAAAL,EACA,MAAAG,EACA,eAAAI,EACA,WAAAN,EACA,SAAAG,EACA,iBAAAO,EACA,YAAAI,EACA,iBAAAI,EACA,cAAAE,EACA,MAAAE,CACJ,GAAM,CACFlB,EACAL,EACAG,EACAI,EACAN,EACAG,EACAO,EACAI,EACAI,EACAE,EACAE,CACJ,CAAG,CACH,CCtGA,SAASC,GAAQC,EAASC,EAAO,GAAI,CACnC,GAAI,MAAM,QAAQD,CAAO,EAAG,OAAOA,EACnC,GAAI,CAACA,GAAW,OAAOA,GAAY,SAAU,MAAO,CAAA,EACpD,UAAWE,KAAOD,EAChB,GAAI,MAAM,QAAQD,EAAQE,CAAG,CAAC,EAAG,OAAOF,EAAQE,CAAG,EAErD,MAAO,CAAA,CACT,CAKO,eAAeC,GAAoB,CAAE,KAAAC,EAAM,cAAAC,EAAe,YAAAC,CAAW,EAAI,CAM9E,OALiB,MAAMC,EAAU,KAAK,sBAAuB,CAC3D,KAAAH,EACA,eAAgBC,EAChB,YAAAC,CACJ,CAAG,GACe,IAClB,CAKO,eAAeE,GAAmB,CAAE,MAAAC,EAAO,OAAAC,CAAM,EAAK,CAAA,EAAI,CAC/D,MAAMC,EAAS,CAAA,EACXF,GAAS,OAAME,EAAO,MAAQF,GAC9BC,GAAU,OAAMC,EAAO,OAASD,GAEpC,MAAMV,GADW,MAAMO,EAAU,IAAI,sBAAuB,CAAE,OAAAI,EAAQ,GAC7C,KACzB,GAAI,MAAM,QAAQX,CAAO,EACvB,MAAO,CAAE,QAASA,EAAS,MAAOA,EAAQ,MAAM,EAElD,GAAIA,GAAW,OAAOA,GAAY,SAAU,CAC1C,MAAMY,EAAUb,GAAQC,EAAS,CAAC,UAAW,QAAS,SAAS,CAAC,EAChE,MAAO,CAAE,GAAGA,EAAS,QAAAY,EAAS,MAAOZ,EAAQ,OAASY,EAAQ,MAAM,CACtE,CACA,MAAO,CAAE,QAAS,GAAI,MAAO,CAAC,CAChC,CAKO,eAAeC,GAAiBC,EAAU,CAE/C,MAAMd,GADW,MAAMO,EAAU,IAAI,uBAAuBO,CAAQ,EAAE,GAC7C,KACzB,OAAId,GAAW,OAAOA,GAAY,UAAYA,EAAQ,OAC7CA,EAELA,GAAW,OAAOA,GAAY,SACzB,CAAE,OAAQ,KAAM,OAAQA,CAAO,EAEjC,CAAE,OAAQ,KAAM,OAAQ,IAAI,CACrC,CAKO,eAAee,GAAaV,EAAe,CAIhD,MAAML,GAHW,MAAMO,EAAU,KAAK,4BAA6B,CACjE,eAAgBF,CACpB,CAAG,GACwB,KACzB,OAAI,MAAM,QAAQL,CAAO,EAChB,CAAE,YAAaA,CAAO,EAE3BA,GAAW,OAAOA,GAAY,SACzB,CAAE,GAAGA,EAAS,YAAaD,GAAQC,EAAS,CAAC,cAAe,OAAO,CAAC,CAAC,EAEvE,CAAE,YAAa,EAAE,CAC1B,CAKO,eAAegB,GAAsB,CAAE,SAAAF,EAAU,MAAAG,EAAO,MAAAR,EAAQ,GAAG,EAAI,CAM5E,MAAMT,GALW,MAAMO,EAAU,KAAK,oBAAqB,CACzD,kBAAmBO,EACnB,IAAKG,EACL,MAAAR,CACJ,CAAG,GACwB,KACzB,OAAIT,GAAW,OAAOA,GAAY,UAAY,OAAO,UAAU,eAAe,KAAKA,EAAS,QAAQ,EAC3FA,EAEF,CAAE,OAAQ,KAAM,OAAQA,CAAO,CACxC,CAKO,eAAekB,GAAoBJ,EAAU,CAElD,OADiB,MAAMP,EAAU,OAAO,uBAAuBO,CAAQ,EAAE,GACzD,IAClB,CC7FA,MAAMK,GAAqBC,GAAO,CAACC,EAAKC,KAAS,CAE/C,QAAS,CAAA,EACT,cAAe,KACf,gBAAiB,CAAA,EACjB,YAAa,KACb,QAAS,GACT,MAAO,KAGP,WAAa/C,GAAY8C,EAAI,CAAE,QAAA9C,CAAO,CAAE,EACxC,SAAWG,GAAU2C,EAAI,CAAE,MAAA3C,CAAK,CAAE,EAGlC,aAAc,SAAY,CACxB2C,EAAI,CAAE,QAAS,GAAM,MAAO,IAAI,CAAE,EAClC,GAAI,CACF,MAAME,EAAW,MAAMC,GAAgC,EACvDH,EAAI,CAAE,QAASE,EAAS,SAAW,GAAI,QAAS,GAAO,CACzD,OAASlC,EAAK,CACZgC,EAAI,CAAE,MAAOhC,EAAI,QAAS,QAAS,GAAO,CAC5C,CACF,EAGA,aAAc,MAAOF,GAAS,CAC5BkC,EAAI,CAAE,QAAS,GAAM,MAAO,IAAI,CAAE,EAClC,GAAI,CAEF,MAAMI,GADW,MAAMC,GAAkCvC,CAAI,GACrC,OACxB,OAAAkC,EAAKM,IAAW,CACd,QAAS,CAAC,GAAGA,EAAM,QAASF,CAAM,EAAE,MAAM,EAAG,GAAG,EAChD,cAAeA,EACf,QAAS,EACjB,EAAQ,EACKA,CACT,OAASpC,EAAK,CACZ,OAAAgC,EAAI,CAAE,MAAOhC,EAAI,QAAS,QAAS,GAAO,EACnC,IACT,CACF,EAGA,aAAc,MAAOyB,GAAa,CAChCO,EAAI,CAAE,QAAS,GAAM,MAAO,IAAI,CAAE,EAClC,GAAI,CACF,aAAMO,GAAkCd,CAAQ,EAChDO,EAAKM,IAAW,CACd,QAASA,EAAM,QAAQ,OAAQxD,GAAMA,EAAE,KAAO2C,CAAQ,EACtD,cAAea,EAAM,eAAe,KAAOb,EAAW,KAAOa,EAAM,cACnE,QAAS,EACjB,EAAQ,EACK,EACT,OAAStC,EAAK,CACZ,OAAAgC,EAAI,CAAE,MAAOhC,EAAI,QAAS,QAAS,GAAO,EACnC,EACT,CACF,EAGA,aAAc,SAAY,CACxB,KAAM,CAAE,cAAAwC,CAAa,EAAKP,EAAG,EAC7B,GAAI,CAACO,GAAe,aAAeA,EAAc,YAAY,OAAS,EACpE,OAAAR,EAAI,CAAE,MAAO,+CAAgD,QAAS,EAAK,CAAE,EACtE,CAAA,EAETA,EAAI,CAAE,QAAS,GAAM,MAAO,IAAI,CAAE,EAClC,GAAI,CACF,MAAME,EAAW,MAAMO,GAA2BD,EAAc,WAAW,EAC3E,OAAAR,EAAI,CAAE,gBAAiBE,EAAS,aAAe,GAAI,QAAS,GAAO,EAC5DA,EAAS,WAClB,OAASlC,EAAK,CACZ,OAAAgC,EAAI,CAAE,MAAOhC,EAAI,QAAS,QAAS,GAAO,EACnC,CAAA,CACT,CACF,EAGA,aAAc,MAAOyB,EAAUG,IAAU,CACvCI,EAAI,CAAE,QAAS,GAAM,MAAO,KAAM,YAAa,KAAM,EACrD,GAAI,CACF,MAAME,EAAW,MAAMQ,GAAoC,CAAE,SAAAjB,EAAU,MAAAG,CAAK,CAAE,EAC9E,OAAAI,EAAI,CAAE,YAAaE,EAAS,OAAQ,QAAS,GAAO,EAC7CA,EAAS,MAClB,OAASlC,EAAK,CACZ,OAAAgC,EAAI,CAAE,MAAOhC,EAAI,QAAS,QAAS,GAAO,EACnC,IACT,CACF,EAGA,UAAW,MAAOyB,GAAa,CAC7BO,EAAI,CAAE,QAAS,GAAM,MAAO,IAAI,CAAE,EAClC,GAAI,CACF,MAAME,EAAW,MAAMS,GAA+BlB,CAAQ,EAC9D,OAAAO,EAAI,CAAE,cAAeE,EAAS,QAAUA,EAAU,QAAS,GAAO,EAC3DA,CACT,OAASlC,EAAK,CACZ,OAAAgC,EAAI,CAAE,MAAOhC,EAAI,QAAS,QAAS,GAAO,EACnC,IACT,CACF,EAGA,iBAAmBoC,GAAWJ,EAAI,CAAE,cAAeI,EAAQ,gBAAiB,CAAA,EAAI,YAAa,KAAM,EAGnG,MAAO,IAAMJ,EAAI,CACf,cAAe,KACf,gBAAiB,CAAA,EACjB,YAAa,KACb,MAAO,IACX,CAAG,CACH,EAAE,ECjEF,SAAwBY,IAAoB,CAC1C,KAAM,CACJ,QAAArB,EACA,cAAAiB,EACA,gBAAAK,EACA,YAAAC,EACA,QAAA5D,EACA,MAAAG,EACA,aAAA0D,EACA,aAAAC,EACA,aAAAC,EACA,aAAAvB,EACA,aAAAwB,EACA,iBAAAC,EACA,MAAA1C,CAAA,EACEqB,GAAA,EAEE,CAAE,YAAAnD,EAAa,iBAAAkB,CAAA,EAAqBjB,GAAA,EACpCwE,EAAoBC,GAAmB,qBAAqB,EAC5D,CAAE,QAAAC,CAAA,EAAYC,GAAA,EACd,CAAE,eAAAC,CAAA,EAAmBC,GAAoBC,GAAW,UAAU,EAE9D,CAACC,GAAkBC,CAAmB,EAAIxE,EAAAA,SAAS,EAAK,EACxD,CAACyE,EAAeC,CAAgB,EAAI1E,EAAAA,SAAS,EAAE,EAC/C,CAAC2E,EAAsBC,CAAuB,EAAI5E,EAAAA,SAAS,EAAE,EAC7D,CAAC6E,EAAqBC,CAAsB,EAAI9E,EAAAA,SAAS,CAAA,CAAE,EAC3D,CAAC+E,EAAYC,EAAa,EAAIhF,EAAAA,SAAS,EAAE,EACzC,CAACiF,EAAeC,CAAgB,EAAIlF,EAAAA,SAAS,CAAE,KAAM,GAAO,SAAU,KAAM,WAAY,EAAA,CAAI,EAE5F,CAACmF,GAAgBC,CAAiB,EAAIpF,EAAAA,SAAS,EAAI,EACnDqF,EAAiBC,GAAkBP,CAAU,EAEnDQ,EAAAA,UAAU,MACK,UACXH,EAAkB,EAAI,EACtB,MAAM,QAAQ,IAAI,CAACzB,IAAgBlD,EAAA,CAAkB,CAAC,EACtD2E,EAAkB,EAAK,MAGlB,IAAM/D,EAAA,GACZ,CAACsC,EAAclD,EAAkBY,CAAK,CAAC,EAE1C,MAAMmE,GAAqB,SAAY,CACjC,CAACf,GAAiBI,EAAoB,OAAS,GACnD,MAAMX,EAAQ,CACZ,KAAMuB,EAAgB,OACtB,MAAO,2BACP,cAAeC,EAAc,eAC7B,qBAAsB,GACtB,mBAAoB,GACpB,OAAQ,CACN,cAAeb,EACf,OAAQ,0BAAA,EAEV,OAAQ,SAAY,CAClB,MAAM9D,EAAS,MAAM6C,EAAa,CAChC,KAAMa,EACN,cAAeI,EACf,YAAaF,CAAA,CACd,EACD,GAAI,CAAC5D,EACH,MAAM,IAAI,MAAM,sBAAsB,EAExC,OAAAyD,EAAoB,EAAK,EACzBE,EAAiB,EAAE,EACnBE,EAAwB,EAAE,EAC1BE,EAAuB,CAAA,CAAE,EAClB/D,CACT,CAAA,CACD,CACH,EAEM4E,GAAqB,SAAY,CAChCvC,GACL,MAAMc,EAAQ,CACZ,KAAMuB,EAAgB,SACtB,MAAO,gBACP,cAAeC,EAAc,eAC7B,qBAAsB,GACtB,mBAAoB,GACpB,OAAQ,CACN,SAAUtC,EAAc,GACxB,OAAQ,eAAA,EAEV,OAAQ,SAAY,CAClB,MAAMrC,EAAS,MAAMuB,EAAA,EACrB,GAAI,CAACvB,EACH,MAAM,IAAI,MAAM,sBAAsB,EAExC,OAAOA,CACT,CAAA,CACD,CACH,EAEM6E,EAAkBtF,EAAAA,YAAY,SAAY,CAC1C,CAAC8C,GAAiB,CAAC2B,EAAW,QAClC,MAAMb,EAAQ,CACZ,KAAMuB,EAAgB,QACtB,MAAO,sBACP,cAAeJ,EAAiBK,EAAc,aAAeA,EAAc,iBAC3E,qBAAsB,GACtB,mBAAoB,GACpB,OAAQ,CACN,SAAUtC,EAAc,GACxB,OAAQ,2BACR,eAAAiC,CAAA,EAEF,OAAQ,SAAY,CAClB,MAAMtE,EAAS,MAAM+C,EAAaV,EAAc,GAAI2B,CAAU,EAC9D,GAAI,CAAChE,EACH,MAAM,IAAI,MAAM,wBAAwB,EAG1C,MAAM8E,EAAO9E,EAAO,MAAQ,CAAA,EACtB+E,EAAUD,EAAK,OAAS,EAAI,OAAO,KAAKA,EAAK,CAAC,CAAC,EAAE,IAAKE,KAAO,CAAE,KAAMA,EAAA,EAAI,EAAI,CAAA,EACnF,OAAA3B,EAAe,CACb,KAAM4B,GAAW,MACjB,MAAO,eAAe5C,EAAc,MAAQ,OAAO,KAAKyC,EAAK,MAAM,SACnE,QAASd,EAAW,MAAM,EAAG,GAAG,EAChC,KAAM,CAAE,QAAAe,EAAS,KAAAD,CAAA,EACjB,OAAQ,OAAA,CACT,EACM9E,CACT,CAAA,CACD,CACH,EAAG,CAACqC,EAAeU,EAAciB,EAAYb,EAASmB,EAAgBjB,CAAc,CAAC,EAE/E6B,GAAqB3F,EAAAA,YAAY,SAAY,CACjD,GAAI,GAAC8C,GAAiB,CAAC2B,EAAW,QAClC,IAAIM,EAAgB,CAClBrB,EAAkBZ,EAAc,MAAQA,EAAc,IAAM,kBAAmBwC,CAAe,EAC9F,MACF,CACA,MAAMA,EAAA,EACR,EAAG,CAAC5B,EAAmBZ,EAAe2B,EAAYa,EAAiBP,CAAc,CAAC,EAE5Ea,GAAsB5F,cAAa0C,GAAW,CAClDkC,EAAiB,CACf,KAAM,GACN,SAAUlC,GAAQ,IAAM,KACxB,WAAYA,GAAQ,MAAQ,aAAA,CAC7B,CACH,EAAG,CAAA,CAAE,EAECmD,GAA4B,SAAY,CAC5C,MAAM9D,EAAW4C,EAAc,SACzBmB,EAAanB,EAAc,WACjCC,EAAiB,CAAE,KAAM,GAAO,SAAU,KAAM,WAAY,GAAI,EAC3D7C,GACL,MAAM6B,EAAQ,CACZ,KAAMuB,EAAgB,OACtB,MAAO,2BACP,cAAeC,EAAc,eAC7B,qBAAsB,GACtB,mBAAoB,GACpB,OAAQ,CACN,SAAArD,EACA,WAAA+D,EACA,OAAQ,0BAAA,EAEV,OAAQ,SAAY,CAClB,MAAMrF,EAAS,MAAM8C,EAAaxB,CAAQ,EAC1C,GAAI,CAACtB,EACH,MAAM,IAAI,MAAM,sBAAsB,EAExC,OAAOA,CACT,CAAA,CACD,CACH,EAEMsF,GAAoBC,GAAW,CACnCxB,EAAuByB,GACrBA,EAAK,SAASD,CAAM,EAChBC,EAAK,OAAOC,GAAMA,IAAOF,CAAM,EAC/B,CAAC,GAAGC,EAAMD,CAAM,CAAA,CAExB,EAGA,OAAInB,GAEAsB,OAACC,EAAA,CAAI,GAAI,CAAE,EAAG,EAAG,SAAU,KAAM,GAAI,MAAA,EACnC,SAAA,CAAAD,EAAAA,KAACC,EAAA,CAAI,GAAI,CAAE,QAAS,OAAQ,WAAY,SAAU,IAAK,EAAG,GAAI,CAAA,EAC5D,SAAA,CAAAC,EAAAA,IAACC,EAAA,EAAS,EACVD,EAAAA,IAACE,EAAA,CAAW,QAAQ,KAAK,SAAA,2BAAA,CAAyB,CAAA,EACpD,EACAF,EAAAA,IAACD,EAAA,CAAI,GAAI,CAAE,QAAS,OAAQ,eAAgB,SAAU,WAAY,SAAU,OAAQ,GAAA,EAClF,SAAAC,MAACG,IAAiB,CAAA,CACpB,CAAA,EACF,EAKFL,OAACC,EAAA,CAAI,GAAI,CAAE,EAAG,EAAG,SAAU,KAAM,GAAI,MAAA,EACnC,SAAA,CAAAD,EAAAA,KAACC,EAAA,CAAI,GAAI,CAAE,QAAS,OAAQ,eAAgB,gBAAiB,WAAY,SAAU,GAAI,CAAA,EACrF,SAAA,CAAAD,OAACC,EAAA,CACC,SAAA,CAAAD,EAAAA,KAACI,EAAA,CAAW,QAAQ,KAAK,GAAI,CAAE,QAAS,OAAQ,WAAY,SAAU,IAAK,CAAA,EACzE,SAAA,CAAAF,EAAAA,IAACC,EAAA,EAAS,EAAE,4BAAA,EACd,QACCC,EAAA,CAAW,QAAQ,QAAQ,MAAM,iBAAiB,SAAA,2DAAA,CAEnD,CAAA,EACF,EACAF,EAAAA,IAACI,EAAA,CACC,QAAQ,YACR,gBAAYC,GAAA,EAAQ,EACpB,QAAS,IAAMxC,EAAoB,EAAI,EACxC,SAAA,oBAAA,CAAA,CAED,EACF,EAECvE,GACC0G,EAAAA,IAACM,EAAA,CAAM,SAAS,QAAQ,GAAI,CAAE,GAAI,CAAA,EAAK,QAAS,IAAM5F,EAAA,EACnD,SAAApB,EACH,EAGF0G,EAAAA,IAACO,GAAA,CACC,MAAM,sBACN,YAAY,qGACZ,MAAO,CACL,CAAE,MAAO,2BAA4B,QAAS,UAAA,EAC9C,CAAE,MAAO,sCAAuC,QAAS,UAAA,EACzD,CAAE,MAAO,wBAAyB,QAAS,UAAA,CAAW,EAExD,MAAK,GACL,GAAI,CAAE,GAAI,CAAA,CAAE,CAAA,EAGdT,EAAAA,KAACU,EAAA,CAAK,UAAS,GAAC,QAAS,EAEvB,SAAA,CAAAR,EAAAA,IAACQ,EAAA,CAAK,KAAM,CAAE,GAAI,GAAI,GAAI,CAAA,EACxB,SAAAV,EAAAA,KAACW,EAAA,CAAM,GAAI,CAAE,EAAG,GACd,SAAA,CAAAT,MAACE,EAAA,CAAW,QAAQ,KAAK,aAAY,GAAC,SAAA,kBAEtC,EACC1E,EAAQ,SAAW,EAClBwE,EAAAA,IAACE,GAAW,MAAM,iBAAiB,GAAI,CAAE,GAAI,EAAG,UAAW,QAAA,EAAY,SAAA,oDAAA,CAEvE,QAECQ,GAAA,CACE,SAAAlF,EAAQ,IAAKa,GACZyD,EAAAA,KAACa,GAAA,CAEC,OAAM,GACN,SAAUlE,GAAe,KAAOJ,EAAO,GACvC,QAAS,IAAMe,EAAiBf,CAAM,EACtC,gBACE2D,EAAAA,IAACY,GAAA,CAAQ,MAAM,gBACb,SAAAZ,EAAAA,IAACa,GAAA,CACC,KAAK,MACL,aAAY,UAAUxE,EAAO,IAAI,GACjC,QAAUyE,GAAM,CACdA,EAAE,gBAAA,EACFvB,GAAoBlD,CAAM,CAC5B,EAEA,eAAC0E,GAAA,CAAA,CAAW,CAAA,CAAA,EAEhB,EAGF,SAAA,CAAAf,EAAAA,IAACgB,GAAA,CACC,SAAAhB,EAAAA,IAACiB,EAAA,CAAA,CAAa,EAChB,EACAjB,EAAAA,IAACkB,GAAA,CACC,QAAS7E,EAAO,KAChB,UAAW,GAAGA,EAAO,aAAa,QAAU,CAAC,YAAA,CAAA,CAC/C,CAAA,EAzBKA,EAAO,EAAA,CA2Bf,CAAA,CACH,CAAA,CAAA,CAEJ,CAAA,CACF,QAGCmE,EAAA,CAAK,KAAM,CAAE,GAAI,GAAI,GAAI,CAAA,EACvB,SAAA/D,SACEgE,EAAA,CAAM,GAAI,CAAE,EAAG,GACd,SAAA,CAAAX,EAAAA,KAACC,EAAA,CAAI,GAAI,CAAE,QAAS,OAAQ,eAAgB,gBAAiB,WAAY,SAAU,GAAI,CAAA,EACrF,SAAA,CAAAC,EAAAA,IAACE,EAAA,CAAW,QAAQ,KAAM,SAAAzD,EAAc,KAAK,EAC7CuD,EAAAA,IAACI,EAAA,CACC,QAAQ,WACR,UAAWjH,EAAU6G,MAACG,EAAA,CAAiB,KAAM,EAAA,CAAI,QAAMgB,GAAA,EAAO,EAC9D,QAASnC,GACT,SAAU7F,EACX,SAAA,qBAAA,CAAA,CAED,EACF,EAECsD,EAAc,aACbuD,EAAAA,IAACE,EAAA,CAAW,MAAM,iBAAiB,GAAI,CAAE,GAAI,CAAA,EAC1C,SAAAzD,EAAc,WAAA,CACjB,EAGFuD,MAACD,GAAI,GAAI,CAAE,QAAS,OAAQ,IAAK,EAAG,GAAI,EAAG,SAAU,MAAA,EACjD,YAAc,aAAe,CAAA,GAAI,IAAI,CAACtF,EAAM2G,IAC5CpB,EAAAA,IAACqB,EAAA,CAEC,WAAOJ,EAAA,EAAa,EACpB,MAAOxG,EAAK,MAAQA,EACpB,QAAQ,UAAA,EAHH2G,CAAA,CAKR,EACH,EAGCtE,EAAgB,OAAS,GACxBgD,EAAAA,KAACC,GAAI,GAAI,CAAE,GAAI,CAAA,EACb,SAAA,CAAAC,MAACE,EAAA,CAAW,QAAQ,YAAY,aAAY,GAAC,SAAA,kBAE7C,EACAF,EAAAA,IAACQ,EAAA,CAAK,UAAS,GAAC,QAAS,EACtB,SAAA1D,EAAgB,IAAI,CAACwE,EAAYF,IAChCpB,EAAAA,IAACQ,GAAK,KAAM,CAAE,GAAI,GAAI,GAAI,CAAA,EACxB,SAAAR,EAAAA,IAACuB,GAAA,CAAK,QAAQ,WACZ,SAAAzB,EAAAA,KAAC0B,GAAA,CAAY,GAAI,CAAE,GAAI,KACrB,SAAA,CAAA1B,EAAAA,KAACC,EAAA,CAAI,GAAI,CAAE,QAAS,OAAQ,WAAY,SAAU,IAAK,EAAG,GAAI,CAAA,EAC5D,SAAA,CAAAC,EAAAA,IAACyB,GAAA,CAAS,GAAI,CAAE,MAAO,kBAAoB,EAC3C3B,EAAAA,KAACI,EAAA,CAAW,QAAQ,YACjB,SAAA,CAAAoB,EAAW,WAAW,MAAIA,EAAW,WAAA,CAAA,CACxC,CAAA,EACF,EACAxB,EAAAA,KAACI,EAAA,CAAW,QAAQ,QAAQ,MAAM,iBAC/B,SAAA,CAAAoB,EAAW,YAAY,MAAIA,EAAW,YAAA,EACzC,EACCA,EAAW,QACVtB,MAACE,EAAA,CAAW,QAAQ,UAAU,MAAM,iBAAiB,QAAQ,QAAQ,GAAI,CAAE,GAAI,EAAA,EAC5E,WAAW,OACd,EAEFF,EAAAA,IAACqB,EAAA,CACC,KAAK,QACL,MAAO,GAAG,KAAK,OAAOC,EAAW,YAAc,GAAK,GAAG,CAAC,eACxD,GAAI,CAAE,GAAI,EAAG,QAAUI,GAAUA,EAAM,QAAQ,OAAS,OAASC,EAAMD,EAAM,QAAQ,KAAK,QAAS,EAAG,EAAIE,EAAQ,GAAG,EAAG,MAAO,gBAAA,CAAiB,CAAA,CAClJ,CAAA,CACF,CAAA,CACF,GAvBkCR,CAwBpC,CACD,CAAA,CACH,CAAA,EACF,QAGDS,GAAA,CAAQ,GAAI,CAAE,GAAI,GAAK,QAGvB3B,EAAA,CAAW,QAAQ,YAAY,aAAY,GAAC,SAAA,kBAE7C,EACAF,EAAAA,IAAC8B,EAAA,CACC,UAAS,GACT,UAAS,GACT,KAAM,EACN,YAAY,kEACZ,MAAO1D,EACP,SAAW0C,GAAMzC,GAAcyC,EAAE,OAAO,KAAK,EAC7C,GAAI,CAAE,GAAI,EAAG,WAAY,WAAA,CAAY,CAAA,EAEvChB,EAAAA,KAACC,EAAA,CAAI,GAAI,CAAE,QAAS,OAAQ,SAAU,OAAQ,IAAK,EAAG,GAAI,CAAA,EACxD,SAAA,CAAAC,EAAAA,IAACqB,EAAA,CACC,KAAK,QACL,MAAM,wBACN,QAAQ,WACR,GAAI,CAAE,SAAU,MAAA,CAAO,CAAA,EAExB3C,GACCsB,EAAAA,IAACqB,EAAA,CACC,KAAK,QACL,MAAO,GAAG3C,EAAe,YAAA,CAAa,YACtC,GAAI,CAAE,SAAU,OAAQ,QAAUgD,GAAUA,EAAM,QAAQ,OAAS,OAASC,EAAMD,EAAM,QAAQ,KAAK,QAAS,EAAG,EAAIE,EAAQ,GAAG,EAAG,MAAO,gBAAA,CAAiB,CAAA,CAC7J,EAEJ,EACA5B,EAAAA,IAACI,EAAA,CACC,QAAQ,YACR,UAAWjH,EAAU6G,MAACG,EAAA,CAAiB,KAAM,EAAA,CAAI,QAAM4B,GAAA,EAAQ,EAC/D,QAASzC,GACT,SAAU,CAAClB,EAAW,KAAA,GAAUjF,EACjC,SAAA,eAAA,CAAA,EAGAuF,GACCsB,EAAAA,IAACM,EAAA,CAAM,SAAS,UAAU,GAAI,CAAE,GAAI,CAAA,EAAK,SAAA,yGAAA,CAEzC,EAIDvD,GACC+C,EAAAA,KAACC,EAAA,CAAI,GAAI,CAAE,GAAI,GACb,SAAA,CAAAD,EAAAA,KAACI,EAAA,CAAW,QAAQ,YAAY,aAAY,GAAC,SAAA,CAAA,YACjCnD,EAAY,MAAM,QAAU,EAAE,QAAA,EAC1C,EACAiD,EAAAA,IAACD,GAAI,GAAI,CAAE,UAAW,MAAA,EACpB,SAAAC,EAAAA,IAAC,MAAA,CAAI,MAAO,CAAE,SAAU,GAAI,OAAQ,GACjC,SAAA,KAAK,UAAUjD,EAAa,KAAM,CAAC,CAAA,CACtC,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAAA,CAEJ,SAEC0D,EAAA,CAAM,GAAI,CAAE,EAAG,EAAG,UAAW,QAAA,EAC5B,SAAA,CAAAT,EAAAA,IAACiB,EAAA,CAAa,GAAI,CAAE,SAAU,GAAI,MAAO,iBAAkB,GAAI,CAAA,CAAE,CAAG,EACpEjB,EAAAA,IAACE,EAAA,CAAW,MAAM,iBAAiB,SAAA,4DAAA,CAEnC,CAAA,CAAA,CACF,CAAA,CAEJ,CAAA,EACF,EAGAJ,EAAAA,KAACkC,GAAA,CAAO,KAAMpE,GAAkB,QAAS,IAAMC,EAAoB,EAAK,EAAG,SAAS,KAAK,UAAS,GAChG,SAAA,CAAAmC,EAAAA,IAACiC,IAAY,SAAA,uBAAA,CAAqB,SACjCC,GAAA,CACC,SAAA,CAAAlC,EAAAA,IAAC8B,EAAA,CACC,UAAS,GACT,MAAM,cACN,MAAOhE,EACP,SAAWgD,GAAM/C,EAAiB+C,EAAE,OAAO,KAAK,EAChD,GAAI,CAAE,GAAI,EAAG,GAAI,CAAA,CAAE,CAAA,EAErBd,EAAAA,IAAC8B,EAAA,CACC,UAAS,GACT,MAAM,cACN,MAAO9D,EACP,SAAW8C,GAAM7C,EAAwB6C,EAAE,OAAO,KAAK,EACvD,UAAS,GACT,KAAM,EACN,GAAI,CAAE,GAAI,CAAA,CAAE,CAAA,QAEbZ,EAAA,CAAW,QAAQ,YAAY,aAAY,GAAC,SAAA,+BAE7C,EACAF,EAAAA,IAACD,EAAA,CAAI,GAAI,CAAE,QAAS,OAAQ,cAAe,SAAU,IAAK,CAAA,EACvD,SAAAnH,EAAY,IAAK6B,GAChBuF,EAAAA,IAACuB,GAAA,CAEC,QAAQ,WACR,GAAI,CACF,OAAQ,UACR,YAAarD,EAAoB,SAASzD,EAAK,EAAE,EAAI,iBAAmB,UACxE,QAASyD,EAAoB,SAASzD,EAAK,EAAE,EAAI,kBAAoB,kBAAA,EAEvE,QAAS,IAAMiF,GAAiBjF,EAAK,EAAE,EAEvC,SAAAuF,EAAAA,IAACwB,IAAY,GAAI,CAAE,GAAI,EAAG,eAAgB,CAAE,GAAI,CAAA,CAAE,EAChD,SAAA1B,EAAAA,KAACC,EAAA,CAAI,GAAI,CAAE,QAAS,OAAQ,WAAY,SAAU,eAAgB,eAAA,EAChE,SAAA,CAAAD,EAAAA,KAACC,EAAA,CAAI,GAAI,CAAE,QAAS,OAAQ,WAAY,SAAU,IAAK,CAAA,EACrD,SAAA,CAAAC,EAAAA,IAACiB,EAAA,EAAa,EACdjB,EAAAA,IAACE,EAAA,CAAY,SAAAzF,EAAK,IAAA,CAAK,CAAA,EACzB,EACCyD,EAAoB,SAASzD,EAAK,EAAE,GACnCuF,EAAAA,IAACqB,EAAA,CAAK,MAAM,WAAW,KAAK,QAAQ,GAAI,CAAE,QAAUK,GAAUA,EAAM,QAAQ,OAAS,OAASC,EAAMD,EAAM,QAAQ,KAAK,QAAS,EAAG,EAAIE,EAAQ,GAAG,EAAG,MAAO,iBAAiB,CAAG,CAAA,CAAA,CAEpL,CAAA,CACF,CAAA,EAnBKnH,EAAK,EAAA,CAqBb,CAAA,CACH,CAAA,EACF,SACC0H,GAAA,CACC,SAAA,CAAAnC,MAACI,GAAO,QAAS,IAAMvC,EAAoB,EAAK,EAAG,SAAA,SAAM,EACzDmC,EAAAA,IAACI,EAAA,CACC,QAAQ,YACR,QAASvB,GACT,SAAU,CAACf,GAAiBI,EAAoB,OAAS,EAC1D,SAAA,QAAA,CAAA,CAED,CAAA,CACF,CAAA,EACF,EAEA8B,EAAAA,IAACoC,GAAA,CACC,KAAM9D,EAAc,KACpB,QAAS,IAAMC,EAAiB,CAAE,KAAM,GAAO,SAAU,KAAM,WAAY,GAAI,EAC/E,UAAWiB,GACX,MAAM,wBACN,QAAS,WAAWlB,EAAc,UAAU,mEAC5C,aAAa,SACb,SAAS,OAAA,CAAA,CACX,EACF,CAEJ,CC/hBA,SAAwBzB,IAAoB,CAC1C,OAAAW,GAAA,QACQ6E,GAAA,EAA2B,CACrC"}